{
  "hash": "0108a6dadf8bdc2b287b066fc226c321",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Distribution of significant effects\"\nformat: html\nexecute:\n  echo: false\n---\n\n::: {.cell}\n\n:::\n\n```{ojs}\nmath = require(\"mathjs\")\nnorm = import('https://unpkg.com/norm-dist@3.1.0/index.js?module')\n\nquad_points = JSON.parse(all_quad_points).at(qp - 1)\n\nsigma = 2 / math.sqrt(ESS)\n\nzeta_sd = math.sqrt(tau**2 + rho * sigma**2)\n\ncrit = norm.icdf(1 - alpha)\n\nbinomial_coefs = Array(m+1).fill(null).map((x,index) => {\n  return math.combinations(m, index);\n})\n\nprobs = quad_points.map(zeta => {\n  let Z = (zeta[0] * zeta_sd + mu - crit * sigma) / math.sqrt(omega**2 + (1 - rho) * sigma**2);\n  return [norm.cdf(Z), zeta[1]];\n})\n\np_binom_norm = binomial_coefs.map((coef, a) => {\n  let p = probs.map((x) => {\n    return (x[0]**a) * ((1 - x[0])**(m - a)) * x[1];\n  });\n  return coef * math.sum(p);\n})\n```\n\n\n<div>\n\n\n```{ojs}\nPlot.plot({\n  x: {\n    label: \"Number of significant effect sizes\"\n  },\n  y: {\n    domain: [0, 1],\n    label: \"Probability\"\n  },\n  marks: [\n    Plot.ruleY(0),\n    Plot.barY(p_binom_norm, {\n      fill: \"steelblue\"\n    }),\n  ]\n})\n```\n\n\n<br>\n\n\n```{ojs}\n//| panel: input\n//| layout-ncol: 2\n\nviewof m = Inputs.range(\n  [1, 30], \n  {value: 6, step: 1, label: \"Number of effect sizes (m):\"}\n)\n\nviewof ESS = Inputs.range(\n  [4, 300], \n  {value: 80, step: 1, label: \"Effective sample size:\"}\n)\n\nviewof mu = Inputs.range(\n  [-2, 2], \n  {value: 0.3, step: 0.01, label: \"Average effect size (mu):\"}\n)\n\nviewof tau = Inputs.range(\n  [0, 1], \n  {value: 0.1, step: 0.01, label: \"Between-study SD (tau):\"}\n)\n\nviewof omega = Inputs.range(\n  [0, 1], \n  {value: 0.1, step: 0.01, label: \"Within-study SD (omega):\"}\n)\n\nviewof rho = Inputs.range(\n  [0, 1], \n  {value: 0.6, step: 0.01, label: \"Correlation of sampling errors (rho):\"}\n)\n\nviewof alpha = Inputs.range(\n  [0.005, 0.995], \n  {value: 0.025, step: .005, label: \"One-sided significance threshold (alpha):\"}\n)\n\nviewof qp = Inputs.range(\n  [1, 30], \n  {value: 21, step: 1, label: \"Number of quadrature points:\"}\n)\n\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script type=\"ojs-define\">\n{\"contents\":[{\"name\":\"all_quad_points\",\"value\":\"[[[-0,1]],[[1,0.5],[-1,0.5]],[[1.7321,0.1667],[5.4474e-34,0.6667],[-1.7321,0.1667]],[[2.3344,0.0459],[0.742,0.4541],[-0.742,0.4541],[-2.3344,0.0459]],[[2.857,0.0113],[1.3556,0.2221],[2.6598e-37,0.5333],[-1.3556,0.2221],[-2.857,0.0113]],[[3.3243,0.0026],[1.8892,0.0886],[0.6167,0.4088],[-0.6167,0.4088],[-1.8892,0.0886],[-3.3243,0.0026]],[[3.7504,0.0005],[2.3668,0.0308],[1.1544,0.2401],[-8.1172e-42,0.4571],[-1.1544,0.2401],[-2.3668,0.0308],[-3.7504,0.0005]],[[4.1445,0.0001],[2.8025,0.0096],[1.6365,0.1172],[0.5391,0.373],[-0.5391,0.373],[-1.6365,0.1172],[-2.8025,0.0096],[-4.1445,0.0001]],[[4.5127,0],[3.2054,0.0028],[2.0768,0.0499],[1.0233,0.2441],[-0,0.4063],[-1.0233,0.2441],[-2.0768,0.0499],[-3.2054,0.0028],[-4.5127,0]],[[4.8595,4.3107e-06],[3.5818,0.0008],[2.4843,0.0191],[1.466,0.1355],[0.4849,0.3446],[-0.4849,0.3446],[-1.466,0.1355],[-2.4843,0.0191],[-3.5818,0.0008],[-4.8595,4.3107e-06]],[[5.188,8.1218e-07],[3.9362,0.0002],[2.8651,0.0067],[1.876,0.0661],[0.9289,0.2422],[-0,0.3694],[-0.9289,0.2422],[-1.876,0.0661],[-2.8651,0.0067],[-3.9362,0.0002],[-5.188,8.1218e-07]],[[5.5009,1.4999e-07],[4.2718,0],[3.2237,0.0022],[2.2595,0.0291],[1.3404,0.147],[0.4444,0.3217],[-0.4444,0.3217],[-1.3404,0.147],[-2.2595,0.0291],[-3.2237,0.0022],[-4.2718,0],[-5.5009,1.4999e-07]],[[5.8002,2.7226e-08],[4.5914,0],[3.5634,0.0007],[2.6207,0.0118],[1.7254,0.0792],[0.8567,0.2379],[-2.789e-31,0.341],[-0.8567,0.2379],[-1.7254,0.0792],[-2.6207,0.0118],[-3.5634,0.0007],[-4.5914,0],[-5.8002,2.7226e-08]],[[6.0874,4.8682e-09],[4.8969,2.661e-06],[3.8869,0.0002],[2.963,0.0044],[2.0883,0.0387],[1.2427,0.1541],[0.4126,0.3026],[-0.4126,0.3026],[-1.2427,0.1541],[-2.0883,0.0387],[-2.963,0.0044],[-3.8869,0.0002],[-4.8969,2.661e-06],[-6.0874,4.8682e-09]],[[6.3639,8.5896e-10],[5.1901,5.9754e-07],[4.1962,0.0001],[3.2891,0.0016],[2.4324,0.0174],[1.6067,0.0894],[0.7991,0.2325],[-1.7432e-32,0.3183],[-0.7991,0.2325],[-1.6067,0.0894],[-2.4324,0.0174],[-3.2891,0.0016],[-4.1962,0.0001],[-5.1901,5.9754e-07],[-6.3639,8.5896e-10]],[[6.6309,1.4978e-10],[5.4722,1.3095e-07],[4.493,0],[3.6009,0.0005],[2.7602,0.0073],[1.952,0.0473],[1.1638,0.1583],[0.3868,0.2866],[-0.3868,0.2866],[-1.1638,0.1583],[-1.952,0.0473],[-2.7602,0.0073],[-3.6009,0.0005],[-4.493,0],[-5.4722,1.3095e-07],[-6.6309,1.4978e-10]],[[6.8891,2.5843e-11],[5.7445,2.808e-08],[4.7785,4.0127e-06],[3.9001,0.0002],[3.0738,0.0029],[2.281,0.0231],[1.5099,0.0974],[0.7518,0.2267],[2.1789e-33,0.2995],[-0.7518,0.2267],[-1.5099,0.0974],[-2.281,0.0231],[-3.0738,0.0029],[-3.9001,0.0002],[-4.7785,4.0127e-06],[-5.7445,2.808e-08],[-6.8891,2.5843e-11]],[[7.1395,4.4166e-12],[6.0077,5.9055e-09],[5.0541,1.0216e-06],[4.188,0.0001],[3.3747,0.0011],[2.5958,0.0105],[1.8398,0.0549],[1.0984,0.1607],[0.3652,0.2728],[-0.3652,0.2728],[-1.0984,0.1607],[-1.8398,0.0549],[-2.5958,0.0105],[-3.3747,0.0011],[-4.188,0.0001],[-5.0541,1.0216e-06],[-6.0077,5.9055e-09],[-7.1395,4.4166e-12]],[[7.3826,7.4828e-13],[6.2629,1.2204e-09],[5.3205,2.5322e-07],[4.4659,0],[3.6644,0.0004],[2.8981,0.0045],[2.1555,0.0287],[1.4289,0.1036],[0.7121,0.2209],[-0,0.2838],[-0.7121,0.2209],[-1.4289,0.1036],[-2.1555,0.0287],[-2.8981,0.0045],[-3.6644,0.0004],[-4.4659,0],[-5.3205,2.5322e-07],[-6.2629,1.2204e-09],[-7.3826,7.4828e-13]],[[7.619,1.2578e-13],[6.5106,2.4821e-10],[5.5787,6.1275e-08],[4.7346,4.4021e-06],[3.944,0.0001],[3.189,0.0018],[2.4587,0.014],[1.7452,0.0615],[1.0429,0.1617],[0.347,0.2608],[-0.347,0.2608],[-1.0429,0.1617],[-1.7452,0.0615],[-2.4587,0.014],[-3.189,0.0018],[-3.944,0.0001],[-4.7346,4.4021e-06],[-5.5787,6.1275e-08],[-6.5106,2.4821e-10],[-7.619,1.2578e-13]],[[7.8494,2.099e-14],[6.7514,4.9754e-11],[5.8294,1.4507e-08],[4.995,1.2254e-06],[4.2143,0],[3.4698,0.0007],[2.7506,0.0064],[2.0491,0.034],[1.3598,0.1084],[0.678,0.2153],[-3.4046e-35,0.2703],[-0.678,0.2153],[-1.3598,0.1084],[-2.0491,0.034],[-2.7506,0.0064],[-3.4698,0.0007],[-4.2143,0],[-4.995,1.2254e-06],[-5.8294,1.4507e-08],[-6.7514,4.9754e-11],[-7.8494,2.099e-14]],[[8.074,3.4795e-15],[6.986,9.8414e-12],[6.0731,3.3665e-09],[5.2477,3.3199e-07],[4.4764,0],[3.7415,0.0003],[3.0324,0.0028],[2.3418,0.0176],[1.6641,0.0672],[0.9952,0.1619],[0.3312,0.2502],[-0.3312,0.2502],[-0.9952,0.1619],[-1.6641,0.0672],[-2.3418,0.0176],[-3.0324,0.0028],[-3.7415,0.0003],[-4.4764,0],[-5.2477,3.3199e-07],[-6.0731,3.3665e-09],[-6.986,9.8414e-12],[-8.074,3.4795e-15]],[[8.2934,5.7324e-16],[7.2147,1.9229e-12],[6.3103,7.6709e-10],[5.4935,8.7751e-08],[4.7307,4.09e-06],[4.0048,0.0001],[3.305,0.0012],[2.6243,0.0086],[1.9573,0.0389],[1.2999,0.1121],[0.6485,0.21],[-8.5115e-36,0.2585],[-0.6485,0.21],[-1.2999,0.1121],[-1.9573,0.0389],[-2.6243,0.0086],[-3.305,0.0012],[-4.0048,0.0001],[-4.7307,4.09e-06],[-5.4935,8.7751e-08],[-6.3103,7.6709e-10],[-7.2147,1.9229e-12],[-8.2934,5.7324e-16]],[[8.5078,9.3902e-17],[7.4379,3.715e-13],[6.5417,1.7187e-10],[5.7327,2.2675e-08],[4.978,1.2177e-06],[4.2604,0],[3.5693,0.0005],[2.8977,0.004],[2.2405,0.0211],[1.5935,0.0721],[0.9534,0.1615],[0.3174,0.2409],[-0.3174,0.2409],[-0.9534,0.1615],[-1.5935,0.0721],[-2.2405,0.0211],[-2.8977,0.004],[-3.5693,0.0005],[-4.2604,0],[-4.978,1.2177e-06],[-5.7327,2.2675e-08],[-6.5417,1.7187e-10],[-7.4379,3.715e-13],[-8.5078,9.3902e-17]],[[8.7176,1.53e-17],[7.656,7.1021e-14],[6.7675,3.7912e-11],[5.966,5.738e-09],[5.2188,3.5302e-07],[4.5089,0],[3.8259,0.0002],[3.1628,0.0018],[2.5145,0.0109],[1.8771,0.0434],[1.2473,0.1149],[0.6225,0.2049],[-0,0.2482],[-0.6225,0.2049],[-1.2473,0.1149],[-1.8771,0.0434],[-2.5145,0.0109],[-3.1628,0.0018],[-3.8259,0.0002],[-4.5089,0],[-5.2188,3.5302e-07],[-5.966,5.738e-09],[-6.7675,3.7912e-11],[-7.656,7.1021e-14],[-8.7176,1.53e-17]],[[8.9231,2.4807e-18],[7.8694,1.3445e-14],[6.9881,8.2428e-12],[6.1937,1.4243e-09],[5.4536,9.9868e-08],[4.7509,3.4434e-06],[4.0754,0.0001],[3.4202,0.0007],[2.7801,0.0053],[2.1515,0.0246],[1.5312,0.0762],[0.9165,0.1606],[0.3052,0.2325],[-0.3052,0.2325],[-0.9165,0.1606],[-1.5312,0.0762],[-2.1515,0.0246],[-2.7801,0.0053],[-3.4202,0.0007],[-4.0754,0.0001],[-4.7509,3.4434e-06],[-5.4536,9.9868e-08],[-6.1937,1.4243e-09],[-6.9881,8.2428e-12],[-7.8694,1.3445e-14],[-8.9231,2.4807e-18]],[[9.1244,4.0034e-19],[8.0783,2.5224e-15],[7.2039,1.7682e-12],[6.4162,3.4726e-10],[5.6828,2.7619e-08],[4.9869,1.0806e-06],[4.3184,0],[3.6705,0.0003],[3.0382,0.0025],[2.4177,0.0132],[1.806,0.0475],[1.2007,0.117],[0.5994,0.2],[-0,0.239],[-0.5994,0.2],[-1.2007,0.117],[-1.806,0.0475],[-2.4177,0.0132],[-3.0382,0.0025],[-3.6705,0.0003],[-4.3184,0],[-4.9869,1.0806e-06],[-5.6828,2.7619e-08],[-6.4162,3.4726e-10],[-7.2039,1.7682e-12],[-8.0783,2.5224e-15],[-9.1244,4.0034e-19]],[[9.3219,6.4325e-20],[8.2831,4.6918e-16],[7.4151,3.7459e-13],[6.6337,8.3266e-11],[5.9067,7.4794e-09],[5.2172,3.3049e-07],[4.5553,8.0936e-06],[3.9143,0.0001],[3.2891,0.0011],[2.6762,0.0068],[2.0726,0.0279],[1.4758,0.0798],[0.8837,0.1594],[0.2943,0.2249],[-0.2943,0.2249],[-0.8837,0.1594],[-1.4758,0.0798],[-2.0726,0.0279],[-2.6762,0.0068],[-3.2891,0.0011],[-3.9143,0.0001],[-4.5553,8.0936e-06],[-5.2172,3.3049e-07],[-5.9067,7.4794e-09],[-6.6337,8.3266e-11],[-7.4151,3.7459e-13],[-8.2831,4.6918e-16],[-9.3219,6.4325e-20]],[[9.5158,1.0293e-20],[8.4838,8.6575e-17],[7.6221,7.8428e-14],[6.8467,1.9657e-11],[6.1256,1.9861e-09],[5.4423,9.869e-08],[4.7866,2.7211e-06],[4.152,0],[3.5335,0.0005],[2.9277,0.0033],[2.3315,0.0156],[1.7426,0.0512],[1.1589,0.1186],[0.5786,0.1954],[1.3299e-37,0.2307],[-0.5786,0.1954],[-1.1589,0.1186],[-1.7426,0.0512],[-2.3315,0.0156],[-2.9277,0.0033],[-3.5335,0.0005],[-4.152,0],[-4.7866,2.7211e-06],[-5.4423,9.869e-08],[-6.1256,1.9861e-09],[-6.8467,1.9657e-11],[-7.6221,7.8428e-14],[-8.4838,8.6575e-17],[-9.5158,1.0293e-20]],[[9.7062,1.6408e-21],[8.6808,1.5856e-17],[7.8251,1.6241e-14],[7.0554,4.5734e-12],[6.34,5.1785e-10],[5.6624,2.8822e-08],[5.0126,8.9091e-07],[4.384,0],[3.7719,0.0002],[3.1726,0.0015],[2.5834,0.0083],[2.0019,0.0311],[1.426,0.0828],[0.8541,0.158],[0.2844,0.218],[-0.2844,0.218],[-0.8541,0.158],[-1.426,0.0828],[-2.0019,0.0311],[-2.5834,0.0083],[-3.1726,0.0015],[-3.7719,0.0002],[-4.384,0],[-5.0126,8.9091e-07],[-5.6624,2.8822e-08],[-6.34,5.1785e-10],[-7.0554,4.5734e-12],[-7.8251,1.6241e-14],[-8.6808,1.5856e-17],[-9.7062,1.6408e-21]]]\"}]}\n</script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}