<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="James E. Pustejovsky">
<meta name="dcterms.date" content="2019-09-30">

<title>James E. Pustejovsky - Simulating correlated standardized mean differences for meta-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="James E. Pustejovsky - Simulating correlated standardized mean differences for meta-analysis">
<meta property="og:description" content="Education Statistics and Meta-Analysis">
<meta property="og:site_name" content="James E. Pustejovsky">
<meta name="twitter:title" content="James E. Pustejovsky - Simulating correlated standardized mean differences for meta-analysis">
<meta name="twitter:description" content="Education Statistics and Meta-Analysis">
<meta name="twitter:card" content="summary">
<meta name="citation_title" content="Simulating correlated standardized mean differences for meta-analysis">
<meta name="citation_author" content="James E. Pustejovsky">
<meta name="citation_publication_date" content="2019-09-30">
<meta name="citation_cover_date" content="2019-09-30">
<meta name="citation_year" content="2019">
<meta name="citation_online_date" content="2019-09-30">
<meta name="citation_fulltext_html_url" content="https://mellifluous-buttercream-e2edd2.netlify.app/posts/Simulating-correlated-SMDs">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Multivariate meta-analysis;,citation_author=Betsy Jane Becker;,citation_editor=Steven D Brown;,citation_editor=Howard E. A. Tinsley;,citation_publication_date=2000;,citation_cover_date=2000;,citation_year=2000;,citation_doi=10.1016/B978-012691360-6/50018-5;,citation_inbook_title=Handbook of applied multivariate statistics and mathematical modeling;">
<meta name="citation_reference" content="citation_title=Effect sizes for continuous data;,citation_author=Michael Borenstein;,citation_editor=Harris M Cooper;,citation_editor=Larry V Hedges;,citation_editor=John C Valentine;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_inbook_title=The handbook of research synthesis and meta-analysis;">
<meta name="citation_reference" content="citation_title=Introduction to Meta-Analysis;,citation_author=Michael Borenstein;,citation_author=Larry V. Hedges;,citation_author=Julian P T Higgins;,citation_author=Hannah R Rothstein;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_fulltext_html_url=http://doi.wiley.com/10.1002/9780470743386;,citation_doi=10.1002/9780470743386;,citation_isbn=9780470743386;">
<meta name="citation_reference" content="citation_title=An alternative pseudolikelihood method for multivariate random-effects meta-analysis;,citation_author=Yong Chen;,citation_author=Chuan Hong;,citation_author=Richard D Riley;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_doi=10.1002/sim.6350;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=Dependent effect sizes in meta-analysis: Incorporating the degree of interdependence.;,citation_author=Shu Fai Cheung;,citation_author=Darius K-S Chan;,citation_publication_date=2004;,citation_cover_date=2004;,citation_year=2004;,citation_issue=5;,citation_doi=10.1037/0021-9010.89.5.780;,citation_volume=89;,citation_journal_title=The Journal of Applied Psychology;">
<meta name="citation_reference" content="citation_title=Synthesizing Research: A Guide for Literature Reviews;,citation_author=Harris M Cooper;,citation_publication_date=1998;,citation_cover_date=1998;,citation_year=1998;">
<meta name="citation_reference" content="citation_title=Research Synthesis and Meta-Analysis;,citation_author=Harris M Cooper;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;">
<meta name="citation_reference" content="citation_title=The role of secondary outcomes in multivariate meta-analysis;,citation_abstract=Univariate meta-analysis concerns a single outcome of interest measured across a number of independent studies. However, many research studies will have also measured secondary outcomes. Multivariate meta-analysis allows us to take these secondary outcomes into account and can also include studies where the primary outcome is missing. We deﬁne the efﬁciency E as the variance of the overall estimate from a multivariate meta-analysis relative to the variance of the overall estimate from a univariate meta-analysis. The extra information gained from a multivariate meta-analysis of n studies is then similar to the extra information gained if a univariate meta-analysis of the primary effect had a further n.1 E/=E studies. The variance contribution of a study’s secondary outcomes (its borrowing of strength) can be thought of as a contrast between the variance matrix of the outcomes in that study and the set of variance matrices of all the studies in the meta-analysis. In the bivariate case this is given a simple graphical interpretation as the borrowing-of-strength plot. We discuss how these ﬁndings can also be used in the context of random-effects meta-analysis. Our discussion is motivated by a published meta-analysis of 10 antihypertension clinical trials.;,citation_author=John B. Copas;,citation_author=Dan Jackson;,citation_author=Ian R. White;,citation_author=Richard D. Riley;,citation_publication_date=2018-11;,citation_cover_date=2018-11;,citation_year=2018;,citation_fulltext_html_url=http://doi.wiley.com/10.1111/rssc.12274;,citation_issue=5;,citation_doi=10.1111/rssc.12274;,citation_issn=00359254;,citation_volume=67;,citation_journal_title=Journal of the Royal Statistical Society: Series C (Applied Statistics);">
<meta name="citation_reference" content="citation_title=Meta-analysis in clinical trials;,citation_author=Rebecca DerSimonian;,citation_author=Nan Laird;,citation_publication_date=1986;,citation_cover_date=1986;,citation_year=1986;,citation_issue=3;,citation_volume=7;,citation_journal_title=Controlled clinical trials;">
<meta name="citation_reference" content="citation_title=Robumeta: Robust variance meta-regression;,citation_author=Zachary Fisher;,citation_author=Elizabeth Tipton;,citation_author=Hou Zhipeng;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://github.com/zackfisher/robumeta;">
<meta name="citation_reference" content="citation_title=Stochastically dependent effect sizes;,citation_author=Leon Jay Gleser;,citation_author=Ingram Olkin;,citation_editor=Harris Cooper;,citation_editor=Larry V. Hedges;,citation_editor=Jeffrey C Valentine;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_inbook_title=The handbook of research synthesis and meta-analysis;">
<meta name="citation_reference" content="citation_title=Robust variance estimation in meta-regression with dependent effect size estimates;,citation_author=Larry V. Hedges;,citation_author=Elizabeth Tipton;,citation_author=Matthew C Johnson;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_issue=1;,citation_doi=10.1002/jrsm.5;,citation_volume=1;,citation_journal_title=Research Synthesis Methods;">
<meta name="citation_reference" content="citation_title=An improved method for bivariate meta-analysis when within-study correlations are unknown;,citation_author=Chuan Hong;,citation_author=Richard D. Riley;,citation_author=Yong Chen;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=1;,citation_doi=10.1002/jrsm.1274;,citation_volume=9;,citation_journal_title=Research Synthesis Methods;">
<meta name="citation_reference" content="citation_title=Multivariate meta-analysis: Potential and promise.;,citation_author=Dan Jackson;,citation_author=Richard D Riley;,citation_author=Ian R White;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_doi=10.1002/sim.4172;,citation_pmid=21268052;,citation_journal_title=Statistics in medicine;">
<meta name="citation_reference" content="citation_title=A multivariate mixed linear model for meta-analysis.;,citation_author=Hripsime Kalaian;,citation_author=Stephen W Raudenbush;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_issue=3;,citation_doi=10.1037/1082-989X.1.3.227;,citation_volume=1;,citation_journal_title=Psychological Methods;">
<meta name="citation_reference" content="citation_title=A multivariate meta-analysis approach for reducing the impact of outcome reporting bias in systematic reviews;,citation_author=Jamie J. Kirkham;,citation_author=Richard D. Riley;,citation_author=Paula R. Williamson;,citation_publication_date=2012-09;,citation_cover_date=2012-09;,citation_year=2012;,citation_fulltext_html_url=http://doi.wiley.com/10.1002/sim.5356;,citation_issue=20;,citation_doi=10.1002/sim.5356;,citation_issn=02776715;,citation_volume=31;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=Practical Meta-Analysis;,citation_author=Mark W Lipsey;,citation_author=David B Wilson;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;">
<meta name="citation_reference" content="citation_title=Assessing meta-regression methods for examining moderator relationships with dependent effect sizes: A Monte Carlo simulation;,citation_author=José Antonio López-López;,citation_author=Wim Van den Noortgate;,citation_author=Emily E. Tanner-Smith;,citation_author=Sandra Jo Wilson;,citation_author=Mark W. Lipsey;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=4;,citation_doi=10.1002/jrsm.1245;,citation_volume=8;,citation_journal_title=Research Synthesis Methods;">
<meta name="citation_reference" content="citation_title=Methods for dealing with multiple outcomes in meta-analysis: a comparison between averaging effect sizes, robust variance estimation and multilevel meta-analysis;,citation_author=Mariola Moeyaert;,citation_author=Maaike Ugille;,citation_author=S. Natasha Beretvas;,citation_author=John Ferron;,citation_author=Rommel Bunuan;,citation_author=Wim Van den Noortgate;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_issue=6;,citation_doi=10.1080/13645579.2016.1252189;,citation_volume=20;,citation_journal_title=International Journal of Social Research Methodology;">
<meta name="citation_reference" content="citation_title=Modeling multivariate effect sizes;,citation_author=Stephen W Raudenbush;,citation_author=Betsy Jane Becker;,citation_author=Hripsime Kalaian;,citation_publication_date=1988;,citation_cover_date=1988;,citation_year=1988;,citation_issue=1;,citation_doi=10.1037/0033-2909.103.1.111;,citation_volume=103;,citation_journal_title=Psychological Bulletin;">
<meta name="citation_reference" content="citation_title=An evaluation of bivariate random-effects meta-analysis for the joint synthesis of two correlated outcomes;,citation_abstract=Often multiple outcomes are of interest in each study identiÿed by a systematic review, and in this situation a separate univariate meta-analysis is usually applied to synthesize the evidence for each outcome independently; an alternative approach is a single multivariate meta-analysis model that utilizes any correlation between outcomes and obtains all the pooled estimates jointly. Surprisingly, multivariate meta-analysis is rarely considered in practice, so in this paper we illustrate the beneÿts and limitations of the approach to provide helpful insight for practitioners.;,citation_author=R. D. Riley;,citation_author=K. R. Abrams;,citation_author=P. C. Lambert;,citation_author=A. J. Sutton;,citation_author=J. R. Thompson;,citation_publication_date=2007-01;,citation_cover_date=2007-01;,citation_year=2007;,citation_fulltext_html_url=http://doi.wiley.com/10.1002/sim.2524;,citation_issue=1;,citation_doi=10.1002/sim.2524;,citation_issn=02776715, 10970258;,citation_volume=26;,citation_journal_title=Statistics in Medicine;">
<meta name="citation_reference" content="citation_title=An alternative model for bivariate random-effects meta-analysis when the within-study correlations are unknown;,citation_author=Richard D Riley;,citation_author=John R Thompson;,citation_author=Keith R Abrams;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_issue=1;,citation_doi=10.1093/biostatistics/kxm023;,citation_volume=9;,citation_journal_title=Biostatistics;">
<meta name="citation_reference" content="citation_title=Multivariate and network meta-analysis of multiple outcomes and multiple treatments: Rationale, concepts, and examples;,citation_author=Richard D Riley;,citation_author=Dan Jackson;,citation_author=Georgia Salanti;,citation_author=Danielle L Burke;,citation_author=Malcolm Price;,citation_author=Jamie Kirkham;,citation_author=Ian R White;,citation_publication_date=2017-09;,citation_cover_date=2017-09;,citation_year=2017;,citation_fulltext_html_url=http://www.bmj.com/lookup/doi/10.1136/bmj.j3932;,citation_doi=10.1136/bmj.j3932;,citation_issn=0959-8138, 1756-1833;,citation_journal_title=BMJ;">
<meta name="citation_reference" content="citation_title=Meta-analytic procedures for combining studies with multiple effect sizes;,citation_author=Robert Rosenthal;,citation_author=Donald B Rubin;,citation_publication_date=1986;,citation_cover_date=1986;,citation_year=1986;,citation_issue=3;,citation_volume=99;,citation_journal_title=Psychological Bulletin;">
<meta name="citation_reference" content="citation_title=Meta-analysis with complex research designs: Dealing with dependence from multiple measures and multiple group comparisons;,citation_author=Nancy K Scammacca;,citation_author=Greg Roberts;,citation_author=Karla K Stuebing;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_issue=3;,citation_doi=10.3102/0034654313500826;,citation_volume=84;,citation_journal_title=Review of Educational Research;">
<meta name="citation_reference" content="citation_title=Robust variance estimation for random effects meta-analysis;,citation_author=Kurex Sidik;,citation_author=Jeffrey N. Jonkman;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=12;,citation_doi=10.1016/j.csda.2005.07.019;,citation_volume=50;,citation_journal_title=Computational Statistics &amp;amp;amp; Data Analysis;">
<meta name="citation_reference" content="citation_title=Robust variance estimation with dependent effect sizes: Practical considerations including a software tutorial in Stata and SPSS;,citation_author=Emily E Tanner-Smith;,citation_author=Elizabeth Tipton;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=1;,citation_doi=10.1002/jrsm.1091;,citation_volume=5;,citation_journal_title=Research Synthesis Methods;">
<meta name="citation_reference" content="citation_title=Three-level meta-analysis of dependent effect sizes;,citation_author=Wim Van den Noortgate;,citation_author=José Antonio López-López;,citation_author=Fulgencio Marín-Martínez;,citation_author=Julio Sánchez-Meca;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=2;,citation_doi=10.3758/s13428-012-0261-6;,citation_volume=45;,citation_journal_title=Behavior Research Methods;">
<meta name="citation_reference" content="citation_title=Meta-analysis of multiple outcomes: A multilevel approach;,citation_author=Wim Van den Noortgate;,citation_author=José Antonio López-López;,citation_author=Fulgencio Marín-Martínez;,citation_author=Julio Sánchez-Meca;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=4;,citation_doi=10.3758/s13428-014-0527-2;,citation_volume=47;,citation_journal_title=Behavior Research Methods;">
<meta name="citation_reference" content="citation_title=Conducting meta-analyses in R with the metafor package;,citation_author=Wolfgang Viechtbauer;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_issue=3;,citation_volume=36;,citation_journal_title=Journal of Statistical Software;">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">James E. Pustejovsky</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../files/Pustejovsky-CV.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../people/index.html"> 
<span class="menu-text">People</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../working-papers.html"> 
<span class="menu-text">Working Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publication/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations/index.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software/index.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Simulating correlated standardized mean differences for meta-analysis</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">effect size</div>
                <div class="quarto-category">standardized mean difference</div>
                <div class="quarto-category">meta-analysis</div>
                <div class="quarto-category">simulation</div>
                <div class="quarto-category">programming</div>
                <div class="quarto-category">distribution theory</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>James E. Pustejovsky </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 30, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#simulating-individual-participant-level-data" id="toc-simulating-individual-participant-level-data" class="nav-link active" data-scroll-target="#simulating-individual-participant-level-data">Simulating individual participant-level data</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#simulating-summary-statistics" id="toc-simulating-summary-statistics" class="nav-link" data-scroll-target="#simulating-summary-statistics">Simulating summary statistics</a>
  <ul class="collapse">
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a></li>
  </ul></li>
  <li><a href="#which-approach-is-better" id="toc-which-approach-is-better" class="nav-link" data-scroll-target="#which-approach-is-better">Which approach is better?</a></li>
  <li><a href="#simulating-full-meta-analyses" id="toc-simulating-full-meta-analyses" class="nav-link" data-scroll-target="#simulating-full-meta-analyses">Simulating full meta-analyses</a>
  <ul class="collapse">
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">Exercises</a></li>
  <li><a href="#a-challenge" id="toc-a-challenge" class="nav-link" data-scroll-target="#a-challenge">A challenge</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>As I’ve discussed in <a href="../..\posts/Sometimes-aggregating-effect-sizes-is-fine">previous posts</a>, meta-analyses in psychology, education, and other areas often include studies that contribute multiple, statistically dependent effect size estimates. I’m interested in methods for meta-analyzing and meta-regressing effect sizes from data structures like this, and studying this sort of thing often entails conducting Monte Carlo simulations. Monte Carlo simulations involve generating artificial data—in this case, a set of studies, each of which has one or more dependent effect size estimates—that follows a certain distributional model, applying different analytic methods to the artificial data, and then repeating the process a bunch of times. Because we know the true parameters that govern the data-generating process, we can evaluate the performance of the analytic methods in terms of bias, accuracy, hypothesis test calibration and power, confidence interval coverage, and the like.</p>
<p>In this post, I’ll discuss two alternative methods to simulate meta-analytic datasets that include studies with multiple, dependent effect size estimates: simulating individual participant-level data or simulating summary statistics. I’ll focus on the case of the standardized mean difference (SMD) because it is so common in meta-analyses of intervention studies. For simplicity, I’ll assume that the effect sizes all come from simple, two-group comparisons (without any covariate adjustment or anything like that) and that the individual observations are multi-variate normally distributed within each group. Our goal will be to simulate a set of <span class="math inline">\(K\)</span> studies, where study <span class="math inline">\(k\)</span> is based on measuring <span class="math inline">\(J_k\)</span> outcomes on a sample of <span class="math inline">\(N_k\)</span> participants, all for <span class="math inline">\(k = 1,...,K\)</span>. Let <span class="math inline">\(\boldsymbol\delta_k = (\delta_{1k} \cdots \delta_{J_k k})'\)</span> be the <span class="math inline">\(J_k \times 1\)</span> vector of true standardized mean differences for study <span class="math inline">\(k\)</span>. I’ll assume that we know these true effect size parameters for all <span class="math inline">\(K\)</span> studies, so that I can avoid committing to any particular form of random effects model.</p>
<section id="simulating-individual-participant-level-data" class="level1">
<h1>Simulating individual participant-level data</h1>
<p>The most direct way to simulate this sort of effect size data is to generate outcome data for every artificial participant in every artificial study. Let <span class="math inline">\(\mathbf{Y}_{ik}^T\)</span> be the <span class="math inline">\(J_k \times 1\)</span> vector of outcomes for treatment group participant <span class="math inline">\(i\)</span> in study <span class="math inline">\(k\)</span>, and let <span class="math inline">\(\mathbf{Y}_{ik}^C\)</span> be the <span class="math inline">\(J_k \times 1\)</span> vector outcomes for control group participant <span class="math inline">\(i\)</span> in study <span class="math inline">\(k\)</span>, for <span class="math inline">\(i=1,...,N_k / 2\)</span> and <span class="math inline">\(k = 1,...,K\)</span>. Assuming multi-variate normality of the outcomes, we can generate these outcome vectors as <span class="math display">\[
\mathbf{Y}_{ik}^T \sim N\left(\boldsymbol\delta_k, \boldsymbol\Psi_k\right) \qquad \text{and}\qquad \mathbf{Y}_{ik}^C \sim N\left(\mathbf{0}, \boldsymbol\Psi_k\right),
\]</span> where <span class="math inline">\(\boldsymbol\Psi_k\)</span> is the population correlation matrix of the outcomes in study <span class="math inline">\(k\)</span>. Note that I am setting the mean outcomes of the control group participants to zero and also specifying that the outcomes all have unit variance within each group. After simulating data based on these distributions, the effect size estimates for each outcome can be calculated directly, following standard formulas.</p>
<p>Here’s what this approach looks like in code. It is helpful to simplify things by focusing on simulating just a single study with multiple, correlated effect sizes. Focusing first on just the input parameters, a function might look like the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>r_SMDs_raw <span class="ot">&lt;-</span> <span class="cf">function</span>(delta, J, N, Psi) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stuff</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ES_data)  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In the above function skeleton, <code>delta</code> would be the true effect size parameter <span class="math inline">\(\boldsymbol\delta_k\)</span>, <code>J</code> would be the number of effect sizes to generate <span class="math inline">\((J_k)\)</span>, <code>N</code> is the total number of participants <span class="math inline">\((N_k)\)</span>, and <code>Psi</code> is a matrix of correlations between the outcomes <span class="math inline">\((\Psi_k)\)</span>. From these parameters, we’ll generate raw data, calculate effect size estimates and standard errors, and return the results in a little dataset.</p>
<p>To make the function a little bit easier to use, I’m going overload the <code>Psi</code> argument so that it can be a single number, indicating a common correlation between the outcomes. Thus, instead of having to feed in a <span class="math inline">\(J_k \times J_k\)</span> matrix, you can specify a single correlation <span class="math inline">\(r_k\)</span>, and the function will assume that all of the outcomes are equicorrelated. In code, the logic is:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(Psi)) Psi <span class="ot">&lt;-</span> Psi <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">-</span> Psi, <span class="at">nrow =</span> J)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here’s the function with the innards:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>r_SMDs_raw <span class="ot">&lt;-</span> <span class="cf">function</span>(delta, J, N, Psi) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(mvtnorm) <span class="co"># for simulating multi-variate normal data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create Psi matrix assuming equicorrelation</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(Psi)) Psi <span class="ot">&lt;-</span> Psi <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">-</span> Psi, <span class="at">nrow =</span> J)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate control group summary statistics</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  Y_C <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> N <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, J), <span class="at">sigma =</span> Psi)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  ybar_C <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Y_C)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  sd_C <span class="ot">&lt;-</span> <span class="fu">apply</span>(Y_C, <span class="dv">2</span>, sd)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate treatment group summary statistics</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="fu">rep</span>(delta, <span class="at">length.out =</span> J)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  Y_T <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> N <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> delta, <span class="at">sigma =</span> Psi)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  ybar_T <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Y_T)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  sd_T <span class="ot">&lt;-</span> <span class="fu">apply</span>(Y_T, <span class="dv">2</span>, sd)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate Cohen's d</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  sd_pool <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_C<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_T<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  ES <span class="ot">&lt;-</span> (ybar_T <span class="sc">-</span> ybar_C) <span class="sc">/</span> sd_pool</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SE of d</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> N <span class="sc">+</span> ES<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> (N <span class="sc">-</span> <span class="dv">2</span>)))</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">ES =</span> ES, <span class="at">SE =</span> SE, <span class="at">N =</span> N)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In action:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="fl">0.2</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">r_SMDs_raw</span>(<span class="at">delta =</span> delta, <span class="at">J =</span> <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">40</span>, <span class="at">Psi =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         ES        SE  N
1 0.3855613 0.3193055 40
2 0.5944490 0.3234959 40
3 0.4130571 0.3197576 40
4 0.9150846 0.3331939 40</code></pre>
</div>
</div>
<p>Or if you’d rather specify the full <span class="math inline">\(\Psi_k\)</span> matrix yourself:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Psi_k <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="sc">+</span> <span class="fu">diag</span>(<span class="fl">0.4</span>, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Psi_k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  1.0  0.6  0.6  0.6
[2,]  0.6  1.0  0.6  0.6
[3,]  0.6  0.6  1.0  0.6
[4,]  0.6  0.6  0.6  1.0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r_SMDs_raw</span>(<span class="at">delta =</span> delta, <span class="at">J =</span> <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">40</span>, <span class="at">Psi =</span> Psi_k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         ES        SE  N
1 0.5366188 0.3221629 40
2 0.5439397 0.3223244 40
3 0.1063544 0.3164630 40
4 0.7696820 0.3283213 40</code></pre>
</div>
</div>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>The function above is serviceable but quite basic. I can think of several additional features that one might like to have for use in research simulations, but I’m feeling both cheeky and lazy at the moment, so I’ll leave them for you, dear reader. Here are some suggested exercises:</p>
<ol type="1">
<li><p>Add an argument to the function, <code>Hedges_g = TRUE</code>, which controls where the simulated effect size is Hedges’ <span class="math inline">\(g\)</span> or Cohen’s <span class="math inline">\(d\)</span>. If it is Hedges’ g, make sure that the standard error is corrected too.</p></li>
<li><p>Add an argument to the function, <code>p_val = TRUE</code>, which allows the user to control whether or not to return <span class="math inline">\(p\)</span>-values from the test of mean differences for each outcome. Note that the p-values should be for a test of the <em>raw</em> mean differences between groups, rather than a test of the effect size <span class="math inline">\(\delta_{jk} = 0\)</span>.</p></li>
<li><p>Add an argument to the function, <code>corr_mat = FALSE</code>, which controls whether the function returns just the simulated effect sizes and SEs or both the simulated effect sizes and the full sampling variance-covariance matrix of the effect sizes. See <a href="../..\posts/correlations-between-SMDs/">here</a> for the relevant formulas.</p></li>
</ol>
</section>
</section>
<section id="simulating-summary-statistics" class="level1">
<h1>Simulating summary statistics</h1>
<p>Another approach to simulating SMDs is to sample from the distribution of the <em>summary statistics</em> used in calculating the effect size. This approach should simplify the code, at the cost of having to use a bit of distribution theory. Let <span class="math inline">\(\mathbf{\bar{y}}_{Tk}\)</span> and <span class="math inline">\(\mathbf{\bar{y}}_{Ck}\)</span> be the <span class="math inline">\(J_k \times 1\)</span> vectors of sample means for the treatment and control groups, respectively. Let <span class="math inline">\(\mathbf{S}_k\)</span> be the <span class="math inline">\(J_k \times J_k\)</span> sample covariance matrix of the outcomes, pooled across the treatment and control groups. Again assuming multi-variate normality, and following the same notation as above: <span class="math display">\[
\mathbf{\bar{y}}_{Ck} \sim N\left(\mathbf{0}, \frac{2}{N_k} \boldsymbol\Psi_k\right), \qquad \mathbf{\bar{y}}_{Tk} \sim N\left(\boldsymbol\delta_k, \frac{2}{N_k} \boldsymbol\Psi_k\right),
\]</span> and <span class="math display">\[
\left(\mathbf{\bar{y}}_{Tk} - \mathbf{\bar{y}}_{Ck}\right) \sim N\left(\boldsymbol\delta_k, \frac{4}{N_k} \boldsymbol\Psi_k\right).
\]</span> This shows how we could directly simulate the numerator of the standardized mean difference.</p>
<p>A <a href="../..\posts/distribution-of-sample-variances/">further bit of distribution theory</a> says that the pooled sample covariance matrix follows a multiple of a <a href="https://en.wikipedia.org/wiki/Wishart_distribution">Wishart distribution</a> with <span class="math inline">\(N_k - 2\)</span> degrees of freedom and scale matrix <span class="math inline">\(\Psi_k\)</span>: <span class="math display">\[
(N_k - 2) \mathbf{S}_k \sim Wishart\left(N_k - 2, \Psi_k \right).
\]</span> Thus, to simulate the denominators of the SMD estimates, we can simulate a single Wishart matrix, pull out the diagonal entries, divide by <span class="math inline">\(N_k - 2\)</span>, and take the square root. In all, we draw a single <span class="math inline">\(J_k \times 1\)</span> observation from a multi-variate normal distribution and a single <span class="math inline">\(J_k \times J_k\)</span> observation from a Wishart distribution. In contrast, the raw data approach requires simulating <span class="math inline">\(N_k\)</span> observations from a multi-variate normal distribution, then calculating <span class="math inline">\(4 J_k\)</span> summary statistics (M and SD for each group on each outcome).</p>
<section id="exercises-1" class="level2">
<h2 class="anchored" data-anchor-id="exercises-1">Exercises</h2>
<p>Once again, I’ll leave it to you, dear reader, to do the fun programming bits:</p>
<ol start="4" type="1">
<li><p>Create a modified version of the function <code>r_SMDs_raw</code> that simulates summary statistics instead of raw data (Call it <code>r_SMDs_stats</code>).</p></li>
<li><p>Use the <code>microbenchmark</code> package (or your preferred benchmarking tool) to compare the computational efficiency of both versions of the function.</p></li>
<li><p>Check your work! Verify that both versions of the function generate the same distributions if the same parameters are used as input.</p></li>
</ol>
</section>
</section>
<section id="which-approach-is-better" class="level1">
<h1>Which approach is better?</h1>
<p>Like many things in research, there’s no clearly superior method here. The advantage of the summary statistics approach is computational efficiency. It should generally be faster than the raw data approach, and if you need to generate 10,000 meta-analysis each with 80 studies in them, the computational savings might add up. On the other hand, computational efficiency isn’t everything.</p>
<p>I see two potential advantages of the raw data approach. First is interpretability: simulating raw data is likely easier to understand. It feels tangible and familiar, harkening back to those bygone days we spent learning ANOVA, whereas the summary statistics approach requires a bit of distribution theory to follow (bookmark this blog post!). Second is extensibility: it is relatively straightforward to extend the approach to use other distributional models for the raw dat (perhaps you want to look at outcomes that follow a <a href="https://en.wikipedia.org/wiki/Multivariate_t-distribution">multi-variate <span class="math inline">\(t\)</span> distribution</a>?) or more complicated estimators of the SMD (difference-in-differences? covariate-adjusted? cluster-randomized trial?). To use the summary statistics approach in more complicated scenarios, you’d have to work out the sampling distributions for yourself, or locate the right reference.</p>
<p>Of course, there’s also no need to choose between these two approaches. As I’m trying to hint at in Exercise 6, it’s actually useful to write both. Then, you can use the (potentially slower) raw data version to verify that the summary statistics version is correct.</p>
</section>
<section id="simulating-full-meta-analyses" class="level1">
<h1>Simulating full meta-analyses</h1>
<p>So far we’ve got a data-generating function that simulates a single study’s worth of effect size estimates. To study meta-analytic methods, we’ll need to build out the function to simulate multiple studies. To do so, I think it’s useful to use the technique of <a href="https://r4ds.hadley.nz/iteration.html">mapping</a>, as implemented in the <code>purrr</code> package’s <code>map_*</code> functions. The idea here is to first generate a “menu” of study-specific parameters for each of <span class="math inline">\(K\)</span> studies, then apply the <code>r_SMDs</code> function to each parameter set.</p>
<p>Let’s consider how to do this for a simple random effects model, where the true effect size parameter is constant within each study (i.e., <span class="math inline">\(\boldsymbol\delta_k = (\delta_k \cdots \delta_k)'\)</span>), and in a model without covariates. We’ll need to generate a true effect for each study, along with a sample size, an outcome dimension, and a correlation between outcomes. For the true effects, I’ll assume that <span class="math display">\[
\delta_k \sim N(\mu, \tau^2),
\]</span> <span class="math display">\[
J_k \sim 2 + Poisson(3),
\]</span> <span class="math display">\[
N_k \sim 20 + 2 \times Poisson(10),
\]</span> and <span class="math display">\[
r_k \sim Beta\left(\rho \nu, (1 - \rho)\nu\right),
\]</span> where <span class="math inline">\(\rho = \text{E}(r_k)\)</span> and <span class="math inline">\(\nu &gt; 0\)</span> controls the variability of <span class="math inline">\(r_k\)</span> across studies, with smaller <span class="math inline">\(\nu\)</span> corresponding to more variable correlations. Specifically, <span class="math inline">\(\text{Var}(r_k) = \rho (1 - \rho) / (1 + \nu)\)</span>. These distributions are just made up, without any particular justification.</p>
<p>Here’s what these distributional models look like in R code:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>J_mean <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>N_mean <span class="ot">&lt;-</span> <span class="dv">45</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="dv">39</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>study_data <span class="ot">&lt;-</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta =</span> <span class="fu">rnorm</span>(K, <span class="at">mean =</span> mu, <span class="at">sd =</span> tau),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">J =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rpois</span>(K, J_mean <span class="sc">-</span> <span class="dv">2</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rpois</span>(K, (N_mean <span class="sc">-</span> <span class="dv">20</span>) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Psi =</span> <span class="fu">rbeta</span>(K, rho <span class="sc">*</span> nu, (<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> nu)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>study_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      delta J  N       Psi
1 0.2092696 2 38 0.6668007
2 0.2299119 5 42 0.4487449
3 0.0664768 3 54 0.7200542
4 0.1609013 6 34 0.6149950
5 0.2180899 6 54 0.7553845
6 0.1299188 3 58 0.7155828</code></pre>
</div>
</div>
<p>Once we have the “menu” of study-level characteristics, it’s just a matter of mapping the parameters to the data-generating function. One way to do this is with <code>pmap_df</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>meta_data <span class="ot">&lt;-</span> <span class="fu">pmap_df</span>(study_data, r_SMDs_raw, <span class="at">.id =</span> <span class="st">"study"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>meta_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   study          ES        SE  N
1      1 -0.12575818 0.3247812 38
2      1 -0.24412399 0.3257160 38
3      2  0.26556471 0.3100317 42
4      2  0.95331328 0.3264938 42
5      2  0.78835910 0.3209470 42
6      2  0.12122926 0.3089042 42
7      2  0.05945635 0.3086783 42
8      3 -0.16817702 0.2726647 54
9      3 -0.28555997 0.2736022 54
10     3  0.10045972 0.2723437 54
11     4 -0.55943777 0.3500532 34
12     4 -0.31311385 0.3452230 34
13     4 -0.29413648 0.3449621 34
14     4 -0.25214567 0.3444422 34
15     4 -0.36021385 0.3459400 34
16     4 -0.53997094 0.3495752 34
17     5 -0.30208044 0.2737727 54
18     5  0.04982397 0.2722094 54
19     5  0.04273584 0.2721978 54
20     5 -0.15579886 0.2725940 54
21     5 -0.24978710 0.2732655 54
22     5 -0.25431832 0.2733056 54
23     6 -0.32438779 0.2643956 58
24     6 -0.14951874 0.2629926 58
25     6 -0.36681929 0.2648904 58</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta_data<span class="sc">$</span>study)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 4 5 6 
2 5 3 6 6 3 </code></pre>
</div>
</div>
<p>Putting it all together into a function, we have</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>r_meta <span class="ot">&lt;-</span> <span class="cf">function</span>(K, mu, tau, J_mean, N_mean, rho, nu) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(purrr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  study_data <span class="ot">&lt;-</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta =</span> <span class="fu">rnorm</span>(K, <span class="at">mean =</span> mu, <span class="at">sd =</span> tau),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">J =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rpois</span>(K, J_mean <span class="sc">-</span> <span class="dv">2</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">N =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rpois</span>(K, (N_mean <span class="sc">-</span> <span class="dv">20</span>) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Psi =</span> <span class="fu">rbeta</span>(K, rho <span class="sc">*</span> nu, (<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> nu)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_df</span>(study_data, r_SMDs_raw, <span class="at">.id =</span> <span class="st">"study"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercises-2" class="level2">
<h2 class="anchored" data-anchor-id="exercises-2">Exercises</h2>
<ol start="7" type="1">
<li><p>Modify <code>r_meta</code> so that it uses <code>r_SMDs_stats</code>.</p></li>
<li><p>Add options to <code>r_meta</code> for <code>Hedges_g</code>, <code>p_val = TRUE</code>, and <code>corr_mat = FALSE</code> and ensure that these get passed along to the <code>r_SMDs</code> function.</p></li>
<li><p>One way to check that the <code>r_meta</code> function is working properly is to generate a very large meta-analytic dataset, then to verify that the generated distributions align with expectations. Here’s a very large meta-analytic dataset:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>meta_data <span class="ot">&lt;-</span> <span class="fu">r_meta</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">100000</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fl">0.2</span>, <span class="at">tau =</span> <span class="fl">0.05</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">J_mean =</span> <span class="dv">5</span>, <span class="at">N_mean =</span> <span class="dv">40</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rho =</span> <span class="fl">0.6</span>, <span class="at">nu =</span> <span class="dv">39</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compare the distribution of the simulated dataset against what you would expect to get based on the input parameters.</p></li>
<li><p>Modify the <code>r_meta</code> function so that <span class="math inline">\(J_k\)</span> and <span class="math inline">\(N_k\)</span> are correlated, according to <span class="math display">\[
\begin{align}
J_k &amp;\sim 2 + Poisson(\mu_J - 2) \\
N_k &amp;\sim 20 + 2 \times Poisson\left(\frac{1}{2}(\mu_N - 20) + \alpha (J_k - \mu_J) \right)
\end{align}
\]</span> for user-specified values of <span class="math inline">\(\mu_J\)</span> (the average number of outcomes per study), <span class="math inline">\(\mu_N\)</span> (the average total sample size per study), and <span class="math inline">\(\alpha\)</span>, which controls the degree of dependence between <span class="math inline">\(J_k\)</span> and <span class="math inline">\(N_k\)</span>.</p></li>
</ol>
</section>
<section id="a-challenge" class="level2">
<h2 class="anchored" data-anchor-id="a-challenge">A challenge</h2>
<p>The meta-analytic model that we’re using here is quite simple—simplistic, even—and for some simulation studies, something more complex might be needed. For example, we might need to generate data from a model that includes within-study random effects, as in: <span class="math display">\[
\delta_{jk} = \mu + u_k + v_{jk}, \quad \text{where}\quad u_k \sim N(0, \tau^2), \quad v_{jk} \sim N(0, \omega^2).
\]</span> Even more complex would be to simulate from a multi-level meta-regression model <span class="math display">\[
\delta_{jk} = \mathbf{x}_{jk} \boldsymbol\beta + u_k + v_{jk}, \quad \text{where}\quad u_k \sim N(0, \tau^2), \quad v_{jk} \sim N(0, \omega^2),
\]</span> where <span class="math inline">\(\mathbf{x}_{jk}\)</span> is a <span class="math inline">\(1 \times p\)</span> row-vector of covariates describing outcome <span class="math inline">\(j\)</span> in study <span class="math inline">\(k\)</span> and <span class="math inline">\(\boldsymbol\beta\)</span> is a <span class="math inline">\(p \times 1\)</span> vector of meta-regression coefficients. In past work, I’ve done this by writing a data-generating function that takes a fixed design matrix <span class="math inline">\(\mathbf{X} = \left(\mathbf{x}_{11}' \cdots \mathbf{x}_{J_K K}'\right)'\)</span> as an input argument, along with <span class="math inline">\(\boldsymbol\beta\)</span>. The design matrix would also include an identifier for each unique study. There are surely better (simpler, easier to follow) ways to implement the multi-level meta-regression model. I’ll once again leave it to you to work out an approach.</p>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2019,
  author = {Pustejovsky, James E.},
  title = {Simulating Correlated Standardized Mean Differences for
    Meta-Analysis},
  date = {2019-09-30},
  url = {https://mellifluous-buttercream-e2edd2.netlify.app/posts/Simulating-correlated-SMDs},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2019" class="csl-entry quarto-appendix-citeas" role="listitem">
Pustejovsky, J. E. (2019, September 30). <em>Simulating correlated
standardized mean differences for meta-analysis</em>. <a href="https://mellifluous-buttercream-e2edd2.netlify.app/posts/Simulating-correlated-SMDs">https://mellifluous-buttercream-e2edd2.netlify.app/posts/Simulating-correlated-SMDs</a>
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mellifluous-buttercream-e2edd2\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="jepusto/jepusto-quarto" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Simulating correlated standardized mean differences for meta-analysis</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '2019-09-30'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../meta-references.bib"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> "../apa.csl"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="an">link-citations:</span><span class="co"> true</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">- effect size</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">- standardized mean difference</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">- meta-analysis</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">- simulation</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">- programming</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">- distribution theory</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="an">code-tools:</span><span class="co"> true</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="an">toc-title:</span><span class="co"> Contents</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>As I've discussed in <span class="co">[</span><span class="ot">previous posts</span><span class="co">](/posts/Sometimes-aggregating-effect-sizes-is-fine)</span>, meta-analyses in psychology, education, and other areas often include studies that contribute multiple, statistically dependent effect size estimates. </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>I'm interested in methods for meta-analyzing and meta-regressing effect sizes from data structures like this, and studying this sort of thing often entails conducting Monte Carlo simulations.</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>Monte Carlo simulations involve generating artificial data---in this case, a set of studies, each of which has one or more dependent effect size estimates---that follows a certain distributional model, applying different analytic methods to the artificial data, and then repeating the process a bunch of times.</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>Because we know the true parameters that govern the data-generating process, we can evaluate the performance of the analytic methods in terms of bias, accuracy, hypothesis test calibration and power, confidence interval coverage, and the like. </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>In this post, I'll discuss two alternative methods to simulate meta-analytic datasets that include studies with multiple, dependent effect size estimates: simulating individual participant-level data or simulating summary statistics. I'll focus on the case of the standardized mean difference (SMD) because it is so common in meta-analyses of intervention studies. For simplicity, I'll assume that the effect sizes all come from simple, two-group comparisons (without any covariate adjustment or anything like that) and that the individual observations are multi-variate normally distributed within each group. Our goal will be to simulate a set of $K$ studies, where study $k$ is based on measuring $J_k$ outcomes on a sample of $N_k$ participants, all for $k = 1,...,K$.</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>Let $\boldsymbol\delta_k = (\delta_{1k} \cdots \delta_{J_k k})'$ be the $J_k \times 1$ vector of true standardized mean differences for study $k$. </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>I'll assume that we know these true effect size parameters for all $K$ studies, so that I can avoid committing to any particular form of random effects model.</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulating individual participant-level data</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>The most direct way to simulate this sort of effect size data is to generate outcome data for every artificial participant in every artificial study. Let $\mathbf{Y}_{ik}^T$ be the $J_k \times 1$ vector of outcomes for treatment group participant $i$ in study $k$, and let $\mathbf{Y}_{ik}^C$ be the $J_k \times 1$ vector outcomes for control group participant $i$ in study $k$, for $i=1,...,N_k / 2$ and $k = 1,...,K$. Assuming multi-variate normality of the outcomes, we can generate these outcome vectors as </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>\mathbf{Y}_{ik}^T \sim N\left(\boldsymbol\delta_k, \boldsymbol\Psi_k\right) \qquad \text{and}\qquad \mathbf{Y}_{ik}^C \sim N\left(\mathbf{0}, \boldsymbol\Psi_k\right),</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>where $\boldsymbol\Psi_k$ is the population correlation matrix of the outcomes in study $k$. </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>Note that I am setting the mean outcomes of the control group participants to zero and also specifying that the outcomes all have unit variance within each group.</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>After simulating data based on these distributions, the effect size estimates for each outcome can be calculated directly, following standard formulas.  </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>Here's what this approach looks like in code. </span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>It is helpful to simplify things by focusing on simulating just a single study with multiple, correlated effect sizes. </span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>Focusing first on just the input parameters, a function might look like the following:</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>r_SMDs_raw <span class="ot">&lt;-</span> <span class="cf">function</span>(delta, J, N, Psi) {</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stuff</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ES_data)  </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>In the above function skeleton, <span class="in">`delta`</span> would be the true effect size parameter $\boldsymbol\delta_k$, <span class="in">`J`</span> would be the number of effect sizes to generate $(J_k)$, <span class="in">`N`</span> is the total number of participants $(N_k)$, and <span class="in">`Psi`</span> is a matrix of correlations between the outcomes $(\Psi_k)$.</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>From these parameters, we'll generate raw data, calculate effect size estimates and standard errors, and return the results in a little dataset.</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>To make the function a little bit easier to use, I'm going overload the <span class="in">`Psi`</span> argument so that it can be a single number, indicating a common correlation between the outcomes. Thus, instead of having to feed in a $J_k \times J_k$ matrix, you can specify a single correlation $r_k$, and the function will assume that all of the outcomes are equicorrelated. In code, the logic is:</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="in">if (!is.matrix(Psi)) Psi &lt;- Psi + diag(1 - Psi, nrow = J)</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>Here's the function with the innards:</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>r_SMDs_raw <span class="ot">&lt;-</span> <span class="cf">function</span>(delta, J, N, Psi) {</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(mvtnorm) <span class="co"># for simulating multi-variate normal data</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create Psi matrix assuming equicorrelation</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.matrix</span>(Psi)) Psi <span class="ot">&lt;-</span> Psi <span class="sc">+</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">-</span> Psi, <span class="at">nrow =</span> J)</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate control group summary statistics</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>  Y_C <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> N <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="fu">rep</span>(<span class="dv">0</span>, J), <span class="at">sigma =</span> Psi)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  ybar_C <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Y_C)</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  sd_C <span class="ot">&lt;-</span> <span class="fu">apply</span>(Y_C, <span class="dv">2</span>, sd)</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate treatment group summary statistics</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  delta <span class="ot">&lt;-</span> <span class="fu">rep</span>(delta, <span class="at">length.out =</span> J)</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>  Y_T <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="at">n =</span> N <span class="sc">/</span> <span class="dv">2</span>, <span class="at">mean =</span> delta, <span class="at">sigma =</span> Psi)</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  ybar_T <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Y_T)</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  sd_T <span class="ot">&lt;-</span> <span class="fu">apply</span>(Y_T, <span class="dv">2</span>, sd)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate Cohen's d</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>  sd_pool <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((sd_C<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sd_T<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>  ES <span class="ot">&lt;-</span> (ybar_T <span class="sc">-</span> ybar_C) <span class="sc">/</span> sd_pool</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SE of d</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>  SE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">4</span> <span class="sc">/</span> N <span class="sc">+</span> ES<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> (N <span class="sc">-</span> <span class="dv">2</span>)))</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">ES =</span> ES, <span class="at">SE =</span> SE, <span class="at">N =</span> N)</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>In action:</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="fl">0.2</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a><span class="fu">r_SMDs_raw</span>(<span class="at">delta =</span> delta, <span class="at">J =</span> <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">40</span>, <span class="at">Psi =</span> <span class="fl">0.6</span>)</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>Or if you'd rather specify the full $\Psi_k$ matrix yourself:</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>Psi_k <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="sc">+</span> <span class="fu">diag</span>(<span class="fl">0.4</span>, <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>Psi_k</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a><span class="fu">r_SMDs_raw</span>(<span class="at">delta =</span> delta, <span class="at">J =</span> <span class="dv">4</span>, <span class="at">N =</span> <span class="dv">40</span>, <span class="at">Psi =</span> Psi_k)</span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>The function above is serviceable but quite basic. I can think of several additional features that one might like to have for use in research simulations, but I'm feeling both cheeky and lazy at the moment, so I'll leave them for you, dear reader. Here are some suggested exercises:</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Add an argument to the function, <span class="in">`Hedges_g = TRUE`</span>, which controls where the simulated effect size is Hedges' $g$ or Cohen's $d$. If it is Hedges' g, make sure that the standard error is corrected too.</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Add an argument to the function, <span class="in">`p_val = TRUE`</span>, which allows the user to control whether or not to return $p$-values from the test of mean differences for each outcome. Note that the p-values should be for a test of the _raw_ mean differences between groups, rather than a test of the effect size $\delta_{jk} = 0$.</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Add an argument to the function, <span class="in">`corr_mat = FALSE`</span>, which controls whether the function returns just the simulated effect sizes and SEs or both the simulated effect sizes and the full sampling variance-covariance matrix of the effect sizes. See <span class="co">[</span><span class="ot">here</span><span class="co">](/posts/correlations-between-SMDs/)</span> for the relevant formulas.</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulating summary statistics</span></span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>Another approach to simulating SMDs is to sample from the distribution of the _summary statistics_ used in calculating the effect size. This approach should simplify the code, at the cost of having to use a bit of distribution theory. Let $\mathbf{\bar{y}}_{Tk}$ and $\mathbf{\bar{y}}_{Ck}$ be the $J_k \times 1$ vectors of sample means for the treatment and control groups, respectively. Let $\mathbf{S}_k$ be the $J_k \times J_k$ sample covariance matrix of the outcomes, pooled across the treatment and control groups. Again assuming multi-variate normality, and following the same notation as above:</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>\mathbf{\bar{y}}_{Ck} \sim N\left(\mathbf{0}, \frac{2}{N_k} \boldsymbol\Psi_k\right), \qquad \mathbf{\bar{y}}_{Tk} \sim N\left(\boldsymbol\delta_k, \frac{2}{N_k} \boldsymbol\Psi_k\right),</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>\left(\mathbf{\bar{y}}_{Tk} - \mathbf{\bar{y}}_{Ck}\right) \sim N\left(\boldsymbol\delta_k, \frac{4}{N_k} \boldsymbol\Psi_k\right).</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>This shows how we could directly simulate the numerator of the standardized mean difference.</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>A <span class="co">[</span><span class="ot">further bit of distribution theory</span><span class="co">](/posts/distribution-of-sample-variances/)</span> says that the pooled sample covariance matrix follows a multiple of a <span class="co">[</span><span class="ot">Wishart distribution</span><span class="co">](https://en.wikipedia.org/wiki/Wishart_distribution)</span> with $N_k - 2$ degrees of freedom and scale matrix $\Psi_k$:</span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>(N_k - 2) \mathbf{S}_k \sim Wishart\left(N_k - 2, \Psi_k \right).</span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>Thus, to simulate the denominators of the SMD estimates, we can simulate a single Wishart matrix, pull out the diagonal entries, divide by $N_k - 2$, and take the square root. In all, we draw a single $J_k \times 1$ observation from a multi-variate normal distribution and a single $J_k \times J_k$ observation from a Wishart distribution. In contrast, the raw data approach requires simulating $N_k$ observations from a multi-variate normal distribution, then calculating $4 J_k$ summary statistics (M and SD for each group on each outcome). </span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>Once again, I'll leave it to you, dear reader, to do the fun programming bits:</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Create a modified version of the function <span class="in">`r_SMDs_raw`</span> that simulates summary statistics instead of raw data (Call it <span class="in">`r_SMDs_stats`</span>). </span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Use the <span class="in">`microbenchmark`</span> package (or your preferred benchmarking tool) to compare the computational efficiency of both versions of the function.</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Check your work! Verify that both versions of the function generate the same distributions if the same parameters are used as input. </span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a><span class="fu"># Which approach is better?</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>Like many things in research, there's no clearly superior method here. The advantage of the summary statistics approach is computational efficiency. It should generally be faster than the raw data approach, and if you need to generate 10,000 meta-analysis each with 80 studies in them, the computational savings might add up. On the other hand, computational efficiency isn't everything. </span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>I see two potential advantages of the raw data approach. First is interpretability: simulating raw data is likely easier to understand. It feels tangible and familiar, harkening back to those bygone days we spent learning ANOVA, whereas the summary statistics approach requires a bit of distribution theory to follow (bookmark this blog post!). Second is extensibility: it is relatively straightforward to extend the approach to use other distributional models for the raw dat (perhaps you want to look at outcomes that follow a <span class="co">[</span><span class="ot">multi-variate $t$ distribution</span><span class="co">](https://en.wikipedia.org/wiki/Multivariate_t-distribution)</span>?) or more complicated estimators of the SMD (difference-in-differences? covariate-adjusted? cluster-randomized trial?). To use the summary statistics approach in more complicated scenarios, you'd have to work out the sampling distributions for yourself, or locate the right reference.</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>Of course, there's also no need to choose between these two approaches. As I'm trying to hint at in Exercise 6, it's actually useful to write both. Then, you can use the (potentially slower) raw data version to verify that the summary statistics version is correct.</span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulating full meta-analyses</span></span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>So far we've got a data-generating function that simulates a single study's worth of effect size estimates. To study meta-analytic methods, we'll need to build out the function to simulate multiple studies. To do so, I think it's useful to use the technique of <span class="co">[</span><span class="ot">mapping</span><span class="co">](https://r4ds.hadley.nz/iteration.html)</span>, as implemented in the <span class="in">`purrr`</span> package's <span class="in">`map_*`</span> functions. The idea here is to first generate a "menu" of study-specific parameters for each of $K$ studies, then apply the <span class="in">`r_SMDs`</span> function to each parameter set. </span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>Let's consider how to do this for a simple random effects model, where the true effect size parameter is constant within each study (i.e., $\boldsymbol\delta_k = (\delta_k \cdots \delta_k)'$), and in a model without covariates. We'll need to generate a true effect for each study, along with a sample size, an outcome dimension, and a correlation between outcomes. For the true effects, I'll assume that</span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>\delta_k \sim N(\mu, \tau^2),</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>J_k \sim 2 + Poisson(3),</span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>N_k \sim 20 + 2 \times Poisson(10),</span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>r_k \sim Beta\left(\rho \nu, (1 - \rho)\nu\right),</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>where $\rho = \text{E}(r_k)$ and $\nu &gt; 0$ controls the variability of $r_k$ across studies, with smaller $\nu$ corresponding to more variable correlations. </span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>Specifically, $\text{Var}(r_k) = \rho (1 - \rho) / (1 + \nu)$. </span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>These distributions are just made up, without any particular justification.</span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a>Here's what these distributional models look like in R code:</span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>J_mean <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>N_mean <span class="ot">&lt;-</span> <span class="dv">45</span></span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> <span class="dv">39</span></span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>study_data <span class="ot">&lt;-</span> </span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta =</span> <span class="fu">rnorm</span>(K, <span class="at">mean =</span> mu, <span class="at">sd =</span> tau),</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">J =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rpois</span>(K, J_mean <span class="sc">-</span> <span class="dv">2</span>),</span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rpois</span>(K, (N_mean <span class="sc">-</span> <span class="dv">20</span>) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">Psi =</span> <span class="fu">rbeta</span>(K, rho <span class="sc">*</span> nu, (<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> nu)</span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>study_data</span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a>Once we have the "menu" of study-level characteristics, it's just a matter of mapping the parameters to the data-generating function. One way to do this is with <span class="in">`pmap_df`</span>:</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a>meta_data <span class="ot">&lt;-</span> <span class="fu">pmap_df</span>(study_data, r_SMDs_raw, <span class="at">.id =</span> <span class="st">"study"</span>)</span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>meta_data</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta_data<span class="sc">$</span>study)</span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>Putting it all together into a function, we have</span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>r_meta <span class="ot">&lt;-</span> <span class="cf">function</span>(K, mu, tau, J_mean, N_mean, rho, nu) {</span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(purrr)</span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a>  study_data <span class="ot">&lt;-</span> </span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta =</span> <span class="fu">rnorm</span>(K, <span class="at">mean =</span> mu, <span class="at">sd =</span> tau),</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>      <span class="at">J =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fu">rpois</span>(K, J_mean <span class="sc">-</span> <span class="dv">2</span>),</span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>      <span class="at">N =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rpois</span>(K, (N_mean <span class="sc">-</span> <span class="dv">20</span>) <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>      <span class="at">Psi =</span> <span class="fu">rbeta</span>(K, rho <span class="sc">*</span> nu, (<span class="dv">1</span> <span class="sc">-</span> rho) <span class="sc">*</span> nu)</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_df</span>(study_data, r_SMDs_raw, <span class="at">.id =</span> <span class="st">"study"</span>)</span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>Modify <span class="in">`r_meta`</span> so that it uses <span class="in">`r_SMDs_stats`</span>.</span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>Add options to <span class="in">`r_meta`</span> for <span class="in">`Hedges_g`</span>, <span class="in">`p_val = TRUE`</span>, and <span class="in">`corr_mat = FALSE`</span> and ensure that these get passed along to the <span class="in">`r_SMDs`</span> function.</span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>One way to check that the <span class="in">`r_meta`</span> function is working properly is to generate a very large meta-analytic dataset, then to verify that the generated distributions align with expectations. Here's a very large meta-analytic dataset:</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, indent = "    ", eval = FALSE}</span></span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a><span class="in">meta_data &lt;- r_meta(</span></span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a><span class="in">  100000, </span></span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a><span class="in">  mu = 0.2, tau = 0.05, </span></span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a><span class="in">  J_mean = 5, N_mean = 40, </span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a><span class="in">  rho = 0.6, nu = 39</span></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a><span class="in">    Compare the distribution of the simulated dataset against what you would expect to get based on the input parameters.</span></span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Modify the <span class="in">`r_meta`</span> function so that $J_k$ and $N_k$ are correlated, according to</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>    \begin{align}</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a>    J_k &amp;\sim 2 + Poisson(\mu_J - 2) <span class="sc">\\</span></span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>    N_k &amp;\sim 20 + 2 \times Poisson\left(\frac{1}{2}(\mu_N - 20) + \alpha (J_k - \mu_J) \right)</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>    \end{align}</span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a>    for user-specified values of $\mu_J$ (the average number of outcomes per study), $\mu_N$ (the average total sample size per study), and $\alpha$, which controls the degree of dependence between $J_k$ and $N_k$.</span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a><span class="fu">## A challenge</span></span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a>The meta-analytic model that we're using here is quite simple---simplistic, even---and for some simulation studies, something more complex might be needed. For example, we might need to generate data from a model that includes within-study random effects, as in:</span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a>\delta_{jk} = \mu + u_k + v_{jk}, \quad \text{where}\quad u_k \sim N(0, \tau^2), \quad v_{jk} \sim N(0, \omega^2).</span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a>Even more complex would be to simulate from a multi-level meta-regression model</span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a>\delta_{jk} = \mathbf{x}_{jk} \boldsymbol\beta + u_k + v_{jk}, \quad \text{where}\quad u_k \sim N(0, \tau^2), \quad v_{jk} \sim N(0, \omega^2),</span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>where $\mathbf{x}_{jk}$ is a $1 \times p$ row-vector of covariates describing outcome $j$ in study $k$ and $\boldsymbol\beta$ is a $p \times 1$ vector of meta-regression coefficients. In past work, I've done this by writing a data-generating function that takes a fixed design matrix $\mathbf{X} = \left(\mathbf{x}_{11}' \cdots \mathbf{x}_{J_K K}'\right)'$ as an input argument, along with $\boldsymbol\beta$. The design matrix would also include an identifier for each unique study. There are surely better (simpler, easier to follow) ways to implement the multi-level meta-regression model. I'll once again leave it to you to work out an approach.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>