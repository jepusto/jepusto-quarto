<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>James E. Pustejovsky</title>
<link>https://jepusto.com/posts/</link>
<atom:link href="https://jepusto.com/posts/index.xml" rel="self" type="application/rss+xml"/>
<description>Education Statistics and Meta-Analysis</description>
<generator>quarto-1.4.552</generator>
<lastBuildDate>Thu, 28 Mar 2024 05:00:00 GMT</lastBuildDate>
<item>
  <title>Distribution of the number of significant effect sizes</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Distribution-of-signficant-effects/</link>
  <description><![CDATA[ 





<p><a href="../..\number-of-significant-effects/">A while back</a>, I posted the outline of a problem about the number of significant effect size estimates in a study that reports multiple outcomes. This problem interests me because it connects to the issue of selective reporting of study results, which creates problems for meta-analysis. Here, I’ll re-state the problem in slightly more general terms and then make some notes about what’s going on.</p>
<p>Consider a study that assesses some effect size across <img src="https://latex.codecogs.com/png.latex?m"> different outcomes. (We’ll be thinking about one study at a time here, so no need to index the study as we would in a meta-analysis problem.) Let <img src="https://latex.codecogs.com/png.latex?T_i"> denote the effect size estimate for outcome <img src="https://latex.codecogs.com/png.latex?i">, let <img src="https://latex.codecogs.com/png.latex?V_i"> denote the sampling variance of the effect size estimate for outcome <img src="https://latex.codecogs.com/png.latex?i">, and let <img src="https://latex.codecogs.com/png.latex?%5Ctheta_i"> denote the true effect size parameter for corresponding to outcome <img src="https://latex.codecogs.com/png.latex?i">. Assume that the study outcomes <img src="https://latex.codecogs.com/png.latex?%5Cleft%5BT_i%5Cright%5D_%7Bi=1%7D%5Em"> follow a correlated-and-hierarchical effects model, in which <img src="https://latex.codecogs.com/png.latex?T_i%20=%20%5Cmu%20+%20u%20+%20v_i%20+%20e_i,"> where the study-level error <img src="https://latex.codecogs.com/png.latex?u%20%5Csim%20N%5Cleft(0,%5Ctau%5E2%5Cright)">, the effect-specific error <img src="https://latex.codecogs.com/png.latex?v_i%20%5Cstackrel%7Biid%7D%7B%5Csim%7D%20N%5Cleft(0,%20%5Comega%5E2%5Cright)">, and the vector of sampling errors <img src="https://latex.codecogs.com/png.latex?%5Cleft%5Be_i%5Cright%5D_%7Bi=1%7D%5Em"> is multivariate normal with mean <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B0%7D">, known variances <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(e_i)%20=%20%5Csigma%5E2">, and compound symmetric correlation structure <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bcor%7D(e_h,%20e_i)%20=%20%5Crho">.</p>
<p>Define <img src="https://latex.codecogs.com/png.latex?A_i"> as an indicator that is equal to one if <img src="https://latex.codecogs.com/png.latex?T_i"> is statistically significant at level <img src="https://latex.codecogs.com/png.latex?%5Calpha"> based on a one-sided test, and otherwise equal to zero. (Equivalently, let <img src="https://latex.codecogs.com/png.latex?A_i"> be equal to one if the effect is statistically significant at level <img src="https://latex.codecogs.com/png.latex?2%20%5Calpha"> and in the theoretically expected direction.) Formally, <img src="https://latex.codecogs.com/png.latex?A_i%20=%20I%5Cleft(%5Cfrac%7BT_i%7D%7B%5Csigma%7D%20%3E%20q_%5Calpha%20%5Cright)"> where <img src="https://latex.codecogs.com/png.latex?q_%5Calpha%20=%20%5CPhi%5E%7B-1%7D(1%20-%20%5Calpha)"> is the critical value from a standard normal distribution (e.g., <img src="https://latex.codecogs.com/png.latex?q_%7B.05%7D%20=%201.645">, <img src="https://latex.codecogs.com/png.latex?q_%7B.025%7D%20=%201.96">). Let <img src="https://latex.codecogs.com/png.latex?N_A%20=%20%5Csum_%7Bi=1%7D%5Em%20A_i"> denote the total number of statistically significant effect sizes in the study. The question is: what is the distribution of <img src="https://latex.codecogs.com/png.latex?N_A">.</p>
<section id="compound-symmetry-to-the-rescue" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="compound-symmetry-to-the-rescue">Compound symmetry to the rescue</h2>
<p>As I noted in the previous post, this set-up means that the effect size estimates have a compound symmetric distribution. We can make this a bit more explicit by writing the sampling errors in terms of the sum of a component that’s common acrosss outcomes and a component that’s specific to each outcome. Thus, let <img src="https://latex.codecogs.com/png.latex?e_i%20=%20f%20+%20g_i">, where <img src="https://latex.codecogs.com/png.latex?f%20%5Csim%20N%5Cleft(0,%20%5Crho%20%5Csigma%5E2%20%5Cright)"> and <img src="https://latex.codecogs.com/png.latex?g_i%20%5Cstackrel%7Biid%7D%7B%5Csim%7D%20N%20%5Cleft(0,%20(1%20-%20%5Crho)%20%5Csigma%5E2%5Cright)">. Let me also define <img src="https://latex.codecogs.com/png.latex?%5Czeta%20=%20%5Cmu%20+%20u%20+%20f"> as the conditional mean of the effects. It then follows that the effect size estimates are <em>conditionally independent</em>, given the common components: <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft(T_i%20%7C%20%5Czeta%20%5Cright)%20%5Cstackrel%7Biid%7D%7B%5Csim%7D%20N%5Cleft(%5Czeta,%20%5Comega%5E2%20+%20(1%20-%20%5Crho)%20%5Csigma%5E2%5Cright)%0A"> Furthermore, the conditional probability of a significant effect is <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPr%7D(A_i%20=%201%20%7C%20%5Czeta)%20=%20%5CPhi%5Cleft(%5Cfrac%7B%5Czeta%20-%20q_%7B%5Calpha%7D%20%5Csigma%7D%7B%5Csqrt%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D%7D%5Cright)%0A"> and <img src="https://latex.codecogs.com/png.latex?A_1,...,A_m"> are mutually independent, conditional on <img src="https://latex.codecogs.com/png.latex?%5Czeta">. Therefore, the conditional distribution of <img src="https://latex.codecogs.com/png.latex?N_A"> is binomial, <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft(N_A%20%7C%20%5Czeta%5Cright)%20%5Csim%20Bin(m,%20%5Cpi)%0A"> where <img src="https://latex.codecogs.com/png.latex?%0A%5Cpi%20=%20%5CPhi%5Cleft(%5Cfrac%7B%5Czeta%20-%20q_%7B%5Calpha%7D%20%5Csigma%7D%7B%5Csqrt%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D%7D%5Cright).%0A"> What about the unconditional distribution?</p>
<p>To get rid of the <img src="https://latex.codecogs.com/png.latex?%5Czeta">, we need to integrate over its distribution, which leads to <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPr%7D(N_A%20=%20a)%20=%20%5Ctext%7BE%7D%5Cleft%5B%5Ctext%7BPr%7D%5Cleft(N_A%20%7C%20%5Czeta%5Cright)%5Cright%5D%20=%20%5Cint%20f_%7BN_A%7D%5Cleft(a%20%7C%20%5Czeta,%20%5Comega,%20%5Csigma,%20%5Crho,%20m%5Cright)%20%5Ctimes%20f_%5Czeta(%5Czeta%20%7C%20%5Cmu,%20%5Ctau,%20%5Csigma,%20%5Crho)%20%5C%20d%20%5Czeta,%0A"> where <img src="https://latex.codecogs.com/png.latex?f_%7BN_A%7D%5Cleft(a%20%7C%20%5Czeta,%20%5Comega,%20%5Csigma,%20%5Crho%20%5Cright)"> is a binomial density with size <img src="https://latex.codecogs.com/png.latex?m"> and probability <img src="https://latex.codecogs.com/png.latex?%5Cpi%20=%20%5Cpi(%5Czeta,%20%5Comega,%20%5Csigma,%20%5Crho)"> and <img src="https://latex.codecogs.com/png.latex?f_%5Czeta(%5Czeta%20%7C%20%5Cmu,%20%5Ctau,%20%5Csigma,%20%5Crho)"> is a normal density with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and variance <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2%20+%20%5Crho%20%5Csigma%5E2">.</p>
<p>This distribution is what you might call a binomial-normal convolution or a random-intercept probit model (where the random intercept is <img src="https://latex.codecogs.com/png.latex?%5Czeta">). As far as I know, the distribution cannot be evaluated analytically but instead must be calculated using some sort of numerical integration routine. Here is an interactive graph of the probability mass function (the probability points are calculated using Gaussian quadrature):</p>
<div class="cell">
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="67" data-source-offset="-0" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 66;"><span id="cb1-67">math <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">require</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mathjs"</span>)</span>
<span id="cb1-68">norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://unpkg.com/norm-dist@3.1.0/index.js?module'</span>)</span>
<span id="cb1-69"></span>
<span id="cb1-70">quad_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">JSON</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(all_quad_points)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">at</span>(qp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-71"></span>
<span id="cb1-72">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> math<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(ESS)</span>
<span id="cb1-73"></span>
<span id="cb1-74">zeta_sd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> math<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(tau<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-75"></span>
<span id="cb1-76">crit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">icdf</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha)</span>
<span id="cb1-77"></span>
<span id="cb1-78">binomial_coefs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Array</span>(m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fill</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>index) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb1-79">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> math<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">combinations</span>(m<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> index)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-80">})</span>
<span id="cb1-81"></span>
<span id="cb1-82">probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quad_points<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(zeta <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb1-83">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (zeta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> zeta_sd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> crit <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> math<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(omega<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-84">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [norm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cdf</span>(Z)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> zeta[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-85">})</span>
<span id="cb1-86"></span>
<span id="cb1-87">p_binom_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> binomial_coefs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((coef<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> a) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb1-88">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">let</span> p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> probs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>((x) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">=&gt;</span> {</span>
<span id="cb1-89">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> (x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>a) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>(m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> a)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-90">  })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-91">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> coef <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> math<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(p)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-92">})</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="grid column-page-inset">
<div class="g-col-7">
<div class="cell">
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="99" data-source-offset="0" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 98;"><span id="cb2-99">Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>({</span>
<span id="cb2-100">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">x</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb2-101">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of significant effect sizes"</span></span>
<span id="cb2-102">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-103">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">y</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb2-104">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">domain</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-105">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability"</span></span>
<span id="cb2-106">  }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-107">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">marks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [</span>
<span id="cb2-108">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ruleY</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-109">    Plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">barY</span>(p_binom_norm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> {</span>
<span id="cb2-110">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fill</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"steelblue"</span></span>
<span id="cb2-111">    })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb2-112">  ]</span>
<span id="cb2-113">})</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="g-col-5">
<div class="cell panel-input card bg-light p-2">
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="124" data-source-offset="-1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 123;"><span id="cb3-124">viewof m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-125">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-126">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of effect sizes (m):"</span>}</span>
<span id="cb3-127">)</span>
<span id="cb3-128"></span>
<span id="cb3-129">viewof ESS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-130">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-131">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effective sample size:"</span>}</span>
<span id="cb3-132">)</span>
<span id="cb3-133"></span>
<span id="cb3-134">viewof mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-135">  [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-136">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average effect size (mu):"</span>}</span>
<span id="cb3-137">)</span>
<span id="cb3-138"></span>
<span id="cb3-139">viewof tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-140">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-141">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Between-study SD (tau):"</span>}</span>
<span id="cb3-142">)</span>
<span id="cb3-143"></span>
<span id="cb3-144">viewof omega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-145">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-146">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Within-study SD (omega):"</span>}</span>
<span id="cb3-147">)</span>
<span id="cb3-148"></span>
<span id="cb3-149">viewof rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-150">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-151">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sampling error correlation (rho):"</span>}</span>
<span id="cb3-152">)</span>
<span id="cb3-153"></span>
<span id="cb3-154">viewof alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-155">  [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.005</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.995</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-156">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bn" style="color: #AD0000;
background-color: null;
font-style: inherit;">005</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"One-sided significance threshold (alpha):"</span>}</span>
<span id="cb3-157">)</span>
<span id="cb3-158"></span>
<span id="cb3-159">viewof qp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Inputs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(</span>
<span id="cb3-160">  [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> </span>
<span id="cb3-161">  {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">step</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">label</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Number of quadrature points:"</span>}</span>
<span id="cb3-162">)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="just-the-moments-please" class="level2">
<h2 class="anchored" data-anchor-id="just-the-moments-please">Just the moments, please</h2>
<p>If all we care about is the expectation of <img src="https://latex.codecogs.com/png.latex?N_A">, we don’t need to bother with all the conditioning business and can just look at the marginal distribution of the effect size estimates taken individually. Marginally, <img src="https://latex.codecogs.com/png.latex?T_i"> is normally distributed with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and variance <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2%20+%20%5Comega%5E2%20+%20%5Csigma%5E2">, so <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BPr%7D(A_i%20=%201)%20=%20%5Cpsi">, where <img src="https://latex.codecogs.com/png.latex?%0A%5Cpsi%20=%20%5CPhi%5Cleft(%5Cfrac%7B%5Cmu%20-%20q_%7B%5Calpha%7D%20%5Csigma%7D%7B%5Csqrt%7B%5Ctau%5E2%20+%20%5Comega%5E2%20+%20%5Csigma%5E2%7D%7D%5Cright).%0A"> By the linearity of expectations, <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BE%7D(N_A)%20=%20%5Csum_%7Bi=1%7D%5Em%20%5Ctext%7BE%7D(A_i)%20=%20m%20%5Cpsi.%0A"></p>
<p>We can also get an approximation for the variance of <img src="https://latex.codecogs.com/png.latex?N_A"> by working with its conditional distribution above. By the rule of variance decomposition, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctext%7BVar%7D(N_A)%20&amp;=%20%5Ctext%7BE%7D%5Cleft%5B%5Ctext%7BVar%7D%5Cleft(N_A%20%7C%20%5Czeta%5Cright)%5Cright%5D%20+%20%5Ctext%7BVar%7D%5Cleft%5B%5Ctext%7BE%7D%5Cleft(N_A%20%7C%20%5Czeta%5Cright)%5Cright%5D%20%5C%5C%0A&amp;=%20m%20%5Ctimes%20%5Ctext%7BE%7D%5Cleft%5B%5Cpi%20(1%20-%20%5Cpi)%5Cright%5D%20+%20m%5E2%20%5Ctimes%20%5Ctext%7BVar%7D%5Cleft%5B%5Cpi%5Cright%5D%5C%5C%0A&amp;=%20m%20%5Ctimes%20%5Ctext%7BE%7D%5Cleft%5B%5Cpi%5Cright%5D%20%5Cleft(1%20-%20%5Ctext%7BE%7D%5Cleft%5B%5Cpi%5Cright%5D%5Cright)%20+%20m%20(m%20-%201)%20%5Ctimes%20%5Ctext%7BVar%7D%5Cleft%5B%5Cpi%5Cright%5D,%0A%5Cend%7Baligned%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cpi"> is, as defined above, a function of <img src="https://latex.codecogs.com/png.latex?%5Czeta"> and thus a random variable. Now, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BE%7D(%5Cpi)%20=%20%5Cpsi"> and we can get something close to <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cpi)"> using a first-order approximation: <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D%5Cleft(%5Cpi%5Cright)%20%5Capprox%20%5Cleft(%5Cleft.%5Cfrac%7B%5Cdelta%20%5Cpi%7D%7B%5Cdelta%20%5Czeta%7D%5Cright%7C_%7B%5Czeta%20=%20%5Cmu%7D%5Cright)%5E2%20%5Ctimes%20%5Ctext%7BVar%7D%5Cleft(%5Czeta%5Cright)%20=%20%5Cleft%5B%5Cphi%5Cleft(%5Cfrac%7B%5Cmu%20-%20q_%7B%5Calpha%7D%20%5Csigma%7D%7B%5Csqrt%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D%7D%5Cright)%5Cright%5D%5E2%20%5Ctimes%20%5Cfrac%7B%5Ctau%5E2%20+%20%5Crho%20%5Csigma%5E2%7D%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D.%0A"> Thus, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctext%7BVar%7D(N_A)%20%5Capprox%20m%20%5Ctimes%20%5Cpsi%20%5Cleft(1%20-%20%5Cpsi%5Cright)%20+%20m%20(m%20-%201)%20%5Ctimes%20%5Cleft%5B%5Cphi%5Cleft(%5Cfrac%7B%5Cmu%20-%20q_%7B%5Calpha%7D%20%5Csigma%7D%7B%5Csqrt%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D%7D%5Cright)%5Cright%5D%5E2%20%5Ctimes%20%5Cfrac%7B%5Ctau%5E2%20+%20%5Crho%20%5Csigma%5E2%7D%7B%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma%5E2%7D.%0A%5Cend%7Baligned%7D%0A"> If the amount of common variation is small, so <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> is near zero and <img src="https://latex.codecogs.com/png.latex?%5Crho"> is near zero, then the contribution of the second term will be small, and <img src="https://latex.codecogs.com/png.latex?N_A"> will act more or less like a binomial random variable with size <img src="https://latex.codecogs.com/png.latex?m"> and probability <img src="https://latex.codecogs.com/png.latex?%5Cpsi">. On the other hand, if the amount of independent variation in the effect sizes is small, so <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> is near zero and <img src="https://latex.codecogs.com/png.latex?%5Crho"> is near 1, then the term on the right will approach <img src="https://latex.codecogs.com/png.latex?m(m%20-%201)%5Cpsi(1%20-%20%5Cpsi)"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D%5Cleft(N_A%5Cright)"> will approach <img src="https://latex.codecogs.com/png.latex?m%5E2%20%5Cpsi(1%20-%20%5Cpsi)">, or the variance of <img src="https://latex.codecogs.com/png.latex?m"> times a single Bernoulli variate. So you could say that <img src="https://latex.codecogs.com/png.latex?N_A"> has anywhere between <img src="https://latex.codecogs.com/png.latex?1"> and <img src="https://latex.codecogs.com/png.latex?m"> variate’s worth of information in it, depending on the degree of correlation between the effect size estimates.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2024,
  author = {Pustejovsky, James E.},
  title = {Distribution of the Number of Significant Effect Sizes},
  date = {2024-03-28},
  url = {https://jepusto.com/posts/Distribution-of-signficant-effects},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2024" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2024. <span>“Distribution of the Number of
Significant Effect Sizes.”</span> March 28, 2024. <a href="https://jepusto.com/posts/Distribution-of-signficant-effects">https://jepusto.com/posts/Distribution-of-signficant-effects</a>.
</div></div></section></div> ]]></description>
  <category>effect size</category>
  <category>distribution theory</category>
  <guid>https://jepusto.com/posts/Distribution-of-signficant-effects/</guid>
  <pubDate>Thu, 28 Mar 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Approximating the distribution of cluster-robust Wald statistics</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Approximating-cluster-robust-Wald-tests/</link>
  <description><![CDATA[ 





<p>In <a href="http://doi.org/10.3102/1076998615606099">Tipton and Pustejovsky (2015)</a>, we examined several different small-sample approximations for cluster-robust Wald test statistics, which are like <img src="https://latex.codecogs.com/png.latex?F"> statistics but based on cluster-robust variance estimators. These statistics are, frankly, kind of weird and awkward to work with, and the approximations that we examined were far from perfect. In this post, I will look in detail at the robust Wald statistic for a simple but common scenario: a one-way ANOVA problem with clusters of dependent observations. <img src="https://latex.codecogs.com/png.latex?%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Ccor%7B%7B%5Ctext%7Bcor%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D"></p>
<p>Consider a setup where clusters can be classified into one of <img src="https://latex.codecogs.com/png.latex?C"> categories, with each cluster of observations falling into a single category. Let <img src="https://latex.codecogs.com/png.latex?%5Cbs%5Cmu%20=%20%5Cleft%5B%5Cmu_c%20%5Cright%5D_%7Bc=1%7D%5EC"> denote the means of these categories. Suppose we have an estimator of those means <img src="https://latex.codecogs.com/png.latex?%5Cbs%7B%5Chat%5Cmu%7D%20=%20%5Cleft%5B%5Chat%5Cmu_c%5Cright%5D_%7Bc=1%7D%5EC"> and a corresponding cluster-robust variance estimator <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BV%7D%5ER%20=%20%5Cbigoplus_%7Bc=1%7D%5EC%20V%5ER_c">. Note that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BV%7D%5ER"> is diagonal because the estimators for each category are independent. Assume that the robust variance estimator is unbiased so <img src="https://latex.codecogs.com/png.latex?%5CE%5Cleft(V%5ER_c%5Cright)%20=%20%5CVar%5Cleft(%20%5Chat%5Cmu_c%20%5Cright)%20=%20%5Cpsi_c"> for <img src="https://latex.codecogs.com/png.latex?c%20=%201,...,C">. Let <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPsi%20=%20%5Cbigoplus_%7Bc=1%7D%5EC%20%5Cpsi_c">.</p>
<p>Suppose that we want to test the null hypothesis that that means of the categories are all equal, <img src="https://latex.codecogs.com/png.latex?H_0:%20%5Cmu_1%20=%20%5Cmu_2%20=%20%5Ccdots%20=%20%5Cmu_C">. We can express this null using a <img src="https://latex.codecogs.com/png.latex?q%20%5Ctimes%20C"> contrast matrix <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BC%7D%20=%20%5Cleft%5B-%5Cbm%7B1%7D_q%20%5C%20%5Cbm%7BI%7D_q%20%5Cright%5D">, where <img src="https://latex.codecogs.com/png.latex?q%20=%20C%20-%201">. The null hypothesis is then <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BC%7D%20%5Cbs%5Cmu%20=%20%5Cbm%7B0%7D_q">. The corresponding cluster-robust Wald statistic is <img src="https://latex.codecogs.com/png.latex?%0AQ%20=%20%5Cbs%7B%5Chat%5Cmu%7D'%20%5Cbm%7BC%7D'%20%5Cleft(%5Cbm%7BC%7D%20%5Cbm%7BV%7D%5ER%20%5Cbm%7BC%7D'%5Cright)%5E%7B-1%7D%20%5Cbm%7BC%7D%20%5Cbs%7B%5Chat%5Cmu%7D.%0A"> Under the null hypothesis, the distribution of <img src="https://latex.codecogs.com/png.latex?Q"> will converge to a <img src="https://latex.codecogs.com/png.latex?%5Cchi%5E2_q"> as the number of clusters in each category grows large. However, with a limited number of clusters in some of the categories, this approximate reference distribution is not very accurate and tests based on it can have wildly inflated type I error rates.</p>
<p>In the paper, we considered several different ways of approximating the distribution of <img src="https://latex.codecogs.com/png.latex?Q"> that work at smaller sample sizes. One class of approaches to approximating the sampling distribution of <img src="https://latex.codecogs.com/png.latex?Q"> is to use a Hotelling’s <img src="https://latex.codecogs.com/png.latex?T%5E2"> distribution with degrees of freedom <img src="https://latex.codecogs.com/png.latex?%5Ceta">. Given the degrees of freedom, Hotelling’s <img src="https://latex.codecogs.com/png.latex?T%5E2"> is a multiple of an <img src="https://latex.codecogs.com/png.latex?F"> distribution: <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Ceta%20-%20q%20+%201%7D%7B%5Ceta%20q%7D%20Q%20%5Csim%20F(q,%20%5Ceta%20-%20q%20+%201).%0A"> The question is then how to determine <img src="https://latex.codecogs.com/png.latex?%5Ceta">.</p>
<p>Several of the approaches that we considered are based on representing the <img src="https://latex.codecogs.com/png.latex?Q"> statistic as <img src="https://latex.codecogs.com/png.latex?%0AQ%20=%20%5Cbm%7Bz%7D'%20%5Cbm%7BD%7D%5E%7B-1%7D%20%5Cbm%7Bz%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbs%5COmega%20=%20%5Cbm%7BC%7D%20%5Cbs%5CPsi%20%5Cbm%7BC%7D'">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7Bz%7D%20=%20%5Cbs%5COmega%5E%7B-1/2%7D%5Cbm%7BC%7D%5Chat%5Cmu_c">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BG%7D%20=%20%5Cbs%5COmega%5E%7B-1/2%7D%20%5Cbm%7BC%7D">, and <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BD%7D%20=%20%5Cbm%7BG%7D%20%5Cbm%7BV%7D%5ER%20%5Cbm%7BG%7D'.%0A"> The various approaches we considered involve different ways of approximating the sampling distribution of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D">.</p>
<p>One of the approximations involves finding degrees of freedom <img src="https://latex.codecogs.com/png.latex?%5Ceta"> by following a strategy suggested by Zhang (<a href="https://doi.org/10.1016/j.jspi.2011.07.023">2012</a>, <a href="https://doi.org/10.14419/ijasp.v1i2.908">2013</a>). These degrees of freedom are given by <img src="https://latex.codecogs.com/png.latex?%0A%5Ceta_Z%20=%20%5Cfrac%7Bq(q%20+%201)%7D%7B%5Csum_%7Bs=1%7D%5Eq%20%5Csum_%7Bt%20=%201%7D%5Eq%20%5CVar(d_%7Bst%7D)%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?d_%7Bst%7D"> is the entry in row <img src="https://latex.codecogs.com/png.latex?s">, column <img src="https://latex.codecogs.com/png.latex?t"> of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D">. To find <img src="https://latex.codecogs.com/png.latex?%5Ceta_Z">, we can compute the denominator using general formulas given in the paper. However, with a bit of analysis we can find a much simpler expression for the special case of one-way ANOVA.</p>
<p>Before going further, it’s useful to observe that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D"> is invariant to linear transformations of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BC%7D">. In particular, an equivalent way to write the null hypothesis is as <img src="https://latex.codecogs.com/png.latex?H_0:%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7BC%7D%20=%20%5Cbm%7B0%7D_q">, where <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPsi_%7B%5Ccirc%7D%20=%20%5Cbigoplus_%7Bc=2%7D%5EC%20%5Cpsi_c"> is the diagonal of the true sampling variances of categories 2 through <img src="https://latex.codecogs.com/png.latex?C">, omitting the first category. Thus, let me redefine <img src="https://latex.codecogs.com/png.latex?%0A%5Cbs%5COmega%20=%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7BC%7D%20%5Cbs%5CPsi%20%5Cbm%7BC%7D'%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D,%0A"> <img src="https://latex.codecogs.com/png.latex?%5Cbm%7Bz%7D%20=%20%5Cbs%5COmega%5E%7B-1/2%7D%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%5Cbm%7BC%7D%5Chat%5Cmu_c">, and <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BG%7D%20=%20%5Cbs%5COmega%5E%7B-1/2%7D%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7BC%7D.%0A"> This transformation of the constraint matrix will make it possible to find a closed-form expression for <img src="https://latex.codecogs.com/png.latex?%5Cbs%5COmega%5E%7B-1/2%7D">.</p>
<p>Now, observe that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cbs%5COmega%20&amp;=%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7BC%7D%20%5Cbs%5CPsi%20%5Cbm%7BC%7D'%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5C%5C%0A&amp;=%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cleft(%5Cbs%5CPsi_%7B%5Ccirc%7D%20+%20%5Cpsi_1%20%5Cbm%7B1%7D_q%20%5Cbm%7B1%7D_q'%5Cright)%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5C%5C%0A&amp;=%20%5Cbm%7BI%7D_q%20+%20%5Cpsi_1%20%5Cbm%7Bf%7D%20%5Cbm%7Bf%7D',%0A%5Cend%7Baligned%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7Bf%7D%20=%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7B1%7D_q%20=%20%5Cleft%5B%20%5Cpsi_c%5E%7B-1/2%7D%5Cright%5D_%7Bc%20=%202%7D%5EC">. From the <a href="\bs\Psi_{\circ}^{-1/2}">Woodbury identity</a>, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbs%5COmega%5E%7B-1%7D%20=%20%5Cbm%7BI%7D%20-%20%5Cfrac%7B1%7D%7BW%7D%20%5Cbm%7Bf%7D%20%5Cbm%7Bf%7D',%0A"> where <img src="https://latex.codecogs.com/png.latex?W%20=%20%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B1%7D%7B%5Cpsi_c%7D">.</p>
<p><a href="https://doi.org/10.1137/22M1471559">Fasi, Higham, and Liu (2023)</a> provide formulas for <img src="https://latex.codecogs.com/png.latex?p%5E%7Bth%7D"> roots of low-rank updates to scaled identity matrices. Their results provide a neat closed-form expression for <img src="https://latex.codecogs.com/png.latex?%5Cbs%5COmega%5E%7B-1/2%7D">. From their Equation (1.9), <img src="https://latex.codecogs.com/png.latex?%0A%5Cbs%5COmega%5E%7B-1/2%7D%20=%20%5Cmathbf%7BI%7D_q%20-%20%5Ckappa%20%5C%20%5Cbm%7Bf%7D%20%5Cbm%7Bf%7D',%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ckappa%20=%20%5Cfrac%7B%5Csqrt%7B%5Cpsi_1%7D%7D%7BW%20%5Csqrt%7B%5Cpsi_1%7D%20+%20%5Csqrt%7BW%7D%7D">. Further, we can write the <img src="https://latex.codecogs.com/png.latex?q%20%5Ctimes%20C"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BG%7D"> as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cbm%7BG%7D%20&amp;=%20%5Cbs%5COmega%5E%7B-1/2%7D%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cbm%7BC%7D%20%5C%5C%0A&amp;=%20%5Cleft(%20%5Cmathbf%7BI%7D_q%20-%20%5Ckappa%20%5C%20%5Cbm%7Bf%7D%20%5Cbm%7Bf%7D'%20%5Cright)%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%20%5Cleft%5B-%5Cbm%7B1%7D_q,%20%5C%20%5Cbm%7BI%7D_q%20%5Cright%5D%20%5C%5C%0A&amp;=%20%5Cleft%5B%5Cfrac%7B%5Ckappa(W%20%5Cpsi_1%20-%201)%20-%20%5Cpsi_1%7D%7B%5Cpsi_1%7D%20%5Cbm%7Bf%7D,%20%20%5Cleft(%20%5Cmathbf%7BI%7D_q%20-%20%5Ckappa%20%5C%20%5Cbm%7Bf%7D%20%5Cbm%7Bf%7D'%20%5Cright)%20%5Cbs%5CPsi_%7B%5Ccirc%7D%5E%7B-1/2%7D%5Cright%5D,%0A%5Cend%7Baligned%7D%0A"> with entries given by <img src="https://latex.codecogs.com/png.latex?%0Ag_%7Bsc%7D%20=%20%5Cbegin%7Bcases%7D%0A%5Cfrac%7B%5Ckappa(W%20%5Cpsi_1%20-%201)%20-%20%5Cpsi_1%7D%7B%5Cpsi_1%20%5Csqrt%7B%5Cpsi_%7Bs+1%7D%7D%7D%20&amp;%20%5Ctext%7Bif%7D%20%5Cquad%20c%20=%201%20%5C%5C%0A%5Cfrac%7BI(s+1%20=%20c)%7D%7B%5Csqrt%7B%5Cpsi_%7Bc%7D%7D%7D%20-%20%5Cfrac%7B%5Ckappa%7D%7B%5Cpsi_c%20%5Csqrt%7B%5Cpsi_%7Bs+1%7D%7D%7D%20&amp;%20%5Ctext%7Bif%7D%20%5Cquad%20c%20%3E%201.%0A%5Cend%7Bcases%7D%0A"> Because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D%20=%20%5Cbm%7BG%7D%20%5Cbm%7BV%7D%5ER%20%5Cbm%7BG%7D'"> and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BV%7D%5ER"> is diagonal, we can write the entries of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D"> as <img src="https://latex.codecogs.com/png.latex?%0Ad_%7Bst%7D%20=%20%5Csum_%7Bc=1%7D%5EC%20g_%7Bsc%7D%20g_%7Btc%7D%20V%5ER_c.%0A"> And because the variance estimators for each category are independent, <img src="https://latex.codecogs.com/png.latex?%0A%5CVar(d_%7Bst%7D)%20=%20%5Csum_%7Bc=1%7D%5EC%20g_%7Bsc%7D%5E2%20g_%7Btc%7D%5E2%20%5CVar(V%5ER_c).%0A"> In <a href="../..\publication/power-approximations-for-dependent-effects/">prior work</a>, we derived expressions for the Satterthwaite degrees of freedom for variances of average effect sizes, and the same formulas can be applied here with the category-specific <img src="https://latex.codecogs.com/png.latex?V%5ER_c">. Let me write <img src="https://latex.codecogs.com/png.latex?%5Cnu_c%20=%202%5Cleft%5B%5CE(V%5ER_c)%5Cright%5D%5E2%20/%20%5CVar(V%5ER_c)"> for the degrees of freedom corresponding to category <img src="https://latex.codecogs.com/png.latex?c">. Then <img src="https://latex.codecogs.com/png.latex?%0A%5CVar(d_%7Bst%7D)%20=%202%20%5Csum_%7Bc=1%7D%5EC%20g_%7Bsc%7D%5E2%20g_%7Btc%7D%5E2%20%5Cfrac%7B%5Cpsi_c%5E2%7D%7B%5Cnu_c%7D.%0A"> We can use this to obtain an expression for Zhang’s approximate degrees of freedom: <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Aq(q%20+%201)%5Ceta_Z%5E%7B-1%7D%20&amp;=%20%5Csum_%7Bs=1%7D%5Eq%20%5Csum_%7Bt%20=%201%7D%5Eq%20%5CVar(d_%7Bst%7D)%20%5C%5C%0A&amp;=%202%5Csum_%7Bs=1%7D%5Eq%20%5Csum_%7Bt%20=%201%7D%5Eq%20%5Csum_%7Bc=1%7D%5EC%20g_%7Bsc%7D%5E2%20g_%7Btc%7D%5E2%20%5Cfrac%7B%5Cpsi_c%5E2%7D%7B%5Cnu_c%7D%20%5C%5C%0A&amp;=%202%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B%5Cpsi_c%5E2%7D%7B%5Cnu_c%7D%20%5Cleft(%5Csum_%7Bs=1%7D%5Eq%20g_%7Bsc%7D%5E2%5Cright)%5E2.%0A%5Cend%7Baligned%7D%0A"> Now, all we need to do is simplify… <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Csum_%7Bs=1%7D%5Eq%20g_%7Bs1%7D%5E2%20&amp;=%20%5Csum_%7Bs=1%7D%5Eq%20%5Cfrac%7B%5Cleft(%5Ckappa(W%20%5Cpsi_1%20-%201)%20-%20%5Cpsi_1%5Cright)%5E2%7D%7B%5Cpsi_1%5E2%20%5Cpsi_%7Bs+1%7D%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cleft(%5Ckappa(W%20%5Cpsi_1%20-%201)%20-%20%5Cpsi_1%5Cright)%5E2%7D%7B%5Cpsi_1%5E2%7D%20%5Csum_%7Bc=2%7D%5EC%20%5Cfrac%7B1%7D%7B%5Cpsi_%7Bs+1%7D%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B%5Cleft(%5Ckappa(W%20%5Cpsi_1%20-%201)%20-%20%5Cpsi_1%5Cright)%5E2%7D%7B%5Cpsi_1%5E2%7D%20%5Cfrac%7B(W%20%5Cpsi_1%20-%201)%7D%7B%5Cpsi_1%7D%20%5C%5C%0A&amp;=%20%5Ctext%7B...a%20bunch%20of%20tedious%20algebra...%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B%5Cpsi_1%5E2%7D%20%5Cleft(%5Cpsi_1%20-%20%5Cfrac%7B1%7D%7BW%7D%5Cright)%0A%5Cend%7Baligned%7D%0A"> and, for <img src="https://latex.codecogs.com/png.latex?c%20=%202,...,C">, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Csum_%7Bs=1%7D%5Eq%20g_%7Bsc%7D%5E2%20&amp;=%20%5Csum_%7Bs=1%7D%5Eq%20%5Cleft(%5Cfrac%7BI(s+1%20=%20c)%7D%7B%5Csqrt%7B%5Cpsi_%7Bc%7D%7D%7D%20-%20%5Cfrac%7B%5Ckappa%7D%7B%5Cpsi_c%20%5Csqrt%7B%5Cpsi_%7Bs+1%7D%7D%7D%5Cright)%5E2%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B%5Cpsi_c%7D%20-%20%5Cfrac%7B2%20%5Ckappa%7D%7B%5Cpsi_c%5E2%7D%20+%20%5Cfrac%7B%5Ckappa%5E2%7D%7B%5Cpsi_c%5E2%7D%5Csum_%7Bs=1%7D%5Eq%20%5Cfrac%7B1%7D%7B%5Cpsi_%7Bs+1%7D%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B%5Cpsi_c%7D%20-%20%5Cfrac%7B2%20%5Ckappa%7D%7B%5Cpsi_c%5E2%7D%20+%20%5Cfrac%7B%5Ckappa%5E2%7D%7B%5Cpsi_c%5E2%7D%5Cfrac%7B(W%20%5Cpsi_1%20-%201)%7D%7B%5Cpsi_1%7D%20%5C%5C%0A&amp;=%20%5Ctext%7B...a%20bunch%20of%20tedious%20algebra...%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7B%5Cpsi_c%5E2%7D%20%5Cleft(%5Cpsi_c%20-%20%5Cfrac%7B1%7D%7BW%7D%5Cright)%0A%5Cend%7Baligned%7D%0A"> Thus, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Aq(q%20+%201)%5Ceta_Z%5E%7B-1%7D%20&amp;=%202%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B%5Cpsi_c%5E2%7D%7B%5Cnu_c%7D%20%5Cleft(%5Csum_%7Bs=1%7D%5Eq%20g_%7Bsc%7D%5E2%5Cright)%5E2%20%5C%5C%0A&amp;=%202%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B1%7D%7B%5Cnu_c%20%5Cpsi_c%5E2%7D%5Cleft(%5Cpsi_c%20-%20%5Cfrac%7B1%7D%7BW%7D%5Cright)%5E2%20%5C%5C%0A&amp;=%202%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B1%7D%7B%5Cnu_c%7D%5Cleft(1%20-%20%5Cfrac%7B1%7D%7B%5Cpsi_c%20W%7D%5Cright)%5E2%0A%5Cend%7Baligned%7D%0A"> or, rearranging, <img src="https://latex.codecogs.com/png.latex?%0A%5Ceta_Z%20=%20%5Cfrac%7BC(C%20-%201)%7D%7B2%20%5Csum_%7Bc=1%7D%5EC%20%5Cfrac%7B1%7D%7B%5Cnu_c%7D%5Cleft(1%20-%20%5Cfrac%7B1%7D%7B%5Cpsi_c%20W%7D%5Cright)%5E2%7D.%0A"> It’s a surprisingly clean formula! Once these degrees of freedom are calculated, the degrees of freedom for the reference <img src="https://latex.codecogs.com/png.latex?F"> distribution would be <img src="https://latex.codecogs.com/png.latex?q"> and <img src="https://latex.codecogs.com/png.latex?%5Ceta_Z%20-%20q%20+%201">.</p>
<p>In the paper, we also considered two other degrees of freedom approximations, which involve not only the variances of <img src="https://latex.codecogs.com/png.latex?d_%7Bst%7D"> but also the covariances between entries. In principle, one could follow similar algebra to get expressions for these other degrees of freedom as well. However, our simulations indicated that the other degrees of freedom approximations tend to be overly conservative and produce type-I error rates way below the nominal level (essentially, hardly ever rejecting the null) and less accurate than HTZ. So, there’s not much reason to work through them unless you find algebra enjoyable for its own sake.</p>
<p>A further question about this cluster-robust Wald statistic is how to approximate its sampling distribution under specific alternative hypotheses. In other words, given a vector of means <img src="https://latex.codecogs.com/png.latex?%5Cmu_1,...,%5Cmu_C"> where the null does not hold, plus some information to determine <img src="https://latex.codecogs.com/png.latex?%5Cpsi_c"> and <img src="https://latex.codecogs.com/png.latex?%5Cnu_c"> for <img src="https://latex.codecogs.com/png.latex?c%20=%201,...,C">, how could we approximate the distribution of <img src="https://latex.codecogs.com/png.latex?Q">? We need something like a non-central Hotelling’s <img src="https://latex.codecogs.com/png.latex?T%5E2"> distribution…</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2024,
  author = {Pustejovsky, James E.},
  title = {Approximating the Distribution of Cluster-Robust {Wald}
    Statistics},
  date = {2024-03-24},
  url = {https://jepusto.com/posts/Approximating-cluster-robust-Wald-tests},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2024" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2024. <span>“Approximating the Distribution of
Cluster-Robust Wald Statistics.”</span> March 24, 2024. <a href="https://jepusto.com/posts/Approximating-cluster-robust-Wald-tests">https://jepusto.com/posts/Approximating-cluster-robust-Wald-tests</a>.
</div></div></section></div> ]]></description>
  <category>robust variance estimation</category>
  <category>distribution theory</category>
  <guid>https://jepusto.com/posts/Approximating-cluster-robust-Wald-tests/</guid>
  <pubDate>Sun, 24 Mar 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Implementing Consul’s generalized Poisson distribution in Stan</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/generalized-poisson-in-Stan/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D%0A"></p>
<p>For a project I am working on, we are using <a href="https://mc-stan.org/">Stan</a> to fit generalized random effects location-scale models to a bunch of count data. In <a href="../..\double-poisson-in-Stan/">a previous post</a>, I walked through our implementation of <a href="https://doi.org/10.2307/2289002">Efron’s (1986)</a> double-Poisson distribution, which we are interested in using because it allows for both over- and under-dispersion relative to the Poisson distribution. Another distribution with these properties is the generalized Poisson distribution described by <a href="https://doi.org/10.1080/00401706.1973.10489112">Consul and Jain (1973)</a>.</p>
<p>In this post, I’ll walk through my implementation of the GPO in Stan. The <a href="https://cran.r-project.org/package=gamlss.dist"><code>gamlss.dist</code> package</a> provides a full set of distributional functions for the generalized Poisson distribution, including a sampler, but the functions are configured to only allow for over-dispersion. Since I’m interested in allowing for under-dispersion as well, I’ll need to write my own functions. As in my previous post, I can validate my Stan functions against the functions from <code>gamlss.dist</code> (although only for over-dispersion scenarios).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># composing figures</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gamlss.dist) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DPO distribution functions</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stan interface to R</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(brms)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fitting generalized linear models</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(bayesplot)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Examine fitted models</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(loo)         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Model fit measures</span></span></code></pre></div>
</details>
</div>
<section id="the-generalized-poisson" class="level2">
<h2 class="anchored" data-anchor-id="the-generalized-poisson">The generalized Poisson</h2>
<p>Consul and Jain’s generalized Poisson distribution is a discrete distribution for non-negative counts, with support <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BS%7D_X%20=%20%5C%7B0,%201,%202,%203,%20...%5C%7D">. The mean-variance relationship of the generalized Poisson is constant; for <img src="https://latex.codecogs.com/png.latex?X%20%5Csim%20GPO(%5Cmu,%20%5Cphi)">, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BE%7D(X)%20=%20%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(X)%20=%20%5Cmu%20/%20%5Cphi"> for <img src="https://latex.codecogs.com/png.latex?0%20%3C%20%5Cphi%20%3C%201">; the expectation and variance are not exact but are close approximations when there is underdispersion, so <img src="https://latex.codecogs.com/png.latex?%5Cphi%20%3E%201">. Thus, like the double-Poisson distribution, the generalized Poisson satisfies the assumptions of a quasi-Poisson generalized linear model (at least approximately).</p>
<p>The density of the generalized Poisson distribution with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and inverse-disperson <img src="https://latex.codecogs.com/png.latex?%5Cphi"> is: <img src="https://latex.codecogs.com/png.latex?%0Af(x%20%7C%20%5Cmu,%20%5Cphi)%20=%20%5Cmu%20%5Csqrt%7B%5Cphi%7D%20%5Cleft(%20x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)%20%5Cright)%5E%7Bx-1%7D%20%5Cfrac%7B%5Cexp%20%5Cleft%5B-%5Cleft(%20x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)%5Cright)%5Cright%5D%7D%7Bx!%7D.%0A"> We then have <img src="https://latex.codecogs.com/png.latex?%0A%5Cln%20f(x%20%7C%20%5Cmu,%20%5Cphi)%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cln%20%5Cphi%20+%20%5Cln%20%5Cmu%20+%20(x%20-%201)%20%5Cln%20%5Cleft(%20x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)%20%5Cright)%20-%20%5Cleft(%20x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)%20%5Cright)%20-%20%5Cln%20%5Cleft(x!%5Cright).%0A"> Using the GPO with under-dispersed data is a little bit more controversial (by statistical standards) than using the DPO. This is because, for parameter values corresponding to under-dispersion, its probability mass function becomes negative for large counts. In particular, note that for values <img src="https://latex.codecogs.com/png.latex?x%20%3E%20%5Cfrac%7B%5Cmu%5Csqrt%5Cphi%7D%7B%5Csqrt%5Cphi%20-%201%7D">, the quantity <img src="https://latex.codecogs.com/png.latex?x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)"> becomes negative, and so <img src="https://latex.codecogs.com/png.latex?f(x%7C%20%5Cmu,%20%5Cphi)"> is no longer a proper probability. Consul suggested handling this situation by truncating the distribution at <img src="https://latex.codecogs.com/png.latex?m%20=%20%5Cleft%5Clfloor%20%5Cfrac%7B%5Cmu%5Csqrt%5Cphi%7D%7B%5Csqrt%5Cphi%20-%201%7D%5Cright%5Crfloor">. However, doing so makes the distribution only an approximation, such that <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is no longer exactly the mean and <img src="https://latex.codecogs.com/png.latex?%5Cphi"> is no longer exactly the inverse dispersion. For modest under-dispersion of no less than 60% of the mean, <img src="https://latex.codecogs.com/png.latex?1%20%3C%20%5Cphi%20%3C%205%20/%203"> and the truncation point is fairly extreme, with <img src="https://latex.codecogs.com/png.latex?m%20%5Capprox%204.4%20%5Cmu">, so I’m not too worried about this issue. We’ll see how it plays out in application, of course.</p>
</section>
<section id="log-of-the-probability-mass-function" class="level1">
<h1>Log of the probability mass function</h1>
<p>Here’s a Stan function implementing the lpmf, with the truncation bit:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">stancode_lpmf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">real gpo_lpmf(int X, real mu, real phi) {</span></span>
<span id="cb2-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ans;</span></span>
<span id="cb2-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real m = mu / (1 - inv(sqrt(phi)));</span></span>
<span id="cb2-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real z = X + sqrt(phi) * (mu - X);</span></span>
<span id="cb2-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (phi &gt; 1 &amp;&amp; X &gt; m)</span></span>
<span id="cb2-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = negative_infinity();</span></span>
<span id="cb2-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else </span></span>
<span id="cb2-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = log(mu) + inv(2) * log(phi) + (X - 1) * log(z) - z - lgamma(X + 1);</span></span>
<span id="cb2-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return ans;</span></span>
<span id="cb2-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>To check that this is accurate, I’ll compare the Stan function to the corresponding function from <code>gamlss.dist</code> for a couple of different parameter values and for <img src="https://latex.codecogs.com/png.latex?x%20=%200,...,100">. If my function is accurate, my calculated log-probabilities should be equal to the results from <code>gamlss.dist::dGPO</code>. Note that the <code>gamlss.dist</code> function uses a different parameterization for the dispersion, with <img src="https://latex.codecogs.com/png.latex?%5Csigma%20=%20%5Cfrac%7B%5Cphi%5E%7B-1/2%7D%20-%201%7D%7B%5Cmu%7D">.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_lpmf, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-lpmf.stan"</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-lpmf.stan"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">test_lpmf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb3-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> (phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mu,</span>
<span id="cb3-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_lpmf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dGPO</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb3-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_lpmf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_dbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> gpo_lpmf),</span>
<span id="cb3-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> my_lpmf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamlss_lpmf</span>
<span id="cb3-15">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_lpmf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi), diff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>( <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Checks out. Onward!</p>
</section>
<section id="quantile-function" class="level1">
<h1>Quantile function</h1>
<p>I’ll next implement the generalized Poisson quantile function, taking advantage of a recurrence relationship for sequential values. Note that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Af(0%20%7C%20%5Cmu,%20%5Cphi)%20&amp;=%20%5Cexp%20%5Cleft(-%5Cmu%20%5Csqrt%7B%5Cphi%7D%5Cright)%20%5C%5C%0Af(x%20%7C%20%5Cmu,%20%5Cphi)%20&amp;=%20f(x%20-%201%20%7C%20%5Cmu,%20%5Cphi)%20%5Ctimes%20%5Cfrac%7B%5Cleft(x%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20x)%5Cright)%5E%7Bx%20-%201%7D%7D%7B%5Cleft(x%20-%201%20+%20%5Csqrt%7B%5Cphi%7D(%5Cmu%20-%20(x%20-%201))%5Cright)%5E%7Bx%20-%202%7D%7D%20%5Ctimes%20%5Cfrac%7B%5Cexp(%5Csqrt%7B%5Cphi%7D%20-%201)%7D%7Bx%7D%0A%5Cend%7Baligned%7D%0A"> where the second expression holds for <img src="https://latex.codecogs.com/png.latex?x%20%5Cgeq%201">.</p>
<p>The function below computes the quantile given a value <img src="https://latex.codecogs.com/png.latex?p"> by computing the cumulative distribution function until <img src="https://latex.codecogs.com/png.latex?p"> is exceeded:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">stancode_quantile <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span></span>
<span id="cb5-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int gpo_quantile(real p, real mu, real phi) {</span></span>
<span id="cb5-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int q = 0;</span></span>
<span id="cb5-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real phi_sqrt = sqrt(phi);</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real mu_phi_sqrt = mu * phi_sqrt;</span></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real m;</span></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (phi &gt; 1) </span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = mu / (1 - inv(phi_sqrt));</span></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else </span></span>
<span id="cb5-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = positive_infinity();</span></span>
<span id="cb5-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real lpmf = - mu_phi_sqrt;</span></span>
<span id="cb5-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real cdf = exp(lpmf);</span></span>
<span id="cb5-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ln_inc;</span></span>
<span id="cb5-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  while (cdf &lt; p &amp;&amp; q &lt; m) {</span></span>
<span id="cb5-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    q += 1;</span></span>
<span id="cb5-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ln_inc = (q - 1) * log(mu_phi_sqrt + q * (1 - phi_sqrt)) - (q - 2) * log(mu_phi_sqrt + (q - 1) * (1 - phi_sqrt)) + (phi_sqrt - 1) - log(q);</span></span>
<span id="cb5-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    lpmf += ln_inc;    </span></span>
<span id="cb5-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf += exp(lpmf);</span></span>
<span id="cb5-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb5-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return q;</span></span>
<span id="cb5-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>If my quantile function is accurate, it should match the value computed from <code>gamlss.dist::qDPO()</code> exactly.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_quantile, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-quantile.stan"</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-quantile.stan"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4">test_quantile <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb6-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb6-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb6-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> (phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mu,</span>
<span id="cb6-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)),</span>
<span id="cb6-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_q =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_dbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> gpo_quantile),</span>
<span id="cb6-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_q =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qGPO</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma),</span>
<span id="cb6-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> my_q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamlss_q</span>
<span id="cb6-18">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_quantile, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi), diff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>( <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/check-quantile-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I should enter this figure in the competition for the world’s most boring statistical graphic.</p>
</section>
<section id="sampler" class="level1">
<h1>Sampler</h1>
<p>The last thing I’ll need is a sampler, which I’ll implement by generating random points from a uniform distribution, then computing the generalized Poisson quantiles of these random points. My implementation just generates a single random variate:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">stancode_qr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb8-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int gpo_quantile(real p, real mu, real phi) {</span></span>
<span id="cb8-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int q = 0;</span></span>
<span id="cb8-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real phi_sqrt = sqrt(phi);</span></span>
<span id="cb8-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real mu_phi_sqrt = mu * phi_sqrt;</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real m;</span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (phi &gt; 1) </span></span>
<span id="cb8-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = mu / (1 - inv(phi_sqrt));</span></span>
<span id="cb8-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else </span></span>
<span id="cb8-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = positive_infinity();</span></span>
<span id="cb8-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real lpmf = - mu_phi_sqrt;</span></span>
<span id="cb8-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real cdf = exp(lpmf);</span></span>
<span id="cb8-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ln_inc;</span></span>
<span id="cb8-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  while (cdf &lt; p &amp;&amp; q &lt; m) {</span></span>
<span id="cb8-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    q += 1;</span></span>
<span id="cb8-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ln_inc = (q - 1) * log(mu_phi_sqrt + q * (1 - phi_sqrt)) - (q - 2) * log(mu_phi_sqrt + (q - 1) * (1 - phi_sqrt)) + (phi_sqrt - 1) - log(q);</span></span>
<span id="cb8-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    lpmf += ln_inc;    </span></span>
<span id="cb8-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf += exp(lpmf);</span></span>
<span id="cb8-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb8-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return q;</span></span>
<span id="cb8-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-22"></span>
<span id="cb8-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int gpo_rng(real mu, real phi) {</span></span>
<span id="cb8-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real p = uniform_rng(0,1);</span></span>
<span id="cb8-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int x = gpo_quantile(p, mu, phi);</span></span>
<span id="cb8-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return x;</span></span>
<span id="cb8-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>To check this function, I’ll generate some large samples from the generalized Poisson with a few different parameter sets. If the sampler is working properly, the empirical cumulative distribution should line up closely with the cumulative distribution computed using <code>gamlss.dist::pGPO()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_qr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-rng.stan"</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GPO-rng.stan"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">gpo_rng_sampler <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(N, mu, phi) {</span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(N, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpo_rng</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi))</span>
<span id="cb9-6">}</span>
<span id="cb9-7"></span>
<span id="cb9-8">test_rng <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb9-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb9-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> (phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mu,</span>
<span id="cb9-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> gpo_rng_sampler),</span>
<span id="cb9-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(x, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(.x)))</span>
<span id="cb9-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-18">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(mu, phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(tb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(.x))[.x],</span>
<span id="cb9-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Freq_cum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(Freq) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb9-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_F =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pGPO</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma)</span>
<span id="cb9-25">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_rng, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(gamlss_F, Freq_cum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Theoretical cdf (gamlss.dist)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical cdf (my function)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/check-rng-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Another approach to checking the sampler is to simulate a bunch of observations and check whether the empirical mean and variance match the theoretical moments. I’ll do this as well, using some values of <img src="https://latex.codecogs.com/png.latex?%5Cphi%20%3E%201"> to test whether the sampler still works when there’s under-dispersion.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">test_moments <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb11-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>),</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb11-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb11-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> gpo_rng_sampler),</span>
<span id="cb11-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(x, mean),</span>
<span id="cb11-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(x, sd),</span>
<span id="cb11-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M_ratio =</span> M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mu,</span>
<span id="cb11-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S_ratio =</span> S <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> phi)</span>
<span id="cb11-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-13">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_ratio"</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"moment"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ratio"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb11-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">moment =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(moment, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M_ratio"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S_ratio"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample mean"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Standard deviation"</span>)),</span>
<span id="cb11-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(mu)</span>
<span id="cb11-18">  )</span>
<span id="cb11-19"></span>
<span id="cb11-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_moments, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(phi, ratio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> mu)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> moment) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/test-sample-moments-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the sample moments closely match the parameter values, with deviations that look pretty much like random error. Nice!</p>
</section>
<section id="using-the-custom-distribution-functions" class="level1">
<h1>Using the custom distribution functions</h1>
<p>To finish out my tests of these functions, I’ll try out a small simulation. Following my <a href="../..\Double-Poisson-in-Stan/">previous post</a>, I’ll generate data based on a generalized linear model with a single predictor <img src="https://latex.codecogs.com/png.latex?X">, where the outcome <img src="https://latex.codecogs.com/png.latex?Y"> follows a generalized Poisson distribution conditional on <img src="https://latex.codecogs.com/png.latex?X">. The data-generating process is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AX%20&amp;%5Csim%20%5CGamma(6,2)%20%5C%5C%0AY%7CX%20&amp;%5Csim%20GPO(%5Cmu(X),%20%5Cphi)%20%5C%5C%0A%5Clog%20%5Cmu(X)%20&amp;=%202%20+%200.3%20%5Ctimes%20X%0A%5Cend%7Baligned%7D%0A"> with the dispersion parameter set to <img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%206/10"> so that the outcome is <em>over</em>-dispersed. I’m looking at over-dispersion here so that the negative binomial has a chance to keep up, since it doesn’t allow for any degree of under-dispersion.</p>
<p>The following code generates a large sample from the data-generating process:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20231206</span>)</span>
<span id="cb12-2">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span></span>
<span id="cb12-3">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb12-4">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> X)</span>
<span id="cb12-5">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb12-6">Y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(mu, gpo_rng, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi)</span>
<span id="cb12-7">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> Y)</span></code></pre></div>
</details>
</div>
<p>Here’s what the sample looks like, along with a smoothed regression estimated using a basic cubic spline:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X, Y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gam'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cs"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/glm-scatterplot-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here is a fit using quasi-likelihood estimation of a log-linear model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">quasi_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quasipoisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(quasi_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ X, family = quasipoisson(link = "log"), data = dat)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.981959   0.020609   96.17   &lt;2e-16 ***
X           0.306733   0.005525   55.52   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasipoisson family taken to be 1.680427)

    Null deviance: 7248.1  on 1499  degrees of freedom
Residual deviance: 2520.5  on 1498  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>This approach recovers the data-generating parameters quite well, with a dispersion estimate of 1.68 compared to the true dispersion parameter of 1.67.</p>
<section id="candidate-models" class="level2">
<h2 class="anchored" data-anchor-id="candidate-models">Candidate models</h2>
<p>Now let me fit the same generalized linear model but assuming that the outcome follow a couple of different distributions, including a true Poisson (with unit dispersion), a negative binomial, the double-Poisson distribution from the previous post, and the generalized Poisson distribution. Here goes!</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">Poisson_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb16-3">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb16-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb16-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb16-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, </span>
<span id="cb16-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb16-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb16-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20231204</span></span>
<span id="cb16-10">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">negbin_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb17-3">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb17-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb17-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb17-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, </span>
<span id="cb17-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb17-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb17-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20231204</span></span>
<span id="cb17-10">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">stancode_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb18-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">real dpo_lpmf(int X, real mu, real phi) {</span></span>
<span id="cb18-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ans;</span></span>
<span id="cb18-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real A = inv(2) * log(phi) - phi * mu;</span></span>
<span id="cb18-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (X == 0)</span></span>
<span id="cb18-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A;</span></span>
<span id="cb18-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else</span></span>
<span id="cb18-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A + X * (phi * (1 + log(mu)) - 1) - lgamma(X + 1) + (1 - phi) * X * log(X);</span></span>
<span id="cb18-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return ans;</span></span>
<span id="cb18-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vector dpo_cdf_vec(real mu, real phi, int maxval) {</span></span>
<span id="cb18-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real d = exp(phi * (1 + log(mu)) - 1);</span></span>
<span id="cb18-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real prob;</span></span>
<span id="cb18-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int n = maxval + 1;</span></span>
<span id="cb18-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[n] cdf;</span></span>
<span id="cb18-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[1] = sqrt(phi) * exp(-mu * phi);</span></span>
<span id="cb18-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  prob = cdf[1] * d;</span></span>
<span id="cb18-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[2] = cdf[1] + prob;</span></span>
<span id="cb18-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 2:maxval) {</span></span>
<span id="cb18-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    prob = prob * d * exp((1 - phi) * (i - 1) * (log(i) - log(i - 1))) / (i^phi);</span></span>
<span id="cb18-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf[i + 1] = cdf[i] + prob;</span></span>
<span id="cb18-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (prob / cdf[i + 1] &lt; 1e-8) {</span></span>
<span id="cb18-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      n = i + 1;</span></span>
<span id="cb18-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      break;</span></span>
<span id="cb18-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb18-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb18-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return cdf / cdf[n];</span></span>
<span id="cb18-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int dpo_quantile(real p, real mu, real phi, int maxval) {</span></span>
<span id="cb18-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[maxval + 1] cdf_vec = dpo_cdf_vec(mu, phi, maxval);</span></span>
<span id="cb18-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int q = 0;</span></span>
<span id="cb18-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  while (cdf_vec[q + 1] &lt; p) {</span></span>
<span id="cb18-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      q += 1;</span></span>
<span id="cb18-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb18-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return q;</span></span>
<span id="cb18-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int dpo_rng(real mu, real phi, int maxval) {</span></span>
<span id="cb18-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real p = uniform_rng(0,1);</span></span>
<span id="cb18-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int x = dpo_quantile(p, mu, phi, maxval);</span></span>
<span id="cb18-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return x;</span></span>
<span id="cb18-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb18-43">double_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">custom_family</span>(</span>
<span id="cb18-44">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dpo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>),</span>
<span id="cb18-45">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">links =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb18-46">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ub =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb18-47">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"int"</span></span>
<span id="cb18-48">)</span>
<span id="cb18-49"></span>
<span id="cb18-50">double_Poisson_stanvars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stanvar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scode =</span> stancode_dpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">block =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions"</span>)</span>
<span id="cb18-51"></span>
<span id="cb18-52">phi_prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exponential</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>)</span>
<span id="cb18-53"></span>
<span id="cb18-54">DPO_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb18-56">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> double_Poisson,</span>
<span id="cb18-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> phi_prior,</span>
<span id="cb18-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stanvars =</span> double_Poisson_stanvars,</span>
<span id="cb18-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb18-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb18-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, </span>
<span id="cb18-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb18-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb18-64">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20231204</span></span>
<span id="cb18-65">  )</span>
<span id="cb18-66"></span>
<span id="cb18-67"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_functions</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vectorize =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb18-68"></span>
<span id="cb18-69">log_lik_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep) {</span>
<span id="cb18-70">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb18-71">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb18-72">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> prep<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y[i]</span>
<span id="cb18-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpo_lpmf</span>(y, mu, phi)</span>
<span id="cb18-74">}</span>
<span id="cb18-75"></span>
<span id="cb18-76">posterior_predict_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, ...) {</span>
<span id="cb18-77">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb18-78">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb18-79">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(maxval)) maxval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(phi, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb18-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpo_rng</span>(mu, phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> maxval)</span>
<span id="cb18-81">}</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">stancode_gpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb19-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">real gpo_lpmf(int X, real mu, real phi) {</span></span>
<span id="cb19-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ans;</span></span>
<span id="cb19-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real m = mu / (1 - inv(sqrt(phi)));</span></span>
<span id="cb19-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real z = X + sqrt(phi) * (mu - X);</span></span>
<span id="cb19-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (phi &gt; 1 &amp;&amp; X &gt; m)</span></span>
<span id="cb19-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = negative_infinity();</span></span>
<span id="cb19-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else </span></span>
<span id="cb19-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = log(mu) + inv(2) * log(phi) + (X - 1) * log(z) - z - lgamma(X + 1);</span></span>
<span id="cb19-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return ans;</span></span>
<span id="cb19-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int gpo_quantile(real p, real mu, real phi) {</span></span>
<span id="cb19-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int q = 0;</span></span>
<span id="cb19-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real phi_sqrt = sqrt(phi);</span></span>
<span id="cb19-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real mu_phi_sqrt = mu * phi_sqrt;</span></span>
<span id="cb19-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real m;</span></span>
<span id="cb19-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (phi &gt; 1) </span></span>
<span id="cb19-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = mu / (1 - inv(phi_sqrt));</span></span>
<span id="cb19-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else </span></span>
<span id="cb19-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    m = positive_infinity();</span></span>
<span id="cb19-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real lpmf = - mu_phi_sqrt;</span></span>
<span id="cb19-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real cdf = exp(lpmf);</span></span>
<span id="cb19-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ln_inc;</span></span>
<span id="cb19-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  while (cdf &lt; p &amp;&amp; q &lt; m) {</span></span>
<span id="cb19-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    q += 1;</span></span>
<span id="cb19-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ln_inc = (q - 1) * log(mu_phi_sqrt + q * (1 - phi_sqrt)) - (q - 2) * log(mu_phi_sqrt + (q - 1) * (1 - phi_sqrt)) + (phi_sqrt - 1) - log(q);</span></span>
<span id="cb19-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    lpmf += ln_inc;    </span></span>
<span id="cb19-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf += exp(lpmf);</span></span>
<span id="cb19-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb19-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return q;</span></span>
<span id="cb19-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int gpo_rng(real mu, real phi) {</span></span>
<span id="cb19-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real p = uniform_rng(0,1);</span></span>
<span id="cb19-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int x = gpo_quantile(p, mu, phi);</span></span>
<span id="cb19-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return x;</span></span>
<span id="cb19-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb19-38">generalized_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">custom_family</span>(</span>
<span id="cb19-39">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>),</span>
<span id="cb19-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">links =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb19-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ub =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb19-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"int"</span></span>
<span id="cb19-43">)</span>
<span id="cb19-44"></span>
<span id="cb19-45">generalized_Poisson_stanvars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stanvar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scode =</span> stancode_gpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">block =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions"</span>)</span>
<span id="cb19-46"></span>
<span id="cb19-47">phi_prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exponential</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>)</span>
<span id="cb19-48"></span>
<span id="cb19-49">GPO_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb19-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb19-51">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> generalized_Poisson,</span>
<span id="cb19-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> phi_prior,</span>
<span id="cb19-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stanvars =</span> generalized_Poisson_stanvars,</span>
<span id="cb19-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb19-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb19-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, </span>
<span id="cb19-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb19-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb19-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20231204</span></span>
<span id="cb19-60">  )</span>
<span id="cb19-61"></span>
<span id="cb19-62"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_functions</span>(GPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vectorize =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb19-63"></span>
<span id="cb19-64">log_lik_gpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep) {</span>
<span id="cb19-65">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb19-66">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb19-67">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> prep<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y[i]</span>
<span id="cb19-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpo_lpmf</span>(y, mu, phi)</span>
<span id="cb19-69">}</span>
<span id="cb19-70"></span>
<span id="cb19-71">posterior_predict_gpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, ...) {</span>
<span id="cb19-72">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb19-73">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb19-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpo_rng</span>(mu, phi)</span>
<span id="cb19-75">}</span></code></pre></div>
</details>
</div>
</section>
<section id="model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison">Model comparison</h2>
<p>Here is a comparison of LOOIC for all of the models:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">loo_comparison <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo</span>(Poisson_fit, negbin_fit, DPO_fit, GPO_fit)</span>
<span id="cb20-2">loo_comparison<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>diffs</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            elpd_diff se_diff
DPO_fit        0.0       0.0 
GPO_fit       -2.9       2.8 
negbin_fit    -8.9       4.4 
Poisson_fit -120.8      20.1 </code></pre>
</div>
</div>
<p>The model based on the double-Poisson distribution fits equally well to the true data-generating process here, suggesting that there’s really just not enough information to distriguish between the two models. The negative binomial distribution fit is substantially worse, and the Poisson distribution fit is awful.</p>
<p>Here’s the posterior for the dispersion (i.e., <img src="https://latex.codecogs.com/png.latex?1%20/%20%5Cphi">) based on the GPO and DPO models:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb22-2">GPO_dispersion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mcmc_areas</span>(GPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">transformations =</span> \(x) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generalized Poisson"</span>)</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brightblue"</span>)</span>
<span id="cb22-8">DPO_dispersion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mcmc_areas</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">transformations =</span> \(x) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double Poisson"</span>)</span>
<span id="cb22-12"></span>
<span id="cb22-13">DPO_dispersion <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> GPO_dispersion <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> </span>
<span id="cb22-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/dispersion-comparison-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Right on par. To get a better sense of model fit, I’ll run some posterior predictive checks, using the quasi-likelihood dispersion as a summary statistic:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">Yrep_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(Poisson_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>) </span>
<span id="cb23-2">Yrep_negbin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(negbin_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb23-3">Yrep_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb23-4">Yrep_gpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(GPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ndraws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb23-5"></span>
<span id="cb23-6">dispersion_coef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(y) {</span>
<span id="cb23-7">  quasi_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quasipoisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>))</span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(quasi_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> quasi_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>df.residual</span>
<span id="cb23-9">}</span>
<span id="cb23-10"></span>
<span id="cb23-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb23-12">Poisson_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_Poisson, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb23-14"></span>
<span id="cb23-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb23-16">negbin_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_negbin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb23-18"></span>
<span id="cb23-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brightblue"</span>)</span>
<span id="cb23-20">dpo_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_dpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double Poisson"</span>)</span>
<span id="cb23-22"></span>
<span id="cb23-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb23-24">gpo_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_gpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generalized Poisson"</span>)</span>
<span id="cb23-26"></span>
<span id="cb23-27">Poisson_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dpo_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> gpo_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb23-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> </span>
<span id="cb23-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.1</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/ppc-dispersion-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Both the double Poisson and the generalized Poisson models generate data with levels of dispersion similar to the observed data. The negative binomial distribution is not noticeably worse.</p>
</section>
<section id="marginal-posterior-predictive-densities" class="level2">
<h2 class="anchored" data-anchor-id="marginal-posterior-predictive-densities">Marginal posterior predictive densities</h2>
<p>Here’s some rootograms for the posterior predictive density of the raw outcomes:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb24-2">Poisson_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_Poisson, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb24-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb24-4">negbin_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_negbin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb24-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brightblue"</span>)</span>
<span id="cb24-6">dpo_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_dpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double Poisson"</span>)</span>
<span id="cb24-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb24-8">gpo_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_gpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generalized Poisson"</span>)</span>
<span id="cb24-9"></span>
<span id="cb24-10">Poisson_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dpo_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> gpo_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/ppd-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You can see from these that the Poisson model maybe expects slightly fewer low counts and slightly fewer high counts than are present in the observed data. However, the figure doesn’t really capture the degree of mis-fit that is apparent with the dispersion summary statistics. I think this is because the distribution of <img src="https://latex.codecogs.com/png.latex?Y"> changes so much depending on the value of the predictor <img src="https://latex.codecogs.com/png.latex?X">.</p>
</section>
<section id="posterior-predictive-residual-densities" class="level2">
<h2 class="anchored" data-anchor-id="posterior-predictive-residual-densities">Posterior predictive residual densities</h2>
<p>One way to focus in on the distributional assumption is to examine the distribution of residuals rather than raw outcomes. I’ll do that here by looking the deviance residuals from the quasi-Poisson GLM model, treating the calculation of the residuals as merely a transformation of the raw data. Here are some posterior predictive density plots of these deviance residuals:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># quasi-Poisson deviance residuals</span></span>
<span id="cb25-2">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(quasi_fit)</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to calculate quasi-Poisson deviance residuals</span></span>
<span id="cb25-5">quasi_residuals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(y) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quasipoisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>))))</span>
<span id="cb25-6"></span>
<span id="cb25-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># transform posterior predictive data into residuals</span></span>
<span id="cb25-8">R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb25-9">resid_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Yrep_Poisson[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>R,], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, quasi_residuals) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>()</span>
<span id="cb25-10">resid_negbin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Yrep_negbin[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>R,], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, quasi_residuals) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>()</span>
<span id="cb25-11">resid_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Yrep_dpo[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>R,], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, quasi_residuals) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>()</span>
<span id="cb25-12">resid_gpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Yrep_gpo[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>R,], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, quasi_residuals) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>()</span>
<span id="cb25-13"></span>
<span id="cb25-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make density plots</span></span>
<span id="cb25-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb25-16">Poisson_resid_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_dens_overlay</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid, resid_Poisson) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb25-17"></span>
<span id="cb25-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb25-19">negbin_resid_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_dens_overlay</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid, resid_negbin) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb25-20"></span>
<span id="cb25-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brightblue"</span>)</span>
<span id="cb25-22">dpo_resid_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_dens_overlay</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid, resid_dpo) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double Poisson"</span>)</span>
<span id="cb25-23"></span>
<span id="cb25-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb25-25">gpo_resid_density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_dens_overlay</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid, resid_gpo) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generalized Poisson"</span>)</span>
<span id="cb25-26"></span>
<span id="cb25-27">Poisson_resid_density <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_resid_density <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dpo_resid_density <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> gpo_resid_density <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb25-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> </span>
<span id="cb25-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/ppd-residuals-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It’s quite a bit clearer from these plots that the DPO and GPO models are closer to replicating the distribution of the data than the Poisson model. The negative binomial model is not obviously mis-specified either.</p>
<p>A notable difference between the negative binomial versus the DPO and GPO distributions is in the form of the mean-variance relationship. For the negative binomial, the variance increases with the square of the mean, whereas for the DPO and GPO, the variance increases in constant proportion to the mean. The residual posterior density plots above don’t really capture these mean-variance relationships in an obvious way. I took one more crack at a posterior predictive check to get at this. Below is a figure showing the loess smooth of the squared residuals versus <img src="https://latex.codecogs.com/png.latex?X"> based on the posterior predictive distributions versus the real data. I couldn’t find an easy way to do this with the <code>bayesplot</code> functions I’ve used above, so I had to bang it out in regular <code>ggplot</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">X_grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb26-2"></span>
<span id="cb26-3">smooth_square_resid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r, x_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X_pred =</span> X_grid) {</span>
<span id="cb26-4">  loess_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loess</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">I</span>(r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_dat)</span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(loess_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_dat =</span> X_pred))</span>
<span id="cb26-6">}</span>
<span id="cb26-7"></span>
<span id="cb26-8">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smooth_square_resid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>resid, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_dat =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X_pred =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X)</span>
<span id="cb26-9"></span>
<span id="cb26-10">smooth_square_resid_ppcs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(R, x_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X_pred =</span> X_grid) {</span>
<span id="cb26-11">  smooth_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(R, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, smooth_square_resid, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_dat =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X_pred =</span> X_pred, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb26-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb26-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(smooth_list),</span>
<span id="cb26-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(X_pred), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(smooth_list)),</span>
<span id="cb26-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sm =</span> smooth_list</span>
<span id="cb26-16">  )</span>
<span id="cb26-17">}</span>
<span id="cb26-18"></span>
<span id="cb26-19">smooth_MV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb26-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb26-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Poisson =</span> resid_Poisson, </span>
<span id="cb26-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Negative binomial</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> resid_negbin,</span>
<span id="cb26-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Double Poisson</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> resid_dpo,</span>
<span id="cb26-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Generalized Poisson</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> resid_gpo</span>
<span id="cb26-25">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(smooth_square_resid_ppcs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_dat =</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distribution"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(X, sm) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb26-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb26-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distribution =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(distribution, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative binomial"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double Poisson"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generalized Poisson"</span>))</span>
<span id="cb26-30">  )</span>
<span id="cb26-31"></span>
<span id="cb26-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(smooth_MV, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X, sm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> distribution)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X, sm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightgreen"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> distribution, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb26-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Loess smooth of squared residuals"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/generalized-poisson-in-Stan/index_files/figure-html/ppd-residual-smooth-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Aha! Here we can clearly see that the negative binomial model generates residuals that have more curvature to the mean-variance relationship, and so don’t really fit with the observed data. The double Poisson and generalized Poisson both generate residuals that match the observed mean-variance relationship decently well.</p>
</section>
</section>
<section id="colophon" class="level1">
<h1>Colophon</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.3 (2024-02-29 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 11 x64 (build 22621)

Matrix products: default


locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] loo_2.7.0          bayesplot_1.11.1   brms_2.21.0        Rcpp_1.0.12       
 [5] rstan_2.32.6       StanHeaders_2.32.6 gamlss.dist_6.1-1  patchwork_1.2.0   
 [9] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       
[13] purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      
[17] ggplot2_3.5.0      tidyverse_2.0.0   

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     farver_2.1.1         fastmap_1.1.1       
 [4] tensorA_0.36.2.1     digest_0.6.35        timechange_0.3.0    
 [7] lifecycle_1.0.4      magrittr_2.0.3       posterior_1.5.0     
[10] compiler_4.3.3       rlang_1.1.3          tools_4.3.3         
[13] utf8_1.2.4           yaml_2.3.8           knitr_1.45          
[16] labeling_0.4.3       bridgesampling_1.1-2 htmlwidgets_1.6.4   
[19] pkgbuild_1.4.4       plyr_1.8.9           BH_1.84.0-0         
[22] abind_1.4-5          withr_3.0.0          grid_4.3.3          
[25] stats4_4.3.3         fansi_1.0.6          colorspace_2.1-0    
[28] inline_0.3.19        scales_1.3.0         MASS_7.3-60.0.1     
[31] ggridges_0.5.6       cli_3.6.2            mvtnorm_1.2-4       
[34] rmarkdown_2.26       generics_0.1.3       RcppParallel_5.1.7  
[37] rstudioapi_0.16.0    reshape2_1.4.4       tzdb_0.4.0          
[40] splines_4.3.3        parallel_4.3.3       matrixStats_1.2.0   
[43] vctrs_0.6.5          Matrix_1.6-5         jsonlite_1.8.8      
[46] hms_1.1.3            glue_1.7.0           codetools_0.2-19    
[49] distributional_0.4.0 stringi_1.8.3        gtable_0.3.4        
[52] QuickJSR_1.1.3       munsell_0.5.1        pillar_1.9.0        
[55] htmltools_0.5.7      Brobdingnag_1.2-9    R6_2.5.1            
[58] RcppEigen_0.3.4.0.0  evaluate_0.23        lattice_0.22-5      
[61] backports_1.4.1      renv_1.0.5           rstantools_2.4.0    
[64] coda_0.19-4.1        gridExtra_2.3        nlme_3.1-164        
[67] checkmate_2.3.1      mgcv_1.9-1           xfun_0.42           
[70] pkgconfig_2.0.3     </code></pre>
</div>
</div>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2023,
  author = {Pustejovsky, James E.},
  title = {Implementing {Consul’s} Generalized {Poisson} Distribution in
    {Stan}},
  date = {2023-12-06},
  url = {https://jepusto.com/posts/generalized-poisson-in-Stan},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2023" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2023. <span>“Implementing Consul’s Generalized
Poisson Distribution in Stan.”</span> December 6, 2023. <a href="https://jepusto.com/posts/generalized-poisson-in-Stan">https://jepusto.com/posts/generalized-poisson-in-Stan</a>.
</div></div></section></div> ]]></description>
  <category>Bayes</category>
  <category>simulation</category>
  <category>distribution-theory</category>
  <category>generalized linear model</category>
  <category>programming</category>
  <category>Rstats</category>
  <guid>https://jepusto.com/posts/generalized-poisson-in-Stan/</guid>
  <pubDate>Wed, 06 Dec 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Implementing Efron’s double Poisson distribution in Stan</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/double-poisson-in-Stan/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D%0A"></p>
<p>For a project I am working on, we are using <a href="https://mc-stan.org/">Stan</a> to fit generalized random effects location-scale models to a bunch of count data. We’re interested in using the double-Poisson distribution, as described by <a href="https://doi.org/10.2307/2289002">Efron (1986)</a>. This is an interesting distribution because it admits for both over- and under-dispersion relative to the Poisson distribution, whereas most of the conventional alternatives such as the negative binomial distribution or Poisson-normal mixture distribution allow only for over-dispersion. The double-Poisson distribution is not implemented in Stan, so we’ve had to write our own distribution function. That’s fine and not particularly difficult. What’s a bit more of a challenge is writing Stan functions to generate random samples from the double-Poisson, so that we can generate posterior predictive checks.<sup>1</sup> In this post, I’ll walk through the implementation of the custom distribution functions needed to use the double-Poisson in Stan. The <a href="https://cran.r-project.org/package=gamlss.dist"><code>gamlss.dist</code> package</a> provides a full set of distributional functions for the double-Poisson distribution, including a sampler. Thus, I can validate my Stan functions against the functions from <code>gamlss.dist</code>.<sup>2</sup></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># composing figures</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gamlss.dist) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DPO distribution functions</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rstan)       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stan interface to R</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(brms)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fitting generalized linear models</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(bayesplot)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Examine fitted models</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(loo)         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Model fit measures</span></span></code></pre></div>
</details>
</div>
<section id="the-double-poisson" class="level2">
<h2 class="anchored" data-anchor-id="the-double-poisson">The double-Poisson</h2>
<p>The double-Poisson distribution is a discrete distribution for non-negative counts, with support <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BS%7D_X%20=%20%5C%7B0,%201,%202,%203,%20...%5C%7D">. The mean-variance relationship of the double-Poisson is approximately constant; for <img src="https://latex.codecogs.com/png.latex?X%20%5Csim%20DPO(%5Cmu,%20%5Cphi)">, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BE%7D(X)%20%5Capprox%20%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(X)%20%5Capprox%20%5Cmu%20/%20%5Cphi">, so that the double-Poisson distribution approximately satisfies the assumptions of a quasi-Poisson generalized linear model (although not quite exactly so).</p>
<p><a href="https://doi.org/10.2307/2289002">Efron (1986)</a> gives the following expression for the density of the double-Poisson distribution with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and inverse-disperson <img src="https://latex.codecogs.com/png.latex?%5Cphi">: <img src="https://latex.codecogs.com/png.latex?%0Af(x%20%7C%20%5Cmu,%20%5Cphi)%20=%20%5Cfrac%7B%5Cphi%5E%7B1/2%7D%20e%5E%7B-%5Cphi%20%5Cmu%7D%7D%7Bc(%5Cmu,%5Cphi)%7D%20%5Cleft(%5Cfrac%7Be%5E%7B-x%7D%20x%5Ex%7D%7Bx!%7D%5Cright)%20%5Cleft(%5Cfrac%7Be%20%5Cmu%7D%7Bx%7D%5Cright)%5E%7B%5Cphi%20x%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?c(%5Cmu,%5Cphi)"> is a scaling constant to ensure that the density sums to one, which is closely approximated by <img src="https://latex.codecogs.com/png.latex?%0Ac(%5Cmu,%20%5Cphi)%20%5Capprox%201%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B12%20%5Cmu%20%5Cphi%7D%5Cleft(1%20+%20%5Cfrac%7B1%7D%7B%5Cmu%20%5Cphi%7D%5Cright).%0A"> We then have <img src="https://latex.codecogs.com/png.latex?%0A%5Cln%20f(x%20%7C%20%5Cmu,%20%5Cphi)%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cln%20%5Cphi%20-%20%5Cphi%20%5Cmu%20-%20%5Cln%20c(%5Cmu,%20%5Cphi)%20+%20x%20(%5Cphi%20+%20%5Cphi%20%5Cln%20%5Cmu%20-%201)%20+%20(1%20-%20%5Cphi)%20x%20%5Cln(x)%20-%20%5Cln%20%5Cleft(x!%5Cright),%0A"> where <img src="https://latex.codecogs.com/png.latex?0%20%5Ctimes%20%5Cln%20(0)"> is evaluated as 0.</p>
</section>
<section id="log-of-the-probability-mass-function" class="level1">
<h1>Log of the probability mass function</h1>
<p>For purposes of using this distribution in Stan, it’s sufficient to provide the log of the probability mass function up to a constant—there’s no need to normalize it to sum to one. Thus, we can ignore the <img src="https://latex.codecogs.com/png.latex?c(%5Cmu,%20%5Cphi)"> term above. Here’s a Stan function implementing the lpmf:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">stancode_lpmf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">real dpo_lpmf(int X, real mu, real phi) {</span></span>
<span id="cb2-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ans;</span></span>
<span id="cb2-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real A = inv(2) * log(phi) - phi * mu;</span></span>
<span id="cb2-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (X == 0)</span></span>
<span id="cb2-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A;</span></span>
<span id="cb2-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else</span></span>
<span id="cb2-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A + X * (phi * (1 + log(mu)) - 1) - lgamma(X + 1) + (1 - phi) * X * log(X);</span></span>
<span id="cb2-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return ans;</span></span>
<span id="cb2-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>To check that this is accurate, I’ll compare the Stan function to the corresponding function from <code>gamlss.dist</code> for a couple of different parameter values and for <img src="https://latex.codecogs.com/png.latex?x%20=%200,...,100">. If my function is accurate, the calculated log-probabilities should differ by a constant value for each set of parameters.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_lpmf, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-lpmf.stan"</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-lpmf.stan"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">test_lpmf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb3-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_lpmf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dDPO</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb3-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_lpmf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_dbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> dpo_lpmf),</span>
<span id="cb3-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> my_lpmf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamlss_lpmf</span>
<span id="cb3-14">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_lpmf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi), diff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>( <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Checks out. Onward!</p>
</section>
<section id="cumulative-distribution-function" class="level1">
<h1>Cumulative distribution function</h1>
<p>I’ll next implement a function to evaluate the cumulative distriution function over a range of values. This is an expensive calculation, but it can be improved a little bit by noting the relationship between sequential values of the probability mass function. Letting <img src="https://latex.codecogs.com/png.latex?d%20=%20%5Cexp%20%5Cleft(%5Cphi%20+%20%5Cphi%20%5Cln%20%5Cmu%20-%201%20%5Cright)">, observe that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Af(0%20%7C%20%5Cmu,%20%5Cphi)%20&amp;=%20%5Cfrac%7B%5Cphi%5E%7B1/2%7D%20e%5E%7B-%5Cphi%20%5Cmu%7D%7D%7Bc(%5Cmu,%5Cphi)%7D%20%5C%5C%0Af(1%20%7C%20%5Cmu,%20%5Cphi)%20&amp;=%20f(0%20%7C%20%5Cmu,%20%5Cphi)%20%5Ctimes%20d%20%5C%5C%0Af(x%20%7C%20%5Cmu,%20%5Cphi)%20&amp;=%20f(x%20-%201%20%7C%20%5Cmu,%20%5Cphi)%20%5Ctimes%20d%20%5Ctimes%20%5Cfrac%7B%5Cexp%5Cleft%5B(1%20-%20%5Cphi)(x%20-%201)%5Cleft(%5Cln(x)%20-%20%5Cln(x%20-%201)%5Cright)%20%5Cright%5D%7D%7Bx%5E%5Cphi%7D%0A%5Cend%7Baligned%7D%0A"> where the last expression holds for <img src="https://latex.codecogs.com/png.latex?x%20%5Cgeq%202">.</p>
<p>The function below computes the cumulative distribution function over the range <img src="https://latex.codecogs.com/png.latex?x%20=%200,...,m"> as follows:</p>
<ul>
<li>Compute <img src="https://latex.codecogs.com/png.latex?f(x%20%7C%20%5Cmu,%20%5Cphi)"> for <img src="https://latex.codecogs.com/png.latex?x%20=%200,1,2,...">, without the scaling constant <img src="https://latex.codecogs.com/png.latex?c(%5Cmu,%20%5Cphi)"></li>
<li>Take <img src="https://latex.codecogs.com/png.latex?F(0%20%7C%20%5Cmu,%20%5Cphi)%20=%20f(0%20%7C%20%5Cmu,%20%5Cphi)"> and accumulate <img src="https://latex.codecogs.com/png.latex?F(x%20%7C%20%5Cmu,%20%5Cphi)%20=%20F(x%20-%201%20%7C%20%5Cmu,%20%5Cphi)%20+%20f(x%20%7C%20%5Cmu,%20%5Cphi)"> for <img src="https://latex.codecogs.com/png.latex?x%20=%200,...,m">.</li>
<li>Check if <img src="https://latex.codecogs.com/png.latex?f(x%20%7C%20%5Cmu,%20%5Cphi)%20/%20F(x%20%7C%20%5Cmu,%20%5Cphi)"> is small (less than <img src="https://latex.codecogs.com/png.latex?10%5E%7B-8%7D">), in which case accumulation stops at the value <img src="https://latex.codecogs.com/png.latex?n">.</li>
<li>The normalized cumulative distribution function will then be <img src="https://latex.codecogs.com/png.latex?F(x%20%7C%20%5Cmu,%20%5Cphi)%20/%20F(n%20%7C%20%5Cmu,%20%5Cphi)">.</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">stancode_cdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span></span>
<span id="cb5-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vector dpo_cdf_vec(real mu, real phi, int maxval) {</span></span>
<span id="cb5-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real d = exp(phi * (1 + log(mu)) - 1);</span></span>
<span id="cb5-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real prob;</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int n = maxval + 1;</span></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[n] cdf;</span></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[1] = sqrt(phi) * exp(-mu * phi);</span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  prob = cdf[1] * d;</span></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[2] = cdf[1] + prob;</span></span>
<span id="cb5-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 2:maxval) {</span></span>
<span id="cb5-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    prob = prob * d * exp((1 - phi) * (i - 1) * (log(i) - log(i - 1))) / (i^phi);</span></span>
<span id="cb5-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf[i + 1] = cdf[i] + prob;</span></span>
<span id="cb5-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (prob / cdf[i + 1] &lt; 1e-8) {</span></span>
<span id="cb5-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      n = i + 1;</span></span>
<span id="cb5-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      break;</span></span>
<span id="cb5-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb5-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb5-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return cdf / cdf[n];</span></span>
<span id="cb5-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>To check that this is accurate, I’ll again compare the Stan function to the corresponding function from <code>gamlss.dist</code>. If my function is accurate, the computed cdf values should be proportional to the cdf calculated from <code>gamlss.dist::pDPO()</code> and the ratio should be very close to 1.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_cdf, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-cdf.stan"</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-cdf.stan"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4">test_cdf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb6-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb6-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, phi),</span>
<span id="cb6-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_cdf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> maxval), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> dpo_cdf_vec)</span>
<span id="cb6-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(my_cdf) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.nan</span>(my_cdf)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(mu, phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>L,</span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_cdf =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pDPO</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> q, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> phi),</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> my_cdf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> gamlss_cdf</span>
<span id="cb6-20">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_cdf, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi), ratio, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>( <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Still on track here (although you might wonder—would I be sharing this post if I couldn’t get the function working?).</p>
</section>
<section id="quantile-function-and-sampler" class="level1">
<h1>Quantile function and sampler</h1>
<p>The main other thing we need is a function for generating random samples from the double-Poisson. The <code>gamlss.dist</code> package has the function <code>rDPO()</code> for this purpose. It’s implemented using the standard inversion method, by calculating quantiles of the double-Poisson corresponding to a random sample from a uniform distribution. Just for funzies, I’ll implement the same approach using Stan.</p>
<p>The function below calculates quantiles by finding the minimum value of <img src="https://latex.codecogs.com/png.latex?q%20%5Cgeq%200"> such that <img src="https://latex.codecogs.com/png.latex?F(q%20+%201%20%7C%20%5Cmu,%20%5Cphi)%20%5Cgeq%20p"> for a specified probability <img src="https://latex.codecogs.com/png.latex?p%20%5Cin%20%5B0,%201%5D">. It is vectorized over <img src="https://latex.codecogs.com/png.latex?p"> and solves for <img src="https://latex.codecogs.com/png.latex?q"> by starting with the smallest <img src="https://latex.codecogs.com/png.latex?p"> and continuing through the largest value.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">stancode_quantile <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span></span>
<span id="cb8-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vector dpo_cdf_vec(real mu, real phi, int maxval) {</span></span>
<span id="cb8-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real d = exp(phi * (1 + log(mu)) - 1);</span></span>
<span id="cb8-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real prob;</span></span>
<span id="cb8-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int n = maxval + 1;</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[n] cdf;</span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[1] = sqrt(phi) * exp(-mu * phi);</span></span>
<span id="cb8-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  prob = cdf[1] * d;</span></span>
<span id="cb8-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[2] = cdf[1] + prob;</span></span>
<span id="cb8-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 2:maxval) {</span></span>
<span id="cb8-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    prob = prob * d * exp((1 - phi) * (i - 1) * (log(i) - log(i - 1))) / (i^phi);</span></span>
<span id="cb8-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf[i + 1] = cdf[i] + prob;</span></span>
<span id="cb8-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (prob / cdf[i + 1] &lt; 1e-8) {</span></span>
<span id="cb8-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      n = i + 1;</span></span>
<span id="cb8-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      break;</span></span>
<span id="cb8-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb8-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb8-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return cdf / cdf[n];</span></span>
<span id="cb8-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">array[] int dpo_quantiles(vector p, real mu, real phi, int maxval) {</span></span>
<span id="cb8-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int N = rows(p);</span></span>
<span id="cb8-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[N] int qs;</span></span>
<span id="cb8-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[N] int indices = sort_indices_asc(p);</span></span>
<span id="cb8-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[maxval + 1] cdf_vec = dpo_cdf_vec(mu, phi, maxval);</span></span>
<span id="cb8-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int j = 0;</span></span>
<span id="cb8-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in indices) {</span></span>
<span id="cb8-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    while (cdf_vec[j + 1] &lt; p[i]) {</span></span>
<span id="cb8-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      j += 1;</span></span>
<span id="cb8-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb8-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    qs[i] = j;</span></span>
<span id="cb8-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb8-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return qs;</span></span>
<span id="cb8-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>If my quantile function is accurate, it should match the value computed from <code>gamlss.dist::qDPO()</code> exactly.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_quantile, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-quantile.stan"</span>)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-quantile.stan"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">test_quantile <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb9-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb9-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, phi),</span>
<span id="cb9-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)),</span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">my_q =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> maxval), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> dpo_quantiles),</span>
<span id="cb9-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_q =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> qDPO)</span>
<span id="cb9-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p, my_q, gamlss_q)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff =</span> my_q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> gamlss_q</span>
<span id="cb9-18">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_quantile, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi), diff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>( <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Phew, still got it!</p>
<p>The last piece of the puzzle is to write a sampler by generating random points from a uniform distribution, then computing the double-Poisson quantiles of these random points. I will implement this two ways: first with an argument for the number of random variates to generate and then, more simply, to generate a single random variate.<sup>3</sup></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">stancode_qr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb11-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">real dpo_lpmf(int X, real mu, real phi) {</span></span>
<span id="cb11-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real ans;</span></span>
<span id="cb11-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real A = inv(2) * log(phi) - phi * mu;</span></span>
<span id="cb11-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  if (X == 0)</span></span>
<span id="cb11-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A;</span></span>
<span id="cb11-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  else</span></span>
<span id="cb11-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ans = A + X * (phi * (1 + log(mu)) - 1) - lgamma(X + 1) + (1 - phi) * X * log(X);</span></span>
<span id="cb11-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return ans;</span></span>
<span id="cb11-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vector dpo_cdf_vec(real mu, real phi, int maxval) {</span></span>
<span id="cb11-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real d = exp(phi * (1 + log(mu)) - 1);</span></span>
<span id="cb11-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real prob;</span></span>
<span id="cb11-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int n = maxval + 1;</span></span>
<span id="cb11-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[n] cdf;</span></span>
<span id="cb11-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[1] = sqrt(phi) * exp(-mu * phi);</span></span>
<span id="cb11-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  prob = cdf[1] * d;</span></span>
<span id="cb11-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  cdf[2] = cdf[1] + prob;</span></span>
<span id="cb11-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 2:maxval) {</span></span>
<span id="cb11-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    prob = prob * d * exp((1 - phi) * (i - 1) * (log(i) - log(i - 1))) / (i^phi);</span></span>
<span id="cb11-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    cdf[i + 1] = cdf[i] + prob;</span></span>
<span id="cb11-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    if (prob / cdf[i + 1] &lt; 1e-8) {</span></span>
<span id="cb11-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      n = i + 1;</span></span>
<span id="cb11-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      break;</span></span>
<span id="cb11-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb11-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb11-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return cdf / cdf[n];</span></span>
<span id="cb11-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">array[] int dpo_quantiles(vector p, real mu, real phi, int maxval) {</span></span>
<span id="cb11-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int N = rows(p);</span></span>
<span id="cb11-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[N] int qs;</span></span>
<span id="cb11-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[N] int indices = sort_indices_asc(p);</span></span>
<span id="cb11-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[maxval + 1] cdf_vec = dpo_cdf_vec(mu, phi, maxval);</span></span>
<span id="cb11-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int j = 0;</span></span>
<span id="cb11-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in indices) {</span></span>
<span id="cb11-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    while (cdf_vec[j + 1] &lt; p[i]) {</span></span>
<span id="cb11-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      j += 1;</span></span>
<span id="cb11-38"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb11-39"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    qs[i] = j;</span></span>
<span id="cb11-40"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb11-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return qs;</span></span>
<span id="cb11-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">array[] int dpo_sample_rng(int n, real mu, real phi, int maxval) {</span></span>
<span id="cb11-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[n] p;</span></span>
<span id="cb11-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  for (i in 1:n) {</span></span>
<span id="cb11-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    p[i] = uniform_rng(0,1);</span></span>
<span id="cb11-47"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  }</span></span>
<span id="cb11-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  array[n] int x = dpo_quantiles(p, mu, phi, maxval);</span></span>
<span id="cb11-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return x;</span></span>
<span id="cb11-50"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int dpo_quantile(real p, real mu, real phi, int maxval) {</span></span>
<span id="cb11-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  vector[maxval + 1] cdf_vec = dpo_cdf_vec(mu, phi, maxval);</span></span>
<span id="cb11-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int q = 0;</span></span>
<span id="cb11-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  while (cdf_vec[q + 1] &lt; p) {</span></span>
<span id="cb11-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">      q += 1;</span></span>
<span id="cb11-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb11-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return q;</span></span>
<span id="cb11-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">int dpo_rng(real mu, real phi, int maxval) {</span></span>
<span id="cb11-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  real p = uniform_rng(0,1);</span></span>
<span id="cb11-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  int x = dpo_quantile(p, mu, phi, maxval);</span></span>
<span id="cb11-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  return x;</span></span>
<span id="cb11-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</details>
</div>
<p>To check this function, I’ll generate some large samples from the double-Poisson with a few different parameter sets. If the sampler is working properly, the empirical cumulative distribution should line up closely with the cumulative distribution computed using <code>gamlss.dist::pDPO()</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">writeLines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions {"</span>, stancode_qr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-rng.stan"</span>)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_stan_functions</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DPO-rng.stan"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4">test_rng <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(</span>
<span id="cb12-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb12-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb12-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb12-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.l =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> dpo_sample_rng),</span>
<span id="cb12-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(x, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(.x)))</span>
<span id="cb12-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-13">  dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(mu, phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(tb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb12-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(.x))[.x],</span>
<span id="cb12-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Freq_cum =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(Freq) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>,</span>
<span id="cb12-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gamlss_F =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pDPO</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> phi)</span>
<span id="cb12-20">  )</span></code></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(test_rng, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(gamlss_F, Freq_cum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(phi))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  </span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_both"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Theoretical cdf (gamlss.dist)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical cdf (my function)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks pretty good, no?</p>
</section>
<section id="using-the-custom-distribution-functions" class="level1">
<h1>Using the custom distribution functions</h1>
<p>To finish out my tests of these functions, let me demonstrate their use in an actual estimation problem. I’ll generate data based on a simple generalized linear model with a single predictor <img src="https://latex.codecogs.com/png.latex?X">, where the outcome <img src="https://latex.codecogs.com/png.latex?Y"> follows a double-Poisson distribution conditional on <img src="https://latex.codecogs.com/png.latex?X">. The data-generating process is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AX%20&amp;%5Csim%20N(0,%201)%20%5C%5C%0AY%7CX%20&amp;%5Csim%20DPO(%5Cmu(X),%20%5Cphi)%20%5C%5C%0A%5Clog%20%5Cmu(X)%20&amp;=%202%20+%200.3%20%5Ctimes%20X%0A%5Cend%7Baligned%7D%0A"> To make things interesting, I’ll set the dispersion parameter to <img src="https://latex.codecogs.com/png.latex?1%20/%20%5Cphi%20=%200.6"> so that the outcome is <em>under</em>-dispersed relative to the Poisson.</p>
<p>The following code generates a large sample from the data-generating process. To keep things R-centric, I use <code>gamlss.dist::rDPO</code> to generate the outcome.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230913</span>)</span>
<span id="cb14-2">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span></span>
<span id="cb14-3">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N)</span>
<span id="cb14-4">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> X)</span>
<span id="cb14-5">phi_inv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb14-6">Y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rDPO</span>(N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> phi_inv)</span>
<span id="cb14-7">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> Y)</span></code></pre></div>
</details>
</div>
<p>Here’s what the sample looks like, along with a smoothed regression estimated using a basic cubic spline:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(X, Y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gam'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cs"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<section id="comparison-models" class="level2">
<h2 class="anchored" data-anchor-id="comparison-models">Comparison models</h2>
<p>Before using the custom distribution, I’ll fit a couple of out-of-the-box models that are useful points of comparison. Surely the simplest, quickest, and dirtiest way to estimate such a regression is with a generalized linear model, using the “quasi-Poisson” family to allow for non-unit dispersion. In R:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">quasi_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quasipoisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(quasi_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ X, family = quasipoisson(link = "log"), data = dat)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.98784    0.01219  163.03   &lt;2e-16 ***
X            0.29276    0.01178   24.85   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for quasipoisson family taken to be 0.6324771)

    Null deviance: 777.74  on 599  degrees of freedom
Residual deviance: 384.90  on 598  degrees of freedom
AIC: NA

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>This approach recovers the data-generating parameters quite well, with a dispersion estimate of 0.632 compared to the true dispersion parameter of 0.6.</p>
<p>Now let me fit the same generalized linear model but assuming that the outcome follows a true Poisson distribution (with unit dispersion). I’ll fit the model in a Bayesian framework with the <code>brms</code> package.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">Poisson_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb18-3">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb18-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb18-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb18-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>, </span>
<span id="cb18-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb18-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb18-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230913</span></span>
<span id="cb18-10">  )</span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(Poisson_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson 
  Links: mu = log 
Formula: Y ~ X 
   Data: dat (Number of observations: 600) 
  Draws: 4 chains, each with iter = 1500; warmup = 500; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.99      0.02     1.96     2.02 1.00     2865     2658
X             0.29      0.01     0.26     0.32 1.00     2552     2381

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>This specification recovers the intercept and slope parameters well too, but doesn’t provide any estimate of dispersion.</p>
<p>As an alternative, I’ll also fit the model using the negative binomial distribution, which is a generalization of the Poisson that allows for over-dispersion (but not under-dispersion):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">negbin_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb20-3">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">negbinomial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb20-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb20-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb20-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>, </span>
<span id="cb20-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb20-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb20-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230913</span></span>
<span id="cb20-10">  )</span>
<span id="cb20-11"></span>
<span id="cb20-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(negbin_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: negbinomial 
  Links: mu = log; shape = identity 
Formula: Y ~ X 
   Data: dat (Number of observations: 600) 
  Draws: 4 chains, each with iter = 1500; warmup = 500; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI  Rhat Bulk_ESS Tail_ESS
Intercept     1.98      0.01     1.96     1.99  8.46        4        4
X             0.31      0.03     0.29     0.36 11.39        4       NA

Further Distributional Parameters:
                                                                                                                      Estimate
shape 288635341964439312984004668864260822628440088608000200668088264284802644482664682404200862480406040224646204882688664.00
                                                                                                                     Est.Error
shape 499993580246645223926226042864464406466686242028244246282864888460026284662046208044222402820440664060080422624068464.00
               l-95% CI
shape 12948941308882.21
                                                                                                                       u-95% CI
shape 1154541367857757248926006442246840288482660022402000800442022846826208466628446428606800248620604060886464806228422446.00
      Rhat Bulk_ESS Tail_ESS
shape  Inf        4       NA

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The <code>brms</code> package implements the negative binomial using the rate parameterization, so the <code>shape</code> parameter corresponds to the inverse dispersion. Thus, a large shape parameter (as in the above fit) implies dispersion that is very close to one (i.e., close to the Poisson).</p>
</section>
<section id="double-poisson-model" class="level2">
<h2 class="anchored" data-anchor-id="double-poisson-model">Double-Poisson model</h2>
<p>Now I’ll fit the same model as previously but using my custom-built double-Poisson distribution. Following <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html">Paul Buerkner’s vignette</a> on using custom distributions in <code>brms</code>, I’ll first specify the custom family object for the double-Poisson:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">double_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">custom_family</span>(</span>
<span id="cb22-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dpo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dpars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>),</span>
<span id="cb22-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">links =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>),</span>
<span id="cb22-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ub =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb22-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"int"</span></span>
<span id="cb22-6">)</span></code></pre></div>
</details>
</div>
<p>I set the defaults to use a log-link for the mean (just as with the Poisson and negative binomial families) and a log-link for the inverse-dispersion. Next, I’ll create an object to add the custom stan code from above into the code created by <code>brm</code> for fitting the model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">double_Poisson_stanvars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stanvar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scode =</span> stancode_qr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">block =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functions"</span>)</span></code></pre></div>
</details>
</div>
<p>I’ll also need to specify a prior to use for the <img src="https://latex.codecogs.com/png.latex?%5Cphi"> parameter of the double-Poisson distribution:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">phi_prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prior</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exponential</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>)</span></code></pre></div>
</details>
</div>
<p>Now I’m ready to fit the model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">DPO_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brm</span>(</span>
<span id="cb25-3">    Y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> double_Poisson,</span>
<span id="cb25-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prior =</span> phi_prior,</span>
<span id="cb25-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stanvars =</span> double_Poisson_stanvars,</span>
<span id="cb25-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, </span>
<span id="cb25-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">warmup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, </span>
<span id="cb25-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iter =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>, </span>
<span id="cb25-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">chains =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb25-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cores =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb25-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230913</span></span>
<span id="cb25-12">  )</span>
<span id="cb25-13"></span>
<span id="cb25-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(DPO_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> Family: dpo 
  Links: mu = log; phi = identity 
Formula: Y ~ X 
   Data: dat (Number of observations: 600) 
  Draws: 4 chains, each with iter = 1500; warmup = 500; thin = 1;
         total post-warmup draws = 4000

Regression Coefficients:
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     1.99      0.01     1.96     2.01 1.00     3592     2849
X             0.29      0.01     0.27     0.32 1.00     3330     3103

Further Distributional Parameters:
    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
phi     1.55      0.09     1.38     1.72 1.00     3043     2560

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>The regression coefficient estimates are basically identical to those from the Poisson and negative-binomial models, estimated with slightly better precision than with the Poisson or negative binomial families. However, we get a posterior for <img src="https://latex.codecogs.com/png.latex?%5Cphi"> that corresponds to <em>under</em>-dispersion. Here’s the posterior for the dispersion (i.e., <img src="https://latex.codecogs.com/png.latex?1%20/%20%5Cphi">):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mcmc_areas</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pars =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">transformations =</span> \(x) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb27-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/DPO-dispersion-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison">Model comparison</h2>
<p>I’d like to get a sense of how much better the double-Poisson model does with capturing the real data-generating process compared to the simple Poisson model or the negative binomial model. There’s a wide range of diagnostics that can inform such comparisons. I’ll consider the leave-one-out information criteria (LOOIC) and also look at some posterior predictive checks.</p>
<p>To calculate LOOIC for the double-Poisson model, I first need to provide a <code>log_lik</code> function that <code>brms</code> can use<sup>4</sup>. Here’s code, using the Stan function from above:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expose_functions</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vectorize =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb28-2">log_lik_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep) {</span>
<span id="cb28-3">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb28-4">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb28-5">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> prep<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y[i]</span>
<span id="cb28-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpo_lpmf</span>(y, mu, phi)</span>
<span id="cb28-7">}</span></code></pre></div>
</details>
</div>
<p>I can then compute LOOIC for all three models:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">loo</span>(DPO_fit, Poisson_fit, negbin_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Output of model 'DPO_fit':

Computed from 4000 by 600 log-likelihood matrix.

         Estimate   SE
elpd_loo  -1305.7 16.9
p_loo         2.9  0.2
looic      2611.4 33.7
------
MCSE of elpd_loo is 0.0.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.7, 1.3]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Output of model 'Poisson_fit':

Computed from 4000 by 600 log-likelihood matrix.

         Estimate   SE
elpd_loo  -1330.0 11.3
p_loo         1.3  0.1
looic      2660.1 22.6
------
MCSE of elpd_loo is 0.0.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 0.9]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Output of model 'negbin_fit':

Computed from 4000 by 600 log-likelihood matrix.

         Estimate   SE
elpd_loo  -1332.9 11.6
p_loo         2.9  0.3
looic      2665.8 23.2
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.0, 0.0]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     157   26.2%   2       
   (0.7, 1]   (bad)        0    0.0%   &lt;NA&gt;    
   (1, Inf)   (very bad) 443   73.8%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Model comparisons:
            elpd_diff se_diff
DPO_fit       0.0       0.0  
Poisson_fit -24.3       6.0  
negbin_fit  -27.2       6.0  </code></pre>
</div>
</div>
<p>By these measures, the double-Poisson model has substantially better fit than either of the other models.</p>
<p>To do posterior predictive checks, I need to provide a <code>posterior_predict</code> function that <code>brms</code> can use. I’ll again do an implementation that uses my custom <code>dpo_rng()</code> from Stan.<sup>5</sup></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">posterior_predict_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i, prep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, ...) {</span>
<span id="cb31-2">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb31-3">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> brms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_dpar</span>(prep, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> i)</span>
<span id="cb31-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.null</span>(maxval)) maxval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(phi, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dpo_rng</span>(mu, phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maxval =</span> maxval)</span>
<span id="cb31-6">}</span></code></pre></div>
</details>
</div>
<p>Functions in hand, I can now compute posterior predictions for the double-Poisson model and make pretty pictures of them, along with corresponding plots for the Poisson and negative-binomial models.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">Yrep_Poisson <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(Poisson_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">draws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>) </span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb32-3">Poisson_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_Poisson, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb32-4"></span>
<span id="cb32-5">Yrep_negbin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(negbin_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">draws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>)</span>
<span id="cb32-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb32-7">negbin_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_negbin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb32-8"></span>
<span id="cb32-9">Yrep_dpo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">posterior_predict</span>(DPO_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">draws =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>)</span>
<span id="cb32-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb32-11">dpo_root <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_rootogram</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_dpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hanging"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double-Poisson"</span>)</span>
<span id="cb32-12"></span>
<span id="cb32-13">dpo_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> Poisson_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_root <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb32-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/ppd-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The differences in predicted frequencies are not that obvious from these plots. The main notable difference is that the Poisson and negative-binomial distributions predict more small counts (in the range of 0 to 3) than are observed, whereas the double-Poisson does better at matching the observed frequency in this range.</p>
<p>I think the lack of glaring differences in the above plots happens because I’m just looking at the marginal distribution of the outcome, and the (explained) variation due to the predictor dampens the degree of under-dispersion. To see this, I’ll create some plots that are grouped by quintiles of <img src="https://latex.codecogs.com/png.latex?X">:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>g <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">include.lowest =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb33-2"></span>
<span id="cb33-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb33-4">Poisson_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_bars_grouped</span>(</span>
<span id="cb33-5">  dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_Poisson, dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>g, </span>
<span id="cb33-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, </span>
<span id="cb33-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facet_args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb33-8">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb33-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb33-10"></span>
<span id="cb33-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb33-12">negbin_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_bars_grouped</span>(</span>
<span id="cb33-13">  dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_negbin, dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>g, </span>
<span id="cb33-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, </span>
<span id="cb33-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facet_args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb33-16">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb33-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb33-18"></span>
<span id="cb33-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb33-20">dpo_bars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_bars_grouped</span>(</span>
<span id="cb33-21">  dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_dpo, dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>g, </span>
<span id="cb33-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, </span>
<span id="cb33-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facet_args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb33-24">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb33-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double-Poisson"</span>)</span>
<span id="cb33-26"></span>
<span id="cb33-27">dpo_bars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> Poisson_bars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_bars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb33-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/ppd-grouped-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Still kind of subtle, I suppose, but you can see more clearly that the double-Poisson does a better job than the other distributions at matching the modes (peaks) of the empirical distribution in each of these subgroups.</p>
<p>One last approach is to look directly at the degree of dispersion in the posterior predictive distributions relative to the actual data. I’ll calculate this dispersion by re-fitting the quick-and-dirty quasi-poisson model in each sample:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">dispersion_coef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(y) {</span>
<span id="cb34-2">  quasi_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quasipoisson</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log"</span>))</span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">residuals</span>(quasi_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> quasi_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>df.residual</span>
<span id="cb34-4">}</span>
<span id="cb34-5"></span>
<span id="cb34-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb34-7">Poisson_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_Poisson, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb34-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poisson"</span>)</span>
<span id="cb34-9"></span>
<span id="cb34-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb34-11">negbin_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_negbin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb34-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Negative-binomial"</span>)</span>
<span id="cb34-13"></span>
<span id="cb34-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">color_scheme_set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)</span>
<span id="cb34-15">dpo_disp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ppc_stat</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, Yrep_dpo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> dispersion_coef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb34-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Double-Poisson"</span>)</span>
<span id="cb34-17"></span>
<span id="cb34-18">dpo_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> Poisson_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> negbin_disp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span></span>
<span id="cb34-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> </span>
<span id="cb34-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/double-poisson-in-Stan/index_files/figure-html/ppc-dispersion-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>From this, we can clearly see that the Poisson and negative binomial model generate data with approximately unit dispersion, which doesn’t match at all with the degree of dispersion in the observed data.</p>
</section>
</section>
<section id="kudos" class="level1">
<h1>Kudos</h1>
<p>So there you have it. It’s really quite feasible to build models with custom distributions. Efron (1986) also describes a double-binomial distribution (as an approximation to the “quasi-binomial” family of generalized linear models), which you could play with implementing for yourself, dear reader, if you are in the mood. Major kudos to <a href="https://paul-buerkner.github.io/">Paul Buerkner</a> for <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a>, <a href="https://jgabry.github.io/">Jonah Gabry</a> and collaborators for <a href="https://mc-stan.org/bayesplot/"><code>bayesplot</code></a>, and <a href="https://mc-stan.org/about/team/">the incredible team of folks</a> developing <a href="https://mc-stan.org/"><code>Stan</code></a>.</p>
</section>
<section id="colophon" class="level1">
<h1>Colophon</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.3 (2024-02-29 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 11 x64 (build 22621)

Matrix products: default


locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] loo_2.7.0          bayesplot_1.11.1   brms_2.21.0        Rcpp_1.0.12       
 [5] rstan_2.32.6       StanHeaders_2.32.6 gamlss.dist_6.1-1  patchwork_1.2.0   
 [9] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       
[13] purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      
[17] ggplot2_3.5.0      tidyverse_2.0.0   

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     farver_2.1.1         fastmap_1.1.1       
 [4] tensorA_0.36.2.1     digest_0.6.35        timechange_0.3.0    
 [7] lifecycle_1.0.4      magrittr_2.0.3       posterior_1.5.0     
[10] compiler_4.3.3       rlang_1.1.3          tools_4.3.3         
[13] utf8_1.2.4           yaml_2.3.8           knitr_1.45          
[16] labeling_0.4.3       bridgesampling_1.1-2 htmlwidgets_1.6.4   
[19] pkgbuild_1.4.4       plyr_1.8.9           BH_1.84.0-0         
[22] abind_1.4-5          withr_3.0.0          grid_4.3.3          
[25] stats4_4.3.3         fansi_1.0.6          colorspace_2.1-0    
[28] inline_0.3.19        scales_1.3.0         MASS_7.3-60.0.1     
[31] ggridges_0.5.6       cli_3.6.2            mvtnorm_1.2-4       
[34] rmarkdown_2.26       generics_0.1.3       RcppParallel_5.1.7  
[37] rstudioapi_0.16.0    reshape2_1.4.4       tzdb_0.4.0          
[40] splines_4.3.3        parallel_4.3.3       matrixStats_1.2.0   
[43] vctrs_0.6.5          Matrix_1.6-5         jsonlite_1.8.8      
[46] hms_1.1.3            glue_1.7.0           codetools_0.2-19    
[49] distributional_0.4.0 stringi_1.8.3        gtable_0.3.4        
[52] QuickJSR_1.1.3       munsell_0.5.1        pillar_1.9.0        
[55] htmltools_0.5.7      Brobdingnag_1.2-9    R6_2.5.1            
[58] RcppEigen_0.3.4.0.0  evaluate_0.23        lattice_0.22-5      
[61] backports_1.4.1      renv_1.0.5           rstantools_2.4.0    
[64] coda_0.19-4.1        gridExtra_2.3        nlme_3.1-164        
[67] checkmate_2.3.1      mgcv_1.9-1           xfun_0.42           
[70] pkgconfig_2.0.3     </code></pre>
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>To be clear up front, what I present is more complicated than really necessary because of these existing R functions to simulate values from the double-Poisson—we can just use the functions from <code>gamlss.dist</code> for purposes of posterior predictive checks (about which more below). I’m trying to work in Stan to the maximum extent possible solely as an excuse to learn more about the language, which I haven’t used much up until today.↩︎</p></li>
<li id="fn2"><p>I should also note that the <a href="http://www.bamlss.org/index.html"><code>bamlss</code> package</a> provides similar functionality and can be combined with <code>gamlss.dist</code> to accomplish basically the same thing as I’m going to do here.↩︎</p></li>
<li id="fn3"><p>The simpler version is what’s needed for generating posterior predictive checks, the fancy version is just to show off how clever I am.↩︎</p></li>
<li id="fn4"><p>Rather than exposing and calling the Stan function, one could just re-implement the log likelihood in R. (Probably the easier way in practice, but again I’m trying to learn me some Stan here…)↩︎</p></li>
<li id="fn5"><p>Of course, I could have saved a bunch of trouble by just using <code>gamlss.dist::rDPO()</code> instead.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2023,
  author = {Pustejovsky, James E.},
  title = {Implementing {Efron’s} Double {Poisson} Distribution in
    {Stan}},
  date = {2023-09-15},
  url = {https://jepusto.com/posts/double-poisson-in-Stan},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2023" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2023. <span>“Implementing Efron’s Double Poisson
Distribution in Stan.”</span> September 15, 2023. <a href="https://jepusto.com/posts/double-poisson-in-Stan">https://jepusto.com/posts/double-poisson-in-Stan</a>.
</div></div></section></div> ]]></description>
  <category>Bayes</category>
  <category>simulation</category>
  <category>distribution-theory</category>
  <category>generalized linear model</category>
  <category>programming</category>
  <category>Rstats</category>
  <guid>https://jepusto.com/posts/double-poisson-in-Stan/</guid>
  <pubDate>Fri, 15 Sep 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Cluster-Bootstrapping a meta-analytic selection model</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <dc:creator>Megha Joshi</dc:creator>
  <link>https://jepusto.com/posts/cluster-bootstrap-selection-model/</link>
  <description><![CDATA[ 





<div class="cell">
<style type="text/css">
.greybox {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 60%;
  padding: 1em;
  background: lightgrey;
  border: 2px solid darkgrey;
  border-radius: 1px;
  font-size: 0.75em;
}
</style>
</div>
<div class="greybox">
<p>The research reported here was supported, in whole or in part, by the Institute of Education Sciences, U.S. Department of Education, through grant R305D220026 to the American Institutes for Research. The opinions expressed are those of the authors and do not represent the views of the Institute or the U.S. Department of Education.</p>
</div>
<p><br> Selective reporting of study results is a big concern for meta-analysts. By selective reporting, we mean the phenomenon where affirmative findings—that is, statistically significant findings in the theoretically expected direction—are more likely to be reported and more likely to be available for a systematic review compared to non-affirmative findings. Selective reporting arises due to biases in the publication process, on the part of journals, editors, and reviewers, as well as strategic decisions on part of the authors <span class="citation" data-cites="rothstein2006publication sutton2009publication">(Rothstein et al., 2006; Sutton, 2009)</span>. Research synthesists worry about selective reporting because it can distort the evidence base available for meta-analysis, almost like a fun-house mirror distorts your appearance, leading to inflation of average effect size estimates and biased estimates of heterogeneity.</p>
<p>If you read the meta-analysis methods literature, you will find scores of tools available to investigate and adjust for the biases created by selective reporting. Well known and widely used methods include:</p>
<ul>
<li>graphical representations like funnel plots and contour-enhanced funnel plots <span class="citation" data-cites="sterne2001funnel Sterne2011recommendations">(Sterne et al., 2011; Sterne &amp; Egger, 2001)</span>;</li>
<li>tests for selective reporting (or at least funnel plot asymmetry) like Egger’s regression <span class="citation" data-cites="egger1997bias">(Egger et al., 1997)</span> or Begg and Mazumdar’s rank correlation test <span class="citation" data-cites="begg1994operating">(Begg &amp; Mazumdar, 1994)</span>;</li>
<li>bias-adjustment methods like PET-PEESE <span class="citation" data-cites="stanley2008metaregression stanley2014metaregression">(Stanley, 2008; Stanley &amp; Doucouliagos, 2014)</span>, Trim-and-Fill <span class="citation" data-cites="duval2000nonparametric">(Duval &amp; Tweedie, 2000)</span>, and selection models <span class="citation" data-cites="hedges2005selection">(Hedges &amp; Vevea, 2005)</span>;</li>
<li>p-value diagnostics like p-curve <span class="citation" data-cites="simonsohn2014pcurve">(Simonsohn et al., 2014)</span>, p-uniform <span class="citation" data-cites="VanAssen2015meta vanaert2016conducting">(Aert et al., 2016; Assen et al., 2015)</span>, and the test of excess significance <span class="citation" data-cites="ioannidis2007exploratory">(Ioannidis &amp; Trikalinos, 2007)</span>; and</li>
<li>sensitivity analyses based on various forms of selection models <span class="citation" data-cites="vevea2005publication Copas2001sensitivity mathur2020sensitivity">(Copas &amp; Shi, 2001; Mathur &amp; VanderWeele, 2020; Vevea &amp; Woods, 2005)</span>.</li>
</ul>
<p>However, nearly all of the statistical methods here have the limitation that they are premised on observing independent effect sizes. That presents a problem for meta-analyses in education, psychology, and other social science fields, where it is very common to have meta-analyses involving <em>dependent</em> effect sizes.</p>
<p>Dependent effects occur in meta-analyses of group comparisons when primary studies report effects for multiple correlated measures of an outcome, at multiple points in time, or for multiple treatment groups compared to the same control group <span class="citation" data-cites="Becker2000multivariate">(Becker, 2000)</span>. Dependent effects are also common in meta-analyses of correlational effect sizes, where primary studies report more than one relevant correlation coefficient based on the same sample of participants. Methods such as multi-level meta-analysis <span class="citation" data-cites="VandenNoortgate2013threelevel">(Van den Noortgate et al., 2013)</span> and robust variance estimation <span class="citation" data-cites="Hedges2010robust">(Hedges et al., 2010)</span> are available to accommodate dependent effects when summarizing findings across studies or investigating moderators of effect size using meta-regression, but these techniques have yet to be extended to methods for testing or correcting bias due to selective reporting. Consequently, it’s pretty common to see research synthesis papers that use very sophisticated models for part of the analysis, but then use kludgey, awkward, or hacky approaches when it comes time to investigating selective reporting <span class="citation" data-cites="rodgers2020evaluating">(Rodgers &amp; Pustejovsky, 2020)</span>.</p>
<p>Along with <a href="https://www.air.org/mosaic">a group of our colleagues</a> from the American Institutes for Research, we are currently working on a project to develop better methods for investigating selective reporting issues in meta-analyses of dependent effect sizes. In this post, we will share an early peek under the hood at one little piece of what we’re studying, by sketching out what we think is a promising and pragmatic method for examining selective reporting while <em>also</em> accounting for effect size dependency. The method is to use a cluster-level bootstrap, which involves re-sampling clusters of observations (i.e., the set of multiple effect size estimates reported within a given primary study) to approximate the sampling distribution of an estimator <span class="citation" data-cites="boos2003introduction cameron2008bootstrap">(Boos, 2003; Cameron et al., 2008)</span>. To illustrate this technique, we will demonstrate how to bootstrap a Vevea-Hedges selection model.</p>
<p>Selection models comprise a large class of models that have two parts: a model describing the evidence-generation process and a model describing the process by which evidence is reported <span class="citation" data-cites="hedges2005selection">(Hedges &amp; Vevea, 2005)</span>. Vevea-Hedges selection models <span class="citation" data-cites="hedges1992modeling vevea1995general Hedges1996estimating">(Hedges, 1992; Hedges &amp; Vevea, 1996; Vevea &amp; Hedges, 1995)</span> involve a random effects meta-regression model for the evidence-generation process and a step function for the reporting process. With a step function, we assume that the probability that an effect size estimate is observed depends on the range in which its p-value falls. For instance, effects with <img src="https://latex.codecogs.com/png.latex?.01%20%3C%20p%20%5Cleq%20.05"> might have some probability <img src="https://latex.codecogs.com/png.latex?%5Clambda_1"> of being reported, effects with <img src="https://latex.codecogs.com/png.latex?.05%20%3C%20p%20%5Cleq%20.10"> might have some other probability <img src="https://latex.codecogs.com/png.latex?%5Clambda_2">, and effects with <img src="https://latex.codecogs.com/png.latex?.10%20%3C%20p"> might have some other probability <img src="https://latex.codecogs.com/png.latex?%5Clambda_3">.<sup>1</sup> Because the Vevea-Hedges model and other selection models separate the data-generation process into these two distinct stages, their parameters have clear interpretations and they can be used to generate bias-adjusted estimates of the distribution of effect sizes and to test for selective reporting issues. The only problem is that available implementations of selection models do not account for effect size dependency—but that’s where cluster bootstrapping could potentially help.</p>
<section id="disclaimer" class="level2">
<h2 class="anchored" data-anchor-id="disclaimer">Disclaimer</h2>
<p>To be clear, this post is based on work in progress. The cluster-bootstrap selection model that we’re going to demonstrate is an <em>experimental</em> and <em>exploratory</em> technique. We’re currently studying its properties and performance using Monte Carlo simulations, but we don’t have formal results to share yet. In the spirit of open and collaborative science, we wrote this post to demonstrate our approach to coding the method, in case others would like to experiment with the technique. Given that there are so few methods available for investigating selective reporting in meta-analyses with dependent effect sizes, we think this method is worth playing with and investigating further, and we would be happy to have others try it out as well. But, if you do so, please treat the results as tentative until we learn more about when the methods work well enough to trust the results.</p>
</section>
<section id="an-example" class="level2">
<h2 class="anchored" data-anchor-id="an-example">An Example</h2>
<p>For demonstrating this method, we will use data from a recent meta-analysis by Lehmann and colleagues <span class="citation" data-cites="lehmann2018metaanalysis">(2018)</span> that examined the effects of the color red on attractiveness judgments. The data is available via the <a href="https://wviechtb.github.io/metadat/reference/dat.lehmann2018.html"><code>metadat</code></a> package <span class="citation" data-cites="metadat">(White et al., 2022)</span>. The dataset includes 81 effect sizes from 41 unique studies. You can browse the data for yourself here:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(metadat)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for the example dataset</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for tidying</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for tidying variable names</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(metafor)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for meta-analysis</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(boot)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for bootstrapping</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tictoc)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for keeping time</span></span>
<span id="cb1-7"></span>
<span id="cb1-8">lehmann_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-9">  dat.lehmann2018 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">study =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_split_fixed</span>(short_title, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(study) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(study, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">presentation =</span> stimuli_presentation, yi, vi, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>())</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">study</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">presentation</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">yi</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">vi</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">short_title</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">full_citation</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">pr_publication</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">source_type</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">preregistered</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">moderator_group</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">context</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">gender</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">color_contrast</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">color_form</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">photo_type</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">photo_similarity</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">dv_type</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">dv_items</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">dv_scale</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">dv_scale_bottom</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">dv_scale_top</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">location</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">continent</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">participants</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">participant_notes</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">design</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">eth_majority</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">eth_majority_detail</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">eth_stim</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">eth_match</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">red_age</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">control_age</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">color_red</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">color_control</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">red_original</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">color_match</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">presentation_control</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">red_n</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">red_m</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">red_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">control_n</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">control_m</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">control_sd</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">sd_diff</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">rm_r</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">control_attractiveness</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">notes</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">total_sample_size</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">pooled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Banas, 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: left;">Banas, 2014 - Exp 1</td>
<td style="text-align: left;">Banas, K. (2014, July 7). Replication of Elliot et al. (2010) for CREP at the University of Edinburgh. Retrieved from osf.io/cvdpw</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Scotland</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">20.43</td>
<td style="text-align: right;">20.95</td>
<td style="text-align: left;">LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">6.05</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">5.96</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Berthold, 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Berthold, 2013 - Exp 1 - In Group</td>
<td style="text-align: left;">Berthold, A. (2013). Unpublished data</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">25.00</td>
<td style="text-align: right;">25.00</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">1.73</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bigelow et al., 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: left;">Bigelow et al., 2013 - Exp 1</td>
<td style="text-align: left;">Bigelow, M.G., Taylor, G. &amp; Underwood, M. (2013). Context-moderated effect of color on physiological and self-report measures of emotional response. UNC Asheville Journal, Undergraduate Research Program, Asheville, NC</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Lab(37.43/59.24/47.63)</td>
<td style="text-align: left;">Lab(36.68/34.86/87.99)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5.22</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4.56</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bigelow et al., 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.73</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">Bigelow et al., 2013 - Exp 1</td>
<td style="text-align: left;">Bigelow, M.G., Taylor, G. &amp; Underwood, M. (2013). Context-moderated effect of color on physiological and self-report measures of emotional response. UNC Asheville Journal, Undergraduate Research Program, Asheville, NC</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Lab(37.43/59.24/47.63)</td>
<td style="text-align: left;">Lab(36.68/34.86/87.99)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4.65</td>
<td style="text-align: right;">2.05</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6.28</td>
<td style="text-align: right;">1.81</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blech, 2014</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Blech, 2014 - Exp 1</td>
<td style="text-align: left;">Blech, C. (2014, August 4). Replication of Elliot et al. (2010). Red, rank, and romance in women viewing men. Retrieved from osf.io/tx2u5</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness, German translation</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">5.25</td>
<td style="text-align: right;">1.48</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">Not part of CREP because Used white as control condition, dropped yellow as not an original control color, age not included because separated into categories (&lt;25, 26-40, &gt;=41)</td>
<td style="text-align: right;">149</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Blech, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.35</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Blech, 2015 - Class Exp</td>
<td style="text-align: left;">Blech, C. (2015). Unpublished data from a class experiment</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Adults</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">31.40</td>
<td style="text-align: right;">31.40</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">3.95</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">4.45</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Boelk &amp; Madden, 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.27</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Boelk &amp; Madden, 2014 - Exp 1</td>
<td style="text-align: left;">Boelk, K., &amp; Madden, W. (2014, August 5). Fork of Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Retrieved from osf.io/zf7c9</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">19.06</td>
<td style="text-align: right;">19.35</td>
<td style="text-align: left;">LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6.03</td>
<td style="text-align: right;">1.24</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">6.40</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Buechner et al., 2015</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">Buechner et al., 2015 - Exp 1 - Prideful Pose</td>
<td style="text-align: left;">Buechner, V. L., Maier, M. A., Lichtenfeld, S., &amp; Elliot, A. J. (2015). Emotion Expression and Color: Their Joint Influence on Perceived Attractiveness and Social Position. Current Psychology, 34(2), 422-433. http://doi.org/10.1007/s12144-014-9266-x</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Dot</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">High School</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">16.88</td>
<td style="text-align: right;">16.88</td>
<td style="text-align: left;">LCh(50.9, 59.7, 25.7)</td>
<td style="text-align: left;">LCh(49.2, 60.2, 278.2)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Costello et al., 2017</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Costello et al., 2017 - Exp 1</td>
<td style="text-align: left;">Costello J., Groeneboom L. &amp; Pollet T. (2017). Romantic red: Do red products enhance the attractiveness of the consumer? Unpublished masters degree manuscript, University of Leiden</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Item</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrad</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">22.60</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">2.25</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">2.38</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Costello et al., 2017</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Costello et al., 2017 - Exp 2</td>
<td style="text-align: left;">Costello J., Groeneboom L. &amp; Pollet T. (2017). Romantic red: Do red products enhance the attractiveness of the consumer? Unpublished masters degree manuscript, University of Leiden</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue/Green</td>
<td style="text-align: left;">Item</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrad</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">21.32</td>
<td style="text-align: right;">21.06</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">2.60</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">2.49</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: left;">Same filters applied as in Exp 1 (excluded homosexual and preferred not to answer). Control combines blue and green</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot &amp; Maier, 2013</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Elliot &amp; Maier, 2013 - Exp 1</td>
<td style="text-align: left;">Elliot, A. J., &amp; Maier, M. a. (2013). The red-attractiveness effect, applying the Ioannidis and Trikalinos (2007b) test, and the broader scientific context: a reply to Francis (2013). Journal of Experimental Psychology. General, 142(1), 297-300. http://doi.org/10.1037/a0029592</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">19.47</td>
<td style="text-align: right;">19.47</td>
<td style="text-align: left;">LCh(42.6, 45.2, 15.8)</td>
<td style="text-align: left;">LCh(43.0, -, 296.7)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">6.29</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">5.93</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot &amp; Niesta, 2008</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: left;">Elliot &amp; Niesta, 2008 - Exp 4</td>
<td style="text-align: left;">Elliot, A. J., &amp; Niesta, D. (2008). Romantic red: red enhances men's attraction to women. Journal of Personality and Social Psychology, 95(5), 1150-1164. http://doi.org/10.1037/0022-3514.95.5.1150</td>
<td style="text-align: right;">2008.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.97</td>
<td style="text-align: right;">19.97</td>
<td style="text-align: left;">LCh(46.1, 51.2, 29.3)</td>
<td style="text-align: left;">LCh(46.1, 51.0, 147.6)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.29</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">5.66</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot &amp; Niesta, 2008</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: left;">Elliot &amp; Niesta, 2008 - Exp 3</td>
<td style="text-align: left;">Elliot, A. J., &amp; Niesta, D. (2008). Romantic red: red enhances men's attraction to women. Journal of Personality and Social Psychology, 95(5), 1150-1164. http://doi.org/10.1037/0022-3514.95.5.1150</td>
<td style="text-align: right;">2008.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: right;">20.00</td>
<td style="text-align: left;">LCh(50.0, 58.7, 30.3)</td>
<td style="text-align: left;">LCh(50.0, -, 52.6)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">6.65</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">5.91</td>
<td style="text-align: right;">1.07</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot &amp; Niesta, 2008</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: left;">Elliot &amp; Niesta, 2008 - Exp 5</td>
<td style="text-align: left;">Elliot, A. J., &amp; Niesta, D. (2008). Romantic red: red enhances men's attraction to women. Journal of Personality and Social Psychology, 95(5), 1150-1164. http://doi.org/10.1037/0022-3514.95.5.1150</td>
<td style="text-align: right;">2008.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.77</td>
<td style="text-align: right;">19.77</td>
<td style="text-align: left;">LCh(45.9, 54.8, 32.5)</td>
<td style="text-align: left;">LCh(46.0, 54.9, 283.0)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7.21</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6.09</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot &amp; Niesta, 2008</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">Elliot &amp; Niesta, 2008 - Exp 2</td>
<td style="text-align: left;">Elliot, A. J., &amp; Niesta, D. (2008). Romantic red: red enhances men's attraction to women. Journal of Personality and Social Psychology, 95(5), 1150-1164. http://doi.org/10.1037/0022-3514.95.5.1150</td>
<td style="text-align: right;">2008.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.27</td>
<td style="text-align: right;">19.27</td>
<td style="text-align: left;">LCh(55.5, 78.0, 28.0)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">7.07</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.13</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">Age includes both male and female participants.</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot &amp; Niesta, 2008</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: left;">Elliot &amp; Niesta, 2008 - Exp 1</td>
<td style="text-align: left;">Elliot, A. J., &amp; Niesta, D. (2008). Romantic red: red enhances men's attraction to women. Journal of Personality and Social Psychology, 95(5), 1150-1164. http://doi.org/10.1037/0022-3514.95.5.1150</td>
<td style="text-align: right;">2008.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.52</td>
<td style="text-align: right;">20.52</td>
<td style="text-align: left;">LCh(50.3, 58.8, 29.9)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">7.33</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6.25</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot et al., 2010</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">Elliot et al., 2010 - Exp 3</td>
<td style="text-align: left;">Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Red, rank, and romance in women viewing men. Journal of Experimental Psychology: General, 139(3), 399-417. http://doi.org/10.1037/a0019689</td>
<td style="text-align: right;">2010.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">19.64</td>
<td style="text-align: right;">19.64</td>
<td style="text-align: left;">LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.69</td>
<td style="text-align: right;">1.22</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">5.27</td>
<td style="text-align: right;">2.04</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">df doesn't match sample size</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot et al., 2010</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">Elliot et al., 2010 - Exp 4</td>
<td style="text-align: left;">Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Red, rank, and romance in women viewing men. Journal of Experimental Psychology: General, 139(3), 399-417. http://doi.org/10.1037/a0019689</td>
<td style="text-align: right;">2010.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Mehrabian &amp; Blum's Perceived attractiveness</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">China</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Chinese</td>
<td style="text-align: left;">Chinese</td>
<td style="text-align: left;">Chinese</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.60</td>
<td style="text-align: right;">20.60</td>
<td style="text-align: left;">LCh(51.3, 51.7, 30.1)</td>
<td style="text-align: left;">LCh(51.5, 51.6, 136.6)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6.32</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">5.50</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot et al., 2010</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: left;">Elliot et al., 2010 - Exp 1</td>
<td style="text-align: left;">Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Red, rank, and romance in women viewing men. Journal of Experimental Psychology: General, 139(3), 399-417. http://doi.org/10.1037/a0019689</td>
<td style="text-align: right;">2010.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.19</td>
<td style="text-align: right;">20.19</td>
<td style="text-align: left;">LCh(49.6, 58.8, 30.4)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.79</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">5.67</td>
<td style="text-align: right;">1.34</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">df doesn't match sample size</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot et al., 2010</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: left;">Elliot et al., 2010 - Exp 7</td>
<td style="text-align: left;">Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Red, rank, and romance in women viewing men. Journal of Experimental Psychology: General, 139(3), 399-417. http://doi.org/10.1037/a0019689</td>
<td style="text-align: right;">2010.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Maner et al perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: left;">LCh(54.8, 43.2, 30.3)</td>
<td style="text-align: left;">LCh(55.1, 43.7, 283.0)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7.50</td>
<td style="text-align: right;">1.17</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">6.13</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot et al., 2010</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">1.05</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: left;">Elliot et al., 2010 - Exp 2</td>
<td style="text-align: left;">Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Red, rank, and romance in women viewing men. Journal of Experimental Psychology: General, 139(3), 399-417. http://doi.org/10.1037/a0019689</td>
<td style="text-align: right;">2010.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.46</td>
<td style="text-align: right;">20.46</td>
<td style="text-align: left;">LCh(49.6, 58.8, 30.4)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7.15</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">6.20</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: left;">Sample size taken from Francis, t(df) seems to be using ANOVA df for post-hoc, age data for both male and female participants (separate was not provided)</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot et al., 2013</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: left;">Elliot et al., 2013 - Exp 1</td>
<td style="text-align: left;">Elliot, A. J., Tracy, J. L., Pazda, A. D., &amp; Beall, A. T. (2013). Red enhances women's attractiveness to men: First evidence suggesting universality. Journal of Experimental Social Psychology, 49(1), 165-168. http://doi.org/10.1016/j.jesp.2012.07.017</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Burkina Faso</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Adults</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">26.80</td>
<td style="text-align: right;">26.80</td>
<td style="text-align: left;">LCh(42.7, 51.5, 20.4)</td>
<td style="text-align: left;">LCh(43.4, 51.5, 269.8)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">4.62</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">4.14</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Frazier, 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Frazier, 2014 - Exp 1</td>
<td style="text-align: left;">Frazier, A. (2014, November 13). Fork of Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Retrieved from osf.io/u0mig</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: right;">18.90</td>
<td style="text-align: left;">LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6.09</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">5.97</td>
<td style="text-align: right;">1.26</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gilston &amp; Privitera, 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">1.92</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">Gilston &amp; Privitera, 2016 - Exp 1 - Healthy</td>
<td style="text-align: left;">Gilston, A., &amp; Privitera, G. J. (2015). A 'Healthy' Color: Information About Healthy Eating Attenuates the 'Red Effect.' Global Journal of Health Science, 8(1), 56-61. https://doi.org/10.5539/gjhs.v8n1p56</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrad</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">19.85</td>
<td style="text-align: right;">19.85</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">5.65</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">3.09</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">1.32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Gueguen, 2012</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Gueguen, 2012 - Exp 1</td>
<td style="text-align: left;">Gueguen, N. (2012). Color and Women Attractiveness: When Red Clothed Women Are Perceived to Have More Intense Sexual Intent. The Journal of Social Psychology, 152(3), 261-265. http://doi.org/10.1080/00224545.2011.605398</td>
<td style="text-align: right;">2012.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue/Green/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">19.20</td>
<td style="text-align: right;">19.20</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">5.95</td>
<td style="text-align: right;">1.24</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">5.04</td>
<td style="text-align: right;">1.22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: left;">Control is average of blue, white, and green</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hesslinger et al. 2015</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">Hesslinger et al. 2015 - Exp 2</td>
<td style="text-align: left;">Hesslinger, V. M., Goldbach, L., Carbon, C.-C., Allgemeine, A., Psychologie, E., &amp; Note, A. (2015). Men in red: A reexamination of the red-attractiveness effect. Psychonomic Bulletin &amp; Review, 55(4), 1-6. http://doi.org/10.3758/s13423-015-0866-8</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness, German translation</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.20</td>
<td style="text-align: right;">20.20</td>
<td style="text-align: left;">CIE-Lab(50, 51, 30)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4.98</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4.63</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: left;">Age includes both male and female participants.</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hesslinger et al. 2015</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Hesslinger et al. 2015 - Exp 1</td>
<td style="text-align: left;">Hesslinger, V. M., Goldbach, L., Carbon, C.-C., Allgemeine, A., Psychologie, E., &amp; Note, A. (2015). Men in red: A reexamination of the red-attractiveness effect. Psychonomic Bulletin &amp; Review, 55(4), 1-6. http://doi.org/10.3758/s13423-015-0866-8</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness, German translation</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">21.20</td>
<td style="text-align: right;">22.60</td>
<td style="text-align: left;">CIE-Lab(50, 51, 30)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">5.71</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">5.62</td>
<td style="text-align: right;">1.44</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">Age includes both male and female participants.</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Johnson et al., 2015</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Johnson et al., 2015 - Exp 1</td>
<td style="text-align: left;">Johnson, K., Meltzer, A., &amp; Grahe, J. E. (2015, October 12). Fork of Elliot, A. J., Niesta Kayser, D., Greitemeyer, T., Lichtenfeld, S., Gramzow, R. H., Maier, M. A., &amp; Liu, H. (2010). Retrieved from osf.io/ictud</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">18.94</td>
<td style="text-align: right;">18.92</td>
<td style="text-align: left;">LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">5.97</td>
<td style="text-align: right;">1.60</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">5.99</td>
<td style="text-align: right;">1.34</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: left;">Yellow group also run, but not included</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Khislavsky, 2016</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Khislavsky, 2016 - Exp 1</td>
<td style="text-align: left;">Khislavsky, A. (2016, March 14). Replication of Elliot et al. (2010). Red, rank, and romance in women viewing men. Retrieved from osf.io/f2udj</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.91</td>
<td style="text-align: right;">20.04</td>
<td style="text-align: left;">~LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">~LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">5.73</td>
<td style="text-align: right;">1.76</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">5.61</td>
<td style="text-align: right;">1.84</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">Not reviewed by CREP</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kirsch, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.47</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Kirsch, 2015 - Exp 1 - Heterosexual</td>
<td style="text-align: left;">Kirsch, F. (2015). Wahrgenommene Attraktivitaet und sexuelle Orientierung: Die Wirkung von Rot und Farbpraeferenzen (Perceived attractiveness and sexual orientation: The effects of red and color preferences). Wiesbaden: Springer. doi: 10.1007/978-3-658-08405-9</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">22.45</td>
<td style="text-align: right;">22.45</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">5.33</td>
<td style="text-align: right;">1.83</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">6.13</td>
<td style="text-align: right;">1.54</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">Cross-gender rating (females rating males). Age includes participants in all conditions.</td>
<td style="text-align: right;">161</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kirsch, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">Kirsch, 2015 - Exp 1 - Heterosexual</td>
<td style="text-align: left;">Kirsch, F. (2015). Wahrgenommene Attraktivitaet und sexuelle Orientierung: Die Wirkung von Rot und Farbpraeferenzen (Perceived attractiveness and sexual orientation: The effects of red and color preferences). Wiesbaden: Springer. doi: 10.1007/978-3-658-08405-9</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Monograph</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">22.45</td>
<td style="text-align: right;">22.45</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">6.85</td>
<td style="text-align: right;">1.44</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6.42</td>
<td style="text-align: right;">1.22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: left;">Cross-gender rating (males rating females). Age includes participants in all conditions.</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kirsch, 2015</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Kirsch, 2015 - Exp 2</td>
<td style="text-align: left;">Kirsch, F. (2015). Wahrgenommene Attraktivitaet und sexuelle Orientierung: Die Wirkung von Rot und Farbpraeferenzen (Perceived attractiveness and sexual orientation: The effects of red and color preferences). Wiesbaden: Springer. doi: 10.1007/978-3-658-08405-9</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Monograph</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6.55</td>
<td style="text-align: right;">1.17</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6.52</td>
<td style="text-align: right;">1.36</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: left;">Means are only for cross-gender rating (males rating females)</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Legate et al., 2015</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.35</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">Legate et al., 2015 - Exp 1</td>
<td style="text-align: left;">Legate, N., Baciu, C., Horne, L. M., Fiol, S., Paniagua, D., Muqeet, M., &amp; Zachocki, E. (2015, June 27). Replication of Elliot et al. (2010) at IIT. Retrieved from osf.io/zih7c</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White (21 white, 16 asian)</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">20.73</td>
<td style="text-align: right;">20.25</td>
<td style="text-align: left;">~LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">~LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">5.76</td>
<td style="text-align: right;">1.61</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6.33</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2015 - Class Exp</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">31.70</td>
<td style="text-align: right;">36.15</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">4.34</td>
<td style="text-align: right;">1.63</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">3.69</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2017 - Exp 1</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">White/Latino</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.41</td>
<td style="text-align: right;">21.22</td>
<td style="text-align: left;">LCh(51.3, 58.2, 29.5)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: right;">2.05</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">4.89</td>
<td style="text-align: right;">1.80</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">116</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2017 - Exp 2</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White/Latino</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">36.05</td>
<td style="text-align: right;">38.32</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">114</td>
<td style="text-align: right;">5.24</td>
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">5.38</td>
<td style="text-align: right;">1.85</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">244</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.23</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2015 - Class Exp</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">33.15</td>
<td style="text-align: right;">33.88</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">5.24</td>
<td style="text-align: right;">1.59</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">5.59</td>
<td style="text-align: right;">1.34</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2017 - Exp 2</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">35.78</td>
<td style="text-align: right;">35.85</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">6.51</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">6.38</td>
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">210</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lehmann &amp; Calin</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman, 2017 - Exp 1</td>
<td style="text-align: left;">Lehmann &amp; Calin-Jageman (2017) Is red really romantic? Direct replications suggest little to no effect of the color red on perceived attractiveness for men and women. Social Psychology.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">20.81</td>
<td style="text-align: right;">20.45</td>
<td style="text-align: left;">LCh(51.3, 58.2, 29.5)</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6.52</td>
<td style="text-align: right;">1.16</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6.52</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lin, 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">Lin, 2014 - Exp 1</td>
<td style="text-align: left;">Lin, H. (2014). Red-colored products enhance the attractiveness of women. Displays, 35(4), 202-205. http://doi.org/10.1016/j.displa.2014.05.009</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Item</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Taiwan</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">3.50</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2.55</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: left;">Control condition is blue; silver condition is dropped as it is not an original control color</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maves &amp; Nadler, 2016</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Maves &amp; Nadler, 2016 - Exp 1</td>
<td style="text-align: left;">Maves, M., &amp; Nadler, J. T. (2016, June 2). Data and Analysis. Retrieved from osf.io/9bm8v</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CREP</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">21.86</td>
<td style="text-align: right;">22.48</td>
<td style="text-align: left;">~LCh(50.0, 59.6, 31.3)</td>
<td style="text-align: left;">~LCh(50.0, -, 69.1)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">6.07</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">6.23</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">O'Mara &amp; Trujillo, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: left;">O'Mara &amp; Trujillo, 2015 - Exp 1 - Masculine Face</td>
<td style="text-align: left;">O'Mara, E. M., &amp; Trujillo, A. (2015), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.10</td>
<td style="text-align: right;">19.10</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6.11</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">4.78</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">O'Mara &amp; Trujillo, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.20</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">O'Mara &amp; Trujillo, 2015 - Exp 2 - Masculine Face</td>
<td style="text-align: left;">O'Mara, E. M., &amp; Trujillo, A. (2015), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">28.23</td>
<td style="text-align: right;">28.23</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.88</td>
<td style="text-align: right;">1.84</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">5.23</td>
<td style="text-align: right;">1.61</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 2 - Long Shirt</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.26</td>
<td style="text-align: right;">19.26</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">4.42</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3.79</td>
<td style="text-align: right;">1.41</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.32</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 2 - Tank Top</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.26</td>
<td style="text-align: right;">19.26</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">3.91</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">4.33</td>
<td style="text-align: right;">1.51</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 1 - Long Shirt</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">34.56</td>
<td style="text-align: right;">34.56</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">6.07</td>
<td style="text-align: right;">2.14</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">5.12</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 1 - Tank Top</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">34.56</td>
<td style="text-align: right;">34.56</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">5.53</td>
<td style="text-align: right;">1.96</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">5.33</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 3 - Tank Top</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.54</td>
<td style="text-align: right;">19.54</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">6.70</td>
<td style="text-align: right;">1.14</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">6.83</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">O'Mara et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">O'Mara et al., 2016 - Exp 3 - Long Shirt</td>
<td style="text-align: left;">O'Mara, E. M., Kershaw, C., Receveur, A., Hunt, C., Askar, S., Ballas, T., Farmer, C., O'Koon, B., Stitzel, C., Vavro, C., &amp; Wilhoit, S. (2016), unpublished data.</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.54</td>
<td style="text-align: right;">19.54</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">6.97</td>
<td style="text-align: right;">1.27</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">7.12</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pazda et al., 2012</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">Pazda et al., 2012 - Exp 2</td>
<td style="text-align: left;">Pazda, A. D., Elliot, A. J., &amp; Greitemeyer, T. (2012). Sexy red: Perceived sexual receptivity mediates the red-attraction relation in men viewing woman. Journal of Experimental Social Psychology, 48(3), 787-790. http://doi.org/10.1016/j.jesp.2011.12.009</td>
<td style="text-align: right;">2012.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Austria</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">23.50</td>
<td style="text-align: right;">23.50</td>
<td style="text-align: left;">LCh(40.6, 40.4, 20.1)</td>
<td style="text-align: left;">LCh(40.3, 41.2, 146.8)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">6.07</td>
<td style="text-align: right;">1.17</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">2.13</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pazda et al., 2014</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Pazda et al., 2014 - Exp 1</td>
<td style="text-align: left;">Pazda, A. D., Elliot, A. J., &amp; Greitemeyer, T. (2014). Perceived sexual receptivity and fashionableness: Separate paths linking red and black to perceived attractiveness. Color Research &amp; Application, 39(2), 208-212. http://doi.org/10.1002/col.21804</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Not specified</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White (170 white, 142 Asian)</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">24.50</td>
<td style="text-align: right;">24.50</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">6.03</td>
<td style="text-align: right;">1.78</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">5.46</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">234</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pazda et al., 2017</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">Pazda et al., 2017 - Exp 1</td>
<td style="text-align: left;">Pazda, A., Thorstenson &amp; Elliot, A. (2017). Unpublished data.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single Item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Lab study</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">19.76</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">red LCh(42.00, 57.92, 348.89), green LCh(41.50, 56.71, 92.17)</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">7.81</td>
<td style="text-align: right;">1.21</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">7.58</td>
<td style="text-align: right;">1.41</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">1.31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pazda et al., 2017</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">Pazda et al., 2017 - Exp 2</td>
<td style="text-align: left;">Pazda, A., Thorstenson &amp; Elliot, A. (2017). Unpublished data.</td>
<td style="text-align: right;">2017.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single Item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">37.43</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">red LCh(42.00, 57.92, 348.89), green LCh(41.50, 56.71, 92.17)</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">8.08</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">1.39</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">1.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peperkoorn et al., 2016</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.43</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Peperkoorn et al., 2016 - Exp 1 - Short Term</td>
<td style="text-align: left;">Peperkoorn, L. S., Roberts, S. C., &amp; Pollet, T. V. (2016). Revisiting the Red Effect on Attractiveness and Sexual Receptivity: No Effect of the Color Red on Human Mate Preferences. Evolutionary Psychology, 14(4). http://doi.org/10.1177/1474704916673841</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-11</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">23.67</td>
<td style="text-align: right;">23.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">14.26</td>
<td style="text-align: right;">3.31</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">15.47</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Peperkoorn et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Peperkoorn et al., 2016 - Exp 2 - Short Term</td>
<td style="text-align: left;">Peperkoorn, L. S., Roberts, S. C., &amp; Pollet, T. V. (2016). Revisiting the Red Effect on Attractiveness and Sexual Receptivity: No Effect of the Color Red on Human Mate Preferences. Evolutionary Psychology, 14(4). http://doi.org/10.1177/1474704916673841</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-11</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Online</td>
<td style="text-align: left;">Mturk</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">30.13</td>
<td style="text-align: right;">30.13</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">15.06</td>
<td style="text-align: right;">4.14</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">15.47</td>
<td style="text-align: right;">3.61</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pollet, 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">Pollet, 2013 - Exp 1</td>
<td style="text-align: left;">Pollet T. (2013). Unpublished data</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Primarily dutch nationality</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">26.60</td>
<td style="text-align: right;">28.40</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">1.22</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">2.96</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: left;">Only blue control color used as other control colors were not in original</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Purdy, 2009</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: left;">Purdy, 2009 - Exp 1 - High Arousal</td>
<td style="text-align: left;">Purdy, M. A. (2009). The influence of the amygdala and color on judgments of attractiveness. UNC Asheville Journal, Undergraduate Research Program, Asheville, NC</td>
<td style="text-align: right;">2009.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">21.00</td>
<td style="text-align: right;">21.00</td>
<td style="text-align: left;">RGB(185, 26, 23)</td>
<td style="text-align: left;">RGB(216,216,216)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">7.26</td>
<td style="text-align: right;">3.27</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">6.24</td>
<td style="text-align: right;">3.27</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Purdy, 2009</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: left;">Purdy, 2009 - Exp 1 - Low Arousal</td>
<td style="text-align: left;">Purdy, M. A. (2009). The influence of the amygdala and color on judgments of attractiveness. UNC Asheville Journal, Undergraduate Research Program, Asheville, NC</td>
<td style="text-align: right;">2009.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">21.00</td>
<td style="text-align: right;">21.00</td>
<td style="text-align: left;">RGB(185, 26, 23)</td>
<td style="text-align: left;">RGB(216,216,216)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">6.37</td>
<td style="text-align: right;">3.31</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">6.33</td>
<td style="text-align: right;">3.27</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 2</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue/Green/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3.66</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3.45</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.60</td>
</tr>
<tr class="even">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 2</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue/Green/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 1</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue/Green/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.50</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.26</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">1.21</td>
</tr>
<tr class="even">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 1</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue/Green/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Different between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.60</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.40</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">1.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 3</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">4.82</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">4.88</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">Roberts et al., 2010</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: left;">Roberts et al., 2010 - Exp 3</td>
<td style="text-align: left;">Roberts, S. C., Owen, R. C., &amp; Havlicek, J. (2010). Distinguishing between Perceiver and Wearer Effects in Clothing Color-Associated Attributions. Evolutionary Psychology, 8(3), 350-364. http://doi.org/10.1177/147470491000800304</td>
<td style="text-align: right;">2010.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item rating of attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Noted in manuscript all caucasian</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">4.87</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">4.90</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: left;">Age range includes both male and female participants.</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Schwarz &amp; Singer, 2013</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Schwarz &amp; Singer, 2013 - Exp 1 - Adults Rate Young</td>
<td style="text-align: left;">Schwarz, S., &amp; Singer, M. (2013). Romantic red revisited: Red enhances men's attraction to young, but not menopausal women. Journal of Experimental Social Psychology, 49(1), 161-164. http://doi.org/10.1016/j.jesp.2012.08.004</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Adults</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">53.47</td>
<td style="text-align: right;">53.47</td>
<td style="text-align: left;">Lum: 35.2, Chroma: 39.3, Hue no specified</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.53</td>
<td style="text-align: right;">1.96</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.13</td>
<td style="text-align: right;">2.17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Schwarz &amp; Singer, 2013</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.15</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Schwarz &amp; Singer, 2013 - Exp 1 - UGrads Rate Young</td>
<td style="text-align: left;">Schwarz, S., &amp; Singer, M. (2013). Romantic red revisited: Red enhances men's attraction to young, but not menopausal women. Journal of Experimental Social Psychology, 49(1), 161-164. http://doi.org/10.1016/j.jesp.2012.08.004</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">24.67</td>
<td style="text-align: right;">24.67</td>
<td style="text-align: left;">Lum: 35.2, Chroma: 39.3, Hue no specified</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.20</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">6.40</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Seibt &amp; Klement, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Seibt &amp; Klement, 2015 - Exp 1</td>
<td style="text-align: left;">Seibt, T., &amp; Klement, V. (2015). The Impact of the Colour Red on Attractiveness Perception. In 4th Advanced Research in Scientific Areas (pp. 20-24). http://doi.org/10.18638/arsa.2015.4.1.799</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Conference Proceedings</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived Attractiveness, subscale of Haselton und Gangestad (2006)</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads and Grads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">26.70</td>
<td style="text-align: right;">26.70</td>
<td style="text-align: left;">RGB(255.0.0)</td>
<td style="text-align: left;">RGB(0.139.0)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">3.07</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Seibt &amp; Klement, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: left;">Seibt &amp; Klement, 2015 - Exp 1</td>
<td style="text-align: left;">Seibt, T., &amp; Klement, V. (2015). The Impact of the Colour Red on Attractiveness Perception. In 4th Advanced Research in Scientific Areas (pp. 20-24). http://doi.org/10.18638/arsa.2015.4.1.799</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Conference Proceedings</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived Attractiveness, subscale of Haselton und Gangestad (2006)</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads and Grads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">26.70</td>
<td style="text-align: right;">26.70</td>
<td style="text-align: left;">RGB(255.0.0)</td>
<td style="text-align: left;">RGB(0.139.0)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Seibt, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: left;">Seibt, 2015 - Exp 1</td>
<td style="text-align: left;">Seibt, T. (2015). Romantic Red Effect in the Attractiveness Perception. In Hassacc (pp. 31-34). http://doi.org/10.18638/hassacc.2015.3.1.186</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Conference Proceedings</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived Attractiveness</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">1-5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads and Grads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">25.50</td>
<td style="text-align: right;">25.50</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">87</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stefan &amp; Gueguen, 2013</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: left;">Stefan &amp; Gueguen, 2013 - Exp 1</td>
<td style="text-align: left;">Stefan J. &amp; Gueguen, N. (2013). Unpublished data.</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Full Body</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-100</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads and Grads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">22.11</td>
<td style="text-align: right;">22.11</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">81.33</td>
<td style="text-align: right;">16.30</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">67.50</td>
<td style="text-align: right;">26.87</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">Data provided by Elliot</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sullivan et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">Sullivan et al., 2016 - Exp 1</td>
<td style="text-align: left;">Sullivan, J., Amaral Lavoie, E., Bays, R. B., Fontana, S., Goodkind, R., Johnson, R., ... Lavoie, M. (2016, April 4). Replication of Elliot et al., 2010: Red, Rank, and Romance. Retrieved from osf.io/pm7fx</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">19.96</td>
<td style="text-align: right;">19.45</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: right;">1.37</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">5.26</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">Two-year class project posted on OSF</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sullivan et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.34</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: left;">Sullivan et al., 2016 - Exp 2</td>
<td style="text-align: left;">Sullivan, J., Amaral Lavoie, E., Bays, R. B., Fontana, S., Goodkind, R., Johnson, R., ... Lavoie, M. (2016, April 4). Replication of Elliot et al., 2010: Red, Rank, and Romance. Retrieved from osf.io/pm7fx</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Latino</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">4.85</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">Age recorded as dichotomy (younger then 20, older than 20) so not included</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sullivan et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">Sullivan et al., 2016 - Exp 1</td>
<td style="text-align: left;">Sullivan, J., Amaral Lavoie, E., Bays, R. B., Fontana, S., Goodkind, R., Johnson, R., ... Lavoie, M. (2016, April 4). Replication of Elliot et al., 2010: Red, Rank, and Romance. Retrieved from osf.io/pm7fx</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">19.62</td>
<td style="text-align: right;">19.75</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">6.21</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">5.58</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sullivan et al., 2016</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: left;">Sullivan et al., 2016 - Exp 2</td>
<td style="text-align: left;">Sullivan, J., Amaral Lavoie, E., Bays, R. B., Fontana, S., Goodkind, R., Johnson, R., ... Lavoie, M. (2016, April 4). Replication of Elliot et al., 2010: Red, Rank, and Romance. Retrieved from osf.io/pm7fx</td>
<td style="text-align: right;">2016.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Unpublished/Online</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6.24</td>
<td style="text-align: right;">1.29</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">6.21</td>
<td style="text-align: right;">1.45</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: left;">Age recorded as dichotomy (younger then 20, older than 20) so not included</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wartenberg et al., 2011</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">Wartenberg et al., 2011 - Exp 1 - In Group</td>
<td style="text-align: left;">Wartenberg, W., Hoepfner, T., Potthast, P., &amp; Mirau, A. (2011). If you wear red on a date, you will please your mate. Proceedings of Empiriepraktikumskongress, 6th, Aug. 7, pp 26-27. University of Jena, Germany.</td>
<td style="text-align: right;">2011.0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Conference Proceedings</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Europe</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">21.47</td>
<td style="text-align: right;">21.47</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No Data</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">1.13</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: left;">Translation of summary provided by Elliot; within subjects info still needed</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">1.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wen et al., 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Wen et al., 2014 - Exp 1 - Feminine Females</td>
<td style="text-align: left;">Wen, F., Zuo, B., Wu, Y., Sun, S., &amp; Liu, K. (2014). Red is Romantic, but Only for Feminine Females: Sexual Dimorphism Moderates Red Effect on Sexual Attraction. Evolutionary Psychology, 12(4), 719-735. http://doi.org/10.1177/147470491401200404</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness, extracted factor</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">China</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.95</td>
<td style="text-align: right;">20.95</td>
<td style="text-align: left;">LCh(51.1, 57.7, 27.8)</td>
<td style="text-align: left;">LCh(51.6, 57.6, 278.3)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Control is average of blue and white conditions; only normalized scores provided. Age range includes participants in all conditions.</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wen et al., 2014</td>
<td style="text-align: left;">Paper</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">Wen et al., 2014 - Exp 1 - Masculine Males</td>
<td style="text-align: left;">Wen, F., Zuo, B., Wu, Y., Sun, S., &amp; Liu, K. (2014). Red is Romantic, but Only for Feminine Females: Sexual Dimorphism Moderates Red Effect on Sexual Attraction. Evolutionary Psychology, 12(4), 719-735. http://doi.org/10.1177/147470491401200404</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Females</td>
<td style="text-align: left;">Blue/White</td>
<td style="text-align: left;">Clothing</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness, extracted factor</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">China</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Asian</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">20.95</td>
<td style="text-align: right;">20.95</td>
<td style="text-align: left;">LCh(51.1, 57.7, 27.8)</td>
<td style="text-align: left;">LCh(51.6, 57.6, 278.3)</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Control is average of blue and white conditions; only normalized scores provided. Age range includes participants in all conditions.</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Williams &amp; Neelon, 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: left;">Williams &amp; Neelon, 2013 - Exp 1 - All</td>
<td style="text-align: left;">Williams, C. L. &amp; Neelon, M. (2013). Conditional beauty: The impact of emotionally linked images on the red effect in sexual attraction. Psi Chi Journal of Psychological Research, 18(1), 10-19.</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White (noted by authors)</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">22.50</td>
<td style="text-align: right;">22.50</td>
<td style="text-align: left;">RGB(183,70,60)</td>
<td style="text-align: left;">RGB(76,105,200)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.81</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">6.15</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: left;">Data provided by Elliot</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Williams &amp; Neelon, 2013</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">Williams &amp; Neelon, 2013 - Exp 2 - Positive and Neutral</td>
<td style="text-align: left;">Williams, C. L. &amp; Neelon, M. (2013). Conditional beauty: The impact of emotionally linked images on the red effect in sexual attraction. Psi Chi Journal of Psychological Research, 18(1), 10-19.</td>
<td style="text-align: right;">2013.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Bust</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Perceived attractiveness</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">1-9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Between Subjects</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">White (noted by authors)</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Matched</td>
<td style="text-align: right;">21.50</td>
<td style="text-align: right;">21.50</td>
<td style="text-align: left;">RGB(183,70,60)</td>
<td style="text-align: left;">RGB(76,105,200)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6.40</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">6.56</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: left;">Data provided by Elliot</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Young, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">Young, 2015 - Exp 1 - More Attractive</td>
<td style="text-align: left;">Young, S. G. (2015). The effect of red on male perceptions of female attractiveness: Moderation by baseline attractiveness of female faces. European Journal of Social Psychology, 45(2), 146-151. http://doi.org/10.1002/ejsp.2098</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: left;">LCh(62.7, 84.6, 34.1)</td>
<td style="text-align: left;">LCh(62.6, -, 265.5)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4.29</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4.17</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Young, 2015</td>
<td style="text-align: left;">Screen</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">Young, 2015 - Exp 2 - More Attractive</td>
<td style="text-align: left;">Young, S. G. (2015). The effect of red on male perceptions of female attractiveness: Moderation by baseline attractiveness of female faces. European Journal of Social Psychology, 45(2), 146-151. http://doi.org/10.1002/ejsp.2098</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Journal</td>
<td style="text-align: left;">Not Pre-Registered</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Romantic</td>
<td style="text-align: left;">Males</td>
<td style="text-align: left;">Blue/Gray</td>
<td style="text-align: left;">Background</td>
<td style="text-align: left;">Head Shot</td>
<td style="text-align: left;">Same between conditions</td>
<td style="text-align: left;">Single item</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1-7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">USA</td>
<td style="text-align: left;">North America</td>
<td style="text-align: left;">Students</td>
<td style="text-align: left;">Undergrads</td>
<td style="text-align: left;">Within Subjects</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">Mixed</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Mis-match</td>
<td style="text-align: right;">21.10</td>
<td style="text-align: right;">21.10</td>
<td style="text-align: left;">LCh(62.7, 84.6, 34.1)</td>
<td style="text-align: left;">LCh(62.7, 84.6, 34.1)</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: right;">1.11</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">4.19</td>
<td style="text-align: right;">1.07</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: left;">Blue and Gray ratings averaged, then compared to red; original data provided</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">1.09</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
<section id="preliminary-analysis" class="level3">
<h3 class="anchored" data-anchor-id="preliminary-analysis">Preliminary Analysis</h3>
<p>As a little warm-up exercise, here is a basic random effects meta-analysis of these data, fit via the <a href="https://wviechtb.github.io/metafor/">metafor</a> package <span class="citation" data-cites="Viechtbauer2010conducting">(Viechtbauer, 2010)</span>. We use cluster-robust standard errors to account for effect size dependency.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimate random effects model</span></span>
<span id="cb2-2">RE_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.uni</span>(yi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> vi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> lehmann_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ML"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate cluster-robust standard errors</span></span>
<span id="cb2-5">RE_robust <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">robust</span>(RE_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster =</span> study, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clubSandwich =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-6">RE_robust</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Random-Effects Model (k = 81; tau^2 estimator: ML)

tau^2 (estimated amount of total heterogeneity): 0.1009 (SE = 0.0245)
tau (square root of estimated tau^2 value):      0.3176
I^2 (total heterogeneity / total variability):   81.54%
H^2 (total variability / sampling variability):  5.42

Test for Heterogeneity:
Q(df = 80) = 246.9683, p-val &lt; .0001

Number of estimates:   81
Number of clusters:    41
Estimates per cluster: 1-6 (mean: 1.98, median: 1)

Model Results:

estimate      se¹    tval¹     df¹    pval¹   ci.lb¹   ci.ub¹     
  0.2069  0.0569   3.6331   23.41   0.0014   0.0892   0.3245   ** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

1) results based on cluster-robust inference (var-cov estimator: CR2,
   approx t-test and confidence interval, df: Satterthwaite approx)</code></pre>
</div>
</div>
<p>The random effects model indicates an average effect size of about 0.21 standard deviations and substantial heterogeneity, with <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%20=%200.32">. The cluster-robust standard error is about 27% bigger than the model-based standard error (not shown) because the latter does not account for dependent effect sizes.</p>
<p>Here is a contour-enhanced funnel plot of the data:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">funnel</span>(RE_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refline =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shade=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray55"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray75"</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/cluster-bootstrap-selection-model/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The funnel plot shows some asymmetry, suggesting that there is reason to be concerned about selective reporting bias in these data.</p>
</section>
<section id="a-selection-model" class="level3">
<h3 class="anchored" data-anchor-id="a-selection-model">A Selection Model</h3>
<p>For starters, we will fit a very simple selection model, with a single step in the probability of reporting at <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20.025">. This is what’s come to be called the <em>three-parameter selection model</em> <span class="citation" data-cites="mcshane2016adjusting">(McShane et al., 2016)</span>. The step is defined in terms of a one-sided p-value, so <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20.025"> corresponds to the point where an effect size estimate in the theoretically expected direction would have a regular, two-sided p-value of .05, right at the mystical threshold of statistical significance. We fit the model using <code>metafor</code>’s <a href="https://wviechtb.github.io/metafor/reference/selmodel.html"><code>selmodel()</code></a> function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">RE_sel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selmodel</span>(RE_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stepfun"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">025</span>)</span>
<span id="cb5-2">RE_sel</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Random-Effects Model (k = 81; tau^2 estimator: ML)

tau^2 (estimated amount of total heterogeneity): 0.0811 (SE = 0.0261)
tau (square root of estimated tau^2 value):      0.2848

Test for Heterogeneity:
LRT(df = 1) = 37.3674, p-val &lt; .0001

Model Results:

estimate      se    zval    pval   ci.lb   ci.ub    
  0.1328  0.0655  2.0267  0.0427  0.0044  0.2612  * 

Test for Selection Model Parameters:
LRT(df = 1) = 1.7646, p-val = 0.1840

Selection Model Results:

                     k  estimate      se     zval    pval   ci.lb   ci.ub    
0     &lt; p &lt;= 0.025  25    1.0000     ---      ---     ---     ---     ---    
0.025 &lt; p &lt;= 1      56    0.5485  0.2495  -1.8097  0.0703  0.0594  1.0375  . 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The selection parameter represents the probability that an effect size estimate that is not in the theoretically expected direction or not statistically significant at the conventional level would be included in the synthesis, relative to the probability that an affirmative, statistically significant effect size estimate would be included. In this example, the probability of selection is estimated as 0.55, meaning only about 55% of the non-significant results that we would expect were generated are actually reported. Adjusting for this selection bias, the model estimates an overall average effect size of 0.13 SD—smaller than the unadjusted random effects estimate—with heterogeneity of <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%20=%200.28">.</p>
<p>The problem with this analysis is that the selection model is set up under the assumption that the effect size estimates are all independent. As a result, the reported standard errors are probably smaller than they should be and the confidence intervals are narrower than they should be. We’ll use cluster bootstrapping to get standard errors and confidence intervals that should better account for effect size dependency.</p>
</section>
</section>
<section id="cluster-bootstrapping-a-selection-model" class="level2">
<h2 class="anchored" data-anchor-id="cluster-bootstrapping-a-selection-model">Cluster Bootstrapping a Selection Model</h2>
<p>In R, the <a href="https://cran.r-project.org/web/packages/boot/boot.pdf"><code>boot</code></a> package provides tools for running a variety of different bootstrap techniques and obtaining confidence intervals based on bootstrap distributions <span class="citation" data-cites="boot">(Canty &amp; Ripley, 2021)</span>. It’s been around for ages and has some very nice features, but it requires a bit of trickery to use it for cluster bootstrapping. The main challenge is that the package functionality is set up under the assumption that every row of the dataset should be treated as an independent observation. To make it work for cluster bootstrapping, we will need a function to fit the selection model, which takes in a dataset with one row per cluster and returns a vector of parameter estimates. The function also has to have an index argument which is a vector of row indexes used to create the bootstrap sample. Here is a skeleton for such a function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit_selmodel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(</span>
<span id="cb7-2">    dat,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dataset with one row per cluster</span></span>
<span id="cb7-3">    index, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vector of indexes used to create the bootstrap sample</span></span>
<span id="cb7-4">    ...    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any further arguments</span></span>
<span id="cb7-5">) { </span>
<span id="cb7-6">  </span>
<span id="cb7-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take subset of data</span></span>
<span id="cb7-8">  boot_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[index,]</span>
<span id="cb7-9">  </span>
<span id="cb7-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model</span></span>
<span id="cb7-11">  </span>
<span id="cb7-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compile parameter estimates into a vector</span></span>
<span id="cb7-13">  </span>
<span id="cb7-14">}</span></code></pre></div>
</details>
</div>
<section id="clustering-and-unclustering" class="level3">
<h3 class="anchored" data-anchor-id="clustering-and-unclustering">Clustering and unclustering</h3>
<p>The Lehmann dataset has one row per effect size, sometimes with multiple rows per study, so we need to modify the data to have one row per study. There are at least two ways to accomplish this. One option is to create a dataset consisting only of study-level IDs, then merge it back on to the full data to get the effect-size level data:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a dataset of study IDs</span></span>
<span id="cb8-2">cluster_IDs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">study =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(lehmann_dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>study))</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(cluster_IDs)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 41
Columns: 1
$ study &lt;chr&gt; "Banas, 2014 ", "Berthold, 2013 ", "Bigelow et al., 2013 ", "Ble…</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Merge with full data</span></span>
<span id="cb10-2">full_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(cluster_IDs, lehmann_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"study"</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4">full_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(study, yi, vi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 81
Columns: 3
$ study &lt;chr&gt; "Banas, 2014 ", "Berthold, 2013 ", "Bigelow et al., 2013 ", "Big…
$ yi    &lt;dbl&gt; 0.05716727, 0.55411916, 0.31467980, -0.73259462, 0.07921700, -0.…
$ vi    &lt;dbl&gt; 0.10267348, 0.06030579, 0.29520322, 0.53354343, 0.02692608, 0.05…</code></pre>
</div>
</div>
<p>Another option is to use the <a href="https://dplyr.tidyverse.org/reference/nest_by.html"><code>dplyr::nest_by()</code></a> function to nest the data by cluster <span class="citation" data-cites="tidyverse">(Wickham et al., 2019)</span>. Then, we can use <a href="https://tidyr.tidyverse.org/reference/unnest.html"><code>tidyr::unnest()</code></a> to recover the effect size level data <span class="citation" data-cites="tidyverse">(Wickham et al., 2019)</span>. Like so:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nest the data for each study</span></span>
<span id="cb12-2">lehmann_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest_by</span>(lehmann_dat, study, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(lehmann_nested)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 41
Columns: 2
Rowwise: study
$ study &lt;chr&gt; "Banas, 2014 ", "Berthold, 2013 ", "Bigelow et al., 2013 ", "Ble…
$ data  &lt;list&lt;tibble[,49]&gt;&gt; [&lt;tbl_df[1 x 49]&gt;], [&lt;tbl_df[1 x 49]&gt;], [&lt;tbl_df[2…</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recover the full dataset</span></span>
<span id="cb14-2">full_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb14-3">  lehmann_nested <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(data)</span>
<span id="cb14-5"></span>
<span id="cb14-6">full_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(study, yi, vi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 81
Columns: 3
Groups: study [41]
$ study &lt;chr&gt; "Banas, 2014 ", "Berthold, 2013 ", "Bigelow et al., 2013 ", "Big…
$ yi    &lt;dbl&gt; 0.05716727, 0.55411916, 0.31467980, -0.73259462, 0.07921700, -0.…
$ vi    &lt;dbl&gt; 0.10267348, 0.06030579, 0.29520322, 0.53354343, 0.02692608, 0.05…</code></pre>
</div>
</div>
<p>We will follow the latter strategy for the remainder of our example.</p>
<p>With this nest-and-unnest approach, we can fill in a little bit more of our function skeleton:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">fit_selmodel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(</span>
<span id="cb16-2">    dat,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dataset with one row per cluster</span></span>
<span id="cb16-3">    index, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># vector of indexes used to create the bootstrap sample</span></span>
<span id="cb16-4">    ...    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any further arguments</span></span>
<span id="cb16-5">) { </span>
<span id="cb16-6">  </span>
<span id="cb16-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take subset of data</span></span>
<span id="cb16-8">  boot_dat_cluster <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[index, ]</span>
<span id="cb16-9">  </span>
<span id="cb16-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand to one row per effect size</span></span>
<span id="cb16-11">  boot_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(boot_dat_cluster, data)</span>
<span id="cb16-12">  </span>
<span id="cb16-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model</span></span>
<span id="cb16-14">  </span>
<span id="cb16-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compile parameter estimates into a vector</span></span>
<span id="cb16-16">  </span>
<span id="cb16-17">}</span></code></pre></div>
</details>
</div>
</section>
<section id="selection-model-function" class="level3">
<h3 class="anchored" data-anchor-id="selection-model-function">Selection model function</h3>
<p>Next, we need to complete the function by writing code to fit the selection model. This is a little bit involved because of the way the <code>metafor</code> package implements the Vevea-Hedges selection model. We first need to fit a regular random effects model using <a href="https://wviechtb.github.io/metafor/reference/rma.uni.html"><code>metafor::rma.uni()</code></a>, then pass the result to the <a href="https://wviechtb.github.io/metafor/reference/selmodel.html"><code>metafor::selmodel()</code></a> function to fit a selection model, and then pull out the parameter estimates as a vector. To make the code clearer, we will move this step out into its own function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">run_sel_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">025</span>) {</span>
<span id="cb17-2">  </span>
<span id="cb17-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial random effects model</span></span>
<span id="cb17-4">  RE_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.uni</span>(</span>
<span id="cb17-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> yi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> vi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ML"</span></span>
<span id="cb17-6">  )</span>
<span id="cb17-7">  </span>
<span id="cb17-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model</span></span>
<span id="cb17-9">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selmodel</span>(</span>
<span id="cb17-10">    RE_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stepfun"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> steps,</span>
<span id="cb17-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skiphes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn off SE calculation</span></span>
<span id="cb17-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skiphet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn off heterogeneity test</span></span>
<span id="cb17-13">  )</span>
<span id="cb17-14">  </span>
<span id="cb17-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compile parameter estimates into a vector</span></span>
<span id="cb17-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>beta[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tau2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>delta[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb17-17">  </span>
<span id="cb17-18">}</span></code></pre></div>
</details>
</div>
<p>Note the use of <code>skiphes</code> and <code>skiphet</code> arguments in the <code>selmodel()</code> call, which skip the calculation of standard errors and skip the calculation of the test for heterogeneity. We don’t need the standard errors here because we’re going to use bootstrapping instead, and we’re not interested in the heterogeneity test. Turning off these calculations saves computational time.</p>
<p>A further complication with fitting a selection model is that the parameter estimates are obtained by maximum likelihood, using an iterative optimization algorithm that sometimes fails to converge. To handle non-convergence, we will pass our function through <a href="https://purrr.tidyverse.org/reference/possibly.html"><code>purrr::possibly()</code></a> so that errors are suppressed, rather than causing everything to grind to a halt <span class="citation" data-cites="tidyverse">(Wickham et al., 2019)</span>. We set the <code>otherwise</code> argument so that non-convergent results are returned as <code>NA</code> values:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">run_sel_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">possibly</span>(run_sel_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">otherwise =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_real_</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
</details>
</div>
</section>
<section id="a-first-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="a-first-bootstrap">A first bootstrap</h3>
<p>Here is the completed fitting function called <code>fit_selmodel()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">fit_selmodel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(dat, </span>
<span id="cb19-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat), </span>
<span id="cb19-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>) {</span>
<span id="cb19-4">  </span>
<span id="cb19-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take subset of data</span></span>
<span id="cb19-6">  boot_dat_cluster <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[index, ]</span>
<span id="cb19-7">  </span>
<span id="cb19-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand to one row per effect size</span></span>
<span id="cb19-9">  boot_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(boot_dat_cluster, data)</span>
<span id="cb19-10">  </span>
<span id="cb19-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model, return vector</span></span>
<span id="cb19-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_sel_model</span>(boot_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> steps)</span>
<span id="cb19-13">  </span>
<span id="cb19-14">}</span></code></pre></div>
</details>
</div>
<p>First, we take a subset of the data based on the index argument. This generates a bootstrap sample from the original data based on re-sampled clusters. We then use <a href="https://tidyr.tidyverse.org/reference/unnest.html"><code>tidyr::unnest()</code></a> to get the effect size level data for those re-sampled clusters. We then re-fit the model using our <code>run_sel_model()</code> function.</p>
<p>Now let’s apply our function to the Lehmann dataset. We will first need to create a nested version of the dataset, with one row per study:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">lehmann_nested <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest_by</span>(lehmann_dat, study, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>)</span></code></pre></div>
</details>
</div>
<p>Now we can fit the selection model using <code>fit_sel_model()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit_selmodel</span>(lehmann_nested)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>beta.intrcpt          tau        delta 
   0.1327996    0.2848304    0.5484541 </code></pre>
</div>
</div>
<p>The results reproduce what we saw earlier when we estimated the three parameter selection model.</p>
<p>Now we can bootstrap using the <a href="https://cran.r-project.org/web/packages/boot/boot.pdf"><code>boot::boot()</code></a> function. The inputs to <code>boot()</code> are the nested dataset, the function to fit the selection model, and then any additional arguments passed to <code>fit_selmodel()</code>—here we include an argument for <code>steps</code>—and finally, the number of bootstrap replications:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate bootstrap</span></span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230321</span>)</span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tic</span>()</span>
<span id="cb23-5"></span>
<span id="cb23-6">boots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boot</span>(</span>
<span id="cb23-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> lehmann_nested,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nested dataset</span></span>
<span id="cb23-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> fit_selmodel,         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function for fitting selection model</span></span>
<span id="cb23-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">025</span>,                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># further arguments to the fitting function</span></span>
<span id="cb23-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span>                          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of bootstraps</span></span>
<span id="cb23-11">)</span>
<span id="cb23-12"></span>
<span id="cb23-13">time_seq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toc</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>141.64 sec elapsed</code></pre>
</div>
</div>
<p>This code takes a while to run, but we can speed it up with parallel processing.</p>
</section>
<section id="parallel-processing" class="level3">
<h3 class="anchored" data-anchor-id="parallel-processing">Parallel processing</h3>
<p>The <code>boot</code> package has some handy parallel processing features, but they can be a bit finicky to use here because of how R manages environments across multiple processes. With the above code, we can’t simply turn on parallel processing because the worker processes won’t know where to find the <code>run_sel_model()</code> function that gets called inside <code>fit_selmodel()</code>. To fix this, we include the <code>run_sel_model()</code> function <em>inside</em> our fitting function, as follows:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">fit_selmodel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(dat, </span>
<span id="cb25-2">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat), </span>
<span id="cb25-3">                         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>) {</span>
<span id="cb25-4">  </span>
<span id="cb25-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># take subset of data</span></span>
<span id="cb25-6">  boot_dat_cluster <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dat[index, ]</span>
<span id="cb25-7">  </span>
<span id="cb25-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># expand to one row per effect size</span></span>
<span id="cb25-9">  boot_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(boot_dat_cluster, data)</span>
<span id="cb25-10">  </span>
<span id="cb25-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># build run_selmodel</span></span>
<span id="cb25-12">  run_sel_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">025</span>) {</span>
<span id="cb25-13">  </span>
<span id="cb25-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial random effects model</span></span>
<span id="cb25-15">    RE_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.uni</span>(</span>
<span id="cb25-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> yi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> vi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ML"</span></span>
<span id="cb25-17">    )</span>
<span id="cb25-18">    </span>
<span id="cb25-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model</span></span>
<span id="cb25-20">    res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selmodel</span>(</span>
<span id="cb25-21">      RE_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stepfun"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> steps,</span>
<span id="cb25-22">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skiphes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn off SE calculation</span></span>
<span id="cb25-23">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">skiphet =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn off heterogeneity test</span></span>
<span id="cb25-24">    )</span>
<span id="cb25-25">    </span>
<span id="cb25-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compile parameter estimates into a vector</span></span>
<span id="cb25-27">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>beta[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tau2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>delta[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb25-28">    </span>
<span id="cb25-29">  }</span>
<span id="cb25-30">  </span>
<span id="cb25-31">  p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>L <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(steps)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate total number of model parameters</span></span>
<span id="cb25-32">  </span>
<span id="cb25-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># error handling for run_sel_model</span></span>
<span id="cb25-34">  run_sel_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">possibly</span>(run_sel_model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">otherwise =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_real_</span>, p))</span>
<span id="cb25-35">  </span>
<span id="cb25-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit selection model, return vector of parameter estimates</span></span>
<span id="cb25-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run_sel_model</span>(boot_dat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> steps)</span>
<span id="cb25-38">  </span>
<span id="cb25-39">}</span></code></pre></div>
</details>
</div>
<p>Now we can call <code>boot()</code> with options for parallel processing. The machine we used to compile this post has 8 cores. We will use half of the available cores for parallel processing. The configuration of parallel processing will depend on your operating system (different options are available for Mac), so you may need to adapt this code a bit.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">ncpus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb26-2"></span>
<span id="cb26-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate bootstrap</span></span>
<span id="cb26-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230321</span>)</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tic</span>()</span>
<span id="cb26-7"></span>
<span id="cb26-8">boots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boot</span>(</span>
<span id="cb26-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> lehmann_nested,</span>
<span id="cb26-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">statistic =</span> fit_selmodel, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">steps =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">025</span>,</span>
<span id="cb26-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1999</span>,</span>
<span id="cb26-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snow"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncpus =</span> ncpus <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parallel processing options</span></span>
<span id="cb26-13">)</span>
<span id="cb26-14"></span>
<span id="cb26-15">time_par <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toc</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>49.61 sec elapsed</code></pre>
</div>
</div>
<p>Parallel processing is really helpful here. We get 2000 bootstraps in 50 seconds, 2.9 times faster than sequential processing.</p>
</section>
<section id="standard-errors" class="level3">
<h3 class="anchored" data-anchor-id="standard-errors">Standard Errors</h3>
<p>The standard deviations of the bootstrapped parameter estimates can be interpreted as standard errors for the parameter estimates that take into account the dependence structure of the effect size estimates. Here is a table comparing the cluster-bootstrapped standard errors to the model-based standard errors generated by <code>selmodel()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> boots<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t0 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># original parameter estimates</span></span>
<span id="cb28-2"></span>
<span id="cb28-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate bootstrap SEs</span></span>
<span id="cb28-4">boot_SE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(boots<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sd, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)  </span>
<span id="cb28-5"></span>
<span id="cb28-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate model-based SEs</span></span>
<span id="cb28-7">model_SE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(RE_sel, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(se, se.tau2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(tau2)), se.delta[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb28-8"></span>
<span id="cb28-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make a table</span></span>
<span id="cb28-10">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb28-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Parameter =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(est),</span>
<span id="cb28-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Est =</span> est,</span>
<span id="cb28-13">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SE(bootstrap)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> boot_SE,</span>
<span id="cb28-14">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SE(model)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> model_SE,</span>
<span id="cb28-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SE(bootstrap) / SE(model)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> boot_SE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> model_SE</span>
<span id="cb28-16">)</span></code></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table class="table table-striped table-condensed table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Parameter</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Est</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE(bootstrap)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE(model)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE(bootstrap) / SE(model)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta.intrcpt</td>
<td style="text-align: right;">0.133</td>
<td style="text-align: right;">0.113</td>
<td style="text-align: right;">0.066</td>
<td style="text-align: right;">1.732</td>
</tr>
<tr class="even">
<td style="text-align: left;">tau</td>
<td style="text-align: right;">0.285</td>
<td style="text-align: right;">0.148</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">3.234</td>
</tr>
<tr class="odd">
<td style="text-align: left;">delta</td>
<td style="text-align: right;">0.548</td>
<td style="text-align: right;">0.780</td>
<td style="text-align: right;">0.250</td>
<td style="text-align: right;">3.127</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>The standard errors based on cluster bootstrapping are all substantially larger than the model-based standard errors, which don’t account for dependence.</p>
</section>
<section id="confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="confidence-intervals">Confidence Intervals</h3>
<p>For reporting results from this sort of analysis, it is useful to provide confidence intervals along with the model parameter estimates and standard errors. These can be calculated using the <a href="https://cran.r-project.org/web/packages/boot/boot.pdf"><code>boot::boot_ci()</code></a> function. This function provides several different types of confidence intervals; for illustration, we will stick with simple percentile confidence intervals, which are calculated by taking percentiles of the bootstrap distribution of each parameter estimate. To use the function, we’ll specify the type of confidence interval and the index of the parameter we want. An index of 1 is for the overall average effect size:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boot.ci</span>(boots, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"perc"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For overall average ES</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1995 bootstrap replicates

CALL : 
boot.ci(boot.out = boots, type = "perc", index = 1)

Intervals : 
Level     Percentile     
95%   (-0.0038,  0.4171 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p>Here is the confidence interval for between-study heterogeneity:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boot.ci</span>(boots, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"perc"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For heterogeneity</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1995 bootstrap replicates

CALL : 
boot.ci(boot.out = boots, type = "perc", index = 2)

Intervals : 
Level     Percentile     
95%   ( 0.001,  0.489 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p>And for the selection weight:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boot.ci</span>(boots, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"perc"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">index =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For selection weight</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 1995 bootstrap replicates

CALL : 
boot.ci(boot.out = boots, type = "perc", index = 3)

Intervals : 
Level     Percentile     
95%   ( 0.0574,  2.7536 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p>Percentile confidence intervals can be asymmetric, and here the confidence interval for the selection weight parameter is notably asymmetric. The end-points of the confidence interval range from 0.057 (which represents very strong selective reporting, with only 6% of non-significant results reported) to 2.754 (which represents very strong selection <em>against</em> affirmative results).<sup>2</sup> So, overall we can’t really draw any strong conclusions about the strength of selective reporting.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this post, we’ve demonstrated how to code a cluster-level bootstrap for a three parameter version of the Vevea-Hedges selection model. We think this cluster-bootstrapping technique is interesting and promising because it can be applied with a very broad swath of models and methods to investigate selective reporting. For instance, the code we’ve demonstrated could be modified by:</p>
<ul>
<li>using a meta-regression model instead of just a summary meta-analysis;</li>
<li>using a different form of selection function such as the beta-weight model proposed by Citkowicz and Vevea <span class="citation" data-cites="Citkowicz2017parsimonious">(2017)</span> or a more elaborate step function with multiple steps; or</li>
<li>using a step function model applied across subsets of effect sizes, as in <span class="citation" data-cites="Coburn2015publication">Coburn &amp; Vevea (2015)</span>.</li>
</ul>
<p>The <a href="https://wviechtb.github.io/metafor/">metafor</a> package implements an expansive set of selection models with the <a href="https://wviechtb.github.io/metafor/reference/selmodel.html"><code>selmodel</code></a> function, so one could really just swap specifications in and out. In principle, the cluster-level bootstrap could also be used in combination with other forms of selective reporting analysis such as PET-PEESE <span class="citation" data-cites="rodgers2020evaluating">(although with such regression adjustments, cluster-robust variance estimation is also an option, see Rodgers &amp; Pustejovsky, 2020)</span> or Copas-style sensitivity analyses <span class="citation" data-cites="Copas2001sensitivity">(Copas &amp; Shi, 2001)</span>.</p>
<p>We are currently studying the performance of bootstrapping a three parameter selection model in some big Monte Carlo simulations. Based on some very preliminary results, it looks like the cluster bootstrapped selection model provides confidence intervals with reasonable coverage levels. We have more to do before we share these results, so again we want to emphasize that what we have demonstrated in this post is <em>experimental</em> and <em>exploratory</em>.</p>
<p>Further questions we need to investigate are how things work if we include covariates in the selection model, whether there are better variations of the bootstrap than what we have demonstrated here <span class="citation" data-cites="xu2020applications">(e.g., the fractionally weighted bootstrapping, Xu et al., 2020)</span>, and the limits of this method in terms of the number of studies needed for adequate performance. If things pan out, we also plan to turn the workflow we’ve demonstrated here into some more user-friendly functions, perhaps as part of the <a href="https://meghapsimatrix.github.io/wildmeta/index.html">wildmeta</a> package.</p>
</section>
<section id="references" class="level2">



<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2">
<div id="ref-vanaert2016conducting" class="csl-entry">
Aert, R. C. M. van, Wicherts, J. M., &amp; Assen, M. A. L. M. van. (2016). Conducting meta-analyses based on <em>p</em> values: Reservations and recommendations for applying <em>p</em> -uniform and <em>p</em> -curve. <em>Perspectives on Psychological Science</em>, <em>11</em>(5), 713–729. <a href="https://doi.org/10.1177/1745691616650874">https://doi.org/10.1177/1745691616650874</a>
</div>
<div id="ref-VanAssen2015meta" class="csl-entry">
Assen, M. A. L. M. van, Van Aert, R. C. M., &amp; Wicherts, J. M. (2015). <span class="nocase">Meta-analysis using effect size distributions of only statistically significant studies</span>. <em>Psychological Methods</em>, <em>20</em>(3), 293–309. https://doi.org/<a href="http://dx.doi.org/10.1037/met0000025">http://dx.doi.org/10.1037/met0000025</a>
</div>
<div id="ref-Becker2000multivariate" class="csl-entry">
Becker, B. J. (2000). <span class="nocase">Multivariate Meta-analysis</span>. In S. D. Brown &amp; H. E. A. Tinsley (Eds.), <em>Handbook of applied multivariate statistics and mathematical modeling</em> (pp. 499–525). Academic Press. <a href="https://doi.org/10.1016/B978-012691360-6/50018-5">https://doi.org/10.1016/B978-012691360-6/50018-5</a>
</div>
<div id="ref-begg1994operating" class="csl-entry">
Begg, C. B., &amp; Mazumdar, M. (1994). Operating characteristics of a rank correlation test for publication bias. <em>Biometrics</em>, <em>50</em>(4), 1088. <a href="https://doi.org/10.2307/2533446">https://doi.org/10.2307/2533446</a>
</div>
<div id="ref-boos2003introduction" class="csl-entry">
Boos, D. D. (2003). Introduction to the bootstrap world. <em>Statistical Science</em>, <em>18</em>(2), 168–174.
</div>
<div id="ref-cameron2008bootstrap" class="csl-entry">
Cameron, A. C., Gelbach, J. B., &amp; Miller, D. L. (2008). Bootstrap-based improvements for inference with clustered errors. <em>The Review of Economics and Statistics</em>, <em>90</em>(3), 414–427.
</div>
<div id="ref-boot" class="csl-entry">
Canty, A., &amp; Ripley, B. D. (2021). <em>Boot: Bootstrap r (s-plus) functions</em>.
</div>
<div id="ref-Citkowicz2017parsimonious" class="csl-entry">
Citkowicz, M., &amp; Vevea, J. L. (2017). <span class="nocase">A parsimonious weight function for modeling publication bias</span>. <em>Psychological Methods</em>, <em>22</em>(1), 28–41. <a href="https://doi.org/10.1037/met0000119">https://doi.org/10.1037/met0000119</a>
</div>
<div id="ref-Coburn2015publication" class="csl-entry">
Coburn, K. M., &amp; Vevea, J. L. (2015). <span class="nocase">Publication bias as a function of study characteristics</span>. <em>Psychological Methods</em>, <em>20</em>(3), 310–330. <a href="https://doi.org/10.1037/met0000046">https://doi.org/10.1037/met0000046</a>
</div>
<div id="ref-Copas2001sensitivity" class="csl-entry">
Copas, J., &amp; Shi, J. Q. (2001). <span class="nocase">A sensitivity analysis for publication bias in systematic reviews.</span> <em>Statistical Methods in Medical Research</em>, <em>10</em>, 251–265.
</div>
<div id="ref-duval2000nonparametric" class="csl-entry">
Duval, S., &amp; Tweedie, R. (2000). A nonparametric "trim and fill" method of accounting for publication bias in meta-analysis. <em>Journal of the American Statistical Association</em>, <em>95</em>(449), 89–98. <a href="https://doi.org/10.2307/2669529">https://doi.org/10.2307/2669529</a>
</div>
<div id="ref-egger1997bias" class="csl-entry">
Egger, M., Smith, G. D., Schneider, M., &amp; Minder, C. (1997). Bias in meta-analysis detected by a simple, graphical test. <em>BMJ</em>, <em>315</em>(7109), 629–634.
</div>
<div id="ref-hedges1992modeling" class="csl-entry">
Hedges, L. V. (1992). Modeling publication selection effects in meta-analysis. <em>Statistical Science</em>, <em>7</em>(2), 246–255.
</div>
<div id="ref-Hedges2010robust" class="csl-entry">
Hedges, L. V., Tipton, E., &amp; Johnson, M. C. (2010). <span class="nocase">Robust variance estimation in meta-regression with dependent effect size estimates</span>. <em>Research Synthesis Methods</em>, <em>1</em>(1), 39–65. <a href="https://doi.org/10.1002/jrsm.5">https://doi.org/10.1002/jrsm.5</a>
</div>
<div id="ref-Hedges1996estimating" class="csl-entry">
Hedges, L. V., &amp; Vevea, J. L. (1996). <span class="nocase">Estimating effect size under publication bias: Small sample properties and robustness of a random effects selection model</span>. <em>Journal of Educational and Behavioral Statistics</em>, <em>21</em>(4), 299. <a href="https://doi.org/10.2307/1165338">https://doi.org/10.2307/1165338</a>
</div>
<div id="ref-hedges2005selection" class="csl-entry">
Hedges, L. V., &amp; Vevea, J. L. (2005). Selection method approaches. In <em>Publication bias in meta-analysis: Prevention, assessment, and adjustments</em> (pp. 145–174). John Wiley &amp; Sons.
</div>
<div id="ref-ioannidis2007exploratory" class="csl-entry">
Ioannidis, J. P. A., &amp; Trikalinos, T. A. (2007). An exploratory test for an excess of significant findings. <em>Clinical Trials</em>, <em>4</em>(3), 245–253. <a href="https://doi.org/10.1177/1740774507079441">https://doi.org/10.1177/1740774507079441</a>
</div>
<div id="ref-lehmann2018metaanalysis" class="csl-entry">
Lehmann, G. K., Elliot, A. J., &amp; Calin-Jageman, R. J. (2018). Meta-analysis of the effect of red on perceived attractiveness. <em>Evolutionary Psychology</em>, <em>16</em>(4), 147470491880241. <a href="https://doi.org/10.1177/1474704918802412">https://doi.org/10.1177/1474704918802412</a>
</div>
<div id="ref-mathur2020sensitivity" class="csl-entry">
Mathur, M. B., &amp; VanderWeele, T. J. (2020). Sensitivity analysis for publication bias in meta‐analyses. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, <em>69</em>(5), 1091–1119. <a href="https://doi.org/10.1111/rssc.12440">https://doi.org/10.1111/rssc.12440</a>
</div>
<div id="ref-mcshane2016adjusting" class="csl-entry">
McShane, B. B., Böckenholt, U., &amp; Hansen, K. T. (2016). Adjusting for publication bias in meta-analysis an evaluation of selection methods and some cautionary notes. <em>Perspectives on Psychological Science</em>, <em>11</em>(5), 730–749. <a href="http://pps.sagepub.com/content/11/5/730.short">http://pps.sagepub.com/content/11/5/730.short</a>
</div>
<div id="ref-rodgers2020evaluating" class="csl-entry">
Rodgers, M. A., &amp; Pustejovsky, J. E. (2020). Evaluating meta-analytic methods to detect selective reporting in the presence of dependent effect sizes. <em>Psychological Methods</em>. <a href="https://doi.org/10.1037/met0000300">https://doi.org/10.1037/met0000300</a>
</div>
<div id="ref-rothstein2006publication" class="csl-entry">
Rothstein, H. R., Sutton, A. J., &amp; Borenstein, M. (2006). <em>Publication bias in meta-analysis: Prevention, assessment and adjustments</em>. John Wiley &amp; Sons.
</div>
<div id="ref-simonsohn2014pcurve" class="csl-entry">
Simonsohn, U., Nelson, L. D., &amp; Simmons, J. P. (2014). P-curve and effect size: Correcting for publication bias using only significant results. <em>Perspectives on Psychological Science</em>, <em>9</em>(6), 666–681. <a href="https://doi.org/10.1177/1745691614553988">https://doi.org/10.1177/1745691614553988</a>
</div>
<div id="ref-stanley2008metaregression" class="csl-entry">
Stanley, T. D. (2008). Meta-regression methods for detecting and estimating empirical effects in the presence of publication selection*. <em>Oxford Bulletin of Economics and Statistics</em>, <em>70</em>(1), 103–127. <a href="https://doi.org/10.1111/j.1468-0084.2007.00487.x">https://doi.org/10.1111/j.1468-0084.2007.00487.x</a>
</div>
<div id="ref-stanley2014metaregression" class="csl-entry">
Stanley, T. D., &amp; Doucouliagos, H. (2014). Meta-regression approximations to reduce publication selection bias. <em>Research Synthesis Methods</em>, <em>5</em>(1), 60–78.
</div>
<div id="ref-sterne2001funnel" class="csl-entry">
Sterne, J. A. C., &amp; Egger, M. (2001). Funnel plots for detecting bias in meta-analysis: Guidelines on choice of axis. <em>Journal of Clinical Epidemiology</em>, <em>54</em>(10), 1046–1055.
</div>
<div id="ref-Sterne2011recommendations" class="csl-entry">
Sterne, J. A. C., Sutton, A. J., Ioannidis, J. P. A., Terrin, N., Jones, D. R., Lau, J., Carpenter, J., Rücker, G., Harbord, R. M., Schmid, C. H., Tetzlaff, J., Deeks, J. J., Peters, J. L., Macaskill, P., Schwarzer, G., Duval, S., Altman, D. G., Moher, D., &amp; Higgins, J. P. T. (2011). <span class="nocase">Recommendations for examining and interpreting funnel plot asymmetry in meta-analyses of randomised controlled trials.</span> <em>BMJ</em>, <em>343</em>, d4002. <a href="https://doi.org/10.1136/bmj.d4002">https://doi.org/10.1136/bmj.d4002</a>
</div>
<div id="ref-sutton2009publication" class="csl-entry">
Sutton, A. (2009). Publication bias. In <em>The handbook of research synthesis and meta-analysis</em> (pp. 435–445). Russell Sage Foundation.
</div>
<div id="ref-VandenNoortgate2013threelevel" class="csl-entry">
Van den Noortgate, W., López-López, J. A., Marín-Martínez, F., &amp; Sánchez-Meca, J. (2013). <span class="nocase">Three-level meta-analysis of dependent effect sizes</span>. <em>Behavior Research Methods</em>, <em>45</em>(2), 576–594. <a href="https://doi.org/10.3758/s13428-012-0261-6">https://doi.org/10.3758/s13428-012-0261-6</a>
</div>
<div id="ref-vevea1995general" class="csl-entry">
Vevea, J. L., &amp; Hedges, L. V. (1995). A general linear model for estimating effect size in the presence of publication bias. <em>Psychometrika</em>, <em>60</em>(3), 419–435. <a href="https://doi.org/10.1007/BF02294384">https://doi.org/10.1007/BF02294384</a>
</div>
<div id="ref-vevea2005publication" class="csl-entry">
Vevea, J. L., &amp; Woods, C. M. (2005). Publication bias in research synthesis: Sensitivity analysis using a priori weight functions. <em>Psychological Methods</em>, <em>10</em>(4), 428–443. <a href="https://doi.org/10.1037/1082-989X.10.4.428">https://doi.org/10.1037/1082-989X.10.4.428</a>
</div>
<div id="ref-Viechtbauer2010conducting" class="csl-entry">
Viechtbauer, W. (2010). <span class="nocase">Conducting meta-analyses in R with the metafor package</span>. <em>Journal of Statistical Software</em>, <em>36</em>(3), 1–48.
</div>
<div id="ref-metadat" class="csl-entry">
White, T., Noble, D., Senior, A., Hamilton, W. K., &amp; Viechtbauer, W. (2022). <em>Metadat: Meta-analysis datasets</em>. <a href="https://CRAN.R-project.org/package=metadat">https://CRAN.R-project.org/package=metadat</a>
</div>
<div id="ref-tidyverse" class="csl-entry">
Wickham, H., Averick, M., Bryan, J., Chang, W., McGowan, L. D., François, R., Grolemund, G., Hayes, A., Henry, L., Hester, J., Kuhn, M., Pedersen, T. L., Miller, E., Bache, S. M., Müller, K., Ooms, J., Robinson, D., Seidel, D. P., Spinu, V., … Yutani, H. (2019). Welcome to the <span class="nocase">tidyverse</span>. <em>Journal of Open Source Software</em>, <em>4</em>(43), 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>
</div>
<div id="ref-xu2020applications" class="csl-entry">
Xu, L., Gotwalt, C., Hong, Y., King, C. B., &amp; Meeker, W. Q. (2020). Applications of the fractional-random-weight bootstrap. <em>The American Statistician</em>, <em>74</em>(4), 345–358. <a href="https://doi.org/10.1080/00031305.2020.1731599">https://doi.org/10.1080/00031305.2020.1731599</a>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Technically, these parameters <img src="https://latex.codecogs.com/png.latex?%5Clambda_1,%5Clambda_2,%5Clambda_3"> are not absolute probabilities but instead <em>relative</em> risks of being reported, compared to a reference range of <img src="https://latex.codecogs.com/png.latex?p">-values. In the above example, they would be defined relative to the probability of being reported for an effect size estimate with <img src="https://latex.codecogs.com/png.latex?p%20%5Cleq%20.01">.↩︎</p></li>
<li id="fn2"><p>Compare this to the model-based confidence interval of <img src="https://latex.codecogs.com/png.latex?%5B0.059,%201.037%5D">.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2023,
  author = {Pustejovsky, James E. and E. Pustejovsky, James and Joshi,
    Megha},
  title = {Cluster-Bootstrapping a Meta-Analytic Selection Model},
  date = {2023-03-30},
  url = {https://jepusto.com/posts/cluster-bootstrap-selection-model},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2023" class="csl-entry quarto-appendix-citeas">
Pustejovsky, J. E., E. Pustejovsky, J., &amp; Joshi, M. (2023, March
30). <em>Cluster-Bootstrapping a meta-analytic selection model</em>. <a href="https://jepusto.com/posts/cluster-bootstrap-selection-model">https://jepusto.com/posts/cluster-bootstrap-selection-model</a>
</div></div></section></div> ]]></description>
  <category>bootstrap</category>
  <category>dependent effect sizes</category>
  <category>meta-analysis</category>
  <category>publication bias</category>
  <category>programming</category>
  <category>Rstats</category>
  <guid>https://jepusto.com/posts/cluster-bootstrap-selection-model/</guid>
  <pubDate>Thu, 30 Mar 2023 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Cohen’s \(d_z\) makes me dizzy when considering measurement error</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/dizzy-for-d-z/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Ccor%7B%7B%5Ctext%7Bcor%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D%0A"></p>
<p>Meta-analyses in education, psychology, and related fields rely heavily of Cohen’s <img src="https://latex.codecogs.com/png.latex?d">, or the standardized mean difference effect size, for quantitatively describing the magnitude and direction of intervention effects. In these fields, Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> is so pervasive that its use is nearly automatic, and analysts rarely question its utility or consider alternatives (response ratios, anyone? POMP?). Despite this state of affairs, working with Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> is theoretically challenging because the standardized mean difference metric does not have a singular definition. Rather, its definition depends on the choice of the standardizing variance used in the denominator.<sup>1</sup></p>
<p>In this post, I’m going to mull over how measurement error and design decisions influence the metric definition of Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> in basic within-group experimental designs. The distorting effects of measurement error has long been a source of concern within psychometric meta-analysis, a perspective associated with the work of <a href="https://methods.sagepub.com/book/methods-of-meta-analysis-3e">Frank Schmidt and Jack Hunter</a>, and measurement-error corrections are well developed and often applied in meta-analyses of correlations. Straight-forward measurement-error corrections have also been described for Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> from between-group designs (see recent work by <a href="https://psyarxiv.com/9mpbn/">Brenton Wiernik and Jeff Dahlke</a>). However, I have literally never seen a meta-analytic application that applied these corrections and I have thus far been unable to locate work on such corrections specifically for effect sizes in within-group designs.<sup>2</sup> So, time to muck about…</p>
<section id="effect-size-definitions-in-within-group-designs" class="level2">
<h2 class="anchored" data-anchor-id="effect-size-definitions-in-within-group-designs">Effect size definitions in within-group designs</h2>
<p>In basic between-group designs, the only variances in the model are the within-group variances, so the choice of standardizing variance is limited to a) the singular population variance, assuming it is homogeneous across groups, b) the variance of one group, or c) the average of the variances in each group. In most applications, homogeneity is assumed (often without much reflection), version (a) of Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> is estimated, and the meta-analyst can go along their merry way. For sake of succinctness, I’ll call this effect size <img src="https://latex.codecogs.com/png.latex?d_%7Bb%7D">, where the <img src="https://latex.codecogs.com/png.latex?b"> indicates the usual version for basic between-group designs.</p>
<p>For within-group or repeated measures designs, the set of choices is more involved and includes a) standardizing by the across-participant variance in one condition (or both conditions, assuming homogeneity) or b) standardizing by the variance of the difference scores. The former approach is sometimes called <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"><sup>3</sup>, the latter is called <img src="https://latex.codecogs.com/png.latex?d_z"><sup>4</sup>. The <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> metric uses the same standardizing variance as the <img src="https://latex.codecogs.com/png.latex?d"> from a basic between-group design, and so results from both types of designs are, in principle, on the same scale.</p>
<p>In the context of meta-analysis, the comparability of <img src="https://latex.codecogs.com/png.latex?d_b"> and <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> is useful when working with a set of studies that include both types of designs. On the other hand, in meta-analyses that consist solely of within-group or repeated measures designs, comparability with <img src="https://latex.codecogs.com/png.latex?d_b"> may be less of a priority and one could consider using <img src="https://latex.codecogs.com/png.latex?d_z"> for synthesis. Purely on a pragmatic level, using <img src="https://latex.codecogs.com/png.latex?d_z"> might be attractive because the only pieces of information needed to calculate it are the total sample size and the <img src="https://latex.codecogs.com/png.latex?t"> statistic (or <img src="https://latex.codecogs.com/png.latex?p">-value) from the comparison between conditions. In contrast, calculating <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> also requires the between-participant standard deviations from one or both groups, which primary studies might not always report.</p>
<p>Going in to this exercise, I had the notion that measurement error would affect <img src="https://latex.codecogs.com/png.latex?d_z"> to a greater degree than <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> because <img src="https://latex.codecogs.com/png.latex?d_z"> involves difference scores and difference scores get hit by measurement error twice. Does this intuition hold up? Let me try to formalize things a bit.</p>
</section>
<section id="a-within-group-design-with-measurement-error" class="level2">
<h2 class="anchored" data-anchor-id="a-within-group-design-with-measurement-error">A within-group design with measurement error</h2>
<p>Suppose we have a within-group design involving two conditions, where participants are assessed on <img src="https://latex.codecogs.com/png.latex?K"> trials under each condition. Let <img src="https://latex.codecogs.com/png.latex?Y_%7Bijk%7D"> denote the outcome from trial <img src="https://latex.codecogs.com/png.latex?k"> for participant <img src="https://latex.codecogs.com/png.latex?j"> under condition <img src="https://latex.codecogs.com/png.latex?i">, for <img src="https://latex.codecogs.com/png.latex?i%20=%201,2">, <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,N">, and <img src="https://latex.codecogs.com/png.latex?k%20=%201,...,K">. A basic model for this set-up is <img src="https://latex.codecogs.com/png.latex?%0AY_%7Bijk%7D%20=%20%5Cmu_i%20+%20u_%7Bij%7D%20+%20e_%7Bijk%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?u_%7B1j%7D"> and <img src="https://latex.codecogs.com/png.latex?u_%7B2j%7D"> are participant-specific errors in the true scores under each condition and the <img src="https://latex.codecogs.com/png.latex?e_%7Bijk%7D">’s are measurement errors. For simplicity, I will assume that:</p>
<ul>
<li>the true-score variance is equal across conditions, with <img src="https://latex.codecogs.com/png.latex?%5CVar(u_%7Bij%7D)%20=%20%5Csigma%5E2"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,2">,</li>
<li>the true scores are correlated across conditions, <img src="https://latex.codecogs.com/png.latex?%5Ccor(u_%7B1j%7D,%20u_%7B2j%7D)%20=%20%5Crho">, and</li>
<li>measurement errors are uncorrelated and have homogeneous variance across conditions, with <img src="https://latex.codecogs.com/png.latex?%5CVar(e_%7Bijk%7D)%20=%20%5Cpsi%5E2">.</li>
</ul>
<p>Let <img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%20%5Csigma%5E2%20/%20(%5Csigma%5E2%20+%20%5Cpsi%5E2)"> denote the reliability (intra-class correlation) of a single observed score. Note that we can write <img src="https://latex.codecogs.com/png.latex?%5Cpsi%5E2"> in terms of the reliability and true-score variance as <img src="https://latex.codecogs.com/png.latex?%5Cpsi%5E2%20=%20%5Csigma%5E2%20%5Ctimes%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%7D">.</p>
<p>Under this model, there are several different standardized mean difference metrics that we could consider. Since measurement reliability might vary from study to study, it would make sense to define the metric in terms of true score variances alone, as <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_%7Bav%7D%20=%20%5Cfrac%7B%5Cmu_2%20-%20%5Cmu_1%7D%7B%5Csigma%7D%0A"> or in terms of the variance of the difference in true scores, as <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_z%20=%20%5Cfrac%7B%5Cmu_2%20-%20%5Cmu_1%7D%7B%5Csigma%20%5Csqrt%7B2(1%20-%20%5Crho)%7D%7D.%0A"> However, we don’t directly observe the true scores, and we can’t estimate their variance unless we have information about score reliabilities. Thus, meta-analysts will usually need to calculate effect sizes in terms of <em>observed</em> scores that include measurement error.</p>
<p>Suppose that the analysis is conducted by taking the average of the <img src="https://latex.codecogs.com/png.latex?K"> trials for each participant under each condition, <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BY%7D_%7Bij%7D%20=%20%5Cfrac%7B1%7D%7BK%7D%20%5Csum_%7Bk=1%7D%5EK%20Y_%7Bijk%7D">, and conducting the analysis using these mean scores. The variance of the mean scores is <img src="https://latex.codecogs.com/png.latex?%0A%5CVar(%5Cbar%7BY%7D_%7Bij%7D)%20=%20%5Csigma%5E2%20%5Cleft(1%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%5Cright),%0A"> so we can define the observed-score standardized mean difference using raw score standardization as <img src="https://latex.codecogs.com/png.latex?%0A%5Ctilde%5Cdelta_%7Bav%7D%20=%20%5Cfrac%7B%5Cmu_2%20-%20%5Cmu_1%7D%7B%5Csigma%20%5Csqrt%7B1%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%7D%7D%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B1%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%7D%7D%20%5Ctimes%20%5Cdelta_%7Bav%7D.%0A"> From this expression, we can see that measurement error attenuates the true-score effect size because the multiplier term is always going to be less than one.</p>
<p>Similarly, the variance of the observed difference scores is <img src="https://latex.codecogs.com/png.latex?%0A%5CVar(%5Cbar%7BY%7D_%7B2j%7D%20-%20%5Cbar%7BY%7D_%7B1j%7D)%20=2%20%5Csigma%5E2%20%5Cleft(1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%5Cright),%0A"> so we can define the observed-score standardized mean difference using change score standardization as <img src="https://latex.codecogs.com/png.latex?%0A%5Ctilde%5Cdelta_z%20=%20%5Cfrac%7B%5Cmu_2%20-%20%5Cmu_1%7D%7B%5Csigma%20%5Csqrt%7B2%20%5Cleft(1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%5Cright)%7D%7D%20=%20%5Csqrt%7B%5Cfrac%7B1%20-%20%5Crho%7D%7B1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%7D%7D%20%5Ctimes%20%5Cdelta_z.%0A"> Again, we can see that measurement error attenuates the true-score effect size because the multiplier term is always going to be less than one. However, unlike with <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D">, the attenuation factor here depends on <img src="https://latex.codecogs.com/png.latex?%5Crho"> in addition to <img src="https://latex.codecogs.com/png.latex?%5Cphi"> and <img src="https://latex.codecogs.com/png.latex?K">. This additional term in the correction factor is one indication that <img src="https://latex.codecogs.com/png.latex?d_z"> might be less desirable for meta-analysis. Correcting <img src="https://latex.codecogs.com/png.latex?d_z"> for the distortion from measurement error would require estimates of both the true-score correlation and the reliability of the scores, whereas correcting <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> would require only the latter.</p>
</section>
<section id="meta-analysis" class="level2">
<h2 class="anchored" data-anchor-id="meta-analysis">Meta-analysis</h2>
<p>The relationships between the true-score effect sizes and the analogous observed score effect sizes starts to be a problem when we consider a meta-analysis of multiple primary studies. Primary studies will often use different instruments and procedures for measuring outcomes (necessitating the use of some standardized effect size), and those differences in instruments and procedures might come along with differences in score reliability as well as variation in the number of trials collected per condition (and plenty of other things, such as sample size, participant characteristics, etc.). Procedural heterogeneity like this creates two potential challenges for meta-analysis: bias in average effect sizes and extra heterogeneity in the distribution of effect sizes. Both could make findings from a meta-analysis more difficult to interpret, although I will argue that extra heterogeneity is more concerning than bias.</p>
<p>To illustrate, let’s now imagine that the parameters of the within-group study design, <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"> or <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z">, <img src="https://latex.codecogs.com/png.latex?%5Crho">, <img src="https://latex.codecogs.com/png.latex?%5Cphi">, and <img src="https://latex.codecogs.com/png.latex?K"> are random variables, drawn from the distribution of parameters across a population of hypothetical studies.</p>
<section id="a-model-for-delta_av" class="level3">
<h3 class="anchored" data-anchor-id="a-model-for-delta_av">A model for <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"></h3>
<p>Let’s first consider <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"> and assume that it follows a random effects model, with <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_%7Bav%7D%20%5Csim%20N%5Cleft(%5Cmu,%20%5Ctau%5E2%5Cright).%0A"> Let’s also assume that the remaining parameters <img src="https://latex.codecogs.com/png.latex?%5Crho">, <img src="https://latex.codecogs.com/png.latex?%5Cphi">, and <img src="https://latex.codecogs.com/png.latex?K"> are independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">. These parameters determine the attenuation factor <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D%20=%20%5Cleft(1%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%5Cright)%5E%7B-1/2%7D">, which relates the observed-score effect size parameter to the true score effect size parameter.</p>
<p>The bias of <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is therefore <img src="https://latex.codecogs.com/png.latex?%0A%5CE%5Cleft(%5Ctilde%5Cdelta_%7Bav%7D%5Cright)%20=%20%5CE%5Cleft(A_%7Bav%7D%5Cdelta_%7Bav%7D%5Cright)%20=%20%5CE(A_%7Bav%7D)%20%5Ctimes%20%5Cmu.%0A"> Thus, under my very simplistic assumptions, a meta-analysis of observed score Cohen’s <img src="https://latex.codecogs.com/png.latex?d_%7Bav%7D"> estimates will be biased (downward) for the overall average effect in the true-score distribution.</p>
<p>You might find that the downward bias in <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is undesirable. On the other hand, bias might not be as a big a problem as it first seems. If all of the observed-score effect sizes are biased to a degree that is unrelated to the true effects, then bias just stretches or compresses the scale of measurement, but doesn’t necessarily lead to interpretive problems. Imagine you have a ruler that is half an inch too short, and you’re trying to compare the heights of different objects. As long as you use the same ruler, then you will still be able to determine which objects are bigger and which are smaller, and by how much, even if the measurements are off in an absolute sense.</p>
<p>Apart from bias, however, variability in <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> will also induce <em>additional heterogeneity</em> in the distribution of observed score effect sizes. This is a clear problem because it creates additional uncertainty, making it harder to draw inferences about the distribution of effects, predict new effect sizes, or identify substantively interesting moderators. To measure this additional heterogeneity and keep its consequences separate from the consequences for bias, I will look at the coefficient of variation in <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D">. Under the assumption that <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> is independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Csqrt%7B%5CVar(%5Ctilde%5Cdelta_%7Bav%7D)%7D%7D%7B%5CE(%5Ctilde%5Cdelta_%7Bav%7D)%7D%20=%20%5Cfrac%7B%5Csqrt%7B(%5Cmu%5E2%20+%202%20%5Ctau%5E2)%20%5CVar(A_%7Bav%7D)%20+%20%5Ctau%5E2%20%5Cleft%5B%5CE(A_%7Bav%7D)%5Cright%5D%5E2%7D%7D%7B%5CE%5Cleft(A_%7Bav%7D%20%5Cright)%20%5Ctimes%20%5Cmu%20%7D%20=%20%5Csqrt%7B%5Cleft%5B%5Cleft(1%20+%20%5Cfrac%7B2%20%5Ctau%5E2%7D%7B%5Cmu%5E2%7D%5Cright)%20%5Cfrac%7B%5CVar(A_%7Bav%7D)%7D%7B%5Cleft%5B%5CE%5Cleft(A_%7Bav%7D%20%5Cright)%5Cright%5D%5E2%7D%20+%20%5Cfrac%7B%5Ctau%5E2%7D%7B%5Cmu%5E2%7D%5Cright%5D%7D.%0A"> Thus, the coefficient of variation for <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is amplified by a factor that depends on the squared coefficient of variation of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D">. Under the same model, <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z%20=%20A_z%20%5Ctimes%20%5Cdelta_%7Bav%7D">, where <img src="https://latex.codecogs.com/png.latex?A_z%20=%20%5Cleft(1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%5Cright)%5E%7B-1/2%7D">, and so <img src="https://latex.codecogs.com/png.latex?%5CE(%5Ctilde%5Cdelta_z)%20=%20%5CE(A_z)%20%5Ctimes%20%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Csqrt%7B%5CVar(%5Ctilde%5Cdelta_z)%7D%7D%7B%5CE(%5Ctilde%5Cdelta_z)%7D%20=%20%5Csqrt%7B%5Cleft%5B%5Cleft(1%20+%20%5Cfrac%7B2%20%5Ctau%5E2%7D%7B%5Cmu%5E2%7D%5Cright)%20%5Cfrac%7B%5CVar(A_z)%7D%7B%5Cleft%5B%5CE%5Cleft(A_z%20%5Cright)%5Cright%5D%5E2%7D%20+%20%5Cfrac%7B%5Ctau%5E2%7D%7B%5Cmu%5E2%7D%5Cright%5D%7D.%0A"></p>
<p>To see what’s going on here, let’s consider some specific distributions for these measurement factors. First, let’s assume:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Crho%20%5Csim%20B(14,%206)">, so that <img src="https://latex.codecogs.com/png.latex?%5CE(%5Crho)%20=%20.7"> and <img src="https://latex.codecogs.com/png.latex?%5CVar(%5Crho)%20=%200.1%5E2">;</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cphi%20%5Csim%20B(3,%205)">, so that <img src="https://latex.codecogs.com/png.latex?%5CE(%5Crho)%20=%20.0.375"> and <img src="https://latex.codecogs.com/png.latex?%5CVar(%5Crho)%20=%200.161%5E2">;</li>
<li><img src="https://latex.codecogs.com/png.latex?K%20%5Csim%201%20+%20Pois(9)">, so <img src="https://latex.codecogs.com/png.latex?%5CE(K)%20=%2010"> and <img src="https://latex.codecogs.com/png.latex?%5CVar(K)%20=%203%5E2">; and</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Crho">, <img src="https://latex.codecogs.com/png.latex?%5Cphi">, and <img src="https://latex.codecogs.com/png.latex?K"> are mutually independent and independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">.</li>
</ul>
<p>Below I simulate 50000 samples from these distributions and calculate <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> and <img src="https://latex.codecogs.com/png.latex?A_z">.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span></span>
<span id="cb1-2">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(R, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb1-3">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(R, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-4">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(R, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb1-5">A_av <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> K))</span>
<span id="cb1-6">A_z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> K)))</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb1-10"></span>
<span id="cb1-11">density_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, lab, col, limits) {</span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(limits) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> col) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> lab, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb1-18">}</span>
<span id="cb1-19"></span>
<span id="cb1-20">p_A_av <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(A_av, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(A[av]),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-21">p_A_z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(A_z, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(A[z]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb1-22">p_A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p_A_z</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/dizzy-for-d-z/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The distribution of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> is mostly concentrated around the mean of <img src="https://latex.codecogs.com/png.latex?E(A_%7Bav%7D)%20=%200.898">, with a coefficient of variation of <img src="https://latex.codecogs.com/png.latex?CV(A_%7Bav%7D)%20=%200.085">. In contrast, the distribution of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> has a mean very close to one, <img src="https://latex.codecogs.com/png.latex?E(A_z)%20=%201.006"> but a coefficient of variation of <img src="https://latex.codecogs.com/png.latex?CV(A_z)%20=%200.21">, about 2.5 times larger. Thus, variation in measurement procedure induces more extra heterogeneity into the distribution of <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> than into <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D">.</p>
<p>Now, one potential objection to this hypothetical scenario is that researchers do not choose the number of trials at random, without consideration for the other parameters of the study design. A more realistic assumption might be that researchers choose <img src="https://latex.codecogs.com/png.latex?K"> to ensure they achieve at least some threshold level of reliability for the observed scores. The reliability of the observed scores is <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D%5E2">, so ensuring some threshold of reliability is equivalent to ensuring the square root of the threshold for <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D">. Let’s suppose that researchers always ensure <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D%20%5Cgeq%200.8"> so that reliability is always at least <img src="https://latex.codecogs.com/png.latex?0.64">. This leads to the following distributions for <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> and <img src="https://latex.codecogs.com/png.latex?A_z">:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">A_av_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A_av[A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>]</span>
<span id="cb2-2">A_z_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> A_z[A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>]</span>
<span id="cb2-3">p_A_av_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(A_av_trunc, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(A[av]),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-4">p_A_z_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(A_z_trunc, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(A[z]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb2-5">p_A_av_trunc <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p_A_z_trunc</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/dizzy-for-d-z/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The distribution of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> loses its left tail, so that its mean is <img src="https://latex.codecogs.com/png.latex?E(A_%7Bav%7D%7CA_%7Bav%7D%20%5Cgeq%200.8)%20=%200.917"> and its coefficient of variation is reduced to <img src="https://latex.codecogs.com/png.latex?CV(A_%7Bav%7D%20%7C%20A_%7Bav%7D%20%5Cgeq%200.8)%20=%200.049">. The distribution of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"> now has a mean of <img src="https://latex.codecogs.com/png.latex?E(A_z%20%7C%20A_%7Bav%7D%20%5Cgeq%200.8)%20=%201.045"> and a coefficient of variation of <img src="https://latex.codecogs.com/png.latex?CV(A_z%20%7C%20A_%7Bav%7D%20%5Cgeq%200.8)%20=%200.173">, about 3.5 times larger than the squared coefficient of variation of <img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D">.</p>
<p>Under both of these scenarios, the observed-score <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is substantially more sensitive to procedural heterogeneity than is <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D">. Based on this model and hypothetical example, it seems clear <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> should be preferred over <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> as a metric for meta-analysis. However, these relationships are predicated on a certain model for the study-specific parameters. One might object to this model because there’s a sense that we have assumed that <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"> is the right answer. After all, the underlying effect size model is specified in terms of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, and the design parameters—including <img src="https://latex.codecogs.com/png.latex?%5Crho"> in particular—are treated as noise, uncorrelated with <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">. What happens to the observed-score metrics <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> if we instead start with a model specified in terms of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z">?</p>
</section>
<section id="a-model-for-delta_z" class="level3">
<h3 class="anchored" data-anchor-id="a-model-for-delta_z">A model for <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z"></h3>
<p>Let’s now see how this works if we treat <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z"> as the correct metric and assume that the design parameters are independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z">. Assume that <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_z%20%5Csim%20N(%5Calpha,%20%5Comega%5E2)%0A"> and that the remaining parameters <img src="https://latex.codecogs.com/png.latex?%5Crho">, <img src="https://latex.codecogs.com/png.latex?%5Cphi">, and <img src="https://latex.codecogs.com/png.latex?K"> are independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">. Then the observed-score standardized mean difference using change score standardization can be written as <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z%20=%20B_z%20%5Ctimes%20%5Cdelta_z">, where <img src="https://latex.codecogs.com/png.latex?%0AB_z%20=%20%5Csqrt%7B%5Cfrac%7B1%20-%20%5Crho%7D%7B1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%7D%7D%0A"> and the observed-score standardized mean difference using raw score standardization can be written as <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D%20=%20B_%7Bav%7D%20%5Ctimes%20%5Cdelta_z">, where <img src="https://latex.codecogs.com/png.latex?%0AB_%7Bav%7D%20=%20%5Cfrac%7B%5Csqrt%7B2%7D(1%20-%20%5Crho)%7D%7B%5Csqrt%7B1%20-%20%5Crho%20+%20%5Cfrac%7B1%20-%20%5Cphi%7D%7B%5Cphi%20K%7D%7D%7D.%0A"> The plots below show the distribution of <img src="https://latex.codecogs.com/png.latex?B_z"> and <img src="https://latex.codecogs.com/png.latex?B_%7Bav%7D"> under the same scenarios considered above. First, the scenario where observed-score reliability is not controlled:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">B_z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> K)))</span>
<span id="cb3-2">B_av <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> K))</span>
<span id="cb3-3"></span>
<span id="cb3-4">p_B_av <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(B_av, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(B[av]),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>))</span>
<span id="cb3-5">p_B_z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(B_z, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(B[z]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb3-6">p_B_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p_B_z</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/dizzy-for-d-z/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Second, the scenario where observed-score reliability is at least 0.64:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">B_z_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B_z[A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>]</span>
<span id="cb4-2">B_av_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> B_av[A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>]</span>
<span id="cb4-3"></span>
<span id="cb4-4">p_B_av_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(B_av, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(B[av]),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>))</span>
<span id="cb4-5">p_B_z_trunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">density_plot</span>(B_z, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(B[z]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yellow"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb4-6">p_B_av_trunc <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p_B_z_trunc</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/dizzy-for-d-z/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The table below reports the coefficients of variation for each of the multiplicative factors I have considered.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb5-2">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(A_av, A_z, B_av, B_z)</span>
<span id="cb5-3"></span>
<span id="cb5-4">random_rel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-5">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.)),</span>
<span id="cb5-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reliability =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"random"</span></span>
<span id="cb5-9">  )</span>
<span id="cb5-10"></span>
<span id="cb5-11">controlled_rel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb5-12">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(A_av <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb5-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(.)),</span>
<span id="cb5-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reliability =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"at least 0.64"</span></span>
<span id="cb5-17">  )</span>
<span id="cb5-18"></span>
<span id="cb5-19">CVs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(random_rel, controlled_rel) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A_ratio =</span> A_z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> A_av,</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">B_ratio =</span> B_z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_av</span>
<span id="cb5-24">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(reliability, A_av, A_z, A_ratio, B_av, B_z, B_ratio)</span>
<span id="cb5-26"></span>
<span id="cb5-27">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(</span>
<span id="cb5-28">  CVs, </span>
<span id="cb5-29">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb5-30">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coefficients of variation"</span>,</span>
<span id="cb5-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reliability"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$A_{av}$"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$A_z$"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$A_z /A_{av}$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$B_{av}$"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$B_z$"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$B_{z} / B_{av}$"</span>),</span>
<span id="cb5-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">escape =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb5-33">)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Coefficients of variation</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Reliability</th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?A_%7Bav%7D"></th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?A_z"></th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?A_z%20/A_%7Bav%7D"></th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?B_%7Bav%7D"></th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?B_z"></th>
<th style="text-align: right;"><img src="https://latex.codecogs.com/png.latex?B_%7Bz%7D%20/%20B_%7Bav%7D"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">random</td>
<td style="text-align: right;">0.085</td>
<td style="text-align: right;">0.210</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">0.285</td>
<td style="text-align: right;">0.182</td>
<td style="text-align: right;">0.64</td>
</tr>
<tr class="even">
<td style="text-align: left;">at least 0.64</td>
<td style="text-align: right;">0.049</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">0.257</td>
<td style="text-align: right;">0.137</td>
<td style="text-align: right;">0.53</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The tables are now more or less turned. Under both reliability scenarios, <img src="https://latex.codecogs.com/png.latex?B_z"> has a lower coefficient of variation than <img src="https://latex.codecogs.com/png.latex?B_%7Bav%7D">, indicating that <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is less affected by procedural heterogeneity than is <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D">. However, <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is still affected in absolute terms, considering that the coefficient of variation for <img src="https://latex.codecogs.com/png.latex?B_z"> is about 79% of the coefficient of variation for <img src="https://latex.codecogs.com/png.latex?A_z">. Of course, <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is quite strongly affected under this model, with a coefficient of variation of 0.257.</p>
</section>
<section id="consequences-for-heterogeneity" class="level3">
<h3 class="anchored" data-anchor-id="consequences-for-heterogeneity">Consequences for heterogeneity</h3>
<p>To make these results a bit more concrete, it’s useful to consider think in terms of heterogeneity of the observed score effect sizes. The figure below plots the CVs of observed-score effect size parameters as a function of the CVs of the true effect size distribution.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb6-3"></span>
<span id="cb6-4">CV_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-5">  CVs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>A_ratio, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>B_ratio) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>reliability, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"het"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_grid</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau_mu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reliability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recode</span>(reliability, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'at least 0.64'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reliability of at least 0.64"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Random reliability"</span>),</span>
<span id="cb6-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(metric, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">["</span>),<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>),</span>
<span id="cb6-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">CV =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau_mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> het<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> tau_mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-13">  )</span>
<span id="cb6-14"></span>
<span id="cb6-15">CV_ex <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> CV_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tau_mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, reliability <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reliability of at least 0.64"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(metric, CV) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">CV =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(CV, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb6-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_sub</span>(metric, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">["</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span>)</span>
<span id="cb6-21">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> metric, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> CV)</span>
<span id="cb6-23"></span>
<span id="cb6-24">CV_obs_labs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb6-25">  CV_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(tau_mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-27"></span>
<span id="cb6-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(CV_obs, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(tau_mu, CV, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> metric)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(reliability)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb6-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> CV_obs_labs, </span>
<span id="cb6-37">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> tau_mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> CV, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> metric, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> metric),</span>
<span id="cb6-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,</span>
<span id="cb6-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb6-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(tau <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mu), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coefficient of variation for observed score ES"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/dizzy-for-d-z/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Consider, for instance, a scenario where observed-score reliability is always at least 0.64 and <img src="https://latex.codecogs.com/png.latex?%5Ctau%20/%20%5Cmu%20=%200.5">, which would be the case if effect sizes are normally distributed and about 97% of effect sizes are positive. Under the effect size model based on <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, the observed-score <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is hardly affected by measurement heterogeneity at all, with a CV of 0.504 but the CV of the observed-score <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is 0.543. Under the effect size model based on <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, the observed-score <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is strongly affected by measurement heterogeneity, with a CV of 0.591; in comparison, the CV of the observed-score <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> of 0.528. Under both models, these increases in CV are effectively constant for larger values of <img src="https://latex.codecogs.com/png.latex?%5Ctau%20/%20%5Cmu">.</p>
</section>
</section>
<section id="so-whats-your-point" class="level2">
<h2 class="anchored" data-anchor-id="so-whats-your-point">So what’s your point?</h2>
<p>Unfortunately, this particular trip down a rabbit hole doesn’t seem to yield many clear take-aways. For the scenario that I looked at here, the preferred choice of effect size metric is apparently driven by what assumptions we find more plausible. If we think the more plausible model is the one in which <img src="https://latex.codecogs.com/png.latex?%5Crho"> is independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, then <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> is less strongly affected by measurement variation and therefore preferred. Further, the attenuation in <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_%7Bav%7D"> depends only on <img src="https://latex.codecogs.com/png.latex?%5Cphi">, which might mean that a correction for attenuation is more feasible. However, if we think the more plausible model is the one in which <img src="https://latex.codecogs.com/png.latex?%5Crho"> is independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z">, then <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is less strongly affected by measurement variation and therefore preferred.<sup>5</sup> In the latter model, one caveat is that the measurement error attenuation in <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Cdelta_z"> is still a complicated mess, depending on both the true score correlation <img src="https://latex.codecogs.com/png.latex?%5Crho"> and the reliability <img src="https://latex.codecogs.com/png.latex?%5Cphi">. This would make it pretty hard to implement some sort of correction for attenuation.</p>
<p>So, how could one decide which meta-analytic model is more plausible in a given application? On a conceptual level, I would argue that the model for <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"> would tend to be more plausible in meta-analyses where there is more operational variation in the interventions examined. I would venture that syntheses that include many different versions of an intervention would tend to have a wider range of correlations between true scores (i.e., more heterogeneous correlations between potential outcomes), even holding the outcome measurement procedures constant. This doesn’t necessarily justify the assumption that <img src="https://latex.codecogs.com/png.latex?%5Crho"> is independent of <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D">, but it does make it seem rather implausible that <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z"> would be independent of <img src="https://latex.codecogs.com/png.latex?%5Crho">.</p>
<p>On a more practical level, it seems like there are a few empirical things that a meta-analyst could do to inform a choice between a model for <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bav%7D"> and one for <img src="https://latex.codecogs.com/png.latex?%5Cdelta_z">. Pragmatically, one could calculate both effect size metrics and just see which one exhibits more heterogeneity. All else equal, it seems reasonable to prefer the metric that has less heterogeneity. One could also try to gather data on the correlation between observed scores, on the reliability of the observed scores, and on the number of trials used in each study. With this information, one could construct measurement-related predictors and use them in a meta-regression to explain variation in the observed effect size estimates. Alternately, one could use the formulas given above to implement attenuation corrections for the effect sizes and see if this leads to reduced heterogeneity. How well would any of these approaches actually work? Answering that question would take some further, more careful and systematic investigation.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Perhaps because use of Cohen’s <img src="https://latex.codecogs.com/png.latex?d"> is so under-scrutinized in practice, methodologists have spent many an afternoon blogging about this problem. For general discussions about issues with how to define Cohen’s <img src="https://latex.codecogs.com/png.latex?d">, see excellent posts from <a href="https://janhove.github.io/reporting/2015/02/05/standardised-vs-unstandardised-es">Jan Vanhove</a> (with <a href="https://janhove.github.io/design/2015/03/16/standardised-es-revisited">a sequel</a>), <a href="http://jakewestfall.org/blog/index.php/2016/03/25/five-different-cohens-d-statistics-for-within-subject-designs/">Jake Westfall</a>, <a href="http://datacolada.org/33">Uri Simonsohn</a>, and <a href="https://transparentstatistics.org/2018/07/05/meanings-effect-size/">Pierre Dragicevic</a>; a more formal discussion by <a href="https://www.floppybunny.org/robin/web/virtualclassroom/stats/basics/articles/effect_size/effect_size_baguley_2009.pdf">Thom Baguley</a>; and some very interesting work on alternative conceptualizations by <a href="https://doi.org/10.1002/jrsm.1130">Tony Ades and colleagues</a>. I can promise, dear reader, that the present blog post will not be nearly as cogent as these contributions—this is more about getting my own thoughts straight than making any recommendations—and so <em>caveat lector</em> applies.↩︎</p></li>
<li id="fn2"><p>I would <em>love</em> to be corrected on both of these points. Please drop a comment or email me with suggested reading.↩︎</p></li>
<li id="fn3"><p>When the standardizing variance is calculated using measurements from only one condition (i.e., the pre-test in a repeated measures design), this version of <img src="https://latex.codecogs.com/png.latex?d"> corresponds to <code>measure = "SMCR"</code>, the “standardized mean change using raw score standardization” in <code>metafor::escalc</code>.↩︎</p></li>
<li id="fn4"><p>This version of <img src="https://latex.codecogs.com/png.latex?d"> corresponds to <code>measure = "SMCC"</code>, the “standardized mean change using change score standardization” in <code>metafor::escalc</code>.↩︎</p></li>
<li id="fn5"><p>And of course, these two models are not the only alternatives—one could look at intermediate scenarios where <img src="https://latex.codecogs.com/png.latex?%5Crho"> and <img src="https://latex.codecogs.com/png.latex?%5Cphi"> are more or less strongly correlated with the true score effect sizes.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2023,
  author = {Pustejovsky, James E.},
  title = {Cohen’s \$d\_z\$ Makes Me Dizzy When Considering Measurement
    Error},
  date = {2023-02-17},
  url = {https://jepusto.com/posts/dizzy-for-d-z},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2023" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2023. <span>“Cohen’s $d_z$ Makes Me Dizzy When
Considering Measurement Error.”</span> February 17, 2023. <a href="https://jepusto.com/posts/dizzy-for-d-z">https://jepusto.com/posts/dizzy-for-d-z</a>.
</div></div></section></div> ]]></description>
  <category>effect size</category>
  <category>standardized mean difference</category>
  <category>design-comparable SMD</category>
  <category>measurement-error</category>
  <guid>https://jepusto.com/posts/dizzy-for-d-z/</guid>
  <pubDate>Fri, 17 Feb 2023 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Corrigendum to Pustejovsky and Tipton (2018), redux</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2-redux/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D%0A"> <strong>UPDATE, March 8, 2023: The correction to our paper has now been published at <em>Journal of Business and Economic Statistics</em>. It is available at</strong> https://doi.org/10.1080/07350015.2023.2174123.</p>
<p>In my <a href="../..\publication/rve-in-fixed-effects-models/">2018 paper with Beth Tipton</a>, published in the <em>Journal of Business and Economic Statistics</em>, we considered how to do cluster-robust variance estimation in fixed effects models estimated by weighted (or unweighted) least squares. As explained in <a href="../..\pusto-tipton-2018-theorem-2/">my previous post</a>, we were recently alerted that Theorem 2 in the paper is incorrect as stated. It turns out, the conditions in the original version of the theorem are too general. A more limited version of the Theorem does actually hold, but only for models estimated using ordinary (unweighted) least squares, under a working model that assumes independent, homoskedastic errors. In this post, I’ll give the revised theorem, following the notation and setup of <a href="../..\pusto-tipton-2018-theorem-2/">the previous post</a> (so better read that first, or what follows won’t make much sense!).</p>
<section id="theorem-2-revised" class="level3">
<h3 class="anchored" data-anchor-id="theorem-2-revised">Theorem 2, revised</h3>
<p>Consider the model <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7By%7D_i%20=%20%5Cbm%7BR%7D_i%20%5Cbs%5Cbeta%20+%20%5Cbm%7BS%7D_i%20%5Cbs%5Cgamma%20+%20%5Cbm%7BT%7D_i%20%5Cbs%5Cmu%20+%20%5Cbs%5Cepsilon_i,%20(%5C#eq:regression)%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7By%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%201"> vector of responses for cluster <img src="https://latex.codecogs.com/png.latex?i">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BR%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20r"> matrix of focal predictors, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BS%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20s"> matrix of additional covariates that vary across multiple clusters, and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20t"> matrix encoding cluster-specific fixed effects, all for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m">. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BU%7D_i%20=%20%5Cleft%5B%20%5Cbm%7BR%7D_i%20%5C%20%5Cbm%7BS%7D_i%20%5Cright%5D"> be the set of predictors that vary across clusters and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D_i%20=%20%5Cleft%5B%20%5Cbm%7BR%7D_i%20%5C%20%5Cbm%7BS%7D_i%20%5C%20%5Cbm%7BT%7D_i%20%5Cright%5D"> be the full set of predictors. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM%7D_%7B%5Cbm%7BT%7D%7D%5Cbm%7BT%7D_i'%5Cright)%20%5Cbm%7BU%7D_i"> be an absorbed version of the focal predictors and the covariates. The cluster-robust variance estimator for the coefficients of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BU%7D_i"> is <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BV%7D%5E%7BCR2%7D%20=%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D%20%5Cleft(%5Csum_%7Bi=1%7D%5Em%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cbm%7BW%7D_i%20%5Cbm%7BA%7D_i%20%5Cbm%7Be%7D_i%20%5Cbm%7Be%7D_i'%20%5Cbm%7BA%7D_i%20%5Cbm%7BW%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20%5Cright)%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D,%0A(#eq:CRVE)%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_1,...,%5Cbm%7BA%7D_m"> are the CR2 adjustment matrices.</p>
<p>If we assume a working model in which <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPsi_i%20=%20%5Csigma%5E2%20%5Cbm%7BI%7D_i"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m"> and estimate the model by ordinary least squares, then the CR2 adjustment matrices have a fairly simple form: <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BA%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D_i%20-%20%5Cbm%7BX%7D_i%20%5Cbm%7BM_X%7D%20%5Cbm%7BX%7D_i'%5Cright)%5E%7B+1/2%7D,%0A(#eq:A-matrix)%0A"> where <img src="https://latex.codecogs.com/png.latex?B%5E%7B+1/2%7D"> is the symmetric square root of the Moore-Penrose inverse of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D">. However, this form is computationally expensive because it involves the full set of predictors, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D_i">, including the cluster-specific fixed effects <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i">. If the model is estimated after absorbing the cluster-specific fixed effects, then it would be convenient to use the adjustment matrices based on the absorbed predictors only, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D_i%20-%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20%5Cbm%7BM_%5Cddot%7BU%7D%7D%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%5Cright)%5E%7B+1/2%7D.%0A(#eq:A-tilde)%0A"> The original version of Theorem 2 asserted that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i%20=%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i">, which is not actually the case. However, for ordinary least squares with the independent, homoskedastic working model, we can show that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20=%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i">. Thus, it doesn’t matter whether we use <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> or <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i"> to calculate the cluster-robust variance estimator. We’ll get the same result either way, but <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i"> is bit easier to compute.</p>
<p>Here’s a formal statement of Theorem 2:</p>
<blockquote class="blockquote">
<p>Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BL%7D_i%20=%20%5Cleft(%5Cbm%7B%5Cddot%7BU%7D%7D'%5Cbm%7B%5Cddot%7BU%7D%7D%20-%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%5Cbm%7B%5Cddot%7BU%7D%7D_i%5Cright)"> and assume that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BL%7D_1,...,%5Cbm%7BL%7D_m"> have full rank <img src="https://latex.codecogs.com/png.latex?r%20+%20s">. If <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BW%7D_i%20=%20%5Cbm%7BI%7D_i"> and <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi_i%20=%20%5Cbm%7BI%7D_i"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m">, then <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20=%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i">, where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%7B%5Cbm%7BA%7D%7D_i"> are as defined in @ref(eq:A-matrix) and @ref(eq:A-tilde), respectively.</p>
</blockquote>
</section>
<section id="proof" class="level3">
<h3 class="anchored" data-anchor-id="proof">Proof</h3>
<p>We can prove this revised Theorem 2 by showing how <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> can be constructed in terms of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i"> and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i">. First, because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i'%5Cbm%7BT%7D_k%20=%20%5Cbm%7B0%7D"> for any <img src="https://latex.codecogs.com/png.latex?i%20%5Cneq%20k">, it follows that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'"> is idempotent, i.e., <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'%20=%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'.%0A"></p>
<p>Next, denote the thin QR decomposition of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D_i"> as <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BQ%7D_i%20%5Cbm%7BR%7D_i">, where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BQ%7D_i"> is semi-orthogonal <img src="https://latex.codecogs.com/png.latex?(%5Cbm%7BQ%7D_i'%5Cbm%7BQ%7D_i%20=%20%5Cbm%7BI%7D)"> and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BR%7D_i"> has the same rank as <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D_i">. Next, let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BB%7D%7D_i%20=%20%5Cbm%7BI%7D_i%20-%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20%5Cbm%7BM_%5Cddot%7BU%7D%7D%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'"> and observe that this can be written as <img src="https://latex.codecogs.com/png.latex?%0A%5Ctilde%7B%5Cbm%7BB%7D%7D_i%20=%20%5Cbm%7BI%7D_i%20-%20%5Cbm%7BQ%7D_i%20%5Cbm%7BQ%7D_i'%20+%20%5Cbm%7BQ%7D_i%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BR%7D_i%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D%20%5Cbm%7BR%7D_i'%5Cright)%5Cbm%7BQ%7D_i'.%0A"> It can then be seen that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Ctilde%7B%5Cbm%7BB%7D%7D_i%5E%7B+1/2%7D%20=%20%5Cbm%7BI%7D_i%20-%20%5Cbm%7BQ%7D_i%20%5Cbm%7BQ%7D_i'%20+%20%5Cbm%7BQ%7D_i%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BR%7D_i%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D%20%5Cbm%7BR%7D_i'%5Cright)%5E%7B+1/2%7D%20%5Cbm%7BQ%7D_i'.%0A"> It follows that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7BT%7D_i%20=%20%5Cbm%7BT%7D_i"> because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BQ%7D_i'%5Cbm%7BT%7D_i%20=%20%5Cbm%7B0%7D">. Further, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BB%7D%7D_i%20%5Cbm%7BT%7D_i%20=%20%5Cbm%7BT%7D_i"> as well.</p>
<p>Now, let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D_i%20-%20%5Cbm%7BX%7D_i%20%5Cbm%7BM_X%7D%20%5Cbm%7BX%7D_i'%5Cright)"> and observe that this can be written as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BB%7D_i%20=%20%5Cbm%7BI%7D_i%20-%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20%5Cbm%7BM_%7B%5Cddot%7BU%7D%7D%7D%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%20=%20%5Cbm%7B%5Ctilde%7BB%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%0A"> because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D_i'%5Cbm%7BT%7D_i%20=%20%5Cbm%7B0%7D">.</p>
<p>We then construct the full adjustment matrix <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BA%7D_i%20=%20%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'.%0A(#eq:A-constructed)%0A"> Showing that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i%20%5Cbm%7BA%7D_i%20%5Cbm%7BB%7D_i%20%5Cbm%7BA%7D_i%20=%20%5Cbm%7BB%7D_i"> will suffice to verify that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> is the symmetric square root of the Moore-Penrose inverse of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i">. Because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'"> is idempotent, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BB%7D%7D_i%20%5Cbm%7BT%7D_i%20=%20%5Cbm%7BT%7D_i">, and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7BT%7D_i%20=%20%5Cbm%7BT%7D_i">, we have <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cbm%7BB%7D_i%20%5Cbm%7BA%7D_i%20%5Cbm%7BB%7D_i%20%5Cbm%7BA%7D_i%20&amp;=%20%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5Cleft(%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5Cleft(%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5C%5C%0A&amp;=%20%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5C%5C%0A&amp;=%20%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%5Ctilde%7B%5Cbm%7BA%7D%7D_i%5Ctilde%7B%5Cbm%7BB%7D%7D_i%5Ctilde%7B%5Cbm%7BA%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5C%5C%0A&amp;=%20%5Cleft(%5Ctilde%7B%5Cbm%7BB%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%5Cbm%7BT%7D_i'%5Cright)%20%5C%5C%0A&amp;=%20%5Cbm%7BB%7D_i.%0A%5Cend%7Baligned%7D%0A"></p>
<p>From the representation of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i"> in @ref(eq:A-constructed), it is clear that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20=%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20-%20%5Cbm%7BT%7D_i%20%5Cbm%7BM_T%7D%20%5Cbm%7BT%7D_i'%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20=%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20%5Cbm%7B%5Cddot%7BU%7D%7D_i">.</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2022,
  author = {Pustejovsky, James E.},
  title = {Corrigendum to {Pustejovsky} and {Tipton} (2018), Redux},
  date = {2022-11-07},
  url = {https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2-redux},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2022" class="csl-entry quarto-appendix-citeas">
Pustejovsky, J. E. (2022, November 7). <em>Corrigendum to Pustejovsky
and Tipton (2018), redux</em>. <a href="https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2-redux">https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2-redux</a>
</div></div></section></div> ]]></description>
  <category>robust variance estimation</category>
  <category>econometrics</category>
  <category>matrix algebra</category>
  <guid>https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2-redux/</guid>
  <pubDate>Mon, 07 Nov 2022 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Corrigendum to Pustejovsky and Tipton (2018)</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A%5Cdef%5Cbm%7B%5Cmathbf%7D%0A%5Cdef%5Cbs%7B%5Cboldsymbol%7D%0A"> In my <a href="../..\publication/rve-in-fixed-effects-models/">2018 paper with Beth Tipton</a>, published in the <em>Journal of Business and Economic Statistics</em>, we considered how to do cluster-robust variance estimation in fixed effects models estimated by weighted (or unweighted) least squares. A careful reader, <a href="https://eeecon.uibk.ac.at/~pfaffermayr/">Dr.&nbsp;Michael Pfaffermayr</a>, recently alerted us to a problem with Theorem 2 in the paper, which concerns a computational short cut for a certain cluster-robust variance estimator in models with cluster-specific fixed effects. The theorem is incorrect as stated, and we are currently working on issuing a correction for the published version of the paper. In the interim, this post details the problem with Theorem 2. I’ll first review the CR2 variance estimator, then describe the assertion of the theorem, and then provide a numerical counter-example demonstrating that the assertion is not correct as stated.</p>
<section id="a-fixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="a-fixed-effects-model">A fixed effects model</h3>
<p>For data that can be grouped into <img src="https://latex.codecogs.com/png.latex?m"> clusters of observations, we considered the model <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7By%7D_i%20=%20%5Cbm%7BR%7D_i%20%5Cbs%5Cbeta%20+%20%5Cbm%7BS%7D_i%20%5Cbs%5Cgamma%20+%20%5Cbm%7BT%7D_i%20%5Cbs%5Cmu%20+%20%5Cbs%5Cepsilon_i,%20(%5C#eq:regression)%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7By%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%201"> vector of responses for cluster <img src="https://latex.codecogs.com/png.latex?i">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BR%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20r"> matrix of focal predictors, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BS%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20s"> matrix of additional covariates that vary across multiple clusters, and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_i"> is an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20t"> matrix encoding cluster-specific fixed effects, all for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m">. The cluster-specific fixed effects satisfy <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_h%20%5Cbm%7BT%7D_i'%20=%20%5Cbm%7B0%7D"> for <img src="https://latex.codecogs.com/png.latex?h%20%5Cneq%20i">. Interest centers on inference for the coefficients on the focal predictors <img src="https://latex.codecogs.com/png.latex?%5Cbs%5Cbeta">.</p>
<p>We considered estimation of Model @ref(eq:regression) by weighted least squares (WLS), possibly under a working model for the distribution of <img src="https://latex.codecogs.com/png.latex?%5Cbs%5Cepsilon_i">. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BW%7D_1,...,%5Cbm%7BW%7D_m"> be a set of symmetric weight matrices used for WLS estimation. Sometimes, these weight matrices may be diagonal, consisting of sampling weights for each observation. Other times, the weight matrices may involve off-diagonal terms as well. Consider a working model <img src="https://latex.codecogs.com/png.latex?%5CVar%5Cleft(%5Cbs%5Cepsilon_i%20%7C%20%5Cbm%7BR%7D_i,%20%5Cbm%7BS%7D_i,%20%5Cbm%7BT%7D_i%5Cright)%20=%20%5Csigma%5E2%20%5Cbs%5CPhi_i"> where <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi_i"> is a symmetric <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20n_i"> matrix that may be a function of a low-dimensional, estimable parameter. Based on this working model, the weight matrices might be taken as <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BW%7D_i%20=%20%5Cbs%7B%5Chat%5CPhi%7D_i%5E%7B-1%7D">, where <img src="https://latex.codecogs.com/png.latex?%5Cbs%7B%5Chat%5CPhi%7D_i"> is an estimate of <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi_i">.</p>
</section>
<section id="the-cr2-variance-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-cr2-variance-estimator">The CR2 variance estimator</h3>
<p>In the paper, we provide a generalization of the bias-reduced linearization estimator introduced by <span class="citation" data-cites="McCaffrey2001generalizations">McCaffrey et al. (2001)</span> and <span class="citation" data-cites="Bell2002bias">Bell &amp; McCaffrey (2002)</span> that can be applied to Model @ref(eq:regression). The variance estimator is effectively a generalization of the HC2 correction for heteroskedasticity-robust standard errors, but that works for models with within-cluster dependence and cluster-specific fixed effects, and so we refer to it the “CR2” estimator.</p>
<p>In order to define the CR2 variance estimator and explain the issue with Theorem 2, I’ll need to lay down a bit more notation. Let <img src="https://latex.codecogs.com/png.latex?N%20=%20%5Csum_%7Bi=1%7D%5Em%20n_i"> be the total sample size. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BU%7D_i%20=%20%5Cleft%5B%20%5Cbm%7BR%7D_i%20%5C%20%5Cbm%7BS%7D_i%20%5Cright%5D"> be the set of predictors that vary across clusters and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D_i%20=%20%5Cleft%5B%20%5Cbm%7BR%7D_i%20%5C%20%5Cbm%7BS%7D_i%20%5C%20%5Cbm%7BT%7D_i%20%5Cright%5D"> be the full set of predictors. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BR%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BS%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BU%7D">, and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D"> denote the stacked versions of the cluster-specific matrices (i.e., <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BR%7D%20=%20%5Cleft%5B%5Cbm%7BR%7D_1'%20%5C%20%5Cbm%7BR%7D_2'%20%5C%20%5Ccdots%20%5C%20%5Cbm%7BR%7D_m'%5Cright%5D'">, etc.). Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BW%7D%20=%20%5Cbigoplus_%7Bi=1%7D%5Em%20%5Cbm%7BW%7D_i"> and <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi%20=%20%5Cbigoplus_%7Bi=1%7D%5Em%20%5Cbs%5CPhi_i">. For a generic matrix <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BZ%7D">, let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BM%7D_%7BZ%7D%20=%20%5Cleft(%5Cbm%7BZ%7D'%5Cbm%7BW%7D%5Cbm%7BZ%7D%5Cright)%5E%7B-1%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BH%7D_%7B%5Cbm%7BZ%7D%7D%20=%20%5Cbm%7BZ%7D%20%5Cbm%7BM%7D_%7B%5Cbm%7BZ%7D%7D%5Cbm%7BZ%7D'%5Cbm%7BW%7D">. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BC%7D_i"> be the <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20N"> matrix that selects the rows of cluster <img src="https://latex.codecogs.com/png.latex?i"> from the full set of observations, such that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D_i%20=%20%5Cbm%7BC%7D_i%20%5Cbm%7BX%7D">. These operators provide an easy way to define absorbed versions of the predictors. Specifically, let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BS%7D%7D%20=%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7BT%7D%7D%5Cright)%20%5Cbm%7BS%7D"> be the covariates after absorbing (i.e., partialling out) the cluster-specific effects, let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D%20=%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7BT%7D%7D%5Cright)%20%5Cbm%7BU%7D"> be an absorbed version of the focal predictors and the covariates, and let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BR%7D%7D%20=%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7B%5Cddot%7BS%7D%7D%7D%5Cright)%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7BT%7D%7D%5Cright)%20%5Cbm%7BR%7D"> be the focal predictors after absorbing the covariates and the cluster-specific fixed effects.</p>
<p>With this notation established, the CR2 variance estimator has the form <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BV%7D%5E%7BCR2%7D%20=%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BR%7D%7D%7D%20%5Cleft(%5Csum_%7Bi=1%7D%5Em%20%5Cbm%7B%5Cddot%7BR%7D%7D_i'%20%5Cbm%7BW%7D_i%20%5Cbm%7BA%7D_i%20%5Cbm%7Be%7D_i%20%5Cbm%7Be%7D_i'%20%5Cbm%7BA%7D_i%20%5Cbm%7BW%7D_i%20%5Cbm%7B%5Cddot%7BR%7D%7D_i%20%5Cright)%20%5Cbm%7BM%7D_%7B%5Cbm%7B%5Cddot%7BR%7D%7D%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BR%7D%7D_i%20=%20%5Cbm%7BC%7D_i%20%5Cbm%7B%5Cddot%7BR%7D%7D"> is the cluster-specific matrix of absorbed focal predictors, <img src="https://latex.codecogs.com/png.latex?%5Cbm%7Be%7D_i"> is the vector of weighted least squares residuals from cluster <img src="https://latex.codecogs.com/png.latex?i">, and <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_1,...,%5Cbm%7BA%7D_m"> are a set of adjustment matrices that correct the bias of the residual cross-products. The adjustment matrices are calculated as follows. Let <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BD%7D_i"> be the upper-right Cholesky factorization of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5CPhi%7D_i"> and define the matrices <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BB%7D_i%20=%20%5Cbm%7BD%7D_i%20%5Cbm%7BC%7D_i%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7BX%7D%7D%5Cright)%20%5Cbs%5CPhi%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7BX%7D%7D%5Cright)'%5Cbm%7BC%7D_i'%20%5Cbm%7BD%7D_i'%0A(#eq:B-matrix)%0A"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m">. The adjustment matrices are then calculated as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BA%7D_i%20=%20%5Cbm%7BD%7D_i'%20%5Cbm%7BB%7D_i%5E%7B+1/2%7D%20%5Cbm%7BD%7D_i,%0A(#eq:A-matrix)%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i%5E%7B+1/2%7D"> is the symmetric square root of the Moore-Penrose inverse of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i">. Theorem 1 in the paper shows that, if the working model <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi"> is correctly specified and some conditions on the rank of <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BU%7D"> are satisfied, then the CR2 estimator is exactly unbiased for the sampling variance of the weighted least squares estimator of <img src="https://latex.codecogs.com/png.latex?%5Cbs%5Cbeta">. Across multiple simulation studies, it’s been observed that the CR2 estimator also works well and outperforms alternative sandwich estimators even when the working model is not correctly specified.</p>
</section>
<section id="theorem-2" class="level3">
<h3 class="anchored" data-anchor-id="theorem-2">Theorem 2</h3>
<p>The adjustment matrices given in @ref(eq:A-matrix) can be expensive to compute directly because the <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i"> matrices involve computing a “residualized” version of the <img src="https://latex.codecogs.com/png.latex?N%20%5Ctimes%20N"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi"> involving the full set of predictors <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D">—including the cluster-specific fixed effects <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BT%7D_1,...,%5Cbm%7BT%7D_m">. Theorem 2 considered whether one can take a computational short cut by omitting the cluster-specific fixed effects from the calculation of the <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BB%7D_i"> matrices. Specifically, define the modified matrices <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7B%5Ctilde%7BB%7D%7D_i%20=%20%5Cbm%7BD%7D_i%20%5Cbm%7BC%7D_i%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D%5Cright)%20%5Cbs%5CPhi%20%5Cleft(%5Cbm%7BI%7D%20-%20%5Cbm%7BH%7D_%7B%5Cbm%7B%5Cddot%7BU%7D%7D%7D%5Cright)'%5Cbm%7BC%7D_i'%20%5Cbm%7BD%7D_i'%0A(#eq:B-modified)%0A"> and <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cbm%7BD%7D_i'%20%5Cbm%7B%5Ctilde%7BB%7D%7D_i%5E%7B+1/2%7D%20%5Cbm%7BD%7D_i,%0A(#eq:A-modified).%0A"> Theorem 2 claims that if the weight matrices are inverse of the working model, such that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BW%7D_i%20=%20%5Cbs%5CPhi_i%5E%7B-1%7D"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,m">, then <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BB%7D%7D_i%5E%7B+1/2%7D%20=%20%5Cbm%7BB%7D_i%5E%7B+1/2%7D"> and hence <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cbm%7BA%7D_i">. The implication is that the cluster-specific fixed effects can be ignored when calculating the adjustment matrices. However, the claimed equivalence does not actually hold.</p>
<p>Here is a simple numerical example that contradicts the assertion of Theorem 2. I first create a predictor matrix consisting of 4 clusters, a single focal predictor, and cluster-specific fixed effects.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20220926</span>)</span>
<span id="cb1-2">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>                                             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of clusters</span></span>
<span id="cb1-3">ni <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(m, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)                            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cluster sizes</span></span>
<span id="cb1-4">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(ni)                                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># total sample size</span></span>
<span id="cb1-5">id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(LETTERS[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>m], ni))                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cluster ID</span></span>
<span id="cb1-6">R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N)                                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># focal predictor</span></span>
<span id="cb1-7">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(R, id)                           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create raw data frame</span></span>
<span id="cb1-8">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">model.matrix</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> R <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># full predictor matrix</span></span>
<span id="cb1-9">Ui <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tapply</span>(R, id, \(x) x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(x))              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># absorbed version of R</span></span>
<span id="cb1-10">U <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unsplit</span>(Ui, id)</span></code></pre></div>
</details>
</div>
<p>Consider a model estimated by ordinary least squares, where the assumed working model is homoskedastic and independent errors, so <img src="https://latex.codecogs.com/png.latex?%5Cbs%5CPhi_i%20=%20%5Cbm%7BI%7D_i">, an <img src="https://latex.codecogs.com/png.latex?n_i%20%5Ctimes%20n_i"> identity matrix (with no parameters to estimate). In this case, the adjustment matrices simplify considerably, to <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7BA%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D_i%20-%20%5Cbm%7BX%7D_i%20%5Cbm%7BM%7D_%7BX%7D%20%5Cbm%7BX%7D_i'%20%5Cright)%5E%7B+1/2%7D%20%5Cqquad%20%5Ctext%7Band%7D%20%5Cqquad%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cleft(%5Cbm%7BI%7D_i%20-%20%5Cbm%7B%5Cddot%7BU%7D%7D_i%20%5Cbm%7BM%7D_%7B%5Cddot%7BU%7D%7D%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cright)%5E%7B+1/2%7D.%0A"> I calculate these directly as follows:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">matrix_power <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x, p) {</span>
<span id="cb2-2">  eig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eigen</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">symmetric =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-3">  val_p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(eig, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(values <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, values<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(eig, vectors <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (val_p <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(vectors)))</span>
<span id="cb2-5">}</span>
<span id="cb2-6"></span>
<span id="cb2-7">MX <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossprod</span>(X))</span>
<span id="cb2-8">B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">by</span>(X, id, as.matrix) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(\(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> MX <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x))</span>
<span id="cb2-11">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(B, matrix_power, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-12">  </span>
<span id="cb2-13">MU <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crossprod</span>(U)</span>
<span id="cb2-14">Btilde <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(Ui, \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> MU <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x))</span>
<span id="cb2-15">Atilde <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(Btilde, matrix_power, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
</div>
<p>Here are the adjustment matrices based on the full predictor matrix <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BX%7D">:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$A
       [,1]   [,2]   [,3]   [,4]   [,5]
[1,]  0.853 -0.198 -0.207 -0.191 -0.257
[2,] -0.198  0.800 -0.200 -0.200 -0.202
[3,] -0.207 -0.200  0.801 -0.201 -0.192
[4,] -0.191 -0.200 -0.201  0.802 -0.210
[5,] -0.257 -0.202 -0.192 -0.210  0.860

$B
       [,1]   [,2]   [,3]
[1,]  0.668 -0.338 -0.330
[2,] -0.338  0.683 -0.345
[3,] -0.330 -0.345  0.675

$C
       [,1]   [,2]   [,3]   [,4]   [,5]   [,6]
[1,]  0.873 -0.206 -0.163 -0.105 -0.233 -0.166
[2,] -0.206  0.873 -0.171 -0.229 -0.100 -0.167
[3,] -0.163 -0.171  0.834 -0.160 -0.173 -0.167
[4,] -0.105 -0.229 -0.160  0.931 -0.271 -0.166
[5,] -0.233 -0.100 -0.173 -0.271  0.946 -0.168
[6,] -0.166 -0.167 -0.167 -0.166 -0.168  0.833

$D
       [,1]   [,2]   [,3]
[1,]  0.797 -0.342 -0.455
[2,] -0.342  0.667 -0.325
[3,] -0.455 -0.325  0.780</code></pre>
</div>
</div>
<p>Compare the above with the adjustment matrices based on the absorbed predictors only:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(Atilde, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$A
         [,1]      [,2]     [,3]      [,4]     [,5]
[1,]  1.05313  0.001860 -0.00742  0.008995 -0.05657
[2,]  0.00186  1.000065 -0.00026  0.000315 -0.00198
[3,] -0.00742 -0.000260  1.00104 -0.001257  0.00790
[4,]  0.00900  0.000315 -0.00126  1.001523 -0.00958
[5,] -0.05657 -0.001980  0.00790 -0.009576  1.06022

$B
         [,1]     [,2]     [,3]
[1,]  1.00139 -0.00478  0.00339
[2,] -0.00478  1.01642 -0.01163
[3,]  0.00339 -0.01163  1.00824

$C
          [,1]      [,2]      [,3]      [,4]     [,5]      [,6]
[1,]  1.039180 -0.039378  4.00e-03  0.061921 -0.06632  5.94e-04
[2,] -0.039378  1.039577 -4.02e-03 -0.062234  0.06665 -5.97e-04
[3,]  0.003999 -0.004019  1.00e+00  0.006320 -0.00677  6.07e-05
[4,]  0.061921 -0.062234  6.32e-03  1.097861 -0.10481  9.39e-04
[5,] -0.066317  0.066651 -6.77e-03 -0.104808  1.11225 -1.01e-03
[6,]  0.000594 -0.000597  6.07e-05  0.000939 -0.00101  1.00e+00

$D
         [,1]     [,2]    [,3]
[1,]  1.13078 -0.00914 -0.1216
[2,] -0.00914  1.00064  0.0085
[3,] -0.12165  0.00850  1.1131</code></pre>
</div>
</div>
<p>The matrices differ:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all.equal</span>(A, Atilde)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Component \"A\": Mean relative difference: 0.6073885"
[2] "Component \"B\": Mean relative difference: 0.7403564"
[3] "Component \"C\": Mean relative difference: 0.5671847"
[4] "Component \"D\": Mean relative difference: 0.6682793"</code></pre>
</div>
</div>
<p>Thus, Theorem 2 is incorrect as stated. (I have yet to identify the mis-step in the proof as given in the supplementary materials of the paper.)</p>
</section>
<section id="further-thoughts" class="level3">
<h3 class="anchored" data-anchor-id="further-thoughts">Further thoughts</h3>
<p>For this particular model specification, it is interesting to note that <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cbm%7BA%7D_i%20+%20%5Cbm%7BT%7D_i%20%5Cbm%7BM%7D_%7B%5Cbm%7BT%7D%7D%20%5Cbm%7BT%7D_i'">. Because <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cbm%7BT%7D_i%20=%20%5Cbm%7B0%7D">, it follows that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cbm%7B%5Ctilde%7BA%7D%7D_i%20=%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cleft(%5Cbm%7BA%7D_i%20+%20%5Cbm%7BT%7D_i%20%5Cbm%7BM%7D_%7B%5Cbm%7BT%7D%7D%20%5Cbm%7BT%7D_i'%20%5Cright)%20=%20%5Cbm%7B%5Cddot%7BU%7D%7D_i'%20%5Cbm%7BA%7D_i.%0A"> This holds in the numerical example:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">UiAtilde <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapply</span>(\(u, a) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(u) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">u =</span> Ui, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> Atilde, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SIMPLIFY =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb9-2">UiA <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapply</span>(\(u, a) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(u) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">u =</span> Ui, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> A, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SIMPLIFY =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all.equal</span>(UiAtilde, UiA)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Thus, although the exact statement of Theorem 2 is incorrect, the substantive implication actually still holds. For this particular example, computing the CR2 variance estimator using the short-cut adjustment matrices <img src="https://latex.codecogs.com/png.latex?%5Cbm%7B%5Ctilde%7BA%7D%7D_1,...,%5Cbm%7B%5Ctilde%7BA%7D%7D_m"> is equivalent to computing the CR2 variance estimator using the full model adjustment matrices <img src="https://latex.codecogs.com/png.latex?%5Cbm%7BA%7D_1,...,%5Cbm%7BA%7D_m">. However, I have not yet been able to work out the general conditions under which this equivalence holds. It may require stricter conditions than those assumed in Theorem 2.</p>
</section>
<section id="references" class="level3">



<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2">
<div id="ref-Bell2002bias" class="csl-entry">
Bell, R. M., &amp; McCaffrey, D. F. (2002). <span class="nocase">Bias reduction in standard errors for linear regression with multi-stage samples</span>. <em>Survey Methodology</em>, <em>28</em>(2), 169–181.
</div>
<div id="ref-McCaffrey2001generalizations" class="csl-entry">
McCaffrey, D. F., Bell, R. M., &amp; Botts, C. H. (2001). <span class="nocase">Generalizations of biased reduced linearization</span>. <em>Proceedings of the Annual Meeting of the American Statistical Association</em>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2022,
  author = {Pustejovsky, James E.},
  title = {Corrigendum to {Pustejovsky} and {Tipton} (2018)},
  date = {2022-09-28},
  url = {https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2022" class="csl-entry quarto-appendix-citeas">
Pustejovsky, J. E. (2022, September 28). <em>Corrigendum to Pustejovsky
and Tipton (2018)</em>. <a href="https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2">https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2</a>
</div></div></section></div> ]]></description>
  <category>robust variance estimation</category>
  <category>econometrics</category>
  <category>matrix algebra</category>
  <guid>https://jepusto.com/posts/Pusto-Tipton-2018-Theorem-2/</guid>
  <pubDate>Wed, 28 Sep 2022 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Variance component estimates in meta-analysis with mis-specified sampling correlation</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/variance-components-with-misspecified-correlation/</link>
  <description><![CDATA[ 





<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdef%5CPr%7B%7B%5Ctext%7BPr%7D%7D%7D%0A%5Cdef%5CE%7B%7B%5Ctext%7BE%7D%7D%7D%0A%5Cdef%5CVar%7B%7B%5Ctext%7BVar%7D%7D%7D%0A%5Cdef%5CCov%7B%7B%5Ctext%7BCov%7D%7D%7D%0A"></p>
<p>In a recent paper with Beth Tipton, we proposed <a href="../..\publication/rve-meta-analysis-expanding-the-range/">new working models</a> for meta-analyses involving dependent effect sizes. The central idea of our approach is to use a working model that captures the main features of the effect size data, such as by allowing for both between- and within-study heterogeneity in the true effect sizes (rather than only between-study heterogeneity). Doing so will lead to more precise estimates of overall average effects or, in models that include predictor variables, more precise estimates of meta-regression coefficients. Further, one can combine this working model with robust variance estimation methods to provide protection against the possibility that some of the model’s assumptions could be mis-specified.</p>
<p>In order to estimate these new working models, the analyst must first make some assumption about the degree of correlation between effect size estimates that come from the same sample. In typical applications, it can be difficult to obtain good empirical information about the correlation between effect size estimates, and so it is common to impose some simplifying assumptions and use rough guesses about the degree of correlation. There’s a sense that this might not matter much—particularly because robust variance estimation should protect the inferences if the assumptions about the correlation are wrong. However, I’m still curious about the extent to which these assumptions about the correlation structure matter for anything.</p>
<p>There’s a few reasons to wonder about how much the correlation matters. One is that the analyst might actually care about the variance component estimates from the working model, if they’re substantively interested in the extent of heterogeneity or if they’re trying to make predictions about the distribution of effect sizes that could be expected in a new study. Compared to earlier working models, the variance component estimates of the models that we proposed in the paper seem to be relatively more sensitive to the assumed correlation. Second, one alternative analytic strategy that’s been proposed (and applied) for meta-analysis of dependent effect sizes is to use a multi-level meta-analysis (MLMA) model. The MLMA is a special case of the correlated-and-hierarchical effects model that we described in the paper, the main difference being that MLMA <em>ignores</em> any correlations between effect size estimates (at the level of the sampling errors), or equivalently, assumes that the correlations are all zero. Thus, MLMA is one specific way that this correlation assumption might be mis-specified. There’s some simulation evidence that inferences based on MLMA may be robust (even without using robust variance estimation), but it’s not clear how general this robustness property might be.</p>
<p>In this post, I’m going to look at the implications of using a mis-specified assumption about the sampling correlation for the variance components in the correlated-and-hierarchical effects working model. As in <a href="../..\weighting-in-multivariate-meta-analysis/">my previous post on weights in multivariate meta-analysis</a>, I’m going to mostly limit consideration to the simple (but important!) case of an intercept-only model, without any further predictors of effect size, to see what can be learned about how the variance components can go wrong.</p>
<section id="the-correlated-and-hierarchical-effects-che-model" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> The correlated-and-hierarchical effects (CHE) model</h1>
<p>Consider a meta-analytic dataset with effect size estimates <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D">, where <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,k_j"> indexes effect size estimates within study <img src="https://latex.codecogs.com/png.latex?j"> and <img src="https://latex.codecogs.com/png.latex?j"> indexes studies, for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,J">. Say that effect size estimate <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> has sampling variance <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_%7Bij%7D">, and there is some sampling correlation between effect sizes <img src="https://latex.codecogs.com/png.latex?h"> and <img src="https://latex.codecogs.com/png.latex?i"> within study <img src="https://latex.codecogs.com/png.latex?j">, denoted <img src="https://latex.codecogs.com/png.latex?%5Cphi_%7Bhij%7D">. The correlated-and-hierarchical effects (or CHE) model describes the distribution of effect sizes using random effects to capture between-study heterogeneity (as in the basic random effects model) and within-study heterogeneity in true effect sizes. In hierarchical notation, the model is <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0AT_%7Bij%7D%20&amp;=%20%5Ctheta_j%20+%20%5Cnu_%7Bij%7D%20+%20e_%7Bij%7D%20%5C%5C%0A%5Ctheta_j%20&amp;=%20%5Cmu%20+%20%5Ceta_j%0A%5Cend%7Balign%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?%5CVar(e_%7Bij%7D)%20=%20%5Csigma%5E2_%7Bij%7D">, <img src="https://latex.codecogs.com/png.latex?%5CVar(%5Cnu_%7Bij%7D)%20=%20%5Comega%5E2"> is the within-study variance, and <img src="https://latex.codecogs.com/png.latex?%5CVar(%5Ceta_j)%20=%20%5Ctau%5E2"> is the between-study variance. To simplify things, let us also assume that the effect size estimates from a given study <img src="https://latex.codecogs.com/png.latex?j"> all have equal sampling variance, so <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_%7B1j%7D%20=%20%5Csigma%5E2_%7B2j%7D%20=%20%5Ccdots%20=%20%5Csigma%5E2_%7Bk_jj%7D%20=%20%5Csigma%5E2_j">, and that there is a common correlation between any pair of effect size estimates from the same study, so <img src="https://latex.codecogs.com/png.latex?%5CCov(e_%7Bhj%7D,%20e_%7Bij%7D)%20=%20%5Cphi%20%5Csigma%5E2_j"> for some correlation <img src="https://latex.codecogs.com/png.latex?%5Cphi">.</p>
<p>Typically, the analyst would estimate this working model using restricted maximum likelihood (REML) estimation to obtain estimates of the variance components <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">, after specifying a value of <img src="https://latex.codecogs.com/png.latex?%5Cphi">. With an adequately large sample of studies, the REML estimators should be close-to-unbiased and accurate. But what if the assumed correlation is wrong? Let’s suppose that the analyst estimates (via REML) the CHE working model but uses the assumption that there is a common correlation between effect size estimates of <img src="https://latex.codecogs.com/png.latex?%5Crho">, which is not necessarily equal to the true correlation <img src="https://latex.codecogs.com/png.latex?%5Cphi">. What are the consequences for estimating <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">?</p>
</section>
<section id="mis-specified-reml" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Mis-specified REML</h1>
<p>To figure out what’s going on here, we need to know something about how REML estimators behave under mis-specified models. For starters, I’ll work with a more general case than the CHE model described above. Suppose that we have a vector of multi-variate normal outcomes <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D_j"> for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,J">, explained by a set of covariates <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_j">, and with true variance-covariance matrix <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CPhi_j">: <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BT%7D_j%20%5C%20%5Csim%20%5C%20N%5Cleft(%20%5Cmathbf%7BX%7D_j%20%5Cbeta,%20%5Cboldsymbol%5CPhi_j%20%5Cright)%0A"> However, suppose that we posit a variance structure <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5COmega_j(%5Cboldsymbol%5Ctheta)">, which is a function of a <img src="https://latex.codecogs.com/png.latex?v">-dimensional variance component parameter <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Ctheta">, and where <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CPhi_j"> is not necessarily conformable to <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5COmega_j(%5Cboldsymbol%5Ctheta)">. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D"> denote the full vector of outcomes and the full (stacked) predictor matrix for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,J">, and let <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CPhi"> and <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5COmega"> denote the corresponding block-diagonal variance-covariance matrices.</p>
<p>We estimate <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Ctheta"> by REML, which maximizes the log likelihood <img src="https://latex.codecogs.com/png.latex?%0A2%20l_R(%5Cboldsymbol%5Ctheta)%20=%20c%20-%5Clog%20%5Cleft%7C%5Cboldsymbol%5COmega_j(%5Cboldsymbol%5Ctheta)%5Cright%7C%20-%20%5Clog%20%5Cleft%7C%5Cmathbf%7BX%7D'%20%5Cboldsymbol%5COmega%5E%7B-1%7D_j(%5Cboldsymbol%5Ctheta)%20%5Cmathbf%7BX%7D%5Cright%7C%20-%20%5Cmathbf%7BT%7D'%5Cmathbf%7BQ%7D(%5Cboldsymbol%5Ctheta)%5Cmathbf%7BT%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BQ%7D(%5Cboldsymbol%5Ctheta)%20=%20%5Cboldsymbol%5COmega%5E%7B-1%7D_j(%5Cboldsymbol%5Ctheta)%20-%20%5Cboldsymbol%5COmega%5E%7B-1%7D_j(%5Cboldsymbol%5Ctheta)%20%5Cmathbf%7BX%7D%20%5Cleft(%5Cmathbf%7BX%7D'%20%5Cboldsymbol%5COmega%5E%7B-1%7D_j(%5Cboldsymbol%5Ctheta)%20%5Cmathbf%7BX%7D%5Cright)%5E%7B-1%7D%20%5Cmathbf%7BX%7D'%5Cboldsymbol%5COmega%5E%7B-1%7D_j(%5Cboldsymbol%5Ctheta)">. Equivalently, the REML estimators solve the score equations <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20l_R(%5Cboldsymbol%5Ctheta)%7D%7B%5Cpartial%20%5Ctheta_q%7D%20=%200,%20%5Cqquad%20%5Ctext%7Bfor%7D%20%5Cqquad%20q%20=%201,...,v.%0A"></p>
<p>Under mis-specification, the REML estimators converge (as <img src="https://latex.codecogs.com/png.latex?J"> increases) to the values that minimize the Kullback-Liebler divergence between the posited model and the true data-generating process. For the restricted likelihood, the Kullback-Liebler divergence is given by <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathcal%7BKL%7D(%5Ctheta,%20%5Ctheta_0)%20&amp;=%20%5CE%5Cleft%5Bl_R(%5Cboldsymbol%5CPhi)%20-%20l_R(%5Cboldsymbol%5Ctheta)%5Cright%5D%20%5C%5C%0A&amp;=%20c%20+%20%5Clog%20%5Cleft%7C%20%5Cboldsymbol%5COmega(%5Cboldsymbol%5Ctheta)%20%5Cright%7C%20+%20%5Clog%20%5Cleft%7C%20%5Cmathbf%7BX%7D'%5Cboldsymbol%5COmega%5E%7B-1%7D(%5Cboldsymbol%5Ctheta)%20%5Cmathbf%7BX%7D%20%5Cright%7C%20+%20%5Ctext%7Btr%7D%5Cleft(%5Cmathbf%7BQ%7D(%5Cboldsymbol%5Ctheta)%20%5Cboldsymbol%5CPhi%5Cright),%0A%5Cend%7Baligned%7D%0A"> where the expectation in the first line is taken with respect to the true data-generating process and where <img src="https://latex.codecogs.com/png.latex?c"> (in the second line) is a constant that does not depend on <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Ctheta">.</p>
</section>
<section id="back-to-che" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Back to CHE</h1>
<p>Let me now jump back to the special case of the CHE model for a meta-analysis with no predictors. Let <img src="https://latex.codecogs.com/png.latex?%5Ctau_*%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega_*%5E2"> denote the variance components in the true data-generating process. Let <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega%5E2"> denote the asymptotic limits of the REML estimators under the mis-specified model. In this model, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_j%20=%20%5Cmathbf%7B1%7D_j">, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cboldsymbol%5CPhi_j%20&amp;=%20%5Cleft(%5Ctau_*%5E2%20+%20%5Cphi%20%5Csigma_j%5E2%5Cright)%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20+%20%5Cleft(%5Comega_*%5E2%20+%20(1%20-%20%5Cphi)%20%5Csigma_j%5E2%5Cright)%20%5Cmathbf%7BI%7D_j%20%5C%5C%0A%5Cboldsymbol%5COmega_j%20&amp;=%20%5Cleft(%5Ctilde%5Ctau%5E2%20+%20%5Crho%20%5Csigma_j%5E2%5Cright)%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20+%20%5Cleft(%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%20%5Csigma_j%5E2%5Cright)%20%5Cmathbf%7BI%7D_j%20%5C%5C%0A%5Cboldsymbol%5COmega_j%5E%7B-1%7D%20&amp;=%20%5Cfrac%7B1%7D%7B%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%5Cleft%5B%5Cmathbf%7BI%7D_j%20-%20%5Cfrac%7B%5Ctilde%5Ctau%5E2%20+%20%5Crho%20%5Csigma_j%5E2%7D%7Bk_j%20%5Ctilde%5Ctau%5E2%20+%20k_j%20%5Crho%20%5Csigma_j%5E2%20+%20%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20%5Cright%5D.%0A%5Cend%7Baligned%7D%0A"> Let <img src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%7B%5Ctilde%7Bw%7D_j%20=%20%5Cfrac%7Bk_j%7D%7Bk_j%20%5Ctilde%5Ctau%5E2%20+%20k_j%20%5Crho%20%5Csigma_j%5E2%20+%20%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%7D"> denote the weight assigned to study <img src="https://latex.codecogs.com/png.latex?j"> under the mis-specified model, with the total weight denoted as <img src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%7B%5Ctilde%7BW%7D%20=%20%5Csum_%7Bj=1%7D%5EJ%20%5Ctilde%7Bw%7D_j%7D">. Similarly, let <img src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%7Bw%5E*_j%20=%20%5Cfrac%7Bk_j%7D%7Bk_j%20%5Ctau_*%5E2%20+%20k_j%20%5Cphi%20%5Csigma_j%5E2%20+%20%5Comega_*%5E2%20+%20(1%20-%20%5Cphi)%5Csigma_j%5E2%7D%7D"> denote the weight that <em>should</em> be assigned to study <img src="https://latex.codecogs.com/png.latex?j"> under the true model. Then we have that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctext%7Btr%7D%5Cleft(%5Cmathbf%7BQ%7D%20%5Cboldsymbol%5CPhi%5Cright)%20&amp;=%20%5Ctext%7Btr%7D%5Cleft(%5Cboldsymbol%5COmega%5E%7B-1%7D%20%5Cboldsymbol%5CPhi%5Cright)%20-%20%5Ctext%7Btr%7D%5Cleft%5B%5Cleft(%5Cmathbf%7B1%7D'%5Cboldsymbol%5COmega%5E%7B-1%7D%20%5Cmathbf%7B1%7D%5Cright)%5E%7B-1%7D%20%5Cmathbf%7B1%7D'%5Cboldsymbol%5COmega%5E%7B-1%7D%20%5Cboldsymbol%5CPhi%20%5Cboldsymbol%5COmega%5E%7B-1%7D%20%5Cmathbf%7B1%7D%5Cright%5D%20%5C%5C%0A&amp;=%20%5Csum_%7Bj=1%7D%5EJ%20%5Ctext%7Btr%7D%5Cleft(%5Cboldsymbol%5COmega%5E%7B-1%7D_j%20%5Cboldsymbol%5CPhi_j%5Cright)%20-%20%5Cfrac%7B1%7D%7B%5Ctilde%7BW%7D%7D%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7B1%7D_j'%5Cboldsymbol%5COmega%5E%7B-1%7D_j%20%5Cboldsymbol%5CPhi_j%20%5Cboldsymbol%5COmega_j%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j%20%5C%5C%0A&amp;=%20%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7Bk_j%7D%7B%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%5Cleft%5B%5Ctau_*%5E2%20+%20%5Comega_*%5E2%20+%20%5Csigma_j%5E2%20-%20%5Cleft(%5Ctilde%5Ctau%5E2%20+%20%5Crho%20%5Csigma_j%5E2%5Cright)%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%7D%7Bw%5E*_j%7D%5Cright%5D%20-%20%5Cfrac%7B1%7D%7B%5Ctilde%7BW%7D%7D%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%5E2%7D%7Bw%5E*_j%7D%20%5C%5C%0A&amp;=%20%5Csum_%7Bj=1%7D%5EJ%20(k_j%20-%201)%20%5Cleft(%5Cfrac%7B%5Comega_*%5E2%20+%20(1%20-%20%5Cphi)%5Csigma_j%5E2%7D%7B%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%5Cright)%20+%20%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%7D%7Bw_j%5E*%7D%20-%20%5Cfrac%7B1%7D%7B%5Ctilde%7BW%7D%7D%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%5E2%7D%7Bw%5E*_j%7D,%0A%5Cend%7Baligned%7D%0A"> and <img src="https://latex.codecogs.com/png.latex?%0A%5Clog%20%5Cleft%7C%20%5Cboldsymbol%5COmega%20%5Cright%7C%20=%20%5Csum_%7Bj=1%7D%5EJ%5Clog%20%5Cleft%7C%20%5Cboldsymbol%5COmega_j%20%5Cright%7C%20=%20%5Csum_%7Bj=1%7D%5EJ%5Cleft%5B%20%5Cleft(k_j%20-%201%5Cright)%20%5Clog%5Cleft(%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%5Cright)%20-%20%5Clog%20%5Cleft(%5Cfrac%7B%5Ctilde%7Bw%7D_j%7D%7Bk_j%7D%5Cright)%5Cright%5D%0A"> and <img src="https://latex.codecogs.com/png.latex?%0A%5Clog%20%5Cleft%7C%5Cmathbf%7B1%7D'%5Cboldsymbol%5COmega%5E%7B-1%7D%20%5Cmathbf%7B1%7D%5Cright%7C%20=%20%5Clog%20%5Cleft(%5Ctilde%7BW%7D%5Cright),%0A"> It follows that the REML estimators converge to the values <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega%5E2"> that minimize <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathcal%7BKL%7D%5Cleft(%5Ctilde%5Ctau%5E2,%20%5Ctilde%5Comega%5E2,%20%5Crho,%20%5Ctau_*%5E2,%20%5Comega_*%5E2,%20%5Cphi%5Cright)%20&amp;=%20%5Csum_%7Bj=1%7D%5EJ%20(k_j%20-%201)%20%5Cleft(%5Cfrac%7B%5Comega_*%5E2%20+%20(1%20-%20%5Cphi)%5Csigma_j%5E2%7D%7B%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%7D%5Cright)%20+%20%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%7D%7Bw_j%5E*%7D%20-%20%5Cfrac%7B1%7D%7B%5Ctilde%7BW%7D%7D%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Ctilde%7Bw%7D_j%5E2%7D%7Bw%5E*_j%7D%20%5C%5C%0A&amp;%20%5Cqquad%20%5Cqquad%20+%20%5Csum_%7Bj=1%7D%5EJ%5Cleft(k_j%20-%201%5Cright)%20%5Clog%5Cleft(%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%5Csigma_j%5E2%5Cright)%20-%20%5Csum_%7Bj=1%7D%5EJ%20%5Clog%20%5Cleft(%5Cfrac%7B%5Ctilde%7Bw%7D_j%7D%7Bk_j%7D%5Cright)%20+%20%5Clog(%5Ctilde%7BW%7D)%0A%5Cend%7Baligned%7D%0A"> This is a complicated non-linear objective function, but it can be minimized numerically using standard techniques.</p>
<p>Here are some heatmaps of the function for <img src="https://latex.codecogs.com/png.latex?%5Ctau%20=%200.2">, <img src="https://latex.codecogs.com/png.latex?%5Comega%20=%200.1">, <img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%200.4">, and some simulated values for <img src="https://latex.codecogs.com/png.latex?k_j"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma_j%5E2">, for three different assumed correlations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20211124</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4">CHE_KL <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(to, tau, omega, phi, rho, k_j, sigmasq_j) {</span>
<span id="cb1-5">  </span>
<span id="cb1-6">  trs_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> to[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_j</span>
<span id="cb1-7">  ors_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> to[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_j</span>
<span id="cb1-8">  w_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> trs_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ors_j)</span>
<span id="cb1-9">  W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_j)</span>
<span id="cb1-10">  </span>
<span id="cb1-11">  tausq_ps_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_j</span>
<span id="cb1-12">  omegasq_ps_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_j</span>
<span id="cb1-13">  wj_star <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tausq_ps_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omegasq_ps_j)</span>
<span id="cb1-14">  </span>
<span id="cb1-15">  A1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> omegasq_ps_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ors_j)</span>
<span id="cb1-16">  A2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> wj_star)</span>
<span id="cb1-17">  A3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_j<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> wj_star) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> W</span>
<span id="cb1-18">  B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((k_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(ors_j) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(w_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> k_j))</span>
<span id="cb1-19">  C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(W)</span>
<span id="cb1-20">  </span>
<span id="cb1-21">  A1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> A2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> C</span>
<span id="cb1-22">  </span>
<span id="cb1-23">}</span>
<span id="cb1-24"></span>
<span id="cb1-25">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb1-26">omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb1-27">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb1-28">J <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb1-29">k_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(J, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-30">sigmasq_j <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(J, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb1-31"></span>
<span id="cb1-32"></span>
<span id="cb1-33">KL_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cross_df</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>),</span>
<span id="cb1-35">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">o =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.005</span>),</span>
<span id="cb1-36">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> o, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.x, .y)),</span>
<span id="cb1-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">KL =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2_dbl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> to, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> CHE_KL, </span>
<span id="cb1-40">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega =</span> omega,</span>
<span id="cb1-41">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_j =</span> k_j, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigmasq_j =</span> sigmasq_j),</span>
<span id="cb1-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rho =="</span>, rho)</span>
<span id="cb1-43">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(rho)</span>
<span id="cb1-45"></span>
<span id="cb1-46">KL_min <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-47">  KL_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(KL <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(KL))</span>
<span id="cb1-49"></span>
<span id="cb1-50">KL_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">KL =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, (KL <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(KL)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(KL) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(KL)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-52"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_parsed"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_contour_filled</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> o, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> KL), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> KL_min, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> o), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(tau), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(omega)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/variance-components-with-misspecified-correlation/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The white points correspond to the true parameter values, while the red points correspond with the values that minimized the K-L divergence. In the middle plot, where <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.4"> corresponds to the true sampling correlation, the function is minimized at the true values of <img src="https://latex.codecogs.com/png.latex?%5Ctau"> and <img src="https://latex.codecogs.com/png.latex?%5Comega">. In the left-hand plot, assuming <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.0"> leads to an upwardly biased value of <img src="https://latex.codecogs.com/png.latex?%5Ctau"> and a downwardly biased value of <img src="https://latex.codecogs.com/png.latex?%5Comega">. In the right-hand plot, assuming <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.8"> leads to a smaller value of <img src="https://latex.codecogs.com/png.latex?%5Ctau"> and a larger value of <img src="https://latex.codecogs.com/png.latex?%5Comega">.</p>
<section id="completely-balanced-designs" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="completely-balanced-designs"><span class="header-section-number">3.1</span> Completely balanced designs</h2>
<p>Things simplify considerably in the special case that the sample of studies is completely balanced, such that <img src="https://latex.codecogs.com/png.latex?k_1%20=%20k_2%20=%20%5Ccdots%20=%20k_J"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma_1%5E2%20=%20%5Csigma_2%5E2%20=%20%5Ccdots%20=%20%5Csigma_J%5E2">. In such a design, the log-likelihood depends on <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> only through the quantities <img src="https://latex.codecogs.com/png.latex?a%20=%20%5Ctau%5E2%20+%20%5Crho%20%5Csigma%5E2"> and <img src="https://latex.codecogs.com/png.latex?b%20=%20%5Comega%5E2%20+%20(1%20-%20%5Crho)%20%5Csigma%5E2">. It follows that <img src="https://latex.codecogs.com/png.latex?%0Al_R%5Cleft(%5Ctau%5E2,%20%5Comega%5E2,%20%5Cphi%5Cright)%20=%20l_R%5Cleft(%5Ctilde%5Ctau%5E2,%20%5Ctilde%5Comega%5E2,%20%5Crho%5Cright)%0A"> so long as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctau%5E2%20+%20%5Cphi%20%5Csigma%5E2%20&amp;=%20%5Ctilde%5Ctau%5E2%20+%20%5Crho%20%5Csigma%5E2%20%5C%5C%0A%5Comega%5E2%20+%20(1%20-%20%5Cphi)%5Csigma%5E2%20&amp;=%20%5Ctilde%5Comega%5E2%20+%20(1%20-%20%5Crho)%20%5Csigma%5E2.%0A%5Cend%7Baligned%7D%0A"> If we assume that <img src="https://latex.codecogs.com/png.latex?(%5Crho%20-%20%5Cphi)%5Csigma%5E2%20%3C%20%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?(%5Cphi%20-%20%5Crho)%5Csigma%5E2%20%3C%20%5Comega%5E2">, then we can set <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctilde%5Ctau%5E2%20&amp;=%20%5Ctau%5E2%20-%20%5Cleft(%5Crho%20-%20%5Cphi%5Cright)%20%5Csigma%5E2%20%5C%5C%0A%5Ctilde%5Comega%5E2%20&amp;=%20%5Comega%5E2%20+%20%5Cleft(%5Crho%20-%20%5Cphi%5Cright)%20%5Csigma%5E2%0A%5Cend%7Baligned%7D%0A"> and achieve the exact same likelihood.<sup>1</sup> Because the Kullback-Liebler divergence is minimized at the log likelihood of the true parameter values, setting <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega%5E2"> equal to the above quantities will also minimize the K-L divergence.</p>
<p>The relationships here are fairly intuitive, I think. When <img src="https://latex.codecogs.com/png.latex?%5Crho"> is an over-estimate of the true correlation <img src="https://latex.codecogs.com/png.latex?%5Cphi">, then the between-study variance will be under-estimated and the within-study variance will be over-estimated, each to an extent that depends on a) the difference between <img src="https://latex.codecogs.com/png.latex?%5Crho"> and <img src="https://latex.codecogs.com/png.latex?%5Cphi"> and b) the size of the (average) sampling variance. When <img src="https://latex.codecogs.com/png.latex?%5Crho"> is an under-estimate of the true correlation <img src="https://latex.codecogs.com/png.latex?%5Cphi">, then the between-study variance will be over-estimated and the within-study variance will be under-estimated, each to an extent that depends on the same components. It’s also rather intriguing to see that the total variance (the sum of <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">) is totally invariant to <img src="https://latex.codecogs.com/png.latex?%5Crho"> and will be preserved no matter what assumption we make regarding the sample correlation.</p>
<p>In practice, of course, it’s pretty unlikely to have a meta-analytic dataset that is completely balanced. Still, the formulas for this completely balanced case might nonetheless be useful as heuristics for the direction of the biases in the parameter estimates—perhaps even as rough guides for the magnitude of bias that could be expected.</p>
</section>
<section id="finding-tildetau2-and-tildeomega2-in-imbalanced-designs" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="finding-tildetau2-and-tildeomega2-in-imbalanced-designs"><span class="header-section-number">3.2</span> Finding <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega%5E2"> in imbalanced designs</h2>
<p>In imbalanced designs, we can find <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega%5E2"> by direct minimization of <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BKL%7D">, given design information <img src="https://latex.codecogs.com/png.latex?k_1,...,k_J"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma_1%5E2,...,%5Csigma_J%5E2">; true parameter values <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">, <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">, <img src="https://latex.codecogs.com/png.latex?%5Cphi">; and assumed correlation <img src="https://latex.codecogs.com/png.latex?%5Crho">. The plot below depicts how <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau">, <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega">, and the total SD <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B%5Ctilde%5Ctau%5E2%20+%20%5Ctilde%5Comega%5E2%7D"> change as a function of the assumed correlation <img src="https://latex.codecogs.com/png.latex?%5Crho">, for various levels of true correlation <img src="https://latex.codecogs.com/png.latex?%5Cphi">, when the design is imbalanced. As previously, I use <img src="https://latex.codecogs.com/png.latex?%5Ctau%20=%200.2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%20=%200.1">.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">find_tau_omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tau, omega, phi, rho, k_j, sigmasq_j) {</span>
<span id="cb2-2"></span>
<span id="cb2-3">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(tau <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>, omega <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn =</span> CHE_KL, </span>
<span id="cb2-4">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega =</span> omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho,</span>
<span id="cb2-5">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_j =</span> k_j, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigmasq_j =</span> sigmasq_j,</span>
<span id="cb2-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L-BFGS-B"</span>)</span>
<span id="cb2-7"></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau_tilde =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_tilde =</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb2-9">}</span>
<span id="cb2-10"></span>
<span id="cb2-11">sigmasq_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(sigmasq_j)</span>
<span id="cb2-12"></span>
<span id="cb2-13">opt_params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cross_df</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau,</span>
<span id="cb2-15">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega =</span> omega,</span>
<span id="cb2-16">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb2-17">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">res =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> find_tau_omega, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k_j =</span> k_j, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigmasq_j =</span> sigmasq_j),</span>
<span id="cb2-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(res) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_tilde =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(tau_tilde<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega_tilde<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb2-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau_pred =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_bar)),</span>
<span id="cb2-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">omega_pred =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigmasq_bar)),</span>
<span id="cb2-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total_pred =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(tau_pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega_pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb2-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi_lab =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phi =="</span>, phi)</span>
<span id="cb2-28">  )</span>
<span id="cb2-29"></span>
<span id="cb2-30">opt_params <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_tilde"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_pred"</span>)),</span>
<span id="cb2-32">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(q, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"param"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recode</span>(type, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tilde =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exact"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pred =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"balanced"</span>),</span>
<span id="cb2-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(type, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exact"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"balanced"</span>)),</span>
<span id="cb2-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">param =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(param, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tau"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total"</span>),</span>
<span id="cb2-38">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tau"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"omega"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqrt(tau^2 + omega^2)"</span>))</span>
<span id="cb2-39">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(rho, p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> type, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> type)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qual"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(param <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> phi_lab, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labeller =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label_parsed"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expression</span>(rho), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parameter"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/variance-components-with-misspecified-correlation/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The top row of the figure shows <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau">, the middle row shows <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega">, and the bottom row shows the total SD, for varying levels of assumed correlation <img src="https://latex.codecogs.com/png.latex?%5Crho">. The solid green lines represent the values that actually minimize the KL divergence. The dashed orange lines correspond to the minimizing values assuming complete balance (and using the average value of the <img src="https://latex.codecogs.com/png.latex?%5Csigma_j%5E2">’s to evaluate the bias). The “balanced” approximations are fairly close—close enough to use as heuristics, at least—although they’re not perfect. In particular, the balanced approximation becomes discrepant from the real minimizing values when <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Ctau"> or <img src="https://latex.codecogs.com/png.latex?%5Ctilde%5Comega"> gets closer to zero. It’s also notable that the total variance is nearly constant (except when one or the other variance component is zero) and the balanced approximation is quite close to the real minimizing values.</p>
</section>
</section>
<section id="implications" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Implications</h1>
<p>This post was mostly just to satisfy my own curiosity about how variance components behave in the MLMA and, more broadly, under mis-specified correlated-and-hierarchical effects meta-analysis models. I don’t think the bias formulas have much practical utility because, if you’re concerned about bias due to mis-specified sampling correlations, the first thing to do is try and develop better assumptions about the sampling correlation structure. Still, I think this analysis might be helpful for purposes of gauging how far off from the true your variance component estimates might be. In further work along these lines, it might be useful to examine the consequences of the biased variance component estimates for the efficiency of overall average effect size estimates based on mis-specified CHE models and the accuracy of model-based standard errors and confidence intervals under mis-specification. It would also be important to verify that these approximations provide accurate predictions for the bias of variance component estimates in realistic meta-analytic data (especially with a small or moderate number of studies).</p>
<p>Another implication of this investigation is that <em>imbalance</em> in the data structure seems to matter. When all studies have an equal number of effect sizes and are equally precise, then everything is simpler and more robust to mistaken assumptions about sampling correlation. Variance component estimation matters more for meta-analytic data in which some studies are more precise or contribute more effect size estimates than others. Therefore, further investigations—including simulation studies—of methods for handling dependent effect sizes really need to examine conditions with imbalanced data in order to draw defensible, generalizable conclusions about the robustness or utility of particular methods.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Consequently, <img src="https://latex.codecogs.com/png.latex?%5Cphi"> is not identifiable (in the statistical sense) in the completely balanced design.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2021,
  author = {Pustejovsky, James E.},
  title = {Variance Component Estimates in Meta-Analysis with
    Mis-Specified Sampling Correlation},
  date = {2021-11-28},
  url = {https://jepusto.com/posts/variance-components-with-misspecified-correlation},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2021" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2021. <span>“Variance Component Estimates in
Meta-Analysis with Mis-Specified Sampling Correlation.”</span> November
28, 2021. <a href="https://jepusto.com/posts/variance-components-with-misspecified-correlation">https://jepusto.com/posts/variance-components-with-misspecified-correlation</a>.
</div></div></section></div> ]]></description>
  <category>meta-analysis</category>
  <category>dependent effect sizes</category>
  <category>distribution theory</category>
  <category>hierarchical models</category>
  <guid>https://jepusto.com/posts/variance-components-with-misspecified-correlation/</guid>
  <pubDate>Sun, 28 Nov 2021 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Implications of mean-variance relationships for standardized mean differences</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/mean-variance-relationships-and-SMDs/</link>
  <description><![CDATA[ 





<p>I spend more time than I probably should discussing meta-analysis problems on the <a href="https://stat.ethz.ch/mailman/listinfo/r-sig-meta-analysis">R-SIG-meta-analysis listserv</a>. The questions that folks pose there are often quite interesting—especially when they’re motivated by issues that they’re wrestling with while trying to complete meta-analysis projects in their diverse fields. For those interested in meta-analytic methodology, I think perusing the mailing list is a good way to get a bit of ground sense about problems that come up in practice and places where there is a need for new methodological work, or at least further methodological guidance.</p>
<p>Recently, a <a href="https://stat.ethz.ch/pipermail/r-sig-meta-analysis/2021-September/003318.html">question came up</a> on the listserv about whether it was reasonable to use the standardized mean difference metric for synthesizing studies where the outcomes are measured as proportions. Luke Martinez wrote:</p>
<blockquote class="blockquote">
<p>I’m doing a meta-analysis where the papers report only “mean” and “sd” of some form of proportion and/or “mean” and “sd” of corresponding raw frequencies. (For context, the papers ask students to read, find, and correct the wrong words in a text.) … My question is given that all these studies only report “mean” and “sd”, can I simply use a SMD effect size?</p>
</blockquote>
<p>I think this is an interesting question because, while the <a href="https://stat.ethz.ch/pipermail/r-sig-meta-analysis/2021-September/003320.html">SMD could work perfectly fine</a> as an effect size metric for proportions, there are also other alternatives that could be considered, such as odds ratios or response ratios or raw differences in proportions. Further, there are some situations where the SMD has disadvantages for synthesizing contrasts between proportions. Thus, it’s a situation where one has to make a choice about the effect size metric, and where the most common metric (the SMD) might not be the right answer. As <a href="https://stat.ethz.ch/pipermail/r-sig-meta-analysis/2021-October/003331.html">I wrote in reply</a>:</p>
<blockquote class="blockquote">
<p>I would suggest that you could also consider other effect measures besides the SMD. For example, the response ratio is also a scale-free metric that could work with the proportion outcomes that you’ve described, and would also be appropriate for raw frequency counts as long as the total number possible is the same for the groups being compared within a given study.</p>
<p>Whether the response ratio would be more appropriate than the SMD is hard to gauge. One would need to know more about how the proportions were assessed and how the assessment procedures varied from study to study. For instance, did some studies use passages with many possible errors to be corrected while other studies used passages with just a few errors? Did the difficulty of the passages differ from study to study? Were there very low or very high mean proportions in any studies? Does there seem to be a relationship between the means and the variances of the proportions of a given group?</p>
</blockquote>
<p>In a <a href="https://stat.ethz.ch/pipermail/r-sig-meta-analysis/2021-October/003361.html">follow-up</a>, I elaborated on some potential problems with using the SMD:</p>
<blockquote class="blockquote">
<ul>
<li><p>Variation in the number of possible errors (and perhaps also in the length of the time provided for the test?) suggests that the measures from different studies may have varying degrees of reliability. Varying reliability introduces heterogeneity in the SMD (because the denominator is inflated or shrunk by the degree of reliability).</p></li>
<li><p>A relationship between the M and SD of the proportions for a given group suggests that the distribution of the individual-level outcomes might also exhibit mean-variance relationships. (I say “suggests” rather than implies because there’s an ecological inference here, i.e., assuming something about individual-level variation on the basis of group-level variation.) If this supposition is reasonable, then that introduces a further potential source of heterogeneity in the SMDs (study-to-study variation in the M for the reference group influences the SD of the reference group, thereby inflating or shrinking the SMDs).</p></li>
</ul>
</blockquote>
<p>And I suggested a possible work-flow for examining the choice of effect size metric:</p>
<blockquote class="blockquote">
<p>Here’s how I might proceed if I were conducting this analysis:</p>
<ol type="1">
<li>Calculate <em>both</em> SMDs and log-transformed response ratios for the full set of studies.</li>
<li>Examine the distribution of effect size estimates for each metric (using histograms or funnel plots). If one of the distributions is skewed or has extreme outliers, take that as an indication that the metric might not be appropriate.</li>
<li>Fit meta-analytic models to summarize the distribution of effect sizes in each metric, using a model that appropriately describes the dependence structure of the estimates. Calculate I-squared statistics, give preference to the metric with lower I-squared.</li>
<li>If (2) and (3) don’t lead to a clearly preferable metric, then choose between SMD and RR based on whichever will make the synthesis results easier to explain to people.</li>
<li>(Optional/extra credit) Whichever metric you choose, repeat your main analyses using the other metric and stuff all those results in supplementary materials, to satisfy any inveterate statistical curmudgeons who might review/read your synthesis.</li>
</ol>
</blockquote>
<p>(When I referred to “inveterate statistical curmudgeons”, I mostly had myself in mind.)</p>
<p>In this post, I want to provide a bit more detail regarding why I think mean-variance relationships in raw data can signal that the standardized mean differences might be less useful as an effect size metric compared to alternatives. The concern is actually broader than meta-analyses of outcomes measured as proportions, so I’ll start with a different case and then return to a situation similar to the one described in the original question.</p>
<section id="mean-variance-relationships-can-induce-heterogeneity" class="level2">
<h2 class="anchored" data-anchor-id="mean-variance-relationships-can-induce-heterogeneity">Mean-variance relationships can induce heterogeneity</h2>
<p>The standardized mean difference parameter for a given study can be defined as: <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_i%20=%20%5Cfrac%7B%5Cmu_%7BBi%7D%20-%20%5Cmu_%7BAi%7D%7D%7B%5Csigma_%7BAi%7D%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D"> are the (population) mean outcomes in group <img src="https://latex.codecogs.com/png.latex?A"> and group <img src="https://latex.codecogs.com/png.latex?B"> of study <img src="https://latex.codecogs.com/png.latex?i"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7BAi%7D"> is the (population) standard deviation in group <img src="https://latex.codecogs.com/png.latex?A"> of study <img src="https://latex.codecogs.com/png.latex?i">.<sup>1</sup> The ideal case for using the SMD metric is when the outcomes in different studies are linearly equatable, so that the outcome scale in one study can be directly translated into the outcome scale of another study. However, if outcomes exhibit mean-variance relationships, linearly equatability seems rather implausible, and we might expect that SMDs will display heterogeneity across studies as a result.</p>
<p>Let me lay out an example of a situation where the outcomes exhibit mean-variance relationships and where, as a consequence, the SMD metric becomes heterogeneous. Suppose that we have <img src="https://latex.codecogs.com/png.latex?k"> studies, each involving a two-group comparison, with groups of equal size. In study <img src="https://latex.codecogs.com/png.latex?i">, the outcomes in group <img src="https://latex.codecogs.com/png.latex?A"> follow a poisson distribution with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D">, so that the variance of the outcomes in group <img src="https://latex.codecogs.com/png.latex?A"> is also <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D">, for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,k">. The outcomes in group <img src="https://latex.codecogs.com/png.latex?B"> follow a poisson distribution with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D">, so the variance is also <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D">. Now, suppose that there is a fixed, proportional relationship between <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D">, so that <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D%20=%20%5Clambda%20%5Cmu_%7BAi%7D"> for some <img src="https://latex.codecogs.com/png.latex?%5Clambda%20%3E%200">. In other words, the treatment contrast is <em>constant</em> on the scale of the response ratio. However, the means in group <img src="https://latex.codecogs.com/png.latex?A"> vary from study to study. To make things concrete, let’s assume that the means in group <img src="https://latex.codecogs.com/png.latex?A"> follow a gamma distribution with shape parameter <img src="https://latex.codecogs.com/png.latex?%5Calpha"> and rate parameter <img src="https://latex.codecogs.com/png.latex?%5Cbeta">: <img src="https://latex.codecogs.com/png.latex?%0A%5Cmu_%7BAi%7D%20%5Csim%20%5CGamma(%5Calpha,%20%5Cbeta).%0A"> What does this model imply about the distribution of standardized mean differences across this set of studies?</p>
<p>Under this model, the SMD parameter for study <img src="https://latex.codecogs.com/png.latex?i"> is: <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_i%20=%20%5Cfrac%7B%5Cmu_%7BBi%7D%20-%20%5Cmu_%7BAi%7D%7D%7B%5Csqrt%7B%5Cmu_%7BAi%7D%7D%7D%20=%20(%5Clambda%20-%201)%20%5Ctimes%20%5Csqrt%7B%5Cmu_%7BAi%7D%7D.%0A"> The first term in the above expression is a constant that only depend on the size of the response ratio, but the second term is random because we have assumed that the group <img src="https://latex.codecogs.com/png.latex?A"> means vary from study to study. It will therefore create heterogeneity in the SMD parameters—the greater the variance of the <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D">’s, the greater the heterogeneity in <img src="https://latex.codecogs.com/png.latex?%5Cdelta_i">. Specifically, under the above assumptions, the effect size parameters follow a <a href="https://en.wikipedia.org/wiki/Nakagami_distribution">Nakagami distribution</a>: <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_i%20%5Csim%20%5Ctext%7BNakagami%7D%5Cleft(m%20=%20%5Calpha,%20%5COmega%20=%20%5Cfrac%7B(%5Clambda%20-%201)%5E2%20%5Calpha%7D%7B%5Cbeta%7D%5Cright)%0A"> Thus, even though we have a model where there is an underlying fixed relationship between <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BBi%7D">, using the SMD metric for synthesis will lead to a situation with heterogeneous effects (even if all of the studies had large sample sizes and so effect sizes in individual studies are precisely estimated).</p>
</section>
<section id="an-example-with-proportions" class="level2">
<h2 class="anchored" data-anchor-id="an-example-with-proportions">An example with proportions</h2>
<p>This sort of behavior is not restricted to the poisson-gamma model I sketched above. The key features of that example are a) the assumption that the outcomes have a strong mean-variance relationship and b) the assumption that the <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7BAi%7D">’s are heterogeneous across studies. If both of these hold, then the resulting SMDs will also be heterogeneous. I’ll now describe a similar model, but where the outcomes within each study are proportions.</p>
<p>As before, suppose that we have <img src="https://latex.codecogs.com/png.latex?k"> studies, each involving a two-group comparison, with groups of equal size. In study <img src="https://latex.codecogs.com/png.latex?i">, the outcomes in group <img src="https://latex.codecogs.com/png.latex?A"> follow a binomial distribution with mean proportion <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BAi%7D"> and <img src="https://latex.codecogs.com/png.latex?T_i"> trials, so that the variance of the outcomes in group <img src="https://latex.codecogs.com/png.latex?A"> is <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BAi%7D%5Cleft(1%20-%20%5Cpi_%7BAi%7D%5Cright)%20T_i">, for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,k">. The outcomes in group <img src="https://latex.codecogs.com/png.latex?B"> also follow a binomial distribution, this one with mean proportion <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BBi%7D"> and <img src="https://latex.codecogs.com/png.latex?T_i"> trials, so the variance is <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BBi%7D%5Cleft(1%20-%20%5Cpi_%7BBi%7D%5Cright)%20T_i">. Next, to induce variation in the group-<img src="https://latex.codecogs.com/png.latex?A"> means, let’s assume that the mean proportions follow a beta distribution: <img src="https://latex.codecogs.com/png.latex?%0A%5Cpi_%7BAi%7D%20%5Csim%20%5Ctext%7BBeta%7D(%5Calpha,%20%5Cbeta).%0A"></p>
<p>Finally, suppose that <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BBi%7D%20=%20%5Clambda_i%20%5Cpi_%7BAi%7D"> for some <img src="https://latex.codecogs.com/png.latex?%5Clambda_i%20%3E%200">.</p>
<p>Under these assumptions, the SMD parameter for study <img src="https://latex.codecogs.com/png.latex?i"> is: <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_i%20=%20%5Cfrac%7B%5Cpi_%7BBi%7DT_i%20-%20%5Cpi_%7BAi%7D%20T_i%7D%7B%5Csqrt%7B%5Cpi_%7BAi%7D%20(1%20-%20%5Cpi_%7BAi%7D)%20T_i%7D%7D%20=%20(%5Clambda_i%20-%201)%20%5Ctimes%20%5Csqrt%7BT_i%7D%20%5Ctimes%20%5Csqrt%7B%5Cfrac%7B%5Cpi_%7BAi%7D%7D%7B1%20-%20%5Cpi_%7BAi%7D%7D%7D.%0A"> From the above expression, it can be seen that there are three potential sources of variation in <img src="https://latex.codecogs.com/png.latex?%5Cdelta_i">: variation in the study-specific response ratio <img src="https://latex.codecogs.com/png.latex?%5Clambda_i">, variation in the group-<img src="https://latex.codecogs.com/png.latex?A"> proportions <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BAi%7D">, and variation in the number of trials <img src="https://latex.codecogs.com/png.latex?T_i">. The total heterogeneity in <img src="https://latex.codecogs.com/png.latex?%5Cdelta_i"> will depend on all three, as well as on the co-variation between <img src="https://latex.codecogs.com/png.latex?%5Clambda_i">, <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BAi%7D">, and <img src="https://latex.codecogs.com/png.latex?T_i">.</p>
<p>To make this concrete, let me simulate some meta-analytic data that follows the above model. To do so, I’ll need to make some additional distributional assumptions<sup>2</sup>:</p>
<ol type="1">
<li>that <img src="https://latex.codecogs.com/png.latex?%5Clambda_i"> is log-normally distributed such that <img src="https://latex.codecogs.com/png.latex?%5Cln%20%5Clambda_i%20%5Csim%20N(%5Cln%20%5CLambda,%20%5Ctau%5E2)">;</li>
<li>that the number of trials is uniformly distributed on the integers between <img src="https://latex.codecogs.com/png.latex?t_%7Bmin%7D"> and <img src="https://latex.codecogs.com/png.latex?t_%7Bmax%7D">;</li>
<li>that <img src="https://latex.codecogs.com/png.latex?N_i">, the number of observations per group in study <img src="https://latex.codecogs.com/png.latex?i">, is uniformly distributed on the integers between <img src="https://latex.codecogs.com/png.latex?n_%7Bmin%7D"> and <img src="https://latex.codecogs.com/png.latex?n_%7Bmax%7D">; and</li>
<li>that <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7BAi%7D">, <img src="https://latex.codecogs.com/png.latex?%5Clambda_i">, <img src="https://latex.codecogs.com/png.latex?T_i">, and <img src="https://latex.codecogs.com/png.latex?N_i"> are mutually independent.</li>
</ol>
<p>Here’s a function that generates study-specific parameter values and sample proportions:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">sim_binom_summary <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(pi_i, T_i, n_i) {</span>
<span id="cb1-2">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> T_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pi_i) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> T_i</span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(y), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SD =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(y))</span>
<span id="cb1-4">}</span>
<span id="cb1-5"></span>
<span id="cb1-6">sim_props <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(</span>
<span id="cb1-7">  k, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># number of studies</span></span>
<span id="cb1-8">  alpha, beta, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters of pi_Ai distribution,</span></span>
<span id="cb1-9">  Lambda, tau, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters of lambda_i distribution</span></span>
<span id="cb1-10">  t_min, t_max, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters of T_i distribution</span></span>
<span id="cb1-11">  n_min, n_max <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameters of the sample size distribution</span></span>
<span id="cb1-12">) {</span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulate parameters</span></span>
<span id="cb1-15">  pi_Ai <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(k, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape1 =</span> alpha, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape2 =</span> beta)</span>
<span id="cb1-16">  lambda_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(k, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(Lambda), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> tau))</span>
<span id="cb1-17">  pi_Bi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> lambda_i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi_Ai</span>
<span id="cb1-18">  T_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(t_min<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>t_max, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> k, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-19">  delta_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (pi_Bi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pi_Ai) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T_i <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(pi_Ai <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pi_Ai) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T_i)</span>
<span id="cb1-20">  n_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(n_min<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_max, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> k, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-21">  </span>
<span id="cb1-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># simulate data</span></span>
<span id="cb1-23">  stats_A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_dfr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi_i =</span> pi_Ai, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">T_i =</span> T_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_i =</span> n_i),</span>
<span id="cb1-24">                             sim_binom_summary) </span>
<span id="cb1-25">                             </span>
<span id="cb1-26">  stats_B <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_dfr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi_i =</span> pi_Bi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">T_i =</span> T_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_i =</span> n_i),</span>
<span id="cb1-27">                             sim_binom_summary)</span>
<span id="cb1-28">  </span>
<span id="cb1-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compile</span></span>
<span id="cb1-30">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi_Ai =</span> pi_Ai, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pi_Bi =</span> pi_Bi, </span>
<span id="cb1-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda_i =</span> lambda_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">T_i =</span> T_i, </span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta_i =</span> delta_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_i =</span> n_i,</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mA =</span> stats_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdA =</span> stats_A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>SD,</span>
<span id="cb1-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mB =</span> stats_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sdB =</span> stats_B<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>SD</span>
<span id="cb1-36">  )</span>
<span id="cb1-37"></span>
<span id="cb1-38">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># effect size calculations</span></span>
<span id="cb1-39">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">escalc</span>(</span>
<span id="cb1-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> res, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ROM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lRR"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V_lRR"</span>),</span>
<span id="cb1-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m1i =</span> mB, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m2i =</span> mA, </span>
<span id="cb1-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd1i =</span> sdB, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd2i =</span> sdA,</span>
<span id="cb1-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n1i =</span> n_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n2i =</span> n_i</span>
<span id="cb1-44">  )</span>
<span id="cb1-45">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> metafor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">escalc</span>(</span>
<span id="cb1-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> res, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SMD"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var.names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V_d"</span>),</span>
<span id="cb1-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m1i =</span> mB, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">m2i =</span> mA, </span>
<span id="cb1-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd1i =</span> sdB, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd2i =</span> sdA,</span>
<span id="cb1-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n1i =</span> n_i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n2i =</span> n_i</span>
<span id="cb1-50">  )</span>
<span id="cb1-51">  </span>
<span id="cb1-52">  res</span>
<span id="cb1-53">}</span>
<span id="cb1-54"></span>
<span id="cb1-55"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20211024</span>)</span>
<span id="cb1-56">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_props</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">beta =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb1-57">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lambda =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span>,</span>
<span id="cb1-58">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span id="cb1-59">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_min =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb1-60"></span>
<span id="cb1-61"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
      pi_Ai     pi_Bi  lambda_i T_i    delta_i n_i        mA       sdA 
1 0.7584480 0.5836965 0.7695933  11 -1.3540950  24 0.7500000 0.1080650 
2 0.7359047 0.4950740 0.6727420  16 -2.1851474  24 0.7786458 0.1222235 
3 0.7132014 0.4773027 0.6692398  12 -1.8068471  10 0.7333333 0.1097134 
4 0.6223653 0.4627406 0.7435193   9 -0.9877857  30 0.6666667 0.1399386 
5 0.5916619 0.4205407 0.7107787   6 -0.8527716  28 0.5833333 0.2103299 
6 0.7266748 0.5014601 0.6900751   9 -1.5160305  35 0.7619048 0.1209466 
         mB       sdB     lRR  V_lRR       d    V_d 
1 0.6174242 0.1285066 -0.1945 0.0027 -1.0983 0.0959 
2 0.5260417 0.1275776 -0.3922 0.0035 -1.9888 0.1245 
3 0.3583333 0.1622089 -0.7161 0.0227 -2.5934 0.3681 
4 0.4555556 0.1943213 -0.3808 0.0075 -1.2306 0.0793 
5 0.4583333 0.2060055 -0.2412 0.0119 -0.5921 0.0746 
6 0.4920635 0.1793349 -0.4372 0.0045 -1.7447 0.0789 </code></pre>
</div>
</div>
<p>For the specified parameter values, there is only a small amount of true heterogeneity in the log of the response ratios (the blue density). Of course, there is further heterogeneity in the log response ratio estimates (the green density) due to sampling error:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(lambda_i), ..scaled..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(lRR, ..scaled..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>A random effects meta-analysis confirms that there is only a modest degree of true heterogeneity in the log response ratios:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(metafor)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> lRR, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> V_lRR, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Random-Effects Model (k = 60; tau^2 estimator: REML)

tau^2 (estimated amount of total heterogeneity): 0.0028 (SE = 0.0013)
tau (square root of estimated tau^2 value):      0.0529
I^2 (total heterogeneity / total variability):   42.01%
H^2 (total variability / sampling variability):  1.72

Test for Heterogeneity:
Q(df = 59) = 100.6304, p-val = 0.0006

Model Results:

estimate      se      zval    pval    ci.lb    ci.ub      
 -0.3498  0.0111  -31.5751  &lt;.0001  -0.3715  -0.3281  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Contrast this with what we get from using the standardized mean difference metric. The distributions of true effect sizes (blue) and of effect size estimates (light purple) have large spread as well as strong left skew:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(delta_i, ..scaled..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(d, ..scaled..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>A random effects meta-analysis of the standardized mean differences shows a greater degree of true heterogeneity, both in terms of the estimated <img src="https://latex.codecogs.com/png.latex?%5Ctau"> and in <img src="https://latex.codecogs.com/png.latex?I%5E2">, or the proportion of total variance in the effect size estimates that is attributable to true heterogeneity:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> V_d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Random-Effects Model (k = 60; tau^2 estimator: REML)

tau^2 (estimated amount of total heterogeneity): 0.2838 (SE = 0.0743)
tau (square root of estimated tau^2 value):      0.5327
I^2 (total heterogeneity / total variability):   72.61%
H^2 (total variability / sampling variability):  3.65

Test for Heterogeneity:
Q(df = 59) = 203.0513, p-val &lt; .0001

Model Results:

estimate      se      zval    pval    ci.lb    ci.ub      
 -1.5967  0.0824  -19.3771  &lt;.0001  -1.7582  -1.4352  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics">Diagnostics</h2>
<p>The code above more-or-less implements the workflow I suggested for deciding between the standardized mean difference or response ratio metric (for proportions, we could also add further comparisons with log odds ratios and with raw differences in proportions). But is there further diagnostic information in the data that could provide a better sense of what is going on? I think there are a few things that might be helpful to consider.</p>
<p>First, the issues I’m concerned with here will arise when there are mean-variance relationships in the outcomes. To get at that, we can simply plot the means and SDs of each group. In the code below, I re-structure the data so that there is one row per group per study. I then plot the SD versus the mean of each group:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb9-3"></span>
<span id="cb9-4">long_summary_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-5">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(n_i, T_i, mA, sdA, mB, sdB) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mA, sdA, mB, sdB), </span>
<span id="cb9-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".value"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"group"</span>),</span>
<span id="cb9-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(m|sd)(A|B)"</span>)</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(long_summary_stats,</span>
<span id="cb9-12">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(m, sd, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_limits</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The plot above does suggest a mean-variance relationship, though it’s a bit messy. We can do better by using the scaled SD, after adjusting for the degree of spread that we would expect given <img src="https://latex.codecogs.com/png.latex?T_i">:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">long_summary_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd_scaled =</span> sd <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(T_i)</span>
<span id="cb10-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(m, sd_scaled, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> group)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x)),</span>
<span id="cb10-9">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expand_limits</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>From the above, it does appear that there could be a relationship between the scaled SD and the mean. The black curve indicates the theoretical mean-variance relationship that would be expected under the binomial distribution, and indeed the empirical relationship appears to be quite similar. This suggests that mean-variance relationships might be at play (a correct supposition, since of course we know the true data-generating process here).</p>
<p>Second, since the outcomes in each group are all proportions, we can simply plot the mean in group <img src="https://latex.codecogs.com/png.latex?B"> versus the mean in group <img src="https://latex.codecogs.com/png.latex?A">:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(mA, mB)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>This plot shows that there is a strong linear relationship between the two means, with a best-fit line that might go through the origin. This suggests that the response ratio might be an appropriate metric (although the difference in proportions might also be appropriate here, since a line with unit slope would probably fit quite well).</p>
<p>Third (and most speculatively/hand-wavily), I think exploratory moderator analysis can be useful here, but interpreted in a non-typical way. Under the model I’ve sketched, we would expect that the standardized mean difference estimates should be systematically associated with the group-<img src="https://latex.codecogs.com/png.latex?A"> means, as well as with the number of trials used to assess outcomes. The scatter-plots below show that this is indeed the case (the right-hand plot shows <img src="https://latex.codecogs.com/png.latex?d_i"> versus <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7BT_i%7D">).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(patchwork)</span>
<span id="cb12-2">mA_d_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(mA, d)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span>
<span id="cb12-9"></span>
<span id="cb12-10">Ti_d_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(T_i), d)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span>
<span id="cb12-16"></span>
<span id="cb12-17">mA_d_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Ti_d_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>This impression is also born out by a meta-regression that includes the group-<img src="https://latex.codecogs.com/png.latex?A"> means and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7BT_i%7D"> as moderators:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma</span>(d <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> mA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(T_i), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> V_d, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Mixed-Effects Model (k = 60; tau^2 estimator: REML)

tau^2 (estimated amount of residual heterogeneity):     0.0238 (SE = 0.0238)
tau (square root of estimated tau^2 value):             0.1544
I^2 (residual heterogeneity / unaccounted variability): 18.12%
H^2 (unaccounted variability / sampling variability):   1.22
R^2 (amount of heterogeneity accounted for):            91.60%

Test for Residual Heterogeneity:
QE(df = 57) = 68.9706, p-val = 0.1330

Test of Moderators (coefficients 2:3):
QM(df = 2) = 110.9125, p-val &lt; .0001

Model Results:

           estimate      se     zval    pval    ci.lb    ci.ub      
intrcpt      2.5225  0.3964   6.3632  &lt;.0001   1.7455   3.2995  *** 
mA          -2.8326  0.4336  -6.5321  &lt;.0001  -3.6825  -1.9827  *** 
sqrt(T_i)   -0.6109  0.0756  -8.0855  &lt;.0001  -0.7590  -0.4628  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Here are the same plots as above, but using the log of the response ratio as the effect size metric:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">mA_lRR_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(mA, lRR)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span>
<span id="cb15-8"></span>
<span id="cb15-9">Ti_lRR_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(T_i), lRR)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span>
<span id="cb15-15"></span>
<span id="cb15-16">mA_lRR_plot <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Ti_lRR_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/mean-variance-relationships-and-SMDs/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>In the left-hand plot, there does not appear to be any relationship between the effect size estimates and the group-<img src="https://latex.codecogs.com/png.latex?A"> means. In the right-hand plot, there does seem to be a mild relationship between the effect size estimates and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7BT_i%7D">, which is a bit surprising, although the strength of the relationship is much weaker than what we saw with the standardized mean differences. Meta-regression analysis supports these interpretations:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma</span>(lRR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>  mA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(T_i), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> V_lRR, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Mixed-Effects Model (k = 60; tau^2 estimator: REML)

tau^2 (estimated amount of residual heterogeneity):     0.0019 (SE = 0.0011)
tau (square root of estimated tau^2 value):             0.0439
I^2 (residual heterogeneity / unaccounted variability): 32.87%
H^2 (unaccounted variability / sampling variability):   1.49
R^2 (amount of heterogeneity accounted for):            31.30%

Test for Residual Heterogeneity:
QE(df = 57) = 84.4977, p-val = 0.0105

Test of Moderators (coefficients 2:3):
QM(df = 2) = 10.6344, p-val = 0.0049

Model Results:

           estimate      se     zval    pval    ci.lb    ci.ub     
intrcpt     -0.2362  0.0950  -2.4864  0.0129  -0.4224  -0.0500   * 
mA           0.1061  0.0948   1.1196  0.2629  -0.0796   0.2918     
sqrt(T_i)   -0.0553  0.0179  -3.0852  0.0020  -0.0904  -0.0202  ** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Now, you might think that a meta-analyst should get excited about the standardized mean difference results, since they’ve uncovered two systematic predictors of effect size magnitude. However, both of these factors are purely operational, arbitrary features of the (simulated) study designs, rather than theoretically or substantively interesting features of the studies. Considered in this light, the finding that they each moderate the magnitude of the standardized mean differences is, more than anything else, <em>annoying</em>. If we wanted to examine other more theoretically interesting moderators, we’d have to do so in a way that accounts for these methodological predictors. At minimum, that would mean including them all in a meta-regression (leading to a model with 3+ predictors). Further, we would have to worry about whether the functional form of the regression is reasonable. Simply adding the theoretical moderator to the model amounts to assuming that it predicts effect size magnitude in a linear, additive fashion, but what if that’s not the right model? Since we know the true data-generating process here, we can see that the linear, additive model <em>would not</em> be correct. But in practice, when we don’t know the true process, this would be much murkier.</p>
<p>The general principle that I’m suggesting here is that effect sizes should ideally be on a metric that is <em>independent</em> of arbitrary methodological factors because this should <em>reduce</em> overall heterogeneity and <em>simplify</em> the model, making it easier to detect real relations of interest. If one has a choice between several different effect size metrics, then a metric that shows clear associations with methodological factors should be discounted in favor of metrics that do not show such associations or show them only weakly. How to fully operationalize this sort of decision (as one would need to when writing a protocol for a meta-analysis, for example), I’m not yet sure about. It seems like a useful avenue for further methodological work.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Yes, there are other ways to define the SMD. Yes, usually we use the standard deviation pooled across both groups. I’m going to use the standard deviation in group <img src="https://latex.codecogs.com/png.latex?A"> alone because it simplifies some of the mathy bits. Please feel free to work through the case with a pooled SD for yourself.↩︎</p></li>
<li id="fn2"><p>One of the vexing things about simulations is that you often end up needing to specify a bunch of assumptions about auxiliary quantities, beyond those of the model you’re actually interested in investigating.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2021,
  author = {Pustejovsky, James E.},
  title = {Implications of Mean-Variance Relationships for Standardized
    Mean Differences},
  date = {2021-11-02},
  url = {https://jepusto.com/posts/mean-variance-relationships-and-SMDs},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2021" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2021. <span>“Implications of Mean-Variance
Relationships for Standardized Mean Differences.”</span> November 2,
2021. <a href="https://jepusto.com/posts/mean-variance-relationships-and-SMDs">https://jepusto.com/posts/mean-variance-relationships-and-SMDs</a>.
</div></div></section></div> ]]></description>
  <category>standardized mean difference</category>
  <category>response ratio</category>
  <category>distribution theory</category>
  <category>meta-analysis</category>
  <guid>https://jepusto.com/posts/mean-variance-relationships-and-SMDs/</guid>
  <pubDate>Tue, 02 Nov 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Inverting partitioned matrices</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/inverting-partitioned-matrices/</link>
  <description><![CDATA[ 





<p>There’s lots of linear algebra out there that’s quite useful for statistics, but that I never learned in school or never had cause to study in depth. In the same spirit as my <a href="../..\Woodbury-identity/">previous post on the Woodbury identity</a>, I thought I would share my notes on another helpful bit of math about matrices. At some point in high school or college, you might have learned how to invert a small matrix by hand. You might recall the formula for the inverse of a two-by-two matrix: <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D%20a%20&amp;%20b%20%5C%5C%20c%20&amp;%20d%5Cend%7Barray%7D%5Cright%5D%5E%7B-1%7D%20=%20%5Cfrac%7B1%7D%7Bad%20-%20bc%7D%5Cleft%5B%5Cbegin%7Barray%7D%7Brr%7D%20d%20&amp;%20-b%20%5C%5C%20-c%20&amp;%20a%5Cend%7Barray%7D%5Cright%5D.%0A"> It turns out that there’s a straight-forward generalization of this formula to matrices of arbitrary size, but that are <em>partitioned</em> into four pieces. The following is based on the presentation from some old notes by Dr.&nbsp;Thomas Minka, <a href="https://tminka.github.io/papers/matrix/">Old and New Matrix Algebra Useful for Statistics</a>. The statement there is quite detailed and general. My version will be for a more specific, simple case, which I’ve found to be common and handy, and that can be presented in a fairly simple form.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BP%7D"> be a matrix of arbitrary size that is composed of four sub-matrices: <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BP%7D%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D%20%5Cmathbf%7BA%7D%20&amp;%20%5Cmathbf%7BB%7D%20%5C%5C%20%5Cmathbf%7BC%7D%20&amp;%20%5Cmathbf%7BD%7D%5Cend%7Barray%7D%5Cright%5D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BD%7D"> are <img src="https://latex.codecogs.com/png.latex?a%20%5Ctimes%20a"> and <img src="https://latex.codecogs.com/png.latex?d%20%5Ctimes%20d"> matrices, both of which are invertible, and where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BB%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BC%7D"> are of conformable dimension.<sup>1</sup> Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D%20=%20%5Cleft(%5Cmathbf%7BD%7D%20-%20%5Cmathbf%7BC%7D%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BB%7D%5Cright)%5E%7B-1%7D">, a <img src="https://latex.codecogs.com/png.latex?d%20%5Ctimes%20d"> matrix. Then <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BP%7D%5E%7B-1%7D%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BX%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20&amp;%20-%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BX%7D%20%5C%5C%20-%20%5Cmathbf%7BX%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20&amp;%20%5Cmathbf%7BX%7D%5Cend%7Barray%7D%5Cright%5D.%0A"> This representation is particularly helpful if <img src="https://latex.codecogs.com/png.latex?d%20%3C%20a">, because in this case <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D"> is of lower dimension and so simpler (in a sense) than <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D%5E%7B-1%7D">.</p>
<p>Another equivalency is more helpful when <img src="https://latex.codecogs.com/png.latex?d%20%3E%20a">. Here, take <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BW%7D%20=%20%5Cleft(%5Cmathbf%7BA%7D%20-%20%5Cmathbf%7BB%7D%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5Cmathbf%7BC%7D%5Cright)%5E%7B-1%7D">, an <img src="https://latex.codecogs.com/png.latex?a%20%5Ctimes%20a"> matrix (and so of lower dimension than <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BD%7D">). Then <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BP%7D%5E%7B-1%7D%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D%20%5Cmathbf%7BW%7D%20&amp;%20-%20%5Cmathbf%7BW%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5C%5C%20-%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BW%7D%20&amp;%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BW%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BD%7D%5E%7B-1%7D%5Cend%7Barray%7D%5Cright%5D.%0A"> Of course, this is just two ways of writing the same thing. You can see this by applying <a href="../..\Woodbury-identity/">everyone’s favorite matrix identity</a> to find that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BW%7D%20=%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BX%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D%20=%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BW%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BD%7D%5E%7B-1%7D">. It is an interesting little algebraic exercise to show that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BW%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BD%7D%5E%7B-1%7D%20=%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BB%7D%20%5Cmathbf%7BX%7D"> and that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BD%7D%5E%7B-1%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BW%7D%20=%20%5Cmathbf%7BX%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D">.</p>
<p>These representations of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BP%7D%5E%7B-1%7D"> are useful for a variety of statistical problems. To give just one example, they lead to a very direct proof of the <a href="https://en.wikipedia.org/wiki/Frisch%E2%80%93Waugh%E2%80%93Lovell_theorem">Frisch-Waugh-Lovell theorem</a>, including under more general conditions than are usually stated.</p>


<!-- -->



<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://tminka.github.io/papers/matrix/">Minka’s notes</a> on partitioned matrices treat a more general case, in which <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BD%7D"> need not be square matrices, nor must they be invertible.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2021,
  author = {Pustejovsky, James E.},
  title = {Inverting Partitioned Matrices},
  date = {2021-10-20},
  url = {https://jepusto.com/posts/inverting-partitioned-matrices},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2021" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2021. <span>“Inverting Partitioned
Matrices.”</span> October 20, 2021. <a href="https://jepusto.com/posts/inverting-partitioned-matrices">https://jepusto.com/posts/inverting-partitioned-matrices</a>.
</div></div></section></div> ]]></description>
  <category>matrix algebra</category>
  <guid>https://jepusto.com/posts/inverting-partitioned-matrices/</guid>
  <pubDate>Wed, 20 Oct 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Standardized mean differences in single-group, repeated measures designs</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/SMDs-in-single-group/</link>
  <description><![CDATA[ 





<p>I received a question from a colleague about computing variances and covariances for standardized mean difference effect sizes from a design involving a single group, measured repeatedly over time. Deriving these quantities is a little exercise in normal distribution theory, which I find kind of relaxing sometimes (hey, we all have our coping mechanisms!).</p>
<section id="the-set-up" class="level1">
<h1>The set-up</h1>
<p>Consider a study in which a single group of <img src="https://latex.codecogs.com/png.latex?n"> participants was measured at each of <img src="https://latex.codecogs.com/png.latex?T%20+%201"> time-points, indexed as <img src="https://latex.codecogs.com/png.latex?t%20=%200,...,T">. At the first time-point, there has not yet been any exposure to an intervention. At the second and subsequent time-points, there is some degree of exposure, and so we are interested in describing change between time point <img src="https://latex.codecogs.com/png.latex?t%20%3E%200"> and time-point 0. For each time-point, we have a sample mean <img src="https://latex.codecogs.com/png.latex?%5Cbar%7By%7D_t"> and a sample standard deviation <img src="https://latex.codecogs.com/png.latex?s_%7Bt%7D">. For now, assume that there is complete response. Let <img src="https://latex.codecogs.com/png.latex?%5Cmu_t"> denote the population mean and <img src="https://latex.codecogs.com/png.latex?%5Csigma_t"> denote the population standard deviation, both at time <img src="https://latex.codecogs.com/png.latex?t">. Let <img src="https://latex.codecogs.com/png.latex?%5Crho_%7Bst%7D"> denote the correlation between outcomes measured at time <img src="https://latex.codecogs.com/png.latex?s"> and time <img src="https://latex.codecogs.com/png.latex?t">, for <img src="https://latex.codecogs.com/png.latex?s,t%20=%200,..,T">, where <img src="https://latex.codecogs.com/png.latex?%5Crho_%7Btt%7D%20=%201">. We might also have sample correlations for each time point, denoted <img src="https://latex.codecogs.com/png.latex?r_%7Bst%7D">. We calculate a standardized mean difference for each time-point <img src="https://latex.codecogs.com/png.latex?t%20%3E%200"> by taking <img src="https://latex.codecogs.com/png.latex?%0Ad_t%20=%20%5Cfrac%7B%5Cbar%7By%7D_t%20-%20%5Cbar%7By%7D_0%7D%7Bs_P%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?s_p"> is the sample standard deviation pooled across all time-points: <img src="https://latex.codecogs.com/png.latex?%0As_P%5E2%20=%20%5Cfrac%7B1%7D%7BT+1%7D%5Csum_%7Bt=0%7D%5ET%20s_t%5E2.%0A"> The question is then, what is <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(d_t)"> and what is <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(d_s,%20d_t)">, for <img src="https://latex.codecogs.com/png.latex?s,t%20=%201,...,T">?</p>
</section>
<section id="the-results" class="level1">
<h1>The results</h1>
<p>Define the <em>unstandardized</em> mean difference between time-point <img src="https://latex.codecogs.com/png.latex?t"> and time-point 0 as <img src="https://latex.codecogs.com/png.latex?D_t%20=%20%5Cbar%7By%7D_t%20-%20%5Cbar%7By%7D_0">. Then, from the algebra of variances and covariances, we have <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(D_t)%20=%20%5Cfrac%7B1%7D%7Bn%7D%5Cleft(%5Csigma_0%5E2%20+%20%5Csigma_t%5E2%20-%202%20%5Crho_%7Bt0%7D%20%5Csigma_0%20%5Csigma_t%5Cright)%0A"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(D_s,%20D_t)%20=%20%5Cfrac%7B1%7D%7Bn%7D%5Cleft%5B%5Csigma_0%5E2%20+%20%5Crho_%7Bst%7D%20%5Csigma_s%20%5Csigma_t%20-%20%5Csigma_0%20%5Cleft(%5Crho_%7Bs0%7D%20%5Csigma_s%20+%20%5Crho_%7Bt0%7D%20%5Csigma_t%5Cright)%20%5Cright%5D."> From a <a href="../..\distribution-of-sample-variances/">previous post</a> about the distribution of sample variances, we have that <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BCov%7D(s_s%5E2,%20s_t%5E2)%20=%20%5Cfrac%7B2%20%5Cleft(%5Crho_%7Bst%7D%20%5Csigma_s%20%5Csigma_t%5Cright)%5E2%7D%7Bn%20-%201%7D.%0A"> Consequently, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctext%7BVar%7D(s_P%5E2)%20&amp;=%20%5Cfrac%7B1%7D%7B(T%20+%201)%5E2%7D%20%5Csum_%7Bs=0%7D%5ET%20%5Csum_%7Bt=0%7D%5ET%20%5Ctext%7BCov%7D(s_s%5E2,%20s_t%5E2)%20%5C%5C%0A&amp;=%20%5Cfrac%7B2%7D%7B(n-1)(T%20+%201)%5E2%7D%20%5Csum_%7Bs=0%7D%5ET%20%5Csum_%7Bt=0%7D%5ET%20%5Cleft(%5Crho_%7Bst%7D%20%5Csigma_s%20%5Csigma_t%5Cright)%5E2.%0A%5Cend%7Baligned%7D%0A"> Let <img src="https://latex.codecogs.com/png.latex?%5Csigma_P%5E2%20=%20%5Cfrac%7B1%7D%7BT+1%7D%5Csum_%7Bt=0%7D%5ET%20%5Csigma_t%5E2"> denote the average population variance across all <img src="https://latex.codecogs.com/png.latex?T%20+%201"> time-points, and let <img src="https://latex.codecogs.com/png.latex?%5Cdelta_t"> denote the standardized mean difference parameter at time <img src="https://latex.codecogs.com/png.latex?t">. Then, following the <a href="../..\multivariate-delta-method/">multivariate delta method</a>, <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(d_t)%20%5Capprox%20%5Cfrac%7B%5Ctext%7BVar%7D(D_t)%7D%7B%5Csigma_P%5E2%7D%20+%20%5Cfrac%7B%5Cdelta_t%5E2%7D%7B2%20%5Cnu%7D%20%5Cqquad%20%5Ctext%7Band%7D%20%5Cqquad%20%5Ctext%7BCov%7D(d_s,%20d_t)%20%5Capprox%20%5Cfrac%7B%5Ctext%7BCov%7D(D_s,%20D_t)%7D%7B%5Csigma_P%5E2%7D%20+%20%5Cfrac%7B%5Cdelta_s%20%5Cdelta_t%7D%7B2%20%5Cnu%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%7B%5Cnu%20=%20%5Cfrac%7B2%20%5Csigma_P%5E4%7D%7B%5Ctext%7BVar%7D(s_P%5E2)%7D%7D">.</p>
<p>Without imposing further assumptions, and assuming that we have access to the sample correlations between time-points, a feasible estimator of the sampling variance of <img src="https://latex.codecogs.com/png.latex?d_t"> is <img src="https://latex.codecogs.com/png.latex?%0AV_t%20=%20%5Cfrac%7Bs_0%5E2%20+%20s_t%5E2%20-%202%20r_%7Bt0%7D%20s_0%20s_t%7D%7Bn%20s_P%5E2%7D%20+%20%5Cfrac%7Bd_t%5E2%7D%7B2%20%5Chat%5Cnu%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cnu%20=%20%5Cfrac%7B(n-1)%20s_p%5E4%7D%7B%5Cfrac%7B1%7D%7B(T%20+%201)%5E2%7D%5Csum_%7Bs=0%7D%5ET%20%5Csum_%7Bt=0%7D%5ET%20r_%7Bst%7D%5E2%20s_s%5E2%20s_t%5E2%7D.%0A"> Similarly, a feasible estimator for the covariance between <img src="https://latex.codecogs.com/png.latex?d_s"> and <img src="https://latex.codecogs.com/png.latex?d_t"> is <img src="https://latex.codecogs.com/png.latex?%0AC_%7Bst%7D%20=%20%5Cfrac%7Bs_0%5E2%20+%20r_%7Bst%7D%20s_s%20s_t%20-%20s_0%20%5Cleft(r_%7Bs0%7D%20s_s%20+%20r_%7Bt0%7D%20s_t%5Cright)%7D%7Bn%20s_P%5E2%7D%20+%20%5Cfrac%7Bd_s%20d_t%7D%7B2%20%5Chat%5Cnu%7D.%0A"></p>
<p>In some cases, it might be reasonable to use further assumptions about distributional structure in order to simplify these approximations. In particular, suppose we assume that the population variances are constant across time-points, <img src="https://latex.codecogs.com/png.latex?%5Csigma_0%20=%20%5Csigma_1%20=%20%5Ccdots%20=%20%5Csigma_T">. In this case, the variances and covariances no longer depend on the scale of the outcome, and we have <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cnu%20=%20%5Cfrac%7B(n%20-%201)(T%20+%201)%7D%7BT%20R%20+%201%7D,%20%5Cqquad%20%5Ctext%7Bwhere%7D%20%5Cqquad%20R%20=%20%5Cfrac%7B2%7D%7BT%20(T%20+%201)%7D%5Csum_%7Bs=0%7D%5E%7BT-1%7D%20%5Csum_%7Bt=s+1%7D%5ET%20r_%7Bst%7D%5E2%0A"> (here, <img src="https://latex.codecogs.com/png.latex?R"> is the average of the squared correlations between pairs of distinct time-points). Since <img src="https://latex.codecogs.com/png.latex?R"> will always be less than 1, <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cnu"> will always be larger than <img src="https://latex.codecogs.com/png.latex?n%20-%201">. If sample correlations aren’t reported or available, it would seem fairly reasonable to use <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cnu%20=%20n%20-%201">, or to make a rough assumption about the average squared correlation <img src="https://latex.codecogs.com/png.latex?R">. With the approximate degrees of freedom <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cnu">, the variances and covariances are then given by <img src="https://latex.codecogs.com/png.latex?%0AV_t%20=%20%5Cfrac%7B2(1%20-%20r_%7Bt0%7D)%7D%7Bn%7D%20+%20%5Cfrac%7Bd_t%5E2%7D%7B2%20%5Chat%5Cnu%7D%20%5Cqquad%20%5Ctext%7Band%7D%20%5Cqquad%20C_%7Bst%7D%20=%20%5Cfrac%7B1%20+%20r_%7Bst%7D%20-%20r_%7Bs0%7D%20-%20r_%7Bt0%7D%7D%7Bn%7D%20+%20%5Cfrac%7Bd_s%20d_t%7D%7B2%20%5Chat%5Cnu%7D.%0A"></p>
</section>
<section id="extension" class="level1">
<h1>Extension</h1>
<p>In some contexts, one might encounter a design that uses <em>over-lapping</em> but <em>not identical</em> samples at each time-point. For instance, in a rotating panel survey, each participant is measured repeatedly for some small number of time-points <img src="https://latex.codecogs.com/png.latex?p%20%3C%20T%20+%201"> (say <img src="https://latex.codecogs.com/png.latex?p%20=%202"> or <img src="https://latex.codecogs.com/png.latex?p%20=%203">), and new participants are added to the sample with each new time-point. The simple repeated measures set-up that I described in this post is an imperfect approximation for such designs. In dealing with such a design, suppose that one knew the total number of observations at each time-point, denoted <img src="https://latex.codecogs.com/png.latex?n_t"> for <img src="https://latex.codecogs.com/png.latex?t%20=%200,...,T">, as well as the number of observations that were common across any pair of time-points, denoted as <img src="https://latex.codecogs.com/png.latex?n_%7Bst%7D"> for <img src="https://latex.codecogs.com/png.latex?s,t%20=%200,...,T">. Further suppose that the drop-outs and additions are ignorable (missing completely at random), so that any subset of participants defined by a pattern of response or non-response is still representative of the full population. I leave it as an exercise for the reader (a relaxing and fun one!) to derive <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(d_t)"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(d_s,%20d_t)"> under such a model.</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2021,
  author = {Pustejovsky, James E.},
  title = {Standardized Mean Differences in Single-Group, Repeated
    Measures Designs},
  date = {2021-10-06},
  url = {https://jepusto.com/posts/SMDs-in-single-group},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2021" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2021. <span>“Standardized Mean Differences in
Single-Group, Repeated Measures Designs.”</span> October 6, 2021. <a href="https://jepusto.com/posts/SMDs-in-single-group">https://jepusto.com/posts/SMDs-in-single-group</a>.
</div></div></section></div> ]]></description>
  <category>effect size</category>
  <category>standardized mean difference</category>
  <category>distribution theory</category>
  <guid>https://jepusto.com/posts/SMDs-in-single-group/</guid>
  <pubDate>Wed, 06 Oct 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Finding the distribution of significant effect sizes</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/number-of-significant-effects/</link>
  <description><![CDATA[ 





<p>In basic meta-analysis, where each study contributes just a single effect size estimate, there has been a lot of work devoted to developing models for selective reporting. Most of these models formulate the selection process as a function of the statistical significance of the effect size estimate; some also allow for the possibility that the precision of the study’s effect influences the probability of selection (i.e., bigger studies are more likely to be reported, regardless of statistical significance).</p>
<p>A problem that I’ve been mulling recently is how to think about selective reporting in meta-analyses that include some studies with <em>multiple</em> effect size estimates. This setting is quite a bit more complicated than basic meta-analysis because there are several different ways that selective reporting could happen. It could be that each effect size estimate is selected (or censored) individually, on the basis of its statistical significance. However, it seems just as plausible that the pattern of statistical significance across the full set of results could influence whether <em>any</em> of the results get selected.</p>
<p>In pondering this stuff, I’m trying to find ways to simplify the space of possibilities or formulate stylized (or “toy”) problems that are more tractable. Here is one such problem. I’ll write it as a question such as you might find in a problem set from a course on statistical distribution theory.</p>
<section id="the-general-problem" class="level1">
<h1>The general problem</h1>
<p>Consider a study that assesses some effect size across <img src="https://latex.codecogs.com/png.latex?m"> different outcomes. Let <img src="https://latex.codecogs.com/png.latex?T_i"> denote the effect size estimate for outcome <img src="https://latex.codecogs.com/png.latex?i">, let <img src="https://latex.codecogs.com/png.latex?V_i"> denote the sampling variance of the effect size estimate for outcome <img src="https://latex.codecogs.com/png.latex?i">, and let <img src="https://latex.codecogs.com/png.latex?%5Ctheta_i"> denote the true effect size parameter for corresponding to outcome <img src="https://latex.codecogs.com/png.latex?i">. Assume that <img src="https://latex.codecogs.com/png.latex?T_i%20%5Csim%20N(%5Ctheta_i,%20V_i),"> where <img src="https://latex.codecogs.com/png.latex?V_i"> is known. Define <img src="https://latex.codecogs.com/png.latex?A_i"> as an indicator that is equal to one if <img src="https://latex.codecogs.com/png.latex?T_i"> is statistically significant at level <img src="https://latex.codecogs.com/png.latex?%5Calpha"> based on a one-sided test, and otherwise equal to zero. (Equivalently, let <img src="https://latex.codecogs.com/png.latex?A_i"> be equal to one if the effect is statistically significant at level <img src="https://latex.codecogs.com/png.latex?2%20%5Calpha"> and in the theoretically expected direction.) Formally, <img src="https://latex.codecogs.com/png.latex?A_i%20=%20I%5Cleft(%5Cfrac%7BT_i%7D%7B%5Csqrt%7BV_i%7D%7D%20%3E%20q_%5Calpha%20%5Cright)"> where <img src="https://latex.codecogs.com/png.latex?q_%5Calpha%20=%20%5CPhi%5E%7B-1%7D(1%20-%20%5Calpha)"> is the critical value from a standard normal distribution (e.g., <img src="https://latex.codecogs.com/png.latex?q_%7B.05%7D%20=%20%60%7Br%7D%20round(qnorm(0.95),3)%60">, <img src="https://latex.codecogs.com/png.latex?q_%7B.025%7D%20=%20%60%7Br%7D%20round(qnorm(0.975),3)%60">). Let <img src="https://latex.codecogs.com/png.latex?N_A%20=%20%5Csum_%7Bi=1%7D%5Em%20A_i"> denote the total number of statistically significant effect sizes in the study. Our general interest is in the distribution of <img src="https://latex.codecogs.com/png.latex?N_A">.</p>
<section id="compound-symmetry" class="level2">
<h2 class="anchored" data-anchor-id="compound-symmetry">Compound symmetry</h2>
<p>In general, the distribution of <img src="https://latex.codecogs.com/png.latex?N_A"> will depend on the joint distribution of <img src="https://latex.codecogs.com/png.latex?(T_1,...,T_m)">, so we will need to make some further assumptions regarding that joint distribution in order to make progress here. One simplifying assumption that seems worth considering is that the effect size estimates follow a compound symmetric distribution. Specifically, assume that all of the effect size estimates have equal sampling variance, <img src="https://latex.codecogs.com/png.latex?V_1%20=%20V_2%20=%20%5Ccdots%20=%20V_m%20=%20V">, and that there is a constant correlation between every pair of effect size estimates: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(T_h,%20T_i)%20=%20%5Crho%20V"> for some correlation <img src="https://latex.codecogs.com/png.latex?%5Crho">. Further, assume that the true effect sizes vary based on a compound symmetric distribution where <img src="https://latex.codecogs.com/png.latex?%0A%5Ctheta_i%20%5Csim%20N(%5Cmu,%20%5Comega%5E2).%0A"> All of this implies that the joint distribution of the effect size estimates is compound symmetric: <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft(%5Cbegin%7Barray%7D%7Bc%7D%20T_1%20%5C%5C%20T_2%20%5C%5C%20%5Cvdots%20%5C%5C%20T_m%20%5Cend%7Barray%7D%5Cright)%20%5Csim%20N%5Cleft%5B%20%5Cmu%20%5Cmathbf%7B1%7D_m,%20%5C%20%5Cleft(%5Comega%5E2%20+%20%5Crho%20V%5Cright)%5Cmathbf%7BJ%7D_m%20+%20(1%20-%20%5Crho)%20V%20%5Cmathbf%7BI%7D_m%20%5Cright%5D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B1%7D_m"> is an <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%201"> vector of 1’s, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BJ%7D_m"> is an <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20m"> matrix of 1’s, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BI%7D_m"> is an <img src="https://latex.codecogs.com/png.latex?m%20%5Ctimes%20m"> identity matrix.</p>
<p>Given the above assumptions, What is the distribution of <img src="https://latex.codecogs.com/png.latex?N_A">?</p>
<p>Please write to me if you’d like to discuss the theory or implications of this problem.</p>


<!-- -->

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2021,
  author = {Pustejovsky, James E.},
  title = {Finding the Distribution of Significant Effect Sizes},
  date = {2021-04-27},
  url = {https://jepusto.com/posts/number-of-significant-effects},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2021" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2021. <span>“Finding the Distribution of
Significant Effect Sizes.”</span> April 27, 2021. <a href="https://jepusto.com/posts/number-of-significant-effects">https://jepusto.com/posts/number-of-significant-effects</a>.
</div></div></section></div> ]]></description>
  <category>effect size</category>
  <category>distribution theory</category>
  <guid>https://jepusto.com/posts/number-of-significant-effects/</guid>
  <pubDate>Tue, 27 Apr 2021 05:00:00 GMT</pubDate>
</item>
<item>
  <title>The Woodbury identity</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Woodbury-identity/</link>
  <description><![CDATA[ 





<p>As in many parts of life, statistics is full of little bits of knowledge that are useful if you happen to know them, but which hardly anybody ever bothers to mention. You would think, if something is so useful, perhaps your professors would spend a fair bit of time explaining it to you. But maybe the stuff seems trivial, obvious, or simple to them, so they don’t bother.</p>
<p>One example of this is Excel keyboard shortcuts. In a previous life, I was an Excel jockey so I learned all the keyboard shortcuts, such as how to move the cursor to the last cell in a continuous block of entries (<code>ctrl</code> + an arrow key). Whenever I do this while sharing a screen in a meeting, someone is invariably astounded and wants to know what dark sorcery I’m conjuring. It’s a simple trick, but a useful one—especially if you’re working with a really large dataset with thousands of rows. But it’s also something that there’s no reason to expect anyone to figure out on their own, and that no stats or quant methods professor is going to spend class time demonstrating.</p>
<p>Let me explain another, slightly more involved example, involving one of my favorite pieces of matrix algebra. There’s a thing called the Woodbury identity, also known as the Sherman-Morrison-Woodbury identity, that is a little life hack for inverting certain types of matrices. It has a <a href="https://en.wikipedia.org/wiki/Woodbury_matrix_identity">Wikipedia page</a>, which I have visited many times. It is a very handy bit of math, if you happen to be a statistics student working with hierarchical models (such as meta-analytic models). I’ll give a statement of the identity, then explain a bit about the connection to hierarchical models.</p>
<section id="the-woodbury-identity" class="level1">
<h1>The Woodbury identity</h1>
<p>Say that you’ve got four matrices, an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20n"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D">, a <img src="https://latex.codecogs.com/png.latex?k%20%5Ctimes%20k"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BC%7D">, an <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20k"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BU%7D">, and a <img src="https://latex.codecogs.com/png.latex?k%20%5Ctimes%20n"> matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D">. Assume that <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BA%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BC%7D"> are invertible. The Woodbury identity tells you how to get the inverse of a certain combination of these matrices: <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft(%5Cmathbf%7BA%7D%20+%20%5Cmathbf%7BU%7D%20%5Cmathbf%7BC%7D%20%5Cmathbf%7BV%7D%5Cright)%5E%7B-1%7D%20=%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20-%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BU%7D%20%5Cleft(%5Cmathbf%7BC%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BV%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D%20%5Cmathbf%7BU%7D%20%5Cright)%5E%7B-1%7D%20%5Cmathbf%7BV%7D%20%5Cmathbf%7BA%7D%5E%7B-1%7D.%0A"> Admit it, you’re impressed. “Dude! Mind. Blown.” you’re probably saying to yourself right now.</p>
<p>Or perhaps you’re still a touch skeptical that this formula is worth knowing. Let me explain the connection to hierarchical models.</p>
</section>
<section id="hierarchical-models" class="level1">
<h1>Hierarchical models</h1>
<p>Hierarchical linear models are a mainstay of statistical analysis in many, many areas of application, including education research, where we often deal with data collected on individuals (students, teachers) nested within larger aggregate units (like schools). In meta-analysis, these models come up if we’re dealing with samples that have more than one relevant outcome, so that we have multiple effect size estimates nested within a given sample or study.</p>
<p>Suppose we have a hierarchical structure with <img src="https://latex.codecogs.com/png.latex?J"> clusters, where cluster <img src="https://latex.codecogs.com/png.latex?j"> has <img src="https://latex.codecogs.com/png.latex?n_j"> individual observations. A quite general way of expressing a hierarchical model for such a data structure is <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BY%7D_j%20=%20%5Cmathbf%7BX%7D_j%20%5Cboldsymbol%5Cbeta%20+%20%5Cmathbf%7BZ%7D_j%20%5Cboldsymbol%5Ceta_j%20+%20%5Cboldsymbol%5Cepsilon_j,%0A"> for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,J">, where, for cluster <img src="https://latex.codecogs.com/png.latex?j">:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BY%7D_j"> is an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%201"> vector of outcomes,</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_j"> is an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%20p"> design matrix for the fixed effects,</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cbeta"> is a <img src="https://latex.codecogs.com/png.latex?p%20%5Ctimes%201"> vector of fixed effect coefficients,</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BZ%7D_j"> is an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%20q"> design matrix for the random effects,</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Ceta_j"> is a <img src="https://latex.codecogs.com/png.latex?q%20%5Ctimes%201"> vector of random effects, and</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cepsilon_j"> is an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%201"> vector of level-1 errors.</li>
</ul>
<p>In this model, we assume that the random effects have mean zero and unknown variance-covariance matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D">, often assumed to be an unstructured, symmetric and invertible matrix; we assume that the level-1 errors are also mean zero with variance-covariance matrix <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j">; and we assume that <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Ceta_j"> is independent of <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cepsilon_j">. In many instances, we might assume that the entries of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Be%7D_j"> are all independent, so <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j"> will be a multiple of an identity matrix, <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j%20=%20%5Csigma%5E2%20%5Cmathbf%7BI%7D_j">. In other instances (such as models for longitudinal data), <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma"> might be a patterned matrix that includes off-diagonal terms, such as an auto-regressive structure.</p>
<p>What is the marginal variance of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BY%7D_j%20%7C%20%5Cmathbf%7BX%7D_j"> in this model? In other words, if we combine the variance due to the random effects and the variance of the level-1 errors, what do we get? We get <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D%5Cleft(%5Cmathbf%7BY%7D_j%20%7C%20%5Cmathbf%7BX%7D_j%20%5Cright)%20=%20%5Cmathbf%7BV%7D_j%20=%20%5Cmathbf%7BZ%7D_j%20%5Cmathbf%7BT%7D%20%5Cmathbf%7BZ%7D_j'%20+%20%5Cboldsymbol%5CSigma_j,%0A"> a matrix that, if you reverse the terms, looks like <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BV%7D_j%20=%20%5Cboldsymbol%5CSigma_j%20+%20%5Cmathbf%7BZ%7D_j%20%5Cmathbf%7BT%7D%20%5Cmathbf%7BZ%7D_j'%0A"> a simple form of the combination of matrices in the left-hand side of the Woodbury identity. Thus, the identity tells us how we can invert this matrix.</p>
<p>But why would we care about inverting this variance-covariance matrix, you might ask? One good reason is that the fixed effect coefficients in the hierarchical model are estimated by weighted least squares, where the weight matrices are the inverse of an estimate of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j">. Thus, to understand how the weights in a hierarchical model work, it’s quite useful to be able to invert <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j">. Another good (related) reason is that the sampling variance of the fixed effect estimates is approximately <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Cboldsymbol%7B%5Chat%5Cbeta%7D)%20%5Capprox%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7BX%7D_j'%5Cmathbf%7BV%7D_j%5E%7B-1%7D%20%5Cmathbf%7BX%7D_j%20%5Cright)%5E%7B-1%7D%0A"> (it would be exact if we knew the parameters of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j"> with certainty). So if we want to understand the precision of <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Chat%5Cbeta%7D"> or the power of a hypothesis test involving <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Chat%5Cbeta%7D">, then we we won’t be able to get very far without inverting <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j">.</p>
<p>Directly applying the identity, we get <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BV%7D_j%5E%7B-1%7D%20=%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20-%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20%5Cmathbf%7BZ%7D_j%20%5Cleft(%5Cmathbf%7BT%7D%5E%7B-1%7D%20+%20%5Cmathbf%7BZ%7D_j'%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%5Cmathbf%7BZ%7D_j%20%5Cright)%5E%7B-1%7D%20%5Cmathbf%7BZ%7D_j'%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%0A"> This expression looks like a bit of a mess, I’ll admit, but it can be useful. Things simplify quite a bit of <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j%5E%7B-1%7D"> has a form that is easy to invert (like a multiple of an identity matrix) and if the dimension of the random effects <img src="https://latex.codecogs.com/png.latex?q"> is small. Under these conditions, <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j%5E%7B-1%7D"> is easy to work with, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D%5E%7B-1%7D"> is manageable because it has small dimensions, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BZ%7D_j'%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%5Cmathbf%7BZ%7D_j"> becomes manageable because it also has small dimensions (<img src="https://latex.codecogs.com/png.latex?q%20%5Ctimes%20q">, in both cases).</p>
<section id="random-intercepts" class="level2">
<h2 class="anchored" data-anchor-id="random-intercepts">Random intercepts</h2>
<p>As an example, consider a very simple model that includes only random intercepts, so <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BZ%7D_j%20=%20%5Cmathbf%7B1%7D_j">, an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%201"> vector with every entry equal to 1, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D"> is simply <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">, the variance of the random intercepts. For simplicity, let’s also assume that the level-1 errors are independent, so <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j%20=%20%5Csigma%5E2%20%5Cmathbf%7BI%7D_j"> and <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20=%20%5Csigma%5E%7B-2%7D%20%5Cmathbf%7BI%7D_j">. Applying the Woodbury identity, <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathbf%7BV%7D_j%5E%7B-1%7D%20&amp;=%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20-%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j%20%5Cleft(%5Cmathbf%7BT%7D%5E%7B-1%7D%20+%20%5Cmathbf%7B1%7D_j'%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%5Cmathbf%7B1%7D_j%20%5Cright)%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j'%20%5Cboldsymbol%5CSigma_j%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Csigma%5E%7B-2%7D%20%5Cmathbf%7BI%7D_j%20-%20%5Csigma%5E%7B-4%7D%20%5Cmathbf%7B1%7D_j%20%5Cleft(%5Ctau%5E%7B-2%7D%20+%20%5Csigma%5E%7B-2%7D%20%5Cmathbf%7B1%7D_j'%5Cmathbf%7B1%7D_j%20%5Cright)%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j'%20%5C%5C%0A&amp;=%20%5Csigma%5E%7B-2%7D%20%5Cmathbf%7BI%7D_j%20-%20%5Csigma%5E%7B-4%7D%20%5Cleft(%5Ctau%5E%7B-2%7D%20+%20%5Csigma%5E%7B-2%7D%20n_j%20%5Cright)%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20%5C%5C%0A&amp;=%20%5Csigma%5E%7B-2%7D%20%5Cleft(%5Cmathbf%7BI%7D_j%20-%20%5Cfrac%7B%5Ctau%5E2%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%5Cright).%0A%5Cend%7Baligned%7D%0A"> Try checking this for yourself by carrying through the matrix algebra for <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j%20%5Cmathbf%7BV%7D_j%5E%7B-1%7D">, which should come out equal to <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BI%7D_j">.</p>
<p>Now suppose that the design matrix is also quite simple, consisting of just an intercept term <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_j%20=%20%5Cmathbf%7B1%7D_j">, so that <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cbeta%20=%20%5Cbeta"> is simply a population mean. How precise is the estimate of the population mean from this hierarchical model? Well, the sampling variance of the estimator <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cbeta"> is approximately <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Ctext%7BVar%7D(%5Chat%5Cbeta)%20&amp;%5Capprox%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7B1%7D_j'%5Cmathbf%7BV%7D_j%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j%20%5Cright)%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Cleft(%5Csigma%5E%7B-2%7D%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7B1%7D_j'%20%5Cleft(%5Cmathbf%7BI%7D_j%20-%20%5Cfrac%7B%5Ctau%5E2%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%5Cright)%20%5Cmathbf%7B1%7D_j%20%5Cright)%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Cleft(%5Csigma%5E%7B-2%7D%20%5Csum_%7Bj=1%7D%5EJ%20n_j%20%5Cleft(1%20-%20%5Cfrac%7Bn_j%20%5Ctau%5E2%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cright)%20%20%5Cright)%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Cleft(%20%5Csigma%5E%7B-2%7D%20%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7Bn_j%20%5Csigma%5E2%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cright)%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7Bn_j%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cright)%5E%7B-1%7D%20%5C%5C%0A&amp;=%20%5Cleft(%5Csigma%5E2%20+%20%5Ctau%5E2%5Cright)%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7Bn_j%7D%20%7B1%20+%20(n_j%20-%201)%20%5Crho%7D%20%5Cright)%5E%7B-1%7D,%0A%5Cend%7Baligned%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%20%5Ctau%5E2%20/%20(%5Ctau%5E2%20+%20%5Csigma%5E2)"> is the intra-class correlation. Squint at this expression for a bit and you can see how the ICC influences the varince. If <img src="https://latex.codecogs.com/png.latex?%5Crho"> is near zero, then the sampling variance will be close to <img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Csigma%5E2%20+%20%5Ctau%5E2%5Cright)%20/%20N">, which is what you would get if you treated every observation as independent. If <img src="https://latex.codecogs.com/png.latex?%5Crho"> is near 1, then the sampling variance ends up being nearly <img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Csigma%5E2%20+%20%5Ctau%5E2%5Cright)%20/%20J">, which is what you would get if you treated every cluster as a single observation. For intermediate ICCs, the sample size from cluster <img src="https://latex.codecogs.com/png.latex?j"> (in the numerator of the fraction inside the summation) gets cut down to size accordingly.</p>
<p>The estimator of the population mean is a weighted average of the outcomes. Specifically, <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cbeta%20=%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7B1%7D_j'%5Cmathbf%7B%5Chat%7BV%7D%7D_j%5E%7B-1%7D%20%5Cmathbf%7B1%7D_j%20%5Cright)%5E%7B-1%7D%20%5Csum_%7Bj=1%7D%5EJ%20%5Cmathbf%7B1%7D_j'%5Cmathbf%7B%5Chat%7BV%7D%7D_j%5E%7B-1%7D%20%5Cmathbf%7BY%7D_j,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B%5Chat%7BV%7D%7D_j"> is an estimator of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j">. If you carry through the matrix algebra, you’ll find that <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Chat%5Cbeta%20&amp;=%20%5Cleft(%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7Bn_j%7D%20%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5Cright)%5E%7B-1%7D%20%5Csum_%7Bj=1%7D%5EJ%20%5Cfrac%7B%5Cmathbf%7B1%7D_j'%5Cmathbf%7BY%7D_j%7D%7B%5Csigma%5E2%20+%20n_j%20%5Ctau%5E2%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BW%7D%20%5Csum_%7Bj=1%7D%5EJ%20%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20w_j%20y_%7Bij%7D,%0A%5Cend%7Baligned%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?w_j%20=%20%5Cfrac%7B1%7D%7B1%20+%20(n_j%20-%201)%20%5Crho%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%7BW%20=%20%5Csum_%7Bj=1%7D%5EJ%20n_j%20w_j%7D">. From this, we can see that the weight of a given observation depends on the ICC and the size of the cluster. If the ICC is low, then weights will all be close to 1. For higher ICCs, observations in smaller clusters get proportionately <em>more</em> weight than observations in larger clusters.</p>
</section>
<section id="a-meta-analysis-example" class="level2">
<h2 class="anchored" data-anchor-id="a-meta-analysis-example">A meta-analysis example</h2>
<p>In a <a href="../..\weighting-in-multivariate-meta-analysis/">previous post</a> on multi-variate meta-analysis, I examined how weighting works in some multi-variate meta-analysis models, where you have multiple effect size estimates nested within a study. Letting <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> denote effect size estimate <img src="https://latex.codecogs.com/png.latex?i"> in study <img src="https://latex.codecogs.com/png.latex?j">, for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_j"> and <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,J">. The first model I considered in the previous post was <img src="https://latex.codecogs.com/png.latex?%0AT_%7Bij%7D%20=%20%5Cmu%20+%20%5Ceta_j%20+%20%5Cnu_%7Bij%7D%20+%20e_%7Bij%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Ceta_j)%20=%20%5Ctau%5E2">, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cnu_%7Bij%7D)%20=%20%5Comega%5E2">, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(e_%7Bij%7D)%20=%20V_j">, treated as known, and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bcor%7D(e_%7Bhj%7D,%20e_%7Bij%7D)%20=%20%5Crho"> for some specified value of <img src="https://latex.codecogs.com/png.latex?%5Crho">.<sup>1</sup> This model makes the simplifying assumptions that the effect sizes within a given study all have the same sampling variance, <img src="https://latex.codecogs.com/png.latex?V_j">, and that there is a single correlation between pairs of outcomes from the same study, that is constant across all pairs of outcomes and across all studies.</p>
<p>You can write this model in matrix form as <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BT%7D_j%20=%20%5Cmu%20%5Cmathbf%7B1%7D_j%20+%20%5Ceta_j%20%5Cmathbf%7B1%7D_j%20+%20%5Cboldsymbol%5Cnu_j%20+%20%5Cmathbf%7Be%7D_j,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cboldsymbol%5Cnu_j)%20=%20%5Comega%5E2%20%5Cmathbf%7BI%7D_j"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cmathbf%7Be%7D_j)%20=%20V_j%20%5Cleft%5B%5Crho%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20+%20(1%20-%20%5Crho)%20%5Cmathbf%7BI%7D_j%5Cright%5D">. It follows that <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Cmathbf%7BT%7D_j)%20=%20(%5Ctau%5E2%20+%20V_j%5Crho)%20%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20+%20%5B%5Comega%5E2%20+%20V_j%20(1%20-%20%5Crho)%5D%20%5Cmathbf%7BI%7D_j.%0A"> The Woodbury identity comes in handy here again, if we want to examine the weights implied by this model or the sampling variance of the overall average effect size estimator.<sup>2</sup> I’ll leave it as an exercise to find an expression for the weight assigned to effect size <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> under this model.<sup>3</sup> You could also try finding an expression for the variance of the overall average effect size estimator <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cmu">, based on inverse-variance weighting, when the model is correctly specified.</p>
</section>
<section id="another-meta-analysis-example" class="level2">
<h2 class="anchored" data-anchor-id="another-meta-analysis-example">Another meta-analysis example</h2>
<p>In the <a href="../..\weighting-in-multivariate-meta-analysis/">previous post</a>, I also covered weighting in a bit more general model, where the sampling variances and correlations are no longer quite so constrained. As before, we have <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BT%7D_j%20=%20%5Cmu%20%5Cmathbf%7B1%7D_j%20+%20%5Ceta_j%20%5Cmathbf%7B1%7D_j%20+%20%5Cboldsymbol%5Cnu_j%20+%20%5Cmathbf%7Be%7D_j,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Ceta_j)%20=%20%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cboldsymbol%5Cnu_j)%20=%20%5Comega%5E2%20%5Cmathbf%7BI%7D_j">. But now let <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cmathbf%7Be%7D_j)%20=%20%5Cboldsymbol%5CSigma_j"> for some arbitrary, symmetric, invertible matrix <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CSigma_j">. The marginal variance of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D_j"> is therefore <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Cmathbf%7BT%7D_j)%20=%20%5Ctau%5E2%5Cmathbf%7B1%7D_j%20%5Cmathbf%7B1%7D_j'%20+%20%5Comega%5E2%20%5Cmathbf%7BI%7D_j%20+%20%5Cboldsymbol%5CSigma_j.%0A"> Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BS%7D_j%20=%20%5Cleft(%5Comega%5E2%20%5Cmathbf%7BI%7D_j%20+%20%5Cboldsymbol%5CSigma_j%5Cright)%5E%7B-1%7D">. Try applying the Woodbury identity to invert <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cmathbf%7BT%7D_j)"> in terms of <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">, <img src="https://latex.codecogs.com/png.latex?n_j">, and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BS%7D_j">. Then see if you can derive the weight assigned to effect <img src="https://latex.codecogs.com/png.latex?i"> in study <img src="https://latex.codecogs.com/png.latex?j"> under this model. See the previous post for the solution.<sup>4</sup></p>


<!-- -->

</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This model is what we call the “correlated-and-hierarchical effects model” in my paper (with Beth Tipton) on <a href="../..\publication/rve-meta-analysis-expanding-the-range/">extending working models for robust variance estimation</a>.↩︎</p></li>
<li id="fn2"><p>Or squint hard at the formula for the variance of <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BT%7D_j">, and you’ll see that it has the same form as the random intercepts model in the previous example. Just replace the <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> in that model with <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2%20+%20V_j%20%5Crho"> and replace the <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2"> in that model with <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2%20+%20V_j%20(1%20-%20%5Crho)">.↩︎</p></li>
<li id="fn3"><p>See the <a href="../..\weighting-in-multivariate-meta-analysis/">previous post</a> for the answer.↩︎</p></li>
<li id="fn4"><p>In the previous post, I expressed the weights in terms of <img src="https://latex.codecogs.com/png.latex?s_%7Bij%7D">, the sum of the entries in row <img src="https://latex.codecogs.com/png.latex?i"> of the <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BS%7D_j"> matrix. In vector form, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bs%7D_j%20=%20%5Cleft(s_%7B1j%7D%20%5C%20s_%7B2j%7D%20%5C%20%5Ccdots%20%5C%20s_%7Bn_j%20j%7D%5Cright)'%20=%20%5Cmathbf%7BS%7D_j%20%5Cmathbf%7B1%7D_j">.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {The {Woodbury} Identity},
  date = {2020-12-04},
  url = {https://jepusto.com/posts/Woodbury-identity},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2020. <span>“The Woodbury Identity.”</span>
December 4, 2020. <a href="https://jepusto.com/posts/Woodbury-identity">https://jepusto.com/posts/Woodbury-identity</a>.
</div></div></section></div> ]]></description>
  <category>hierarchical models</category>
  <category>matrix algebra</category>
  <guid>https://jepusto.com/posts/Woodbury-identity/</guid>
  <pubDate>Fri, 04 Dec 2020 06:00:00 GMT</pubDate>
</item>
<item>
  <title>An ANCOVA puzzler</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/ancova-puzzler/</link>
  <description><![CDATA[ 





<p>Doing effect size calculations for meta-analysis is a good way to lose your faith in humanity—or at least your faith in researchers’ abilities to do anything like sensible statistical inference. Try it, and you’re surely encounter head-scratchingly weird ways that authors have reported even simple analyses, like basic group comparisons. When you encounter this sort of thing, you have two paths: you can despair, curse, and/or throw things, or you can view the studies as curious little puzzles—brain-teasers, if you will—to keep you awake and prevent you from losing track of those notes you took during your stats courses, back when. Here’s one of those curious little puzzles, which I recently encountered in helping a colleague with a meta-analysis project.</p>
<p>A researcher conducts a randomized experiment, assigning participants to each of <img src="https://latex.codecogs.com/png.latex?G"> groups. Each participant is assessed on a variable <img src="https://latex.codecogs.com/png.latex?Y"> at pre-test and at post-test (we can assume there’s no attrition). In their study write-up, the researcher reports sample sizes for each group, means and standard deviations for each group at pre-test and at post-test, and <em>adjusted</em> means at post-test, where the adjustment is done using a basic analysis of covariance, controlling for pre-test scores only. The data layout looks like this:</p>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Group</th>
<th><img src="https://latex.codecogs.com/png.latex?N"></th>
<th>Pre-test <img src="https://latex.codecogs.com/png.latex?M"></th>
<th>Pre-test <img src="https://latex.codecogs.com/png.latex?SD"></th>
<th>Post-test <img src="https://latex.codecogs.com/png.latex?M"></th>
<th>Post-test <img src="https://latex.codecogs.com/png.latex?SD"></th>
<th>Adjusted post-test <img src="https://latex.codecogs.com/png.latex?M"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Group A</td>
<td><img src="https://latex.codecogs.com/png.latex?n_A"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cbar%7Bx%7D_%7BA%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?s_%7BA0%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cbar%7By%7D_%7BA%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?s_%7BA1%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Ctilde%7By%7D_A"></td>
</tr>
<tr class="even">
<td>Group B</td>
<td><img src="https://latex.codecogs.com/png.latex?n_B"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cbar%7Bx%7D_%7BB%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?s_%7BB0%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cbar%7By%7D_%7BB%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?s_%7BB1%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Ctilde%7By%7D_B"></td>
</tr>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cvdots"></td>
</tr>
</tbody>
</table>
<p>Note that the write-up does <em>not</em> provide an estimate of the correlation between the pre-test and the post-test, nor does it report a standard deviation or standard error for the mean change-score between pre-test and post-test within each group. All we have are the summary statistics, plus the adjusted post-test scores. We can assume that the adjustment was done according to the basic ANCOVA model, assuming a common slope across groups as well as homoskedasticity and so on. The model is then <img src="https://latex.codecogs.com/png.latex?%0Ay_%7Big%7D%20=%20%5Calpha_g%20+%20%5Cbeta%20x_%7Big%7D%20+%20e_%7Big%7D,%0A"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_g"> and <img src="https://latex.codecogs.com/png.latex?g%20=%201,...,G">, where <img src="https://latex.codecogs.com/png.latex?e_%7Big%7D"> is an independent error term that is assumed to have constant variance across groups.</p>
<section id="for-realz" class="level3">
<h3 class="anchored" data-anchor-id="for-realz">For realz?</h3>
<p>Here’s an example with real data, drawn from Table 2 of <a href="https://doi.org/10.1080/10573560500455703">Murawski (2006)</a>:</p>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>Group</th>
<th><img src="https://latex.codecogs.com/png.latex?N"></th>
<th>Pre-test <img src="https://latex.codecogs.com/png.latex?M"></th>
<th>Pre-test <img src="https://latex.codecogs.com/png.latex?SD"></th>
<th>Post-test <img src="https://latex.codecogs.com/png.latex?M"></th>
<th>Post-test <img src="https://latex.codecogs.com/png.latex?SD"></th>
<th>Adjusted post-test <img src="https://latex.codecogs.com/png.latex?M"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Group A</td>
<td>25</td>
<td>37.48</td>
<td>4.64</td>
<td>37.96</td>
<td>4.35</td>
<td>37.84</td>
</tr>
<tr class="even">
<td>Group B</td>
<td>26</td>
<td>36.85</td>
<td>5.18</td>
<td>36.46</td>
<td>3.86</td>
<td>36.66</td>
</tr>
<tr class="odd">
<td>Group C</td>
<td>16</td>
<td>37.88</td>
<td>3.88</td>
<td>37.38</td>
<td>4.76</td>
<td>36.98</td>
</tr>
</tbody>
</table>
<p>That study reported this information for each of several outcomes, with separate analyses for each of two sub-groups (LD and NLD). The text also reports that they used a two-level hierarchical linear model for the ANCOVA adjustment. For simplicity, let’s just ignore the hierarchical linear model aspect and assume that it’s a straight, one-level ANCOVA.</p>
</section>
<section id="the-puzzler" class="level3">
<h3 class="anchored" data-anchor-id="the-puzzler">The puzzler</h3>
<p>Calculate an estimate of the standardized mean difference between group <img src="https://latex.codecogs.com/png.latex?B"> and group <img src="https://latex.codecogs.com/png.latex?A">, along with the sampling variance of the SMD estimate, that adjusts for pre-test differences between groups. Candidates for numerator of the SMD include the adjusted mean difference, <img src="https://latex.codecogs.com/png.latex?%5Ctilde%7By%7D_B%20-%20%5Ctilde%7By%7D_A"> or the difference-in-differences, <img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Cbar%7By%7D_B%20-%20%5Cbar%7Bx%7D_B%5Cright)%20-%20%5Cleft(%5Cbar%7By%7D_A%20-%20%5Cbar%7Bx%7D_A%5Cright)">. In either case, the tricky bit is finding the sampling variance of this quantity, which involves the pre-post correlation. For the denominator of the SMD, you use the post-test SD, either pooled across just groups <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B"> or pooled across all <img src="https://latex.codecogs.com/png.latex?G"> groups, assuming a common population variance.</p>
<p>Have an idea for how to solve this? Post it in the comments or email it to me. Need the solution because you have a study like this in your meta-analysis? Contact me and I’ll share it with you directly. I’m being coy because I’m teaching meta-analysis next semester, and I feel like this would make a good extra credit problem…</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {An {ANCOVA} Puzzler},
  date = {2020-11-24},
  url = {https://jepusto.com/posts/ancova-puzzler},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2020. <span>“An ANCOVA Puzzler.”</span> November
24, 2020. <a href="https://jepusto.com/posts/ancova-puzzler">https://jepusto.com/posts/ancova-puzzler</a>.
</div></div></section></div> ]]></description>
  <category>meta-analysis</category>
  <category>effect size</category>
  <category>standardized mean difference</category>
  <guid>https://jepusto.com/posts/ancova-puzzler/</guid>
  <pubDate>Tue, 24 Nov 2020 06:00:00 GMT</pubDate>
</item>
<item>
  <title>From Longhorn to Badger</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/from-longhorn-to-badger/</link>
  <description><![CDATA[ 





<p>It’s taken me a while to finally get around to updating my website with some personal news. I’ve moved from UT Austin to the <a href="https://www.wisc.edu/">UW Madison</a> <a href="https://education.wisc.edu/">School of Education</a>, where I am now an associate professor in the <a href="https://edpsych.education.wisc.edu/">Educational Psychology Department</a>’s <a href="https://edpsych.education.wisc.edu/academics/quantitative-methods/">Quantitative Methods program</a>. We left Austin at the very end of July, arriving in Madison on August 1st. Our moving truck took a bit longer to arrive, but we’re now more or less installed in our new (or rather old–1950’s era) home. I grew up in Wisconsin (in the Milwaukee area), so this move brings us much closer to my family, who have already come to visit. We’ve also already been enjoying the fantastic bike paths and facilities that Madison has to offer.</p>
<p>On a professional level, I’m very much looking forward to the opportunities that the School of Education and Educational Psychology Department present, especially to opportunities for collaboration with new colleagues and students. I’m planning to offer a course on research synthesis and meta-analysis this coming Spring semester—something I’ve never had the opportunity to teach in a semester-long format, actually—and I’m looking forward to offering my own pedagogical perspective on material that I think about constantly in a research context. Gene Glass, who is credited as the originator of the term meta-analysis and who conducted some of the first meta-analyses within the social sciences, <a href="https://en.wikipedia.org/wiki/Gene_V._Glass#Background">received his Ph.D.&nbsp;in Educational Psychology from UW Madison in 1965</a>, so perhaps I’ll be able to channel a bit of his spirit in my course.</p>
<p>Even as I’m excited to get started at Madison, I will also very much miss my colleagues at UT Austin, who were so supportive during my pre-tenure phase. Because of COVID, I didn’t really get to say a proper farewell before we skipped town. I am continuing to advise several doctoral students in the Quantitative Methods program though, so we will likely get to connect in video meetings, at least.</p>
<p>Moving during the COVID pandemic has presented some challenges (logistical, emotional, and family-related) for me, though I know many others have had to deal with far worse. As we all weather this together, please feel free to leave a comment or drop me a line if you’d like to talk about stats, meta-analysis, R programming, or what-not.</p>


<!-- -->


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {From {Longhorn} to {Badger}},
  date = {2020-08-28},
  url = {https://jepusto.com/posts/from-longhorn-to-badger},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2020. <span>“From Longhorn to Badger.”</span>
August 28, 2020. <a href="https://jepusto.com/posts/from-longhorn-to-badger">https://jepusto.com/posts/from-longhorn-to-badger</a>.
</div></div></section></div> ]]></description>
  <guid>https://jepusto.com/posts/from-longhorn-to-badger/</guid>
  <pubDate>Fri, 28 Aug 2020 05:00:00 GMT</pubDate>
</item>
<item>
  <title>What do meta-analysts mean by ‘multivariate’ meta-analysis?</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/what-does-multivariate-mean/</link>
  <description><![CDATA[ 





<p>If you’ve ever had class with me or attended one of my presentations, you’ve probably heard me grouse about how statisticians are mostly awful about naming things.<sup>1</sup> A lot of the terminology in our field is pretty bad and ineloquent. As a leading example, look no further than Rubin and Little’s classification of missing data mechanisms as missing completely at random (MCAR), missing at random (MAR), or missing not at random (MNAR). Clear as mud, and the last one sounds like something you’d see on a handmade sign with a picture of someone’s pet puppy who wandered off last week.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://petkey.blob.core.windows.net/resource/images/940000/949000/949340_500W.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As another example, consider that introductory statistics students always struggle to distinguish between no less than <strong><em>three</em></strong> different concepts that are all called “variance”: population variance, sample variance, and sampling variance.<sup>2</sup> Unless the instructor also took diction training from the Royal Shakespeare Company, it’s no wonder that a fair number of students are left confused.</p>
<p><img src="https://jepusto.com/img/Hamlet-z-transform.jpg" class="img-fluid"> In this post, I will try to clarify (at least a little bit) another mess of terminology that crops up a lot in my work on meta-analysis: what do we mean when we say a model or method is “multivariate”? In the context of meta-analysis methods, I think there are at least three distinct senses in which this term is used:</p>
<ul>
<li>As an umbrella term for models/methods where there is more than one effect size estimate per study,</li>
<li>As a description for a class of methods within that broad umbrella, where certain aspects of the model are treated as known, or</li>
<li>As a description for a class of models for multivariate effect size estimates, where each effect size estimate from a study falls into one of a set of distinct categories.</li>
</ul>
<p>Let me explain what I mean by each of these.</p>
<section id="multivariate-handwaving" class="level2">
<h2 class="anchored" data-anchor-id="multivariate-handwaving">Multivariate handwaving</h2>
<p>In the context of meta-analysis, the broadest meaning of “multivariate” is any method used for modeling data that includes more than one effect size estimate in some or all of the included studies. Formally, the term would apply to any model appropriate for a set of <img src="https://latex.codecogs.com/png.latex?k"> studies, where study <img src="https://latex.codecogs.com/png.latex?j"> includes <img src="https://latex.codecogs.com/png.latex?n_j"> effect size estimates, and where the effect size estimates would be denoted <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D">, for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_j"> and <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">.</p>
<p>As it is used here, “multivariate” is really an umbrella term that could encompass a wide variety of methods and models, including multi-level meta-analysis or meta-regression models, multivariate methods in the narrower senses I will describe subsequently, and even robust variance estimation methods. It would also encompass techniques for handling this sort of data structure that aren’t strictly models, such as aggregating effect size estimates to the level of the study or using Harris Cooper’s “shifting unit-of-analysis” method <span class="citation" data-cites="Cooper1998synthesizing">(Cooper, 1998)</span>. This usage of “multivariate” involves a bit too much hand-waving for my taste (although I’ve been guilty of using the term this way in the past). I think a better, clearer term for this broad class of methods would be to call them methods for <strong><em>meta-analysis of dependent effect sizes</em></strong>.</p>
</section>
<section id="multivariate-sampling-errors" class="level2">
<h2 class="anchored" data-anchor-id="multivariate-sampling-errors">Multivariate sampling errors</h2>
<p>Another sense in which “multivariate” is used pertains to a certain class of models for dependent effect sizes. In particular, “multivariate meta-analysis” sometimes means a model where the sampling variances and covariances of the effect size estimates are treated as fully known. Say that each effect size estimate <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> has a corresponding true effect size parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7Bij%7D">, so that the sampling error is <img src="https://latex.codecogs.com/png.latex?e_%7Bij%7D%20=%20T_%7Bij%7D%20-%20%5Ctheta_%7Bij%7D">, or <img src="https://latex.codecogs.com/png.latex?%0AT_%7Bij%7D%20=%20%5Ctheta_%7Bij%7D%20+%20e_%7Bij%7D.%0A"> Typically, meta-analysis techniques treat the sampling errors as having known variances, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(e_%7Bij%7D)%20=%20%5Csigma_%7Bij%7D%5E2"> for known <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bij%7D%5E2">. Here, a multivariate meta-analysis would go a step further and make assumptions that <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(e_%7Bhj%7D,%20e_%7Bij%7D)%20=%20%5Crho_%7Bhij%7D%5Csigma_%7Bhj%7D%20%5Csigma_%7Bij%7D"> for <em>known</em> correlations <img src="https://latex.codecogs.com/png.latex?%5Crho_%7Bhij%7D">, <img src="https://latex.codecogs.com/png.latex?h,i%20=%201,...,n_j"> and <img src="https://latex.codecogs.com/png.latex?j=1,...,k">. Typically, the sampling variances and covariances would play into how the model is estimated and how one conducts inference and gets standard errors on things, etc.</p>
<p><span class="citation" data-cites="Becker2000multivariate">Becker (2000)</span> and <span class="citation" data-cites="Gleser2009stochastically">Gleser &amp; Olkin (2009)</span> describe a whole slew of different situations where meta-analysts will encounter multiple effect size estimates within a given study, and both provide formulas for the covariances between those effect sizes. In some situations, these covariances can be calculated just based on primary study sample sizes or other information readily available from study reports. In other situations (such as when one calculates <a href="../..\correlations-between-smds/">standardized mean differences for each of several outcomes on a common set of participants</a>), the information needed to calculate covariances might not be available, which is where methods like robust variance estimation come in. With this meaning of the term, multivariate meta-analysis methods are those that both directly model the dependent effects structure and that treat the sampling covariances as known. They are therefore distinct from methods, such as robust variance estimation, that do not rely on knowing the exact variance-covariance structure of the sampling errors. In my own work, I find it helpful to be able to draw this distinction, so I rather like this usage of “multivariate.” This will surely irritate some statisticians, though, who prefer the third, stricter meaning of the term.</p>
</section>
<section id="strictly-multivariate-models" class="level2">
<h2 class="anchored" data-anchor-id="strictly-multivariate-models">Strictly multivariate models</h2>
<p>A third meaning of multivariate is to denote a class of models for multivariate data, meaning data where each unit is measured on several dimensions or characteristics. In the meta-analysis context, multivariate effect sizes are ones where, for each included study or sample, we have effect sizes describing outcomes (e.g., treatment effects) on one or more dimensions. For example, say that we have a bunch of studies examining some sort of educational intervention, and each study reports effect sizes describing the intervention’s impact on a) reading performance, b) social studies achievement, and/or c) language arts achievement. What differentiates this sort of multivariate data from the first, “umbrella” sense of the term is that with strictly multivariate data, no study has more than one effect size within a given dimension. In contrast, meta-analysis of dependent effect sizes deal with data structures that are not necessarily so tidy and organized, such that we might not be able to classify each effect size into one of a finite and exhaustive set of categories.</p>
<p>When working with strictly multivariate data like this, a multivariate meta-analysis (or meta-regression) model would entail estimating average effects (or regression coefficients) <em>for each dimension</em> rather than aggregating across dimensions. This class of models was discussed extensively in an excellent article by <span class="citation" data-cites="Jackson2011multivariate">Jackson et al. (2011)</span>.<sup>3</sup> With my example of educational intervention studies, we would estimate average impacts on reading performance, social studies achievement, and language arts achievement. Estimating an overall aggregate effect on academic achievement would make little sense here, because we’d be mixing apples, oranges, and kiwis.</p>
<p>Formally, this sort of data structure and model can be described as follows. As previously, say that we have a set of <img src="https://latex.codecogs.com/png.latex?k"> studies, where study <img src="https://latex.codecogs.com/png.latex?j"> has <img src="https://latex.codecogs.com/png.latex?n_j"> effect sizes, <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D">, and correspoding sampling variances <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bij%7D%5E2">, both for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_j"> and <img src="https://latex.codecogs.com/png.latex?j%20=%201,...k">. Effect size <img src="https://latex.codecogs.com/png.latex?i"> from study <img src="https://latex.codecogs.com/png.latex?j"> can be classified into one of <img src="https://latex.codecogs.com/png.latex?C"> dimensions. Let <img src="https://latex.codecogs.com/png.latex?d%5Ec_%7Bij%7D"> be an indicator for whether effect <img src="https://latex.codecogs.com/png.latex?i"> falls into dimension <img src="https://latex.codecogs.com/png.latex?c">, for <img src="https://latex.codecogs.com/png.latex?c%20=%201,...,C">. With a strictly multivariate structure, there is never more than one effect per category, so <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20d%5Ec_%7Bij%7D%20%5Cleq%201"> for each <img src="https://latex.codecogs.com/png.latex?c%20=%201,...,C"> and <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">. A typical multivariate random effects model would then be <img src="https://latex.codecogs.com/png.latex?%0AT_%7Bij%7D%20=%20%5Csum_%7Bc=1%7D%5EC%20%5Cleft(%5Cmu_c%20+%20v_%7Bcj%7D%5Cright)%20d%5Ec_%7Bij%7D%20+%20e_%7Bij%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmu_c"> is the average effect size for category <img src="https://latex.codecogs.com/png.latex?c">, <img src="https://latex.codecogs.com/png.latex?v_%7Bcj%7D"> is a random effect for category <img src="https://latex.codecogs.com/png.latex?c"> in study <img src="https://latex.codecogs.com/png.latex?j">, and <img src="https://latex.codecogs.com/png.latex?e_%7Bij%7D"> is the sampling error term. The classic assumption about the random effects is that they are dependent within study, so <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(v_%7Bcj%7D)%20=%20%5Ctau%5E2_c%20%5Cqquad%20%5Ctext%7Band%7D%20%5Cqquad%20%5Ctext%7BCov%7D(v_%7Bbj%7D,%20v_%7Bcj%7D)%20=%20%5Ctau_%7Bbc%7D%0A"> for <img src="https://latex.codecogs.com/png.latex?b,c%20=%201,...,C">. Typically, these sorts of models would also rely on assumptions about the correlations between the sampling errors, just as with the second meaning of multivariate. Thus, to complete the model, we would have <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(e_%7Bhj%7D,%20e_%7Bij%7D)%20=%20%5Crho_%7Bhij%7D%5Csigma_%7Bhj%7D%5Csigma_%7Bij%7D"> for known <img src="https://latex.codecogs.com/png.latex?%5Crho_%7Bhij%7D">. In practice, we might want to impose some common structure to the correlations across studies, such as using <img src="https://latex.codecogs.com/png.latex?%5Crho_%7Bhij%7D">’s that depend on the dimensions being correlated but are common across studies. Formally, we would have <img src="https://latex.codecogs.com/png.latex?%0A%5Crho_%7Bhij%7D%20=%20%5Csum_%7Bb=1%7D%5EC%20%5Csum_%7Bc=1%7D%5EC%20d%5Eb_%7Bij%7D%20%5C%20d%5Ec_%7Bij%7D%20%5C%20%5Crho_%7Bbc%7D.%0A"> Of course, even getting this level of detail about correlations between effect sizes might often be pretty challenging.</p>
<p>In a strictly multivariate meta-regression model, we would also allow the coefficients for each predictor to be specific to each category, so that <img src="https://latex.codecogs.com/png.latex?%0AT_%7Bij%7D%20=%20%5Csum_%7Bc=1%7D%5EC%20%5Cleft(%5Cmathbf%7Bx%7D_%7Bij%7D%5Cboldsymbol%5Cbeta_c%20+%20v_%7Bcj%7D%5Cright)%20d%5Ec_%7Bij%7D%20+%20e_%7Bij%7D,%0A"> In my example of educational intervention impact studies, say that are interested in whether the effects differ between quasi-experimental studies and true randomized control trials, and whether the effects differ based on the proportion of the sample that was economically disadvantaged. The strictly multivariate model would always involve interacting these predictors with the outcome category. In R’s equation notation, the meta-regression specification would be</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">ES <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Cat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Cat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>RCT <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Cat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>disadvantaged_pct</span></code></pre></div>
</details>
</div>
<p>In contrast, in a generic meta-regression for dependent effect sizes, we might not include all of the interactions, and instead assume that the associations of the predictors were constant across outcome dimensions, as in</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">ES <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> outcome_cat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> RCT <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> college_pct</span></code></pre></div>
</details>
</div>
<p>In the strict sense of the term, the model without interactions is no longer really a multivariate meta-regression.</p>
</section>
<section id="remarks" class="level2">
<h2 class="anchored" data-anchor-id="remarks">Remarks</h2>
<p>An interesting property of strict multivariate meta-analysis models is that they involve partial pooling—or “borrowing of strength”—across dimensions <span class="citation" data-cites="riley_evaluation_2007 riley_multivariate_2017">(R. D. Riley et al., 2007; Richard D. Riley et al., 2017)</span>. Even though the model has separate coefficients for each dimension, the estimates for a given dimension are influenced by the available effect sizes for <em>all</em> dimensions. For instance, in the meta-analysis of educational intervention studies, the average impact on reading performance outcomes is based in part on the effect size estimates for the social studies and language arts performance. This happens because the model treats all of the dimensions as <em>correlated</em>—through the correlated sampling errors and, potentially, through the correlated random effects structure. <span class="citation" data-cites="copas_role_2018">Copas et al. (2018)</span> examine how this works and propose a diagnostic plot to understand how it happens in application. <span class="citation" data-cites="kirkham_multivariate_2012">Kirkham et al. (2012)</span> also show that the borrowing of strength phenomenon can partially mitigate bias from selective outcome reporting. These concepts could be quite relevant even beyond the “strict” multivariate meta-analysis context in which they have been explored. It strikes me that it would be useful to investigate them in the more general context of meta-analysis with dependent effect sizes—that is, multivariate meta-analysis in the first, broadest sense.</p>
</section>
<section id="references" class="level2">



<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2">
<div id="ref-Becker2000multivariate" class="csl-entry">
Becker, B. J. (2000). <span class="nocase">Multivariate meta-analysis</span>. In S. D. Brown &amp; H. E. A. Tinsley (Eds.), <em>Handbook of applied multivariate statistics and mathematical modeling</em> (pp. 499–525). Academic Press. <a href="https://doi.org/10.1016/B978-012691360-6/50018-5">https://doi.org/10.1016/B978-012691360-6/50018-5</a>
</div>
<div id="ref-Cooper1998synthesizing" class="csl-entry">
Cooper, H. M. (1998). <em><span class="nocase">Synthesizing Research: A Guide for Literature Reviews</span></em> (3rd ed.). Sage Publications, Inc.
</div>
<div id="ref-copas_role_2018" class="csl-entry">
Copas, J. B., Jackson, D., White, I. R., &amp; Riley, R. D. (2018). The role of secondary outcomes in multivariate meta-analysis. <em>Journal of the Royal Statistical Society: Series C (Applied Statistics)</em>, <em>67</em>(5), 1177–1205. <a href="https://doi.org/10.1111/rssc.12274">https://doi.org/10.1111/rssc.12274</a>
</div>
<div id="ref-Gleser2009stochastically" class="csl-entry">
Gleser, L. J., &amp; Olkin, I. (2009). <span class="nocase">Stochastically dependent effect sizes</span>. In H. Cooper, L. V. Hedges, &amp; J. C. Valentine (Eds.), <em>The handbook of research synthesis and meta-analysis</em> (2nd ed., pp. 357–376). Russell Sage Foundation.
</div>
<div id="ref-Jackson2011multivariate" class="csl-entry">
Jackson, D., Riley, R. D., &amp; White, I. R. (2011). <span class="nocase">Multivariate meta-analysis: Potential and promise.</span> <em>Statistics in Medicine</em>. <a href="https://doi.org/10.1002/sim.4172">https://doi.org/10.1002/sim.4172</a>
</div>
<div id="ref-kirkham_multivariate_2012" class="csl-entry">
Kirkham, J. J., Riley, R. D., &amp; Williamson, P. R. (2012). A multivariate meta-analysis approach for reducing the impact of outcome reporting bias in systematic reviews. <em>Statistics in Medicine</em>, <em>31</em>(20), 2179–2195. <a href="https://doi.org/10.1002/sim.5356">https://doi.org/10.1002/sim.5356</a>
</div>
<div id="ref-riley_evaluation_2007" class="csl-entry">
Riley, R. D., Abrams, K. R., Lambert, P. C., Sutton, A. J., &amp; Thompson, J. R. (2007). An evaluation of bivariate random-effects meta-analysis for the joint synthesis of two correlated outcomes. <em>Statistics in Medicine</em>, <em>26</em>(1), 78–97. <a href="https://doi.org/10.1002/sim.2524">https://doi.org/10.1002/sim.2524</a>
</div>
<div id="ref-riley_multivariate_2017" class="csl-entry">
Riley, Richard D., Jackson, D., Salanti, G., Burke, D. L., Price, M., Kirkham, J., &amp; White, I. R. (2017). Multivariate and network meta-analysis of multiple outcomes and multiple treatments: Rationale, concepts, and examples. <em>BMJ</em>, j3932. <a href="https://doi.org/10.1136/bmj.j3932">https://doi.org/10.1136/bmj.j3932</a>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>“Mostly” rather than “uniformly” due to exceptions like Brad Efron (a.k.a. Mr.&nbsp;Bootstrap) and Rob Tibshirani (a.k.a. Mr.&nbsp;Lasso).↩︎</p></li>
<li id="fn2"><p>And then consider the square roots of these quantities, respectively: population standard deviation, sample standard deviation, and <strong><em>standard error</em></strong>. WTF?↩︎</p></li>
<li id="fn3"><p>Read this article! It’s essential. And it comes with pages and pages of commentary by other statisticans.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {What Do Meta-Analysts Mean by “Multivariate” Meta-Analysis?},
  date = {2020-06-27},
  url = {https://jepusto.com/posts/what-does-multivariate-mean},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, J. E. (2020, June 27). <em>What do meta-analysts mean by
<span>“multivariate”</span> meta-analysis?</em> <a href="https://jepusto.com/posts/what-does-multivariate-mean">https://jepusto.com/posts/what-does-multivariate-mean</a>
</div></div></section></div> ]]></description>
  <category>meta-analysis</category>
  <category>multivariate</category>
  <category>dependent effect sizes</category>
  <guid>https://jepusto.com/posts/what-does-multivariate-mean/</guid>
  <pubDate>Sat, 27 Jun 2020 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Weighting in multivariate meta-analysis</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/</link>
  <description><![CDATA[ 





<p>One common question about multivariate/multi-level meta-analysis is how such models assign weight to individual effect size estimates. When a version of the question came up recently on the <a href="https://stat.ethz.ch/pipermail/r-sig-meta-analysis/2020-June/002149.html">R-sig-meta-analysis listserv</a>, Dr.&nbsp;Wolfgang Viechtbauer offered a <a href="http://www.metafor-project.org/doku.php/tips:weights_in_rma.mv_models">whole blog post</a> in reply, demonstrating how weights work in simpler fixed effect and random effects meta-analysis and then how things get more complicated in multivariate models. I started thumb-typing my own reply as well, but then decided it would be better to write up a post so that I could use a bit of math notation (and to give my thumbs a break). So, in this post I’ll try to add some further intuition on how weights work in certain multivariate meta-analysis models. Most of the discussion will apply to models that include multiple level of random effects, but no predictors. I’ll also comment briefly on meta-regression models with only study-level predictor variables, and finally give some pointers to work on more complicated models.</p>
<section id="a-little-background" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="a-little-background"><span class="header-section-number">0.1</span> A little background</h2>
<p>It’s helpful to start by looking briefly at the basic fixed effect and random effects models, assuming that we’ve got a set of studies that each contribute a single effect size estimate so everything’s independent. Letting <img src="https://latex.codecogs.com/png.latex?T_j"> be the effect size from study <img src="https://latex.codecogs.com/png.latex?j">, with sampling variance <img src="https://latex.codecogs.com/png.latex?V_j">, both for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">, the basic random effects model is: <img src="https://latex.codecogs.com/png.latex?%0AT_j%20=%20%5Cmu%20+%20%5Ceta_j%20+%20e_j%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is the overall average effect size, <img src="https://latex.codecogs.com/png.latex?v_j"> is a random effect with variance <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Ceta_j)%20=%20%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?e_j"> is a sampling error with known variance <img src="https://latex.codecogs.com/png.latex?V_j">. The first step in estimating this model is to estimate <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">. There’s lots of methods for doing so, but let’s not worry about those details—just pick one and call the estimate <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%5E2">. Then, to estimate <img src="https://latex.codecogs.com/png.latex?%5Cmu">, we take a weighted average of the effect size estimates: <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cmu%20=%20%5Cfrac%7B1%7D%7BW%7D%20%5Csum_%7Bj=1%7D%5Ek%20w_j%20T_j,%20%5Cqquad%20%5Ctext%7Bwhere%7D%20%5Cquad%20W%20=%20%5Csum_%7Bj=1%7D%5Ek%20w_j.%0A"> The weights used in the weighted average are chosen to make the overall estimate as precise as possible (i.e., having the smallest possible sampling variance or standard error). Mathematically, the best possible weights are <strong><em>inverse variance</em></strong> weights, that is, setting the weight for each effect size estimate proportional to the inverse of how much variance there is in each estimate. With inverse variance weights, larger studies with more precise effect size estimates will tend to get more weight and smaller, noisier studies will tend to get less weight.</p>
<p>In the basic random effects model, the weights for each study are proportional to <img src="https://latex.codecogs.com/png.latex?%0Aw_j%20=%20%5Cfrac%7B1%7D%7B%5Chat%5Ctau%5E2%20+%20V_j%7D,%0A"> for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">. The denominator term here includes both the (estimated) between-study heterogeneity and the sampling variance because both terms contribute to how noisy the effect size estimate is. In the fixed effect model, we ignore between-study heterogeneity so the weights are inversely proportional to the sampling variances, with <img src="https://latex.codecogs.com/png.latex?w_j%20=%201%20/%20V_j">. In the random effects model, larger between-study heterogeneity will make the weights closer to equal, while smaller between-study heterogeneity will lead to weights that tend to emphasize larger studies with more precise estimates. In the remainder, I’ll show that there are some similar dynamics at work in a more complicated, multivariate meta-analysis model.</p>
</section>
<section id="a-multivariate-meta-analysis" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="a-multivariate-meta-analysis"><span class="header-section-number">0.2</span> A multivariate meta-analysis</h2>
<p>Now let’s consider the case where some or all studies in our synthesis contribute more than one effect size estimate. Say that we have effect sizes <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D">, where <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_j"> indexes effect size estimates within study <img src="https://latex.codecogs.com/png.latex?j"> and <img src="https://latex.codecogs.com/png.latex?j"> indexes studies, for <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">. Say that effect size estimate <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> has sampling variance <img src="https://latex.codecogs.com/png.latex?V_%7Bij%7D">, and there is some sampling correlation between effect sizes <img src="https://latex.codecogs.com/png.latex?h"> and <img src="https://latex.codecogs.com/png.latex?i"> within study <img src="https://latex.codecogs.com/png.latex?j">, denoted <img src="https://latex.codecogs.com/png.latex?r_%7Bhij%7D">.</p>
<p>There are many models that a meta-analyst might consider for this data structure. A fairly common one would be a model that includes random effects not only for between-study heterogeneity (as in the basic random effects model) but also random effects capturing within-study heterogeneity in true effect sizes. Let me write this model heirarchically, as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0AT_%7Bij%7D%20&amp;=%20%5Ctheta_j%20+%20%5Cnu_%7Bij%7D%20+%20e_%7Bij%7D%20%5C%5C%0A%5Ctheta_j%20&amp;=%20%5Cmu%20+%20%5Ceta_j%0A%5Cend%7Balign%7D%0A"> In the first line of the model, <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j"> denotes the average effect size parameter for study <img src="https://latex.codecogs.com/png.latex?j">, <img src="https://latex.codecogs.com/png.latex?%5Cnu_%7Bij%7D"> captures within-study heterogeneity in the true effect size parameters and <img src="https://latex.codecogs.com/png.latex?e_%7Bij%7D"> is a sampling error. Above, I’ve assumed that we know the structure of the sampling errors, so <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(e_%7Bij%7D)%20=%20V_%7Bij%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(e_%7Bhj%7D,%20e_%7Bij%7D)%20=%20r_%7Bhij%7D%20%5Csqrt%7BV_%7Bhj%7D%20V_%7Bij%7D%7D">. Let’s also denote the within-study variance as <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">, so <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Cnu_%7Bij%7D)%20=%20%5Comega%5E2">. In the second line of the model, <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is still the overall average effect size across all studies and effect sizes within studies and <img src="https://latex.codecogs.com/png.latex?%5Ceta_j"> is a between-study error, with <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Ceta_j)%20=%20%5Ctau%5E2">, capturing the degree of heterogeneity in the <em>average</em> effect sizes (the <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j">’s) across studies.<sup>1</sup></p>
<p>One thing to note about this model is that it treats all of the effect sizes as coming from a population with a common mean <img src="https://latex.codecogs.com/png.latex?%5Cmu">. Some statisticians might object to calling it a multivariate model because we’re not distinguishing averages for different dimensions (or variates) of the effect sizes. To this I say: whatev’s, donkey! I’m calling it multivariate because you have to use the <code>rma.mv()</code> function from the <code>metafor</code> package to estimate it. I will acknowledge, though, that there will often be reason to use more complicated models, for example by replacing the overall average <img src="https://latex.codecogs.com/png.latex?%5Cmu"> with some meta-regression <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D_%7Bij%7D%20%5Cboldsymbol%5Cbeta">. That’s a discussion for another day. For now, we’re only going to consider the model with an overall average effect size parameter <img src="https://latex.codecogs.com/png.latex?%5Cmu">. The question is, <strong><em>how do the individual effect size estimates <img src="https://latex.codecogs.com/png.latex?T_%7Bij%7D"> contribute to the estimate of this overall average effect?</em></strong></p>
</section>
<section id="equally-precise-effect-size-estimates" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="equally-precise-effect-size-estimates"><span class="header-section-number">0.3</span> Equally precise effect size estimates</h2>
<p>To make some headway, it is helpful to first consider an even more specific model where, within a given study, all effect size estimates are equally precise and equally correlated. In particular, let’s assume that for each study <img src="https://latex.codecogs.com/png.latex?j">, the sampling variances are all equal, with <img src="https://latex.codecogs.com/png.latex?V_%7Bij%7D%20=%20V_j"> for <img src="https://latex.codecogs.com/png.latex?i%20=%201,...,n_j">, and the correlations between the sampling errors are also all equal, with <img src="https://latex.codecogs.com/png.latex?r_%7Bhij%7D%20=%20r_j"> for <img src="https://latex.codecogs.com/png.latex?h,i%20=%201,...,n_j">.</p>
<p>These assumptions might not be all that far-fetched. Within a given study, if the effect size estimates are for different measures of a common construct, it’s not unlikely that they would all be based on similar sample sizes (+/- a bit of item non-response). It might be a bit less likely if the effect size estimates are for treatment effects from different follow-up times (since drop-out/non-response tends to increase over time) or different treatment groups compared to a common control group—but still perhaps not entirely unreasonable. Further, it’s rather <em>uncommon</em> to have good information about the correlations between effect size estimates from a given study (because primary studies don’t often report all of the information needed to calculate these correlations). In practice, meta-analysts might need to simply <a href="../..\imputing-covariance-matrices-for-multi-variate-meta-analysis/">make a rough guess about the correlations</a> and then use robust variance estimation and/or sensitivity analysis to check themselves. And if we’re just ball-parking, then we’ll probably assume a single correlation for all of the studies.</p>
<p>The handy thing about this particular scenario is that, because all of the effect size estimates within a study are equally precise and equally correlated, the most efficient way to estimate an average effect for a given study is to <strong><em>just take the simple average</em></strong> (and, intuitively, this seems like the only sensible thing to do). To be precise, consider how we would estimate <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j"> for a given study <img src="https://latex.codecogs.com/png.latex?j">. The most precise possible estimate is simply <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Ctheta_j%20=%20%5Cfrac%7B1%7D%7Bn_j%7D%20%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20T_%7Bij%7D.%0A"> And we could do the same for each of the other studies, <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">. It turns out that the estimate of the overall average effect size is a weighted average of these study-specific average effect sizes: <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cmu%20=%20%5Cfrac%7B1%7D%7BW%7D%20%5Csum_%7Bj=1%7D%5Ek%20w_j%20%5Chat%5Ctheta_j,%0A"> for some weights <img src="https://latex.codecogs.com/png.latex?w_1,...,w_k">. But what are these weights? Just like in the basic random effects model, they are inverse-variance weights. It’s just that the variance is a little bit more complicated.</p>
<p>Consider how precise each of the study-specific estimates are, relative to the true effects in their respective studies. Conditional on the true effect <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j">, <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Chat%5Ctheta_j%20%7C%20%5Ctheta_j)%20=%20%5Cfrac%7B1%7D%7Bn_j%7D%5Cleft(%5Comega%5E2%20+%20(n_j%20-%201)%20r_j%20V_j%20+%20V_j%5Cright).%0A"> Without conditioning on <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j">, the variance of the <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctheta_j"> estimates also includes a term for variation in the true study-specific average effect sizes, becoming <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Chat%5Ctheta_j)%20=%20%5Ctau%5E2%20+%20%5Cfrac%7B1%7D%7Bn_j%7D%5Cleft(%5Comega%5E2%20+%20(n_j%20-%201)%20r_j%20V_j%20+%20V_j%5Cright).%0A"> The weights used in estimating <img src="https://latex.codecogs.com/png.latex?%5Cmu"> are the inverse of this quantity: <img src="https://latex.codecogs.com/png.latex?%0Aw_j%20=%20%5Cfrac%7B1%7D%7B%5Ctau%5E2%20+%20%5Cfrac%7B1%7D%7Bn_j%7D%5Cleft(%5Comega%5E2%20+%20(n_j%20-%201)%20r_j%20V_j%20+%20V_j%5Cright)%7D.%0A"> Within a study, each individual effect size gets an <img src="https://latex.codecogs.com/png.latex?n_j%5E%7Bth%7D"> of this study-level weight. We can therefore write the overall average as <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cmu%20=%20%5Cfrac%7B1%7D%7BW%7D%20%5Csum_%7Bj=1%7D%5Ek%20%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20w_%7Bij%7D%20T_%7Bij%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%0Aw_%7Bij%7D%20=%20%5Cfrac%7B1%7D%7Bn_j%20%5Ctau%5E2%20+%20%5Comega%5E2%20+%20(n_j%20-%201)%20r_j%20V_j%20+%20V_j%7D.%0A"></p>
<p>There are several things worth noting about this expression for the weights. First, suppose that there is little between-study or within-study heterogeneity, so <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> are both close to zero. Then the weights are driven by the number of effect sizes within the study (<img src="https://latex.codecogs.com/png.latex?n_j">), the sampling variance of those effect sizes (<img src="https://latex.codecogs.com/png.latex?V_j">) and their correlation <img src="https://latex.codecogs.com/png.latex?r_j">. If <img src="https://latex.codecogs.com/png.latex?r_j"> is near one, then averaging together a bunch of highly correlated estimates doesn’t improve precision much, relative to just using one of the effect sizes. The study-specific average effect estimate will therefore have variance close to <img src="https://latex.codecogs.com/png.latex?V_j"> (i.e., the variance of a single effect size estimate). If <img src="https://latex.codecogs.com/png.latex?r_j"> is below one, then averaging yields a more precise estimate than any of the individual effect sizes, and averaging together more effect sizes will yield a more precise estimate at the study level. If the assumed correlations are reasonably accurate, the weights used in the multi-variate meta-analysis will appropriately take into account the number of effect sizes within each study and the precision of those effect sizes.</p>
<p>Second, now suppose that there is no between-study heterogeneity (<img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2%20=%200">) but there is positive within-study heterogeneity. Larger degrees of within-study heterogeneity will tend to equalize the weights <em>at the effect size level</em>, regardless of how effect size estimates are nested within studies. When there is within-study heterogeneity, averaging together a bunch of estimates will yield a more precise estimate of study-specific average effects. Therefore, when <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> is larger, studies with more effect sizes will tend to get a relatively larger share of the weight.<sup>2</sup></p>
<p>Third and finally, between-study heterogeneity will tend to equalize the weights at the study level, so that the overall average is pulled closer to a simple average of the study-specific average effects. This works very much like in basic random effects meta-analysis, where increased heterogeneity will lead to weights that are closer to equal and an average effect size estimate that is closer to a simple average.</p>
</section>
<section id="a-computational-example" class="level2" data-number="0.4">
<h2 data-number="0.4" class="anchored" data-anchor-id="a-computational-example"><span class="header-section-number">0.4</span> A computational example</h2>
<p>I think it’s useful to verify algebraic results like the ones I’ve given above by checking that you can reproduce them with real data. I’ll use the <code>corrdat</code> dataset from the <code>robumeta</code> package for illustration. The dataset has one duplicated row in it (I have no idea why!), which I’ll remove before analyzing further.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(corrdat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">package =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"robumeta"</span>)</span>
<span id="cb1-4"></span>
<span id="cb1-5">corrdat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-6">  corrdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(studyid, esid, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.keep_all =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</details>
</div>
<p>This dataset included a total of 171 effect size estimates from 39 unique studies. For each study, between 1 and 18 eligible effect size estimates were reported. Here is a histogram depicting the number of studies by the number of reported effect size estimates:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Here is the plot of the variances of each effect size versus the study IDs:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For most of the studies, the effect sizes have very similar sampling variances. One exception is study 9, where two of the effect sizes have variances of under 0.20 and the other two effect sizes have variances in excess of 0.35. Another exception is study 30, which has one effect size with much larger variance than the others.</p>
<p>Just for sake of illustration, I’m going to <em>enforce</em> my assumption that effect sizes have equal variances within each study by recomputing the sampling variances as the <em>average</em> sampling variance within each study. I will then impute a sampling variance-covariance matrix for the effect sizes, assuming a correlation of 0.7 for effects from the same study:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(clubSandwich)</span>
<span id="cb2-2"></span>
<span id="cb2-3">corrdat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-4">  corrdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(studyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V_bar =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(var)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb2-8"></span>
<span id="cb2-9">V_mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">impute_covariance_matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> corrdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>V_bar, </span>
<span id="cb2-10">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cluster =</span> corrdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>studyid,</span>
<span id="cb2-11">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)</span></code></pre></div>
</details>
</div>
<p>With this variance-covariance matrix, I can then estimate the multivariate meta-analysis model:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(metafor)</span>
<span id="cb3-2"></span>
<span id="cb3-3">MVMA_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.mv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> effectsize, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V =</span> V_mat, </span>
<span id="cb3-4">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">random =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> studyid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> esid,</span>
<span id="cb3-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> corrdat)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(MVMA_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Multivariate Meta-Analysis Model (k = 171; method: REML)

  logLik  Deviance       AIC       BIC      AICc   
-94.7852  189.5703  195.5703  204.9777  195.7149   

Variance Components:

            estim    sqrt  nlvls  fixed        factor 
sigma^2.1  0.0466  0.2159     39     no       studyid 
sigma^2.2  0.1098  0.3314    171     no  studyid/esid 

Test for Heterogeneity:
Q(df = 170) = 1141.4235, p-val &lt; .0001

Model Results:

estimate      se    zval    pval   ci.lb   ci.ub      
  0.2263  0.0589  3.8413  0.0001  0.1108  0.3417  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Based on this model, between-study heterogeneity is estimated as <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%20=%200.216"> and within-study heterogeneity is estimated as <img src="https://latex.codecogs.com/png.latex?%5Chat%5Comega%20=%200.331">, both of which are quite high. The overall average effect size estimate is 0.226, with a standard error of 0.059.</p>
<p>I’ll first get the weights used in <code>rma.mv</code> to compute the overall average. The weights are represented as an <img src="https://latex.codecogs.com/png.latex?N%20%5Ctimes%20N"> matrix. Taking the row or column sums, then rescaling by the total, gives the weight assigned to each effect size estimate:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">W_mat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weights</span>(MVMA_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix"</span>)</span>
<span id="cb5-2">corrdat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>w_ij_metafor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(W_mat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(W_mat)</span></code></pre></div>
</details>
</div>
<p>To verify that the formulas above are correct, I’ll use them to directly compute weights:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb6-2">tau_sq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MVMA_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb6-3">omega_sq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MVMA_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb6-4"></span>
<span id="cb6-5">corrdat_weights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-6">  corrdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(studyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_j =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ij =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau_sq <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> omega_sq <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (n_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> V_bar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V_bar)</span>
<span id="cb6-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ij =</span> w_ij <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_ij)</span>
<span id="cb6-15">  )</span></code></pre></div>
</details>
</div>
<p>The weights I computed are perfectly correlated with the weights used <code>rma.mv</code>, as can be seen in the plot below.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(corrdat_weights, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(w_ij, w_ij_metafor)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>If we remove the within-study random effect term from the model, the weights will be equivalent to setting <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> to zero, but with a different estimate of <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">MVMA_no_omega <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.mv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> effectsize, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V =</span> V_mat, </span>
<span id="cb8-2">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">random =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> studyid,</span>
<span id="cb8-3">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> corrdat)</span>
<span id="cb8-4">MVMA_no_omega</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Multivariate Meta-Analysis Model (k = 171; method: REML)

Variance Components:

            estim    sqrt  nlvls  fixed   factor 
sigma^2    0.0951  0.3084     39     no  studyid 

Test for Heterogeneity:
Q(df = 170) = 1141.4235, p-val &lt; .0001

Model Results:

estimate      se    zval    pval   ci.lb   ci.ub      
  0.2235  0.0619  3.6122  0.0003  0.1022  0.3448  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Re-fitting the model with <code>rma.mv()</code> gives an between-study heterogeneity estimate of <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%20=%200.308"> and an overall average effect size estimate of <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cmu%20=%200">. Using this estimate, I’ll compute the weights based on the formula and then use those weights to determine the overall average effect size estimate.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">tau_sq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MVMA_no_omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma2</span>
<span id="cb10-2"></span>
<span id="cb10-3">corrdat_weights <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-4">  corrdat_weights <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ij_no_omega =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau_sq <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (n_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> V_bar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V_bar),</span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_ij_no_omega =</span> w_ij_no_omega <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_ij_no_omega)</span>
<span id="cb10-8">  )</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(corrdat_weights, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted.mean</span>(effectsize, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> w_ij_no_omega))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2235231</code></pre>
</div>
</div>
<p>This matches the output of <code>rma.mv()</code>.</p>
<p>Here is a plot showing the weights of individual effect sizes for each study. In blue are the weights under the assumption that <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2%20=%200">. In green are the weights allowing for <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2%20%3E%200">. It’s notable here that introducing the within-study heterogeneity term leads to pretty big changes in the weights for some studies. In particular, studies that have only a single effect size estimate (e.g., studys 7, 8, 22, 25, 28) lose <em>a lot</em> of weight when <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2%20%3E%200">. That’s partially because <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> tends to pull weight towards studies with more effect sizes, and partially because of the change in the estimate of <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2">, which tends to equalize the weight assigned to each study.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Below is a plot illustrating the changes in study-level weights (i.e., aggregating the weight assigned to each study). The bar color corresponds to the number of effect size estimates in each study; light grey studies have just one effect size, while studies with more effect sizes are more intensly purple. The notable drops in weight for studies with a single effect size estimate (light grey) are visible here too. Studies with more effect sizes (e.g., studies 2, 15, 30, with dark purple bars) gain weight when we allow <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> to be greater than zero.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in
ggplot2 3.3.4.
ℹ Please use "none" instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="now-without-compound-symmetry" class="level2" data-number="0.5">
<h2 data-number="0.5" class="anchored" data-anchor-id="now-without-compound-symmetry"><span class="header-section-number">0.5</span> Now without compound symmetry</h2>
<p>If we remove the restrictions that effect sizes from the same study have the same sampling variance and are equi-correlated, then the weights get a little bit more complicated. However, the general intuitions carry through. Let’s now consider the model with arbitrary sampling variance <img src="https://latex.codecogs.com/png.latex?V_%7Bij%7D"> and sampling correlations within studies <img src="https://latex.codecogs.com/png.latex?r_%7Bhij%7D">. The most efficient estimate of the study-specific average effect is now a <em>weighted</em> average, with weights that depend on both the variances and covariances of the effect size estimates within each study. Let <img src="https://latex.codecogs.com/png.latex?%0A%5Cboldsymbol%7B%5Chat%5CSigma%7D_j%20=%20%5Chat%5Comega%5E2%20%5Cmathbf%7BI%7D_j%20+%20%5Cmathbf%7BV%7D_j,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BI%7D_j"> is an <img src="https://latex.codecogs.com/png.latex?n_j%20%5Ctimes%20n_j"> identity matrix and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BV%7D_j"> is the sampling variance-covariance matrix of the effect size estimates, with entry <img src="https://latex.codecogs.com/png.latex?(h,i)"> equal to <img src="https://latex.codecogs.com/png.latex?%5Cleft%5B%5Cmathbf%7BV%7D_j%5Cright%5D_%7Bh,i%7D%20=%20r_%7Bhij%7D%20%5Csqrt%7BV_%7Bhj%7D%20V_%7Bij%7D%7D">. The estimate of the study-specific average effect size for study <img src="https://latex.codecogs.com/png.latex?j"> is still a weighted average: <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Ctheta_j%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20s_%7Bij%7D%20T_%7Bij%7D%7D%7B%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20s_%7Bij%7D%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%0As_%7Bij%7D%20=%20%5Cdisplaystyle%7B%5Csum_%7Bh=1%7D%5E%7Bn_j%7D%20%5Cleft%5B%5Cboldsymbol%7B%5Chat%5CSigma%7D%5E%7B-1%7D%5Cright%5D_%7Bhi%7D%7D,%0A"> and <img src="https://latex.codecogs.com/png.latex?%5Cleft%5B%5Cboldsymbol%7B%5Chat%5CSigma%7D%5E%7B-1%7D%5Cright%5D_%7Bhi%7D"> denotes entry <img src="https://latex.codecogs.com/png.latex?(h,i)"> in the inverse of the matrix <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Chat%5CSigma%7D">. Let <img src="https://latex.codecogs.com/png.latex?V%5EC_j"> denote the variance of the study-specific average effect size estimate, conditional on the true <img src="https://latex.codecogs.com/png.latex?%5Ctheta_j">: <img src="https://latex.codecogs.com/png.latex?%0AV%5EC_j%20=%20%5Ctext%7BVar%7D(%5Chat%5Ctheta_j%20%7C%20%5Ctheta_j)%20=%20%5Cleft(%5Csum_%7Bi=1%7D%5E%7Bn_j%7D%20s_%7Bij%7D%20%5Cright)%5E%7B-1%7D%0A"> The unconditional variance of <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctheta_j"> is then <img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVar%7D(%5Chat%5Ctheta_j)%20=%20%5Ctau%5E2%20+%20V%5EC_j.%0A"> Because the overall average effect size estimate is (still) the inverse-variance weighted average, the weight assigned at the study level is equal to <img src="https://latex.codecogs.com/png.latex?%0Aw_j%20=%20%5Cfrac%7B1%7D%7B%5Chat%5Ctau%5E2%20+%20V%5EC_j%7D%0A"> and the weight assigned to individual effect sizes is <img src="https://latex.codecogs.com/png.latex?%0Aw_%7Bij%7D%20=%20%5Cfrac%7Bs_%7Bij%7D%20V%5EC_j%7D%7B%5Chat%5Ctau%5E2%20+%20V%5EC_j%7D.%0A"> How do <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> affect these more general weights? The intuitions that I described earlier still mostly hold. Increasing <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> will tend to equalize the weights at the effect size level (i.e., equalize the <img src="https://latex.codecogs.com/png.latex?s_%7Bij%7D"> across <img src="https://latex.codecogs.com/png.latex?i"> and <img src="https://latex.codecogs.com/png.latex?j">), pulling weight towards studies with more effect size estimates. Increasing <img src="https://latex.codecogs.com/png.latex?%5Ctau%5E2"> will tend to equalize the weights at the study-level.</p>
<p>One wrinkle with the more general form of the weights is that the effect-size level weights can sometimes be <em>negative</em> (i.e., negative <img src="https://latex.codecogs.com/png.latex?s_%7Bij%7D">). This will tend to happen when the sampling variances within a study are discrepant, such as when one <img src="https://latex.codecogs.com/png.latex?V_%7Bij%7D"> is much smaller than the others in study <img src="https://latex.codecogs.com/png.latex?j">, when the (assumed or estimated) sampling correlation is high, and when <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2"> is zero or small. This is something that warrants further investigation.</p>
</section>
<section id="what-about-meta-regression" class="level2" data-number="0.6">
<h2 data-number="0.6" class="anchored" data-anchor-id="what-about-meta-regression"><span class="header-section-number">0.6</span> What about meta-regression?</h2>
<p>Some of the foregoing analysis also applies to models that include predictors. In particular, the formulas I’ve given for the weights will still hold for meta-regression models <strong><em>that include only study-level predictors</em></strong>. In other words, they work for models of the following form: <img src="https://latex.codecogs.com/png.latex?%0AT_%7Bij%7D%20=%20%5Cmathbf%7Bx%7D_j%20%5Cboldsymbol%5Cbeta%20+%20%5Ceta_j%20+%20%5Cnu_%7Bij%7D%20+%20e_%7Bij%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D_j"> is a row-vector of one or more predictors for study <img src="https://latex.codecogs.com/png.latex?j"> (including a constant intercept). Introducing these predictors will alter the variance component estimates <img src="https://latex.codecogs.com/png.latex?%5Chat%5Ctau%5E2"> and <img src="https://latex.codecogs.com/png.latex?%5Chat%5Comega%5E2">, but the form of the weights will remain the same as above, and the intuitions still hold. This is because, for purposes of estimating <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cbeta">, the model is essentially the same as a meta-regression at the study level, using the study-specific average effect size estimates as input: <img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Ctheta_j%20=%20%5Cmathbf%7Bx%7D_j%20%5Cboldsymbol%5Cbeta%20+%20%5Ceta_j%20+%20%5Ctilde%7Be%7D_j%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(%5Ctilde%7Be%7D_j)%20=%20%5Ctext%7BVar%7D(%5Chat%5Ctheta_j%20%7C%20%5Ctheta_j)">.<sup>3</sup></p>
<p>Here is an illustration with the <code>corrdat</code> meta-analysis. In these data, the variable <code>college</code> indicates whether the effect size comes from a college-age sample; it varies only at the study level. The variable <code>males</code>, <code>binge</code>, and <code>followup</code> have some within-study variation, which I’ll by taking the average of each of these predictors at the study level:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">corrdat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb14-2">  corrdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(studyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb14-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">males_M =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(males),</span>
<span id="cb14-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binge_M =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(binge),</span>
<span id="cb14-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">followup_M =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(followup)</span>
<span id="cb14-8">  )</span></code></pre></div>
</details>
</div>
<p>Now let’s fit a meta-regression model using all of the study-level predictors:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">MVMR_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma.mv</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> effectsize, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V =</span> V_mat,</span>
<span id="cb15-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mods =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> college <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> males_M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> binge_M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> followup_M,  </span>
<span id="cb15-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">random =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> studyid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> esid,</span>
<span id="cb15-4">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> corrdat)</span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(MVMR_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Multivariate Meta-Analysis Model (k = 171; method: REML)

  logLik  Deviance       AIC       BIC      AICc   
-86.6244  173.2488  187.2488  209.0327  187.9577   

Variance Components:

            estim    sqrt  nlvls  fixed        factor 
sigma^2.1  0.0297  0.1723     39     no       studyid 
sigma^2.2  0.1068  0.3268    171     no  studyid/esid 

Test for Residual Heterogeneity:
QE(df = 166) = 1083.6655, p-val &lt; .0001

Test of Moderators (coefficients 2:5):
QM(df = 4) = 13.0787, p-val = 0.0109

Model Results:

            estimate      se     zval    pval    ci.lb    ci.ub    
intrcpt      -0.0361  0.3678  -0.0982  0.9218  -0.7571   0.6849    
college       0.2660  0.1384   1.9215  0.0547  -0.0053   0.5373  . 
males_M       0.0023  0.0048   0.4753  0.6346  -0.0072   0.0118    
binge_M       0.3441  0.1570   2.1927  0.0283   0.0365   0.6518  * 
followup_M   -0.0023  0.0011  -2.0379  0.0416  -0.0044  -0.0001  * 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>As you might expect, between-study heterogeneity is reduced a bit by the inclusion of these predictors.<sup>4</sup></p>
<p>We can check my claim of computational equivalence by fitting the meta-regression model at the study level. Here I’ll aggregate everything up to the study level and compute the study-level weights:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">tau_sq_reg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MVMR_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb17-2">omega_sq_reg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MVMR_fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb17-3"></span>
<span id="cb17-4">corrdat_studylevel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb17-5">  corrdat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(studyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_j =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(effectsize, n_j, V_bar, college, binge_M, followup_M, males_M), mean</span>
<span id="cb17-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb17-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">V_cond =</span> (omega_sq_reg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (n_j <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> V_bar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V_bar) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_j,</span>
<span id="cb17-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w_j =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (tau_sq_reg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> V_cond)</span>
<span id="cb17-13">  )</span></code></pre></div>
</details>
</div>
<p>Now I can fit a study-level meta-regression model. I use the <code>weights</code> argument to ensure that the meta-regression is estimated using the <img src="https://latex.codecogs.com/png.latex?w_j"> weights:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">MR_study_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yi =</span> effectsize, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vi =</span> V_cond, </span>
<span id="cb18-2">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mods =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> college <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> males_M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> binge_M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> followup_M, </span>
<span id="cb18-3">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> w_j, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> corrdat_studylevel)</span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(MR_study_fit)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Mixed-Effects Model (k = 39; tau^2 estimator: REML)

  logLik  deviance       AIC       BIC      AICc   
-13.0651   26.1303   38.1303   47.2884   41.2414   

tau^2 (estimated amount of residual heterogeneity):     0.0297 (SE = 0.0264)
tau (square root of estimated tau^2 value):             0.1723
I^2 (residual heterogeneity / unaccounted variability): 26.89%
H^2 (unaccounted variability / sampling variability):   1.37
R^2 (amount of heterogeneity accounted for):            37.90%

Test for Residual Heterogeneity:
QE(df = 34) = 46.5050, p-val = 0.0748

Test of Moderators (coefficients 2:5):
QM(df = 4) = 13.0787, p-val = 0.0109

Model Results:

            estimate      se     zval    pval    ci.lb    ci.ub    
intrcpt      -0.0361  0.3678  -0.0982  0.9218  -0.7571   0.6849    
college       0.2660  0.1384   1.9215  0.0547  -0.0053   0.5373  . 
males_M       0.0023  0.0048   0.4753  0.6346  -0.0072   0.0118    
binge_M       0.3441  0.1570   2.1927  0.0283   0.0365   0.6518  * 
followup_M   -0.0023  0.0011  -2.0379  0.0416  -0.0044  -0.0001  * 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The meta-regression coefficient estimates are essentially identical to those from the multi-variate meta-regression, although the between-study heterogeneity estimate differs slightly because it is based on maximizing the single-level model, conditional on an estimate of <img src="https://latex.codecogs.com/png.latex?%5Comega%5E2">.</p>
</section>
<section id="and-beyond" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> And beyond!</h1>
<p>In true multi-variate models, the meta-regression specification would typically include indicators for each dimension of the model. More generally, we might have a model that includes predictors varying within study, encoding characteristics of the outcome measures, sub-groups, or treatment conditions corresponding to each effect size estimate. The weights in these model get substantially more complicated, not in the least because the weights <em>are specific to the predictors</em>. For instance, in a model with four within-study predictors, a different set of weights is used in estimating the coefficients corresponding to each predictor. As Dr.&nbsp;<a href="https://twitter.com/Richard_D_Riley">Richard Riley</a> noted on Twitter, relevant work on more complicated models includes <a href="https://doi.org/10.1177/0962280215611702">this great paper by Dan Jackson and colleagues</a> and <a href="https://doi.org/10.1177/0962280216688033">this paper by Riley and colleagues</a>. The latter paper demonstrates how multivariate models entail partial “borrowing of strength” across dimensions of the effect sizes, which is very helpful for building intuition about how these models work. I would encourage you to check out both papers if you are grappling with understanding how weights work in complex meta-regression models.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note that this model also encompasses the multi-level meta-analysis described by <a href="https://doi.org/10.1002/jrsm.35">Konstantopoulos (2011)</a> and <a href="https://doi.org/10.3758/s13428-012-0261-6">Van den Noortgate, et al.&nbsp;(2013)</a> as a special case, with <img src="https://latex.codecogs.com/png.latex?r_%7Bhij%7D%20=%200"> for all <img src="https://latex.codecogs.com/png.latex?h,i=1,...,n_j"> and <img src="https://latex.codecogs.com/png.latex?j%20=%201,...,k">.↩︎</p></li>
<li id="fn2"><p>Perhaps that makes sense, if you’ve carefully selected the set of effect sizes for inclusion in your meta-analysis. However, it seems to me that it could sometimes lead to perverse results. Say that all studies but one include just a single effect size estimate, each using the absolute gold standard approach to assessing the outcome, but that one study took a “kitchen sink” approach and assessed the outcome a bunch of different ways, including the gold standard plus a bunch of junky scales. Inclusion of the junky scales will lead to within-study heterogeneity, which in turn will <em>pull the overall average effect size towards this study—the one with all the junk!</em> That seems less than ideal, and the sort of situation where it would be better to select from the study with multiple outcomes the single effect size estimate based on the outcome assessment that most closely aligns with the other studies.↩︎</p></li>
<li id="fn3"><p>Things get even simpler if the model does not include within-study random effects, as I discussed in <a href="../..\sometimes-aggregating-effect-sizes-is-fine/">a previous post</a>.↩︎</p></li>
<li id="fn4"><p>However, this need not be the case—it’s possible that introducing between-study predictors could <em>increase</em> the estimate of between-study heterogeneity. Yes, that’s totally counter-intuitive. Multi-level models can be weird.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {Weighting in Multivariate Meta-Analysis},
  date = {2020-06-09},
  url = {https://jepusto.com/posts/weighting-in-multivariate-meta-analysis},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2020. <span>“Weighting in Multivariate
Meta-Analysis.”</span> June 9, 2020. <a href="https://jepusto.com/posts/weighting-in-multivariate-meta-analysis">https://jepusto.com/posts/weighting-in-multivariate-meta-analysis</a>.
</div></div></section></div> ]]></description>
  <category>meta-analysis</category>
  <category>weighting</category>
  <guid>https://jepusto.com/posts/weighting-in-multivariate-meta-analysis/</guid>
  <pubDate>Tue, 09 Jun 2020 05:00:00 GMT</pubDate>
</item>
<item>
  <title>An update on code folding with blogdown + Academic theme</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/code-folding-update/</link>
  <description><![CDATA[ 





<p><strong>UPDATED November 21, 2020</strong>. <em>Thanks to Allen O’Brien for pointing out a bug in the codefolding code, which led to the last code chunk defaulting to hidden rather than open. Allen sent along a simple fix to the <a href="https://github.com/jepusto/jepusto.com/blob/master/static/js/codefolding.js"><code>codefolding.js</code></a> file.</em></p>
<p>About a year ago I added a code-folding feature to my site, following an approach developed by <a href="https://statnmap.com/2017-11-13-enable-code-folding-in-bookdown-and-blogdown/">Sébastien Rochette</a>. I recently updated my site to work with the latest version of the <a href="https://sourcethemes.com/academic/">Academic theme</a> for Hugo, and it turns out that this broke <a href="../..\code-folding-with-blogdown-academic/">my code-folding implementation</a>. It took a bit of putzing and some help from a freelance web developer to fix it, but it’s now working again, and I’m again doing my happy robot dance:</p>
<p><img src="https://media.giphy.com/media/mIZ9rPeMKefm0/giphy.gif" class="img-fluid"></p>
<p>In this post, I’ll provide instructions on how to reproduce the approach with the current version of the Academic theme, which is <a href="https://sourcethemes.com/academic/updates/v4.8.0/">4.8 (March 2020)</a>. Credit where credit is due:</p>
<ul>
<li>Sébastien Rochette worked out <a href="https://statnmap.com/2017-11-13-enable-code-folding-in-bookdown-and-blogdown/">the earlier implementation</a>.</li>
<li>Web developer <a href="https://upwork.com/freelancers/~01328c0a21498eac2a">Max B.</a> worked out the kinks to get it working with the latest version of Academic. We connected through Upwork. Hire him there if you have web dev work!</li>
<li>As I’ve said before, I couldn’t write javascript to save my life, and my only contribution here is to write down the instructions.</li>
</ul>
<section id="code-folding-with-the-academic-theme" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="code-folding-with-the-academic-theme"><span class="header-section-number">1</span> Code folding with the Academic theme</h2>
<ol type="1">
<li><p>You’ll first need to add the codefolding javascript assets. Create a folder called <code>js</code> under the <code>/static</code> directory of your site. Add the file <a href="https://github.com/jepusto/jepusto.com/blob/master/static/js/codefolding.js"><code>codefolding.js</code></a>.</p></li>
<li><p>Create a folder called <code>css</code> under the <code>/static</code> directory of your site. Add the file <a href="https://github.com/jepusto/jepusto.com/blob/master/static/css/codefolding.css"><code>codefolding.css</code></a>. This is the css for the buttons that will appear on your posts.</p></li>
<li><p>Add the file <a href="https://github.com/jepusto/jepusto.com/blob/master/layouts/partials/article_footer_js.html"><code>article_footer_js.html</code></a> to the <code>/layouts/partials</code> directory of your site.</p></li>
<li><p>Add the file <a href="https://github.com/jepusto/jepusto.com/blob/master/layouts/partials/header_maincodefolding.html"><code>header_maincodefolding.html</code></a> to the <code>/layouts/partials</code> directory of your site.</p></li>
<li><p>If you do not already have a file <code>head_custom.html</code> in the <code>/layouts/partials</code> directory, create it. Add the following lines of code to the file:</p>
<p>::: {.cell}</p>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb1-1">{{ <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> not site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Params</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">disable_codefolding</span> }}</span>
<span id="cb1-2">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script src<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;/</span>script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-3">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link rel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> href<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{{ "</span>css<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>codefolding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">css</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | relURL }}"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/&gt;</span></span>
<span id="cb1-4">{{ end }}</span></code></pre></div>
</details>
<p>:::</p></li>
<li><p>If you do not already have a file <code>site_footer.html</code> in the <code>/layouts/partials</code> directory, copy it over from <code>/themes/hugo-academic/layouts/partials</code>. Add the following lines of code to it, somewhere towards the bottom (see <a href="https://github.com/jepusto/jepusto.com/blob/master/layouts/partials/site_footer.html">my version</a> for example):</p>
<p>::: {.cell}</p>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;!--</span> Init code folding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--&gt;</span></span>
<span id="cb2-2">{{ partial <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"article_footer_js.html"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> }}</span></code></pre></div>
</details>
<p>:::</p></li>
<li><p>If you do not already have the file <code>page_header.html</code> in the <code>/layouts/partials</code> directory, copy it over from <code>/themes/hugo-academic/layouts/partials</code>. Add the following line of code at appropriate points so that your posts will include the “Show/hide code” button:</p>
<p>::: {.cell}</p>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"> {{ partial <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header_maincodefolding"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> }}</span></code></pre></div>
</details>
<p>:::</p>
<p>Note that you’ll likely need to add it twice due do conditionals in <code>page_header.html</code>. For example, <a href="https://github.com/jepusto/jepusto.com/blob/master/layouts/partials/page_header.html">my version of the file</a> includes the partial at lines 62 and 91.</p></li>
<li><p>Modify your <code>params.toml</code> file (in the directory <code>/config/_default</code>) to include the following lines:</p>
<p>::: {.cell}</p>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">############################</span></span>
<span id="cb4-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Code folding</span></span>
<span id="cb4-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">############################</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set to true to disable code folding</span></span>
<span id="cb4-6">disable_codefolding <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> false</span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set to "hide" or "show" all codes by default</span></span>
<span id="cb4-8">codefolding_show <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"show"</span></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set to true to exclude the "Show/hide all" button</span></span>
<span id="cb4-10">codefolding_nobutton <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> false</span></code></pre></div>
</details>
<p>:::</p></li>
</ol>
</section>
<section id="using-the-codefolding-parameters" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="using-the-codefolding-parameters"><span class="header-section-number">2</span> Using the codefolding parameters</h2>
<p>The <code>params.toml</code> file now has three parameters that control code folding:</p>
<ul>
<li><code>disable_codefolding</code> controls whether to load the code folding scripts on your site. Set it to <code>true</code> to disable code folding globally.</li>
<li><code>codefolding_show</code> controls whether code blocks will be shown or hidden by default. If your previous posts have lots of code in them, set the default to <code>show</code> to minimize changes in the appearance of your site.</li>
<li><code>codefolding_nobutton</code> controls whether the “Show/hide code” button will appear at the top of posts that include code blocks. Set it to <code>true</code> to disable the button but keep the other code folding functionality.</li>
</ul>
<p>The above parameters are defaults for your entire site. To over-ride the defaults, you can also set the parameters in the YAML header of any post:</p>
<ul>
<li>Set <code>disable_codefolding: true</code> to turn off code folding for the post.</li>
<li>Set <code>codefolding_show: hide</code> to hide the code blocks in the post (as in <a href="../..\package-downloads/">this post</a>).</li>
<li>Set <code>codefolding_nobutton: true</code> to turn off the “Show/hide code” button at the top of the post (as in the present post).</li>
</ul>
<p>I hope these instructions work for you. If not, questions, corrections, and clarifications are welcome. Happy blogging, y’all!</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2020,
  author = {Pustejovsky, James E.},
  title = {An Update on Code Folding with Blogdown + {Academic} Theme},
  date = {2020-05-03},
  url = {https://jepusto.com/posts/code-folding-update},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2020" class="csl-entry quarto-appendix-citeas">
Pustejovsky, James E. 2020. <span>“An Update on Code Folding with
Blogdown + Academic Theme.”</span> May 3, 2020. <a href="https://jepusto.com/posts/code-folding-update">https://jepusto.com/posts/code-folding-update</a>.
</div></div></section></div> ]]></description>
  <category>programming</category>
  <category>Rstats</category>
  <guid>https://jepusto.com/posts/code-folding-update/</guid>
  <pubDate>Sun, 03 May 2020 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Simulating correlated standardized mean differences for meta-analysis</title>
  <dc:creator>James E. Pustejovsky</dc:creator>
  <link>https://jepusto.com/posts/Simulating-correlated-SMDs/</link>
  <description><![CDATA[ 





<p>As I’ve discussed in <a href="../..\Sometimes-aggregating-effect-sizes-is-fine">previous posts</a>, meta-analyses in psychology, education, and other areas often include studies that contribute multiple, statistically dependent effect size estimates. I’m interested in methods for meta-analyzing and meta-regressing effect sizes from data structures like this, and studying this sort of thing often entails conducting Monte Carlo simulations. Monte Carlo simulations involve generating artificial data—in this case, a set of studies, each of which has one or more dependent effect size estimates—that follows a certain distributional model, applying different analytic methods to the artificial data, and then repeating the process a bunch of times. Because we know the true parameters that govern the data-generating process, we can evaluate the performance of the analytic methods in terms of bias, accuracy, hypothesis test calibration and power, confidence interval coverage, and the like.</p>
<p>In this post, I’ll discuss two alternative methods to simulate meta-analytic datasets that include studies with multiple, dependent effect size estimates: simulating individual participant-level data or simulating summary statistics. I’ll focus on the case of the standardized mean difference (SMD) because it is so common in meta-analyses of intervention studies. For simplicity, I’ll assume that the effect sizes all come from simple, two-group comparisons (without any covariate adjustment or anything like that) and that the individual observations are multi-variate normally distributed within each group. Our goal will be to simulate a set of <img src="https://latex.codecogs.com/png.latex?K"> studies, where study <img src="https://latex.codecogs.com/png.latex?k"> is based on measuring <img src="https://latex.codecogs.com/png.latex?J_k"> outcomes on a sample of <img src="https://latex.codecogs.com/png.latex?N_k"> participants, all for <img src="https://latex.codecogs.com/png.latex?k%20=%201,...,K">. Let <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cdelta_k%20=%20(%5Cdelta_%7B1k%7D%20%5Ccdots%20%5Cdelta_%7BJ_k%20k%7D)'"> be the <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%201"> vector of true standardized mean differences for study <img src="https://latex.codecogs.com/png.latex?k">. I’ll assume that we know these true effect size parameters for all <img src="https://latex.codecogs.com/png.latex?K"> studies, so that I can avoid committing to any particular form of random effects model.</p>
<section id="simulating-individual-participant-level-data" class="level1">
<h1>Simulating individual participant-level data</h1>
<p>The most direct way to simulate this sort of effect size data is to generate outcome data for every artificial participant in every artificial study. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BY%7D_%7Bik%7D%5ET"> be the <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%201"> vector of outcomes for treatment group participant <img src="https://latex.codecogs.com/png.latex?i"> in study <img src="https://latex.codecogs.com/png.latex?k">, and let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BY%7D_%7Bik%7D%5EC"> be the <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%201"> vector outcomes for control group participant <img src="https://latex.codecogs.com/png.latex?i"> in study <img src="https://latex.codecogs.com/png.latex?k">, for <img src="https://latex.codecogs.com/png.latex?i=1,...,N_k%20/%202"> and <img src="https://latex.codecogs.com/png.latex?k%20=%201,...,K">. Assuming multi-variate normality of the outcomes, we can generate these outcome vectors as <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7BY%7D_%7Bik%7D%5ET%20%5Csim%20N%5Cleft(%5Cboldsymbol%5Cdelta_k,%20%5Cboldsymbol%5CPsi_k%5Cright)%20%5Cqquad%20%5Ctext%7Band%7D%5Cqquad%20%5Cmathbf%7BY%7D_%7Bik%7D%5EC%20%5Csim%20N%5Cleft(%5Cmathbf%7B0%7D,%20%5Cboldsymbol%5CPsi_k%5Cright),%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5CPsi_k"> is the population correlation matrix of the outcomes in study <img src="https://latex.codecogs.com/png.latex?k">. Note that I am setting the mean outcomes of the control group participants to zero and also specifying that the outcomes all have unit variance within each group. After simulating data based on these distributions, the effect size estimates for each outcome can be calculated directly, following standard formulas.</p>
<p>Here’s what this approach looks like in code. It is helpful to simplify things by focusing on simulating just a single study with multiple, correlated effect sizes. Focusing first on just the input parameters, a function might look like the following:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">r_SMDs_raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(delta, J, N, Psi) {</span>
<span id="cb1-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># stuff</span></span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(ES_data)  </span>
<span id="cb1-4">}</span></code></pre></div>
</details>
</div>
<p>In the above function skeleton, <code>delta</code> would be the true effect size parameter <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cdelta_k">, <code>J</code> would be the number of effect sizes to generate <img src="https://latex.codecogs.com/png.latex?(J_k)">, <code>N</code> is the total number of participants <img src="https://latex.codecogs.com/png.latex?(N_k)">, and <code>Psi</code> is a matrix of correlations between the outcomes <img src="https://latex.codecogs.com/png.latex?(%5CPsi_k)">. From these parameters, we’ll generate raw data, calculate effect size estimates and standard errors, and return the results in a little dataset.</p>
<p>To make the function a little bit easier to use, I’m going overload the <code>Psi</code> argument so that it can be a single number, indicating a common correlation between the outcomes. Thus, instead of having to feed in a <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%20J_k"> matrix, you can specify a single correlation <img src="https://latex.codecogs.com/png.latex?r_k">, and the function will assume that all of the outcomes are equicorrelated. In code, the logic is:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.matrix</span>(Psi)) Psi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Psi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Psi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> J)</span></code></pre></div>
</details>
</div>
<p>Here’s the function with the innards:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">r_SMDs_raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(delta, J, N, Psi) {</span>
<span id="cb3-2"></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(mvtnorm) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for simulating multi-variate normal data</span></span>
<span id="cb3-4">  </span>
<span id="cb3-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create Psi matrix assuming equicorrelation</span></span>
<span id="cb3-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.matrix</span>(Psi)) Psi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Psi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Psi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> J)</span>
<span id="cb3-7">  </span>
<span id="cb3-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate control group summary statistics</span></span>
<span id="cb3-9">  Y_C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmvnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, J), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> Psi)</span>
<span id="cb3-10">  ybar_C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(Y_C)</span>
<span id="cb3-11">  sd_C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Y_C, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sd)</span>
<span id="cb3-12">  </span>
<span id="cb3-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate treatment group summary statistics</span></span>
<span id="cb3-14">  delta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(delta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> J)</span>
<span id="cb3-15">  Y_T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rmvnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> delta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> Psi)</span>
<span id="cb3-16">  ybar_T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colMeans</span>(Y_T)</span>
<span id="cb3-17">  sd_T <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(Y_T, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, sd)</span>
<span id="cb3-18"></span>
<span id="cb3-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate Cohen's d</span></span>
<span id="cb3-20">  sd_pool <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((sd_C<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sd_T<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-21">  ES <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (ybar_T <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ybar_C) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sd_pool</span>
<span id="cb3-22">  </span>
<span id="cb3-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># calculate SE of d</span></span>
<span id="cb3-24">  SE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ES<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb3-25"></span>
<span id="cb3-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ES =</span> ES, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">SE =</span> SE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> N)</span>
<span id="cb3-27"></span>
<span id="cb3-28">}</span></code></pre></div>
</details>
</div>
<p>In action:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">delta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r_SMDs_raw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> delta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">J =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Psi =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         ES        SE  N
1 0.4013354 0.3195612 40
2 0.3678654 0.3190307 40
3 0.3548671 0.3188369 40
4 0.2310348 0.3173363 40</code></pre>
</div>
</div>
<p>Or if you’d rather specify the full <img src="https://latex.codecogs.com/png.latex?%5CPsi_k"> matrix yourself:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">Psi_k <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb7-2">Psi_k</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  1.0  0.6  0.6  0.6
[2,]  0.6  1.0  0.6  0.6
[3,]  0.6  0.6  1.0  0.6
[4,]  0.6  0.6  0.6  1.0</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r_SMDs_raw</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> delta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">J =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Psi =</span> Psi_k)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           ES        SE  N
1  0.11468537 0.3165013 40
2 -0.41626629 0.3198124 40
3 -0.05569958 0.3162923 40
4 -0.08697579 0.3163851 40</code></pre>
</div>
</div>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>The function above is serviceable but quite basic. I can think of several additional features that one might like to have for use in research simulations, but I’m feeling both cheeky and lazy at the moment, so I’ll leave them for you, dear reader. Here are some suggested exercises:</p>
<ol type="1">
<li><p>Add an argument to the function, <code>Hedges_g = TRUE</code>, which controls where the simulated effect size is Hedges’ <img src="https://latex.codecogs.com/png.latex?g"> or Cohen’s <img src="https://latex.codecogs.com/png.latex?d">. If it is Hedges’ g, make sure that the standard error is corrected too.</p></li>
<li><p>Add an argument to the function, <code>p_val = TRUE</code>, which allows the user to control whether or not to return <img src="https://latex.codecogs.com/png.latex?p">-values from the test of mean differences for each outcome. Note that the p-values should be for a test of the <em>raw</em> mean differences between groups, rather than a test of the effect size <img src="https://latex.codecogs.com/png.latex?%5Cdelta_%7Bjk%7D%20=%200">.</p></li>
<li><p>Add an argument to the function, <code>corr_mat = FALSE</code>, which controls whether the function returns just the simulated effect sizes and SEs or both the simulated effect sizes and the full sampling variance-covariance matrix of the effect sizes. See <a href="../..\correlations-between-SMDs">here</a> for the relevant formulas.</p></li>
</ol>
</section>
</section>
<section id="simulating-summary-statistics" class="level1">
<h1>Simulating summary statistics</h1>
<p>Another approach to simulating SMDs is to sample from the distribution of the <em>summary statistics</em> used in calculating the effect size. This approach should simplify the code, at the cost of having to use a bit of distribution theory. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BTk%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BCk%7D"> be the <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%201"> vectors of sample means for the treatment and control groups, respectively. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BS%7D_k"> be the <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%20J_k"> sample covariance matrix of the outcomes, pooled across the treatment and control groups. Again assuming multi-variate normality, and following the same notation as above: <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BCk%7D%20%5Csim%20N%5Cleft(%5Cmathbf%7B0%7D,%20%5Cfrac%7B2%7D%7BN_k%7D%20%5Cboldsymbol%5CPsi_k%5Cright),%20%5Cqquad%20%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BTk%7D%20%5Csim%20N%5Cleft(%5Cboldsymbol%5Cdelta_k,%20%5Cfrac%7B2%7D%7BN_k%7D%20%5Cboldsymbol%5CPsi_k%5Cright),%0A"> and <img src="https://latex.codecogs.com/png.latex?%0A%5Cleft(%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BTk%7D%20-%20%5Cmathbf%7B%5Cbar%7By%7D%7D_%7BCk%7D%5Cright)%20%5Csim%20N%5Cleft(%5Cboldsymbol%5Cdelta_k,%20%5Cfrac%7B4%7D%7BN_k%7D%20%5Cboldsymbol%5CPsi_k%5Cright).%0A"> This shows how we could directly simulate the numerator of the standardized mean difference.</p>
<p>A <a href="../..\distribution-of-sample-variances">further bit of distribution theory</a> says that the pooled sample covariance matrix follows a multiple of a <a href="https://en.wikipedia.org/wiki/Wishart_distribution">Wishart distribution</a> with <img src="https://latex.codecogs.com/png.latex?N_k%20-%202"> degrees of freedom and scale matrix <img src="https://latex.codecogs.com/png.latex?%5CPsi_k">: <img src="https://latex.codecogs.com/png.latex?%0A(N_k%20-%202)%20%5Cmathbf%7BS%7D_k%20%5Csim%20Wishart%5Cleft(N_k%20-%202,%20%5CPsi_k%20%5Cright).%0A"> Thus, to simulate the denominators of the SMD estimates, we can simulate a single Wishart matrix, pull out the diagonal entries, divide by <img src="https://latex.codecogs.com/png.latex?N_k%20-%202">, and take the square root. In all, we draw a single <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%201"> observation from a multi-variate normal distribution and a single <img src="https://latex.codecogs.com/png.latex?J_k%20%5Ctimes%20J_k"> observation from a Wishart distribution. In contrast, the raw data approach requires simulating <img src="https://latex.codecogs.com/png.latex?N_k"> observations from a multi-variate normal distribution, then calculating <img src="https://latex.codecogs.com/png.latex?4%20J_k"> summary statistics (M and SD for each group on each outcome).</p>
<section id="exercises-1" class="level2">
<h2 class="anchored" data-anchor-id="exercises-1">Exercises</h2>
<p>Once again, I’ll leave it to you, dear reader, to do the fun programming bits:</p>
<ol start="4" type="1">
<li>Create a modified version of the function <code>r_SMDs_raw</code> that simulates summary statistics instead of raw data (Call it <code>r_SMDs_stats</code>).</li>
<li>Use the <code>microbenchmark</code> package (or your preferred benchmarking tool) to compare the computational efficiency of both versions of the function.</li>
<li>Check your work! Verify that both versions of the function generate the same distributions if the same parameters are used as input.</li>
</ol>
</section>
</section>
<section id="which-approach-is-better" class="level1">
<h1>Which approach is better?</h1>
<p>Like many things in research, there’s no clearly superior method here. The advantage of the summary statistics approach is computational efficiency. It should generally be faster than the raw data approach, and if you need to generate 10,000 meta-analysis each with 80 studies in them, the computational savings might add up. On the other hand, computational efficiency isn’t everything.</p>
<p>I see two potential advantages of the raw data approach. First is interpretability: simulating raw data is likely easier to understand. It feels tangible and familiar, harkening back to those bygone days we spent learning ANOVA, whereas the summary statistics approach requires a bit of distribution theory to follow (bookmark this blog post!). Second is extensibility: it is relatively straightforward to extend the approach to use other distributional models for the raw dat (perhaps you want to look at outcomes that follow a <a href="https://en.wikipedia.org/wiki/Multivariate_t-distribution">multi-variate <img src="https://latex.codecogs.com/png.latex?t"> distribution</a>?) or more complicated estimators of the SMD (difference-in-differences? covariate-adjusted? cluster-randomized trial?). To use the summary statistics approach in more complicated scenarios, you’d have to work out the sampling distributions for yourself, or locate the right reference.</p>
<p>Of course, there’s also no need to choose between these two approaches. As I’m trying to hint at in Exercise 6, it’s actually useful to write both. Then, you can use the (potentially slower) raw data version to verify that the summary statistics version is correct.</p>
</section>
<section id="simulating-full-meta-analyses" class="level1">
<h1>Simulating full meta-analyses</h1>
<p>So far we’ve got a data-generating function that simulates a single study’s worth of effect size estimates. To study meta-analytic methods, we’ll need to build out the function to simulate multiple studies. To do so, I think it’s useful to use the technique of <a href="https://r4ds.had.co.nz/iteration.html">mapping</a>, as implemented in the <code>purrr</code> package’s <code>map_*</code> functions. The idea here is to first generate a “menu” of study-specific parameters for each of <img src="https://latex.codecogs.com/png.latex?K"> studies, then apply the <code>r_SMDs</code> function to each parameter set.</p>
<p>Let’s consider how to do this for a simple random effects model, where the true effect size parameter is constant within each study (i.e., <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cdelta_k%20=%20(%5Cdelta_k%20%5Ccdots%20%5Cdelta_k)'">), and in a model without covariates. We’ll need to generate a true effect for each study, along with a sample size, an outcome dimension, and a correlation between outcomes. For the true effects, I’ll assume that <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_k%20%5Csim%20N(%5Cmu,%20%5Ctau%5E2),%0A"> <img src="https://latex.codecogs.com/png.latex?%0AJ_k%20%5Csim%202%20+%20Poisson(3),%0A"> <img src="https://latex.codecogs.com/png.latex?%0AN_k%20%5Csim%2020%20+%202%20%5Ctimes%20Poisson(10),%0A"> and <img src="https://latex.codecogs.com/png.latex?%0Ar_k%20%5Csim%20Beta%5Cleft(%5Crho%20%5Cnu,%20(1%20-%20%5Crho)%5Cnu%5Cright),%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Crho%20=%20%5Ctext%7BE%7D(r_k)"> and <img src="https://latex.codecogs.com/png.latex?%5Cnu%20%3E%200"> controls the variability of <img src="https://latex.codecogs.com/png.latex?r_k"> across studies, with smaller <img src="https://latex.codecogs.com/png.latex?%5Cnu"> corresponding to more variable correlations. Specifically, <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BVar%7D(r_k)%20=%20%5Crho%20(1%20-%20%5Crho)%20/%20(1%20+%20%5Cnu)">. These distributions are just made up, without any particular justification.</p>
<p>Here’s what these distributional models look like in R code:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb11-2">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb11-3">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb11-4">J_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb11-5">N_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span></span>
<span id="cb11-6">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb11-7">nu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span></span>
<span id="cb11-8"></span>
<span id="cb11-9">study_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb11-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> tau),</span>
<span id="cb11-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">J =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(K, J_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb11-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(K, (N_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb11-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Psi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(K, rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> nu, (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> nu)</span>
<span id="cb11-15">  )</span>
<span id="cb11-16"></span>
<span id="cb11-17">study_data</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      delta J  N       Psi
1 0.1894457 7 32 0.7549766
2 0.1964491 4 36 0.6275585
3 0.2161156 4 48 0.5009596
4 0.2206781 7 56 0.5841191
5 0.1831423 5 46 0.7166385
6 0.2775416 7 48 0.5401121</code></pre>
</div>
</div>
<p>Once we have the “menu” of study-level characteristics, it’s just a matter of mapping the parameters to the data-generating function. One way to do this is with <code>pmap_df</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb13-2">meta_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_df</span>(study_data, r_SMDs_raw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"study"</span>)</span>
<span id="cb13-3">meta_data</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   study          ES        SE  N
1      1  0.47285752 0.3587849 32
2      1  0.65783522 0.3636103 32
3      1  0.57657128 0.3613040 32
4      1  0.68218028 0.3643572 32
5      1  0.46669617 0.3586504 32
6      1  0.70849614 0.3651933 32
7      1  0.84616428 0.3700449 32
8      2 -0.08674375 0.3334993 36
9      2  0.31344971 0.3354936 36
10     2  0.04778159 0.3333837 36
11     2  0.11810127 0.3336409 36
12     3 -0.17311493 0.2892388 48
13     3  0.02853218 0.2886905 48
14     3  0.04031596 0.2887057 48
15     3 -0.07183585 0.2887723 48
16     4  0.51047582 0.2717377 56
17     4  0.58239287 0.2730735 56
18     4  0.64002355 0.2742653 56
19     4  0.26974012 0.2685187 56
20     4  0.39571123 0.2699601 56
21     4  0.41572636 0.2702385 56
22     4  0.62513604 0.2739472 56
23     5  0.05925185 0.2949516 46
24     5  0.35510948 0.2973037 46
25     5  0.09237341 0.2950483 46
26     5  0.17188695 0.2954526 46
27     5  0.34924860 0.2972248 46
28     6  0.44744536 0.2924201 48
29     6  0.49049630 0.2931696 48
30     6  0.63335706 0.2961310 48
31     6  0.61458119 0.2957007 48
32     6  0.75247981 0.2991454 48
33     6  0.77571983 0.2997899 48
34     6  0.81747976 0.3009936 48</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">table</span>(meta_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>study)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 4 5 6 
7 4 4 7 5 7 </code></pre>
</div>
</div>
<p>Putting it all together into a function, we have</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">r_meta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(K, mu, tau, J_mean, N_mean, rho, nu) {</span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">require</span>(purrr)</span>
<span id="cb17-3">  </span>
<span id="cb17-4">  study_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb17-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb17-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> tau),</span>
<span id="cb17-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">J =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(K, J_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb17-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rpois</span>(K, (N_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb17-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Psi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(K, rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> nu, (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> nu)</span>
<span id="cb17-10">    )</span>
<span id="cb17-11">  </span>
<span id="cb17-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap_df</span>(study_data, r_SMDs_raw, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"study"</span>)</span>
<span id="cb17-13">}</span></code></pre></div>
</details>
</div>
<section id="exercises-2" class="level2">
<h2 class="anchored" data-anchor-id="exercises-2">Exercises</h2>
<ol start="7" type="1">
<li><p>Modify <code>r_meta</code> so that it uses <code>r_SMDs_stats</code>.</p></li>
<li><p>Add options to <code>r_meta</code> for <code>Hedges_g</code>, <code>p_val = TRUE</code>, and <code>corr_mat = FALSE</code> and ensure that these get passed along to the <code>r_SMDs</code> function.</p></li>
<li><p>One way to check that the <code>r_meta</code> function is working properly is to generate a very large meta-analytic dataset, then to verify that the generated distributions align with expectations. Here’s a very large meta-analytic dataset:</p>
<p>::: {.cell}</p>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">meta_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">r_meta</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, </span>
<span id="cb18-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">J_mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N_mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, </span>
<span id="cb18-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span>)</span></code></pre></div>
</details>
<p>:::</p>
<p>Compare the distribution of the simulated dataset against what you would expect to get based on the input parameters.</p></li>
<li><p>Modify the <code>r_meta</code> function so that <img src="https://latex.codecogs.com/png.latex?J_k"> and <img src="https://latex.codecogs.com/png.latex?N_k"> are correlated, according to <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0AJ_k%20&amp;%5Csim%202%20+%20Poisson(%5Cmu_J%20-%202)%20%5C%5C%0AN_k%20&amp;%5Csim%2020%20+%202%20%5Ctimes%20Poisson%5Cleft(%5Cfrac%7B1%7D%7B2%7D(%5Cmu_N%20-%2020)%20+%20%5Calpha%20(J_k%20-%20%5Cmu_J)%20%5Cright)%0A%5Cend%7Balign%7D%0A"> for user-specified values of <img src="https://latex.codecogs.com/png.latex?%5Cmu_J"> (the average number of outcomes per study), <img src="https://latex.codecogs.com/png.latex?%5Cmu_N"> (the average total sample size per study), and <img src="https://latex.codecogs.com/png.latex?%5Calpha">, which controls the degree of dependence between <img src="https://latex.codecogs.com/png.latex?J_k"> and <img src="https://latex.codecogs.com/png.latex?N_k">.</p></li>
</ol>
</section>
<section id="a-challenge" class="level2">
<h2 class="anchored" data-anchor-id="a-challenge">A challenge</h2>
<p>The meta-analytic model that we’re using here is quite simple—simplistic, even—and for some simulation studies, something more complex might be needed. For example, we might need to generate data from a model that includes within-study random effects, as in: <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_%7Bjk%7D%20=%20%5Cmu%20+%20u_k%20+%20v_%7Bjk%7D,%20%5Cquad%20%5Ctext%7Bwhere%7D%5Cquad%20u_k%20%5Csim%20N(0,%20%5Ctau%5E2),%20%5Cquad%20v_%7Bjk%7D%20%5Csim%20N(0,%20%5Comega%5E2).%0A"> Even more complex would be to simulate from a multi-level meta-regression model <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_%7Bjk%7D%20=%20%5Cmathbf%7Bx%7D_%7Bjk%7D%20%5Cboldsymbol%5Cbeta%20+%20u_k%20+%20v_%7Bjk%7D,%20%5Cquad%20%5Ctext%7Bwhere%7D%5Cquad%20u_k%20%5Csim%20N(0,%20%5Ctau%5E2),%20%5Cquad%20v_%7Bjk%7D%20%5Csim%20N(0,%20%5Comega%5E2),%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7Bx%7D_%7Bjk%7D"> is a <img src="https://latex.codecogs.com/png.latex?1%20%5Ctimes%20p"> row-vector of covariates describing outcome <img src="https://latex.codecogs.com/png.latex?j"> in study <img src="https://latex.codecogs.com/png.latex?k"> and <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cbeta"> is a <img src="https://latex.codecogs.com/png.latex?p%20%5Ctimes%201"> vector of meta-regression coefficients. In past work, I’ve done this by writing a data-generating function that takes a fixed design matrix <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D%20=%20%5Cleft(%5Cmathbf%7Bx%7D_%7B11%7D'%20%5Ccdots%20%5Cmathbf%7Bx%7D_%7BJ_K%20K%7D'%5Cright)'"> as an input argument, along with <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%5Cbeta">. The design matrix would also include an identifier for each unique study. There are surely better (simpler, easier to follow) ways to implement the multi-level meta-regression model. I’ll once again leave it to you to work out an approach.</p>


<!-- -->

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pustejovsky2019,
  author = {Pustejovsky, James E.},
  title = {Simulating Correlated Standardized Mean Differences for
    Meta-Analysis},
  date = {2019-09-30},
  url = {https://jepusto.com/posts/Simulating-correlated-SMDs},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pustejovsky2019" class="csl-entry quarto-appendix-citeas">
Pustejovsky, J. E. (2019, September 30). <em>Simulating correlated
standardized mean differences for meta-analysis</em>. <a href="https://jepusto.com/posts/Simulating-correlated-SMDs">https://jepusto.com/posts/Simulating-correlated-SMDs</a>
</div></div></section></div> ]]></description>
  <category>effect size</category>
  <category>standardized mean difference</category>
  <category>meta-analysis</category>
  <category>simulation</category>
  <category>programming</category>
  <category>distribution theory</category>
  <guid>https://jepusto.com/posts/Simulating-correlated-SMDs/</guid>
  <pubDate>Mon, 30 Sep 2019 05:00:00 GMT</pubDate>
</item>
</channel>
</rss>
